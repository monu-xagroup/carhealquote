(self.webpackChunkcar_heal_quote=self.webpackChunkcar_heal_quote||[]).push([[113],{22744:(B,P,r)=>{"use strict";r.r(P),r.d(P,{ChqNewCaseModule:()=>pt,MyHammerConfig:()=>W});var _=r(36895),w=r(81390),R=r(9655),O=r(97392),u=r(25852),V=r(56969),T=r(61135),e=r(94650);let A=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,o){},encapsulation:2}),n})();class G extends A{canDeactivate(){return!this.checkDataChanged()}}var y=r(83853),l=r(81364),f=r(12484),b=r(38709),D=r(85567),v=r(42736),F=r(14315),x=r(36978),S=r(54135),I=r(89383);const L=["companyOrg"],k=["licenseId"],ee=["driverPhone"],te=["driverCode"],oe=["orgType"];function ie(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-input",33),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onFormUpdate(i))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("inputModel",t.formModel.claimNumber)}}const ne=function(n){return{hide:n}};function ae(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",34)(1,"div",35)(2,"div",36)(3,"label",10),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"chq-input",37),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onFormUpdate(i))}),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(5,ne,t.isFormConfirmed)),e.xp6(4),e.Oqu(e.lcZ(5,3,"car_owner_details")),e.xp6(2),e.Q6J("inputModel",t.formModel.carOwnerSelector)}}const se=function(n){return{"disable-input disable-controls":n}};function re(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",35)(2,"div",36)(3,"label",10),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"chq-input",38,39),e.NdJ("clicked",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.hideDropdown(i))})("controlOutput",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(8,"chq-input",40,41),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onFormUpdate(i))}),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.isRetailProvider&&t.isFormConfirmed?"car_owner_details":e.lcZ(5,4,"company_details")),e.xp6(2),e.Q6J("inputModel",t.formModel.companyName),e.xp6(2),e.Q6J("ngClass",e.VKq(6,se,"select"===t.formModel.companyName.type))("inputModel",t.formModel.licenseId)}}function ce(n,c){if(1&n&&e._UZ(0,"chq-button",42),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.confirmButtonModel)}}function le(n,c){if(1&n&&e._UZ(0,"chq-button",42),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.nextButtonModel)}}const de=function(n){return{"text-mode":n}};function me(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"chq-step-header",3),e.TgZ(2,"form",4)(3,"div",5)(4,"div",6)(5,"chq-input",7),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA()()(),e.TgZ(6,"div",5)(7,"div",8)(8,"div",9)(9,"label",10),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"chq-input",11,12),e.NdJ("clicked",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.hideDropdown(i))})("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.YNc(14,ie,1,1,"chq-input",13),e.qZA()()(),e.YNc(15,ae,7,7,"div",14),e.YNc(16,re,10,8,"div",15),e.TgZ(17,"div",5)(18,"div",16)(19,"div",17)(20,"label",10),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"div",18)(24,"chq-input",19),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(25,"chq-input",19),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA()()(),e.TgZ(26,"div",20)(27,"div",18)(28,"chq-input",21),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(29,"div",22)(30,"div",18)(31,"chq-input",23,24),e.NdJ("clicked",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.hideDropdown(i))})("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(33,"chq-input",25,26),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA()()()()()()()(),e.TgZ(35,"div",27)(36,"div",28)(37,"div",29),e._UZ(38,"img",30),e.qZA()(),e.TgZ(39,"div",31),e.YNc(40,ce,1,1,"chq-button",32),e.YNc(41,le,1,1,"chq-button",32),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(20,de,t.isFormConfirmed)),e.xp6(1),e.Q6J("chqModel",t.header),e.xp6(4),e.Q6J("inputModel",t.formModel.jobNumber),e.xp6(5),e.Oqu(e.lcZ(11,16,"work_provider_details")),e.xp6(2),e.Q6J("inputModel",t.formModel.companyOrgType),e.xp6(2),e.Q6J("ngIf","Insurance Company"===t.customerFormData.companyOrgType),e.xp6(1),e.Q6J("ngIf",t.isRetailProvider),e.xp6(1),e.Q6J("ngIf",!t.isRetailProvider||t.customerFormData[t.formModel.carOwnerSelector.name]&&"Person"!==t.customerFormData[t.formModel.carOwnerSelector.name]),e.xp6(5),e.Oqu(t.isRetailProvider&&t.isFormConfirmed&&t.customerFormData[t.formModel.carOwnerSelector.name]&&"Person"===t.customerFormData[t.formModel.carOwnerSelector.name]?"car_owner_details":e.lcZ(22,18,"drivers_details")),e.xp6(3),e.Q6J("inputModel",t.formModel.firstName),e.xp6(1),e.Q6J("inputModel",t.formModel.lastName),e.xp6(3),e.Q6J("inputModel",t.formModel.email),e.xp6(3),e.Q6J("inputModel",t.formModel.driverCode),e.xp6(2),e.Q6J("inputModel",t.formModel.driverPhone),e.xp6(7),e.Q6J("ngIf",t.currentCaseStatus),e.xp6(1),e.Q6J("ngIf",t.isFormConfirmed&&!t.commonService.isViewOnly)}}function he(n,c){1&n&&e._UZ(0,"no-access-error")}let U=(()=>{class n extends G{constructor(t,o,i,a,s,d){super(),this.router=t,this.commonService=o,this.monitorService=i,this.caseService=a,this.coreService=s,this.route=d,this.header=y.XJ,this.isApiLoading=!0,this.confirmButtonModel={label:"",type:"primary"},this.nextButtonModel={label:"",type:"primary"},this.isFormConfirmed=!1,this.isRetail=!0,this.customerFormData={jobNumber:"",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",firstName:"",lastName:"",companyId:0,partnershipId:0,customerTypeID:1,driverCode:"",driverPhone:0,carOwnerSelector:"",email:""},this.caseId="0",this.caseObjectId=0,this.showNoAccess=!1,this.commonService.accessRight.closed&&(this.commonService.accessRight=new T.X(!0)),this.commonService.userProfileData.subscribe(m=>{if(m&&m.data){const{organizationDetail:h}=m.data;h&&(this.currentOrgId=h.id,this.countryCode=h.countryCode)}})}checkDataChanged(){return!this.isFormConfirmed&&(this.originalData?this.compareObjects(this.originalData,this.customerFormData):!!this.checkDataDirty())}compareObjects(t,o){const i=Object.keys(t);for(const a in i){const s=i[a];if(t[s]!==o[s])return!0}return!1}get isRetailProvider(){return!!this.customerFormData.companyOrgType&&"Retail"===this.customerFormData.companyOrgType}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0"),this.monitorService.logEvent("ngAfterViewInit",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}get isRetailAndCompanyProvider(){return!!this.customerFormData.companyOrgType&&("Retail"!==this.customerFormData.companyOrgType||"Retail"===this.customerFormData.companyOrgType&&this.customerFormData.carOwnerSelector&&"Person"!==this.customerFormData.carOwnerSelector)}get retail(){return this.customerFormData.companyOrgType?this.formModel.companyOrgType.selectedOption[this.formModel.companyOrgType.displayValue]:""}updateButton(){const t=Object.keys(this.formModel);for(const o in t){const i=t[o];this.formModel[i]={...this.formModel[i],mode:this.isFormConfirmed?"value":"text"}}this.isFormConfirmed=!this.isFormConfirmed,this.confirmButtonModel={...this.confirmButtonModel,label:this.isFormConfirmed?"Change details":"Confirm",type:this.isFormConfirmed?"outline":"primary",icon:this.isFormConfirmed?"gobackward":"check"},this.monitorService.logEvent("updateButton",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}setTextMode(){const t=Object.keys(this.formModel);for(const o in t){const i=t[o];if("companyOrgType"===i){const a={},{displayValue:s,fieldValue:d}=this.formModel[i];a[d]=this.customerFormData[i],a[s]="",a[s]=this.customerFormData[i],this.formModel[i]={...this.formModel[i],mode:"text",selectedOption:a}}else this.formModel[i]={...this.formModel[i],mode:"text"}}this.confirmButtonModel={...this.confirmButtonModel,label:"Change details",type:"outline",icon:"gobackward"},this.monitorService.logEvent("setTextMode",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}confirmData(){if(this.monitorService.logEvent("confirmData",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}]),this.isFormConfirmed)return this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.selectedOption.name="",this.formModel.companyOrgType.observable=this.caseService.getProviders(),setTimeout(()=>{this.orgType.triggerObservable()})),void this.updateButton();this.commonService.showLoading();const t={companyOrgType:this.customerFormData.companyOrgType,caseTypeID:1,customerTypeID:"Retail"===this.customerFormData.companyOrgType?this.customerFormData.customerTypeID:null,domainID:2100,tariffId:this.customerFormData.tariffId,isTariffEditable:this.customerFormData.isTariffEditable,firstName:this.customerFormData.firstName,lastName:this.customerFormData.lastName,countryCode:this.customerFormData.driverCode,mobileNumber:this.customerFormData.driverPhone.toString(),email:this.customerFormData.email,companyId:this.customerFormData.companyId,partnershipId:this.customerFormData.partnershipId,claimNumber:"Insurance Company"===this.customerFormData.companyOrgType?this.customerFormData.claimNumber:"",companyName:this.isRetailAndCompanyProvider?this.customerFormData.companyName:"",companyLicenseNumber:this.isRetailAndCompanyProvider?this.customerFormData.licenseId:""};this.commonService.repairPermission||(t.externalID=this.customerFormData.jobNumber),"0"!=this.caseId?(t.caseId=this.caseObjectId,t.caseGuid=this.caseId,this.caseService.updateCase(t).subscribe({next:o=>{o&&(this.updateButton(),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])),this.commonService.hideLoading()},error:o=>{this.commonService.hideLoading(),this.monitorService.logException(o,V._.Error)}})):this.caseService.saveNewCase(t).subscribe({next:o=>{o&&(this.caseId=o.data.caseGuid,this.commonService.caseId.next(this.caseId),this.caseObjectId=o.data.id,this.header.caseNumber=o.data.caseNumber,this.updateButton(),this.router.navigate([`/quote/case/${this.caseId}`],{replaceUrl:!0}),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])),this.commonService.hideLoading()},error:o=>{this.commonService.hideLoading(),this.monitorService.logException(o,V._.Error)}})}hideDropdown(t){t===this.formModel.companyOrgType.name?(this.driverCode.closeDropdown(),this.companyOrg?.closeDropdown()):t===this.formModel.companyName.name?(this.driverCode.closeDropdown(),this.orgType?.closeDropdown()):(this.orgType?.closeDropdown(),this.companyOrg?.closeDropdown())}onObservableLoad(t){if(this.commonService.hideLoading(),t&&t&&t.length>0){const o=t.filter(a=>a.phoneCountryCode===this.formModel.driverCode.selectedOption?.phoneCountryCode);if(o.length>0){const a=o[0],s=a.regExpression;this.formModel.driverCode={...this.formModel.driverCode,selectedOption:a},this.driverPhone.updateCurrentValidation(s,!0)}const i=this.route.parent?.snapshot.paramMap.get("id");(!i||"0"===i)&&this.setPrefillData(t)}}onFormUpdate(t){if(this.monitorService.logEvent("onFormUpdate",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId,output:t}]),"driverCode"===t.name&&this.driverPhone.updateCurrentValidation(t.value.regExpression),"select"===t.type){const o=this.customerFormData[t.name],i=this.formModel[t.name].fieldValue||this.formModel[t.name].displayValue;if(this.formModel[t.name]?.selectedOption&&this.formModel[t.name]?.selectedOption[i]===t?.value[i])return;this.formModel[t.name]={...this.formModel[t.name],selectedOption:t.value},this.customerFormData[t.name]=t.value[i],"companyOrgType"===t.name&&(o!==this.customerFormData[t.name]&&setTimeout(()=>{this.companyOrg?.setUnTouched(),this.licenseId?.setUnTouched()}),t.value[i]&&"Insurance Company"!==t.value[this.formModel[t.name].displayValue]&&(this.formModel.claimNumber={...this.formModel.claimNumber,value:""}),t.value[i]&&"Retail"!==t.value[this.formModel[t.name].displayValue]?(this.formModel.companyName={...this.formModel.companyName,displayValue:"companyName",fieldValue:"companyName",onObservableLoad:this.updateCaseData.bind(this),placeHolder:"Select...",value:"",type:"select",observable:this.caseService.getCompanyData(t.value[i],"")},this.formModel.companyName.selectedOption&&this.formModel.companyName.selectedOption?.tariffId&&(this.customerFormData.companyId=null,this.customerFormData.companyName=null,this.formModel.companyName.selectedOption={}),this.customerFormData.licenseId="",this.formModel.licenseId={...this.formModel.licenseId,value:""},setTimeout(()=>{o&&"Retail"!==o&&this.currentStatus&&this.companyOrg?.triggerObservable()})):(t.value[i]&&"Retail"===t.value[this.formModel[t.name].displayValue]&&(this.formModel.claimNumber={...this.formModel.claimNumber,value:""},this.formModel.companyName={...this.formModel.companyName,placeHolder:"Company Name"},this.customerFormData.claimNumber="",this.currentStatus&&this.caseService.getCompanyData(t.value[i],"").subscribe({next:a=>{if(a&&a.data?.length>0){const s=a.data[0];this.customerFormData.companyId=s.companyId,this.customerFormData.tariffId=s.tariffId,this.formModel.companyName.selectedOption&&this.formModel.companyName.selectedOption?.tariffId&&(this.customerFormData.licenseId="",this.formModel.licenseId={...this.formModel?.licenseId,value:""}),"Person"===this.customerFormData[this.formModel.carOwnerSelector.name]&&(this.customerFormData.companyName=null,this.formModel.companyName.value=""),this.customerFormData.isTariffEditable=s.isEditable,this.customerFormData.partnershipId=s.partnershipId,this.formModel.companyName.selectedOption=s[0],this.checkForFormValidation()}},error:()=>{this.customerFormData.tariffId=0,this.customerFormData.isTariffEditable=!1}})),this.formModel.companyName={...this.formModel.companyName,type:"text"})),"companyName"===t.name&&t.value&&(this.customerFormData.companyId=t.value.companyId,this.customerFormData.tariffId=t.value.tariffId,this.customerFormData.isTariffEditable=t.value.isEditable,this.customerFormData.licenseId=t.value.licenseId.toString(),this.formModel.licenseId={...this.formModel?.licenseId,value:t.value.licenseId.toString()},this.customerFormData.partnershipId=t.value.partnershipId),this.customerFormData[this.formModel[t.name].idField]=t.value[this.formModel[t.name].displayValue]}else"carOwnerSelector"===t.name&&t.keyFieldValue&&this.formModel[t.name].idField&&(this.customerFormData[this.formModel[t.name].idField]=t.keyFieldValue),t.isValid?(this.formModel[t.name].value=t.value,this.customerFormData[t.name]=t.value):(this.formModel[t.name].value="",this.customerFormData[t.name]="driverPhone"!==t.name?"":0);this.customerFormData={...this.customerFormData},this.checkForFormValidation()}navigateToVehicle(){this.monitorService.logEvent("navigateToVehicle",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])}updateCaseData(t){if(t&&this.customerFormData.companyId&&!this.customerFormData.tariffId){const o=t.filter(i=>i.companyId===this.customerFormData.companyId);o.length>0&&(this.customerFormData.tariffId=o[0].tariffId,this.customerFormData.isTariffEditable=o[0].isEditable,this.formModel.licenseId={...this.formModel?.licenseId,value:o[0].licenseId.toString()},this.customerFormData.partnershipId=o[0].partnershipId,this.formModel.companyName.selectedOption=o[0])}}get currentStatus(){return!this.caseResponse?.status&&!this.isFormConfirmed||-1===["reject","rejected","approved","closed","repairestimation"].indexOf(this.caseResponse?.status?.toLowerCase())&&!this.isFormConfirmed}get currentCaseStatus(){return!this.caseResponse?.status&&this.currentOrgId===this.caseResponse?.organizationDetail?.organizationId||!this.commonService.isViewOnly&&-1===["reject","rejected","approved","closed","repairestimation","complete"].indexOf(this.caseResponse?.status?.toLowerCase())}loadCaseDetails(){const t=Object.keys(this.formModel),o=this.route.parent?.snapshot.paramMap.get("id");if(o&&"0"!=o)this.caseId=o,this.isApiLoading=!0,this.commonService.caseId.next(this.caseId),this.commonService.showLoading(),this.caseService.getCaseDetail(this.caseId).subscribe({next:i=>{this.caseResponse=i.data,this.caseObjectId=this.caseResponse.id,this.commonService.caseStatus.next(this.caseResponse.status),this.caseResponse.inspections.length>0&&this.commonService.inspectionId.next(this.caseResponse.inspections[0].inspectionId),this.commonService.isViewOnly=this.currentOrgId!=this.caseResponse?.organizationDetail?.organizationId,(!this.currentStatus||this.commonService.isViewOnly)&&(this.setTextMode(),this.isFormConfirmed=!0),this.header.caseNumber=this.caseResponse.caseNumber,this.formDataFromResponse=(0,y.Wk)(this.caseResponse),this.customerFormData=(0,y.Qb)(this.formDataFromResponse),this.originalData=JSON.parse(JSON.stringify(this.customerFormData));for(const s in t){const d=this.formModel[t[s]],{type:m,displayValue:h,fieldValue:p}=d;if(this.customerFormData[t[s]])if("select"===m){const g={};g[h]="",g[p]=this.customerFormData[t[s]],!this.currentStatus&&"companyOrgType"===t[s]&&(g[h]=this.customerFormData[t[s]]),this.formModel[t[s]]={...this.formModel[t[s]],value:"",selectedOption:g}}else{let g={};"companyName"===t[s]&&(g={companyName:this.customerFormData[t[s]]}),this.formModel[t[s]]={...this.formModel[t[s]],value:this.customerFormData[t[s]],selectedOption:g}}}this.checkRouteParams(),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()},complete:()=>{this.isApiLoading=!1}});else{this.isApiLoading=!1,this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.observable=this.caseService.getProviders());for(const i in t){const a=t[i];"driverCode"!==a?this.formModel[a]={...this.formModel[a],value:"",selectedOption:{}}:(this.formModel[a]={...this.formModel[a],value:"",selectedOption:{phoneCountryCode:this.countryCode??"+91"}},this.customerFormData.driverCode=this.countryCode??"+91")}}}setPrefillData(t){const o=this.commonService.getSessionStorage("selectedSearchItem");if(o){const i=JSON.parse(o);if(this.formModel.email={...this.formModel.email,value:i.email,selectedOption:{}},this.customerFormData.email=i.email,i.firstName&&(this.customerFormData.firstName=i.firstName,this.formModel.firstName={...this.formModel.firstName,value:this.customerFormData.firstName,selectedOption:{}}),i.lastName&&(this.customerFormData.lastName=i.lastName,this.formModel.lastName={...this.formModel.lastName,value:this.customerFormData.lastName,selectedOption:{}}),i.phoneNumber){const a=i.phoneNumber?.substring(0,3),s=i.phoneNumber?.substring(0,4);let d="",m=t.filter(h=>h.phoneCountryCode===a);if(0===m.length?(d=i.phoneNumber?.substring(4,i.phoneNumber?.length),m=t.filter(h=>h.phoneCountryCode===s)):d=i.phoneNumber?.substring(3,i.phoneNumber?.length),m.length>0){const h=m[0],p=h.regExpression;this.customerFormData.driverCode=h?.phoneCountryCode,this.formModel.driverCode={...this.formModel.driverCode,selectedOption:h},this.driverPhone?.updateCurrentValidation(p,!0)}this.formModel.driverPhone={...this.formModel.driverPhone,value:d,selectedOption:{}},this.customerFormData.driverPhone=parseInt(d)}if(i.email||i.phoneNumber||i.firstName){if(i.make||i.model||i.vin||i.plate)return;this.commonService.setSessionStorage("selectedSearchItem","")}}}checkDataDirty(){return Object.keys(this.customerFormData),this.compareObjects(this.customerFormData,{jobNumber:"",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",firstName:"",lastName:"",companyId:0,partnershipId:0,customerTypeID:1,driverCode:this.countryCode??"+91",driverPhone:0,carOwnerSelector:"",email:""})}checkForFormValidation(){const t=Object.keys(this.customerFormData);let o=[];"Retail"===this.retail?"Person"===this.customerFormData.carOwnerSelector?o=["companyName","claimNumber","licenseId","companyId"]:"Company"===this.customerFormData.carOwnerSelector&&(o=["claimNumber","companyId"]):"Insurance Company"!=this.customerFormData.companyOrgType&&(o=["claimNumber"]),this.commonService.repairPermission&&o.push("jobNumber");let i=!0;for(const a in t){const s=t[a];"carOwnerSelector"===s||"isTariffEditable"===s||-1!==o.indexOf(s)||this.customerFormData[s]||(i=!1)}if(this.isFormConfirmed)this.confirmButtonModel.type="outline";else if(i){if(this.isFormConfirmed)return void(this.confirmButtonModel.type="outline");this.confirmButtonModel.type="primary"}else this.confirmButtonModel.type="disabled";this.monitorService.logEvent("checkForFormValidation",["ChqNewCustomerComponent","addenda-quote",{validationStatus:i?"Form is valid":"Form is invalid"}])}checkRouteParams(){this.route.queryParams.subscribe(t=>{const o=t.isBack;"true"===o||!0===o?(this.isFormConfirmed=!0,this.setTextMode()):this.currentStatus&&(this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.observable=this.caseService.getProviders()))})}ngOnInit(){this.monitorService.logEvent("ngOnInit",["ChqNewCustomerComponent","addenda-quote"]),this.formModel=(0,y.U6)(),this.commonService.repairPermission&&(this.formModel.jobNumber={...this.formModel.jobNumber,disabled:!0,validation:null}),this.confirmButtonModel={label:"Confirm",type:"primary",icon:"check",onclick:this.confirmData.bind(this)},this.nextButtonModel={label:"Next add vehicle",type:"primary",icon:"plus-filled",onclick:this.navigateToVehicle.bind(this)},this.formModel.driverCode.observable||(this.formModel.driverCode.observable=this.coreService.getPhoneNumber(),this.formModel.driverCode.onObservableLoad=this.onObservableLoad.bind(this)),this.header.caseNumber="",this.checkForFormValidation(),this.loadCaseDetails(),this.commonService.accessRight.subscribe({next:o=>{o||(this.showNoAccess=!0)}});const t=document.querySelector(".addenda-container");t&&(t.scrollTop=0)}ngOnDestroy(){this.monitorService.logEvent("ngOnDestroy",["ChqNewCustomerComponent","addenda-quote"]),this.commonService.accessRight.unsubscribe(),this.commonService.isViewOnly=!1}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.F0),e.Y36(l.v),e.Y36(f.M),e.Y36(b.n),e.Y36(D.p),e.Y36(w.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chq-new-case"]],viewQuery:function(t,o){if(1&t&&(e.Gf(L,5),e.Gf(k,5),e.Gf(ee,5),e.Gf(te,5),e.Gf(oe,5)),2&t){let i;e.iGM(i=e.CRH())&&(o.companyOrg=i.first),e.iGM(i=e.CRH())&&(o.licenseId=i.first),e.iGM(i=e.CRH())&&(o.driverPhone=i.first),e.iGM(i=e.CRH())&&(o.driverCode=i.first),e.iGM(i=e.CRH())&&(o.orgType=i.first)}},features:[e.qOj],decls:2,vars:2,consts:[["class","new-case-container mh-0",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"new-case-container","mh-0",3,"ngClass"],[3,"chqModel"],[1,"form-container"],[1,"row"],[1,"job-number","col-3"],[3,"inputModel","controlOutput"],[1,"work-provider","col-6"],[1,"work-input-wrapper","row"],[1,"col-12","sub-heading"],[1,"col-6",3,"inputModel","clicked","controlOutput"],["orgType",""],["class","col-6",3,"inputModel","controlOutput",4,"ngIf"],["class","row",3,"ngClass",4,"ngIf"],["class","row",4,"ngIf"],[1,"driver-details","col-12"],[1,"driver-input-wrapper","row"],[1,"driver-fields-wrapper"],[1,"driver-field",3,"inputModel","controlOutput"],[1,"driver-address-wrapper","row"],[1,"driver-field","basis-272",3,"inputModel","controlOutput"],[1,"driver-field","basis-272"],[1,"driver-field","driver-code-field","no-padding",3,"inputModel","clicked","controlOutput"],["driverCode",""],[1,"driver-field","no-padding",3,"inputModel","controlOutput"],["driverPhone",""],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],[1,"footer-button-wrapper"],[3,"buttonModel",4,"ngIf"],[1,"col-6",3,"inputModel","controlOutput"],[1,"row",3,"ngClass"],[1,"insurer-details","col-12"],[1,"insurance-input-wrapper","row"],[1,"company-input","col-3",3,"inputModel","controlOutput"],[1,"company-input","col-6",3,"inputModel","clicked","controlOutput"],["companyOrg",""],[1,"col-6",3,"ngClass","inputModel","controlOutput"],["licenseId",""],[3,"buttonModel"]],template:function(t,o){1&t&&(e.YNc(0,me,42,22,"div",0),e.YNc(1,he,1,0,"no-access-error",1)),2&t&&(e.Q6J("ngIf",!o.isApiLoading&&!o.showNoAccess),e.xp6(1),e.Q6J("ngIf",o.showNoAccess))},dependencies:[_.mk,_.O5,v._,F.D,x.E,S.U,I.X$],styles:[".new-case-container[_ngcontent-%COMP%]{height:calc(100vh - 76px - (63px + 4.6vw));overflow:hidden;overflow-y:auto;padding:0 calc(5px + 1.5vw);padding-bottom:1.5vw}.new-case-container[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]{font-weight:700;font-size:14px;line-height:20px;color:var(--xa-black)}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;flex:1}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .job-number[_ngcontent-%COMP%]{margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]{flex-direction:column;margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   .work-input-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   .car-owner-wrapper[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]{margin-bottom:10px;flex-direction:column}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]   .insurance-input-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]{flex:4;display:flex;flex-direction:column}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-input-wrapper[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-address-wrapper[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-input-wrapper[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-address-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field[_ngcontent-%COMP%]{flex:1 1 120px;padding:10px;width:120px}@media (max-width: 850px){.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field[_ngcontent-%COMP%]{padding:6px}}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.no-padding[_ngcontent-%COMP%]{padding:0}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.driver-code-field[_ngcontent-%COMP%]{min-width:120px;max-width:120px;padding-right:20px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.basis-272[_ngcontent-%COMP%]{flex-basis:272px}.new-case-container[_ngcontent-%COMP%]   .hide[_ngcontent-%COMP%]{display:none}.new-case-container[_ngcontent-%COMP%]   .disable-input[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .partial-disable-info[_ngcontent-%COMP%]{pointer-events:none}.text-mode[_ngcontent-%COMP%]   .job-number[_ngcontent-%COMP%]{padding-left:9px}  .disable-controls input{opacity:.6!important}"]}),n})();var q=r(15861),Y=r(83905),pe=r(32076),H=r(60562),N=r(71764),ue=r(4093),$=r(13975),fe=r(50356),ge=r(74178);const ve=["make"],Ce=["model"],_e=["year"];function Me(n,c){if(1&n&&e._UZ(0,"chq-button",25),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.confirmButtonModel)}}function be(n,c){if(1&n&&e._UZ(0,"chq-button",25),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.nextButtonModel)}}const we=function(n){return{"text-mode":n}},Oe=function(n){return{"partial-disable-info":n}},Z=function(n){return{"disable-input disable-controls":n}},ye=function(n){return{"partial-disable-info disable-controls":n}};function De(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"chq-step-header",3),e.TgZ(2,"label",4),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",5)(6,"chq-input",6),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA()(),e.TgZ(7,"form",7)(8,"div",8)(9,"chq-input",9,10),e.NdJ("clicked",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.hideDropdown(i))})("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(11,"chq-input",11,12),e.NdJ("clicked",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.hideDropdown(i))})("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(13,"chq-input",13,14),e.NdJ("clicked",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.hideDropdown(i))})("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA()(),e.TgZ(15,"div",15)(16,"chq-input",6),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(17,"chq-input",6),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA(),e.TgZ(18,"chq-input",16),e.NdJ("controlOutput",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onFormUpdate(i))}),e.qZA()()(),e.TgZ(19,"div",17),e._UZ(20,"img",18),e.qZA(),e.TgZ(21,"div",19)(22,"div",20)(23,"div",21),e._UZ(24,"img",22),e.qZA()(),e.TgZ(25,"div",23),e.YNc(26,Me,1,1,"chq-button",24),e.YNc(27,be,1,1,"chq-button",24),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(20,we,t.isFormConfirmed)),e.xp6(1),e.Q6J("chqModel",t.vehicleHeader),e.xp6(2),e.Oqu(e.lcZ(4,18,"vehicle_detail")),e.xp6(2),e.Q6J("ngClass",e.VKq(22,Oe,t.searchDisabled)),e.xp6(1),e.Q6J("inputModel",t.formModel.vin),e.xp6(2),e.Q6J("ngClass",e.VKq(24,Z,t.inputDisabled)),e.xp6(1),e.Q6J("inputModel",t.formModel.make)("ngClass",e.VKq(26,Z,t.makeDisabled)),e.xp6(2),e.Q6J("inputModel",t.formModel.model)("ngClass",e.VKq(28,Z,t.modelDisabled)),e.xp6(2),e.Q6J("inputModel",t.formModel.year)("ngClass",e.VKq(30,Z,t.yearDisabled)),e.xp6(2),e.Q6J("ngClass",e.VKq(32,ye,t.infoDisabled)),e.xp6(1),e.Q6J("inputModel",t.formModel.licensePlate),e.xp6(1),e.Q6J("inputModel",t.formModel.carMilege),e.xp6(1),e.Q6J("inputModel",t.formModel.registrationDate),e.xp6(8),e.Q6J("ngIf",t.currentStatus),e.xp6(1),e.Q6J("ngIf",t.isFormConfirmed&&!t.commonService.isViewOnly)}}function xe(n,c){1&n&&e._UZ(0,"no-access-error")}let Ie=(()=>{class n{constructor(t,o,i,a,s,d,m,h,p,g){this.router=t,this.commonService=o,this.route=i,this.caseService=a,this.vehicleService=s,this.inspectionService=d,this.monitorService=m,this.labourService=h,this.mediaCollectionService=p,this.cd=g,this.vehicleHeader=H.mo,this.caseId="0",this.status="",this.tariffId=0,this.vehicleFormData={vin:"",make:"",model:"",year:"",carMilege:"",licensePlate:"",registrationDate:""},this.isFormConfirmed=!1,this.serviceName="vin",this.inputDisabled=!0,this.infoDisabled=!0,this.searchDisabled=!1,this.importTerms=[],this.vehicleId=0,this.inspections={},this.domainID=0,this.partnershipId=0,this.labourData=null,this.makeDisabled=!1,this.preventVinCall=!1,this.caseCreatedDate="",this.umc="",this.originalVin="",this.modelDisabled=!1,this.yearDisabled=!1,this.inspectionTemplateId=0,this.showNoAccess=!1,this.customerName="",this.email="",this.originalTariffObject={},this.userPermission={},this.commonService.eventfromToastComponent$.subscribe(C=>{C&&(this.monitorService.logEvent("eventfromToastComponent",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/document`]))}),this.commonService.accessRight.closed&&(this.commonService.accessRight=new T.X(!0)),this.commonService.userProfileData.subscribe(C=>{if(C&&C.data){const{userPermission:M,vehicleSourceType:j,organizationDetail:J}=C.data;this.userPermission=M||{},this.estimateId=j,J&&(this.currentOrgId=J.id)}})}checkGTEstimatePermission(){const{orgPackages:t=[]}=this.userPermission,o=t.filter(i=>"Repair Estimate"===i.automotiveServiceName);if(o&&o.length>0){const{permissions:i}=o[0],a=i.filter(s=>"gt.estimate"===s.permissionName||"gt.estimate.vinquery"===s.permissionName);if(a&&a.length>0)return!0}return!1}checkVINQueryPermission(){const{orgPackages:t=[]}=this.userPermission,o=t.filter(i=>"vehicle identification"===i.automotiveServiceName?.toLowerCase());if(o&&o.length>0){const{permissions:i}=o[0],a=i.filter(s=>"gt.data.vincoding"===s.permissionName);if(a&&a.length>0)return!0}return!1}process(t){var o=this;return(0,q.Z)(function*(){if(o.caseId=t,o.commonService.showLoading(),yield o.populateReadonlyFields(t).then(i=>{if(null==i.data)return void o.commonService.hideLoading();o.vehicleId=i.data.vehicleId||0,o.vehicleHeader.caseNumber=i.data.caseNumber;const{vinNumber:a,licensePlateNumber:s,vehicleMileage:d,registrationDate:m,vehicleMake:h,vehicleModel:p,modelYear:g,status:C,tariffs:M,domainID:j,umc:J,id:ut}=i.data;o.id=ut,0!=o.vehicleId&&(o.infoDisabled=!1,o.searchDisabled=!1,o.inputDisabled=!1,o.preventVinCall=!0,o.originalVin=a,o.labourData=M.length>0?M[0]:[]),o.customerName=i.data.caseDetail?.firstName,o.email=i.data.caseDetail?.email,o.vehicleHeader.caseNumber=i.data.caseNumber,o.caseCreatedDate=i.data.createdDate,o.formModel.vin={...o.formModel.vin,value:a},o.status=C,o.commonService.caseStatus.next(C),o.formModel.licensePlate={...o.formModel.licensePlate,value:s},o.formModel.carMilege={...o.formModel.carMilege,value:d},o.formModel.registrationDate={...o.formModel.registrationDate,value:m},o.formModel.make={...o.formModel.make,selectedOption:{name:h}},o.formModel.year={...o.formModel.year,selectedOption:{name:g||i.data.modelYearRange}},o.formModel.model={...o.formModel.model,selectedOption:{modelDescription:p}},o.umc=J,o.tariffId=M[0]?.tariffId,o.isTariffEditable=M[0]?.isEditable,o.partnershipId=M[0]?.partnershipId,o.domainID=j,o.inspections=i.data.inspections[0],o.inspections&&o.commonService.inspectionId.next(o.inspections.inspectionId),o.originalTariffObject={make:h,partnershipId:o.partnershipId,registrationDate:N(m).format("YYYY-MM-DDT00:00:00")},o.vehicleFormData={...o.vehicleFormData,vin:a,make:h,model:p,year:g||i.data.modelYearRange,carMilege:d,licensePlate:s,registrationDate:m},o.commonService.isViewOnly=o.currentOrgId!=i.data.organizationDetail?.organizationId,o.validate(),o.commonService.hideLoading()}).catch(()=>{o.commonService.hideLoading()}),o.prefillVehicleData(),0!=o.vehicleId||o.commonService.isViewOnly)return o.setTextMode(),void(o.isFormConfirmed=!0);yield o.populateDropdowns()})()}prefillVehicleData(){const t=this.commonService.getSessionStorage("selectedSearchItem");if(t){const o=JSON.parse(t);o.vin&&!this.vehicleFormData.vin&&(this.preventVinCall=!0,this.vehicleFormData.vin=o.vin,this.formModel.vin={...this.formModel.vin,value:o.vin}),o.make&&!this.vehicleFormData.make&&(this.vehicleFormData.make=o.make,this.formModel.make={...this.formModel.make,selectedOption:{name:o.make}}),o.model&&!this.vehicleFormData.model&&(this.vehicleFormData.model=o.model,this.formModel.model={...this.formModel.model,selectedOption:{modelDescription:o.model}}),o.importInterval&&!this.vehicleFormData.year&&(this.vehicleFormData.year=o.importInterval,this.formModel.year={...this.formModel.year,value:o.importInterval,selectedOption:{name:o.importInterval}}),o.plate&&!this.vehicleFormData.licensePlate&&(this.vehicleFormData.licensePlate=o.plate,this.formModel.licensePlate={...this.formModel.licensePlate,value:o.plate}),(o.make||o.model||o.vin||o.plate)&&(this.commonService.setSessionStorage("selectedSearchItem",""),this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!0,this.enableDropdowns())}}populateDropdowns(){var t=this;return(0,q.Z)(function*(){const o=yield(0,Y.z)(t.vehicleService.getVehicleMake());t.formModel.make={...t.formModel.make,options:o.sort((s,d)=>s.name.localeCompare(d.name))};const a=t.formModel.make.options.filter(s=>s.name===t.vehicleFormData.make);a.length>0&&t.vehicleService.getVehicleModel(a[0].id,t.estimateId).subscribe(s=>{t.formModel.model={...t.formModel.model,options:s};const d=t.formModel.model.options?.filter(m=>m.umc==t.umc);d.length>0&&t.vehicleService.getVehicleYearByModel(d[0].id,t.estimateId)?.subscribe(m=>{t.formModel.year={...t.formModel.year,options:m}})})})()}populateReadonlyFields(t){var o=this;return(0,q.Z)(function*(){if(t&&"0"!=t)return o.caseId=t,o.commonService.showLoading(),(0,Y.z)(o.caseService.getCaseDetail(t))})()}navigateToDocument(){this.monitorService.logEvent("navigateToDocument",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/document`])}ngOnInit(){var t=this;return(0,q.Z)(function*(){t.formModel=(0,H.br)(),t.confirmButtonModel={label:"Confirm",type:"primary",icon:"check",onclick:t.confirmData.bind(t)},t.nextButtonModel={label:"Next add documents",type:"primary",icon:"plus-filled",onclick:t.navigateToDocument.bind(t)};const o=t.route?.parent?.snapshot?.paramMap?.get("id");t.monitorService.logEvent("ngOnInit",["ChqNewVehicleComponent","addenda-quote",{caseId:o}]),t.commonService.accessRight.subscribe({next:a=>{a||(t.showNoAccess=!0)}}),t.inspectionService.getInspectionTemplateList().subscribe({next:a=>{const s=a?.data;s.length>0&&(t.inspectionTemplateId=s[0].id)}}),yield t.process(o);const i=document.querySelector(".addenda-container");i&&(i.scrollTop=0)})()}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0","vehicle"),this.monitorService.logEvent("ngAfterViewInit",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}])}setTextMode(){this.inputDisabled=!1,this.makeDisabled=!1;const t=Object.keys(this.formModel);for(const o in t){const i=t[o];this.formModel[i]={...this.formModel[i],mode:"text"}}this.confirmButtonModel={...this.confirmButtonModel,label:"Change car",type:"outline",icon:"gobackward"}}updateButton(){var t=this;return(0,q.Z)(function*(){const o=Object.keys(t.formModel);for(const i in o){const a=o[i];t.formModel[a]={...t.formModel[a],mode:t.isFormConfirmed?"value":"text"}}"Change car"==t.confirmButtonModel.label&&(t.checkVINQueryPermission()?(t.preventVinCall=!0,t.vehicleService.getVinDecoder(t.vehicleFormData.vin).subscribe({next:i=>{t.makeDisabled=!!i?.success}})):t.makeDisabled=!1,t.commonService.showLoading(),yield t.populateDropdowns(),t.commonService.hideLoading()),t.isFormConfirmed=!t.isFormConfirmed,t.confirmButtonModel={...t.confirmButtonModel,label:t.isFormConfirmed?"Change car":"Confirm",type:t.isFormConfirmed?"outline":"primary",icon:t.isFormConfirmed?"refresh":"check"}})()}confirmData(){if(this.isFormConfirmed)this.updateButton();else if(this.commonService.showLoading(),this.vehicleId&&this.vehicleFormData.vin===this.originalVin)this.updateVehicle();else{const t={vin:this.vehicleFormData.vin,vehicleCountryId:1,umc:this.umc,make:this.vehicleFormData.make,model:this.vehicleFormData.model,mileage:Number(this.vehicleFormData.carMilege),firstRegistrationDate:N(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00"),registrationNumber:this.vehicleFormData.licensePlate,condition:1,ModelYearRange:this.vehicleFormData.year,InspectionTemplateId:this.inspectionTemplateId,CustomerName:this.customerName,CustomerEmail:this.email};this.vehicleService.addVehicle(t,this.domainID,this.id).subscribe({next:o=>{o&&(this.vehicleId=o.id,this.inspections={},this.inspections.inspectionId=o.inspectionId,this.inspections.inspectionGuid=o.inspectionGuid,this.updateVehicle())},error:o=>{this.commonService.hideLoading()}})}}updateVehicle(){var t=this;return(0,q.Z)(function*(){t.monitorService.logEvent("updateVehicle",["ChqNewVehicleComponent","addenda-quote",{caseId:t.caseId}]),t.commonService.showLoading();const o={vin:t.vehicleFormData.vin,umc:t.umc,vehicleMake:t.vehicleFormData.make,vehicleModel:t.vehicleFormData.model,modelYearRange:t.vinGTMotive?.modelYearRange||t.vehicleFormData.year,vehicleID:t.vehicleId,licensePlateNumber:t.vehicleFormData.licensePlate,vehicleMileage:Number(t.vehicleFormData.carMilege),registrationDate:N(t.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00")},i={inspectionID:t.inspections.inspectionId,inspectionGuid:t.inspections.inspectionGuid},a=N(t.vehicleFormData.registrationDate).year().toString();(t.originalTariffObject.make!=t.vehicleFormData.make||t.partnershipId!=t.originalTariffObject.partnershipId||N(t.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00")!=t.originalTariffObject.registrationDate||!t.labourData?.tariffLabourRates?.length)&&(yield t.getLabourData(t.tariffId,t.isTariffEditable,t.partnershipId,t.vehicleFormData.make,a)),t.vehicleService.updateVehicleCase({vehicle:o,inspection:i,tariff:t.labourData},t.caseId).subscribe({next:d=>{if(d){if(t.labourData.isEditable){let m=!0;if(t.labourData.tariffLabourRates.forEach(h=>{h.amount>0&&(m=!1)}),m){const h={objectId:t.caseId,link:"here",labourData:t.labourData};return t.commonService.hideLoading(),void t.commonService.showInfoToast(5e5,"labour_value_update",h)}}t.router.navigate([`/quote/case/${t.caseId}/document`])}t.commonService.hideLoading()},error:d=>{t.commonService.hideLoading()}})})()}onFormUpdate(t){this.monitorService.logEvent("onFormUpdate",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId,output:t}]),"select"===t.type?(this.formModel[t.name]={...this.formModel[t.name],selectedOption:t.value},this.vehicleFormData[t.name]=t.value[this.formModel[t.name].fieldValue],"make"==t.name?(this.vehicleFormData.model="",this.vehicleFormData.year=null,this.modelDisabled=!0,this.yearDisabled=!0,this.formModel.year={...this.formModel.year,selectedOption:{},options:[],observable:null},this.formModel.model={...this.formModel.model,selectedOption:{}},t.value&&(this.formModel.model={...this.formModel.model,observable:this.vehicleService.getVehicleModel(t.value.id,this.estimateId),onObservableLoad:this.enableDropdowns.bind(this)},setTimeout(()=>{this.model.triggerObservable()}))):"model"==t.name&&(this.yearDisabled=!0,this.formModel.year={...this.formModel.year,selectedOption:{},observable:null,options:[]},this.vehicleFormData.year=null,t.value&&(this.umc=t.value.umc,this.formModel.year={...this.formModel.year,observable:this.vehicleService.getVehicleYearByModel(t.value.id,this.estimateId),onObservableLoad:this.enableDropdowns.bind(this)},setTimeout(()=>{this.year.triggerObservable()})))):t.isValid?(this.formModel[t.name].value=t.value,this.vehicleFormData[t.name]=t.value):(this.formModel[t.name].value="",this.vehicleFormData[t.name]=""),this.vehicleFormData={...this.vehicleFormData},"vin"==t.name&&t.isValid&&this.populateForm(),this.validate()}enableDropdowns(){this.modelDisabled=!1,this.yearDisabled=!1}hideDropdown(t){t===this.formModel.make.name?(this.model.closeDropdown(),this.year.closeDropdown()):t===this.formModel.model.name?(this.make.closeDropdown(),this.year.closeDropdown()):(this.model.closeDropdown(),this.make.closeDropdown())}validate(){const t=Object.keys(this.vehicleFormData);this.monitorService.logEvent("validate",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]);let o=!0;for(const i in t)if(!this.vehicleFormData[t[i]]){o=!1;break}this.confirmButtonModel.type=this.isFormConfirmed?"outline":o?"primary":"disabled"}populateForm(){const t=this.formModel.vin.value?.toLocaleString();this.monitorService.logEvent("populateForm",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.checkVINQueryPermission()?(0,pe.D)(t).pipe().subscribe({complete:()=>{17==t.length&&!this.isFormConfirmed&&!this.preventVinCall&&(this.commonService.showLoading(),this.vehicleService.getVinDecoder(t).subscribe({error:()=>{this.commonService.hideLoading(),this.vinGTMotive=null,this.resetDropdown()},next:o=>{if(o?.success){this.vinGTMotive=o.data,this.umc=this.vinGTMotive?.umc,this.formModel.make={...this.formModel.make,selectedOption:{name:o.data.vehicleMake}},this.formModel.model={...this.formModel.model,selectedOption:{modelDescription:o.data.vehicleModel}};const a=this.formModel.make.options.filter(s=>s.name===o.data.vehicleMake);a.length>0&&(this.formModel.model={...this.formModel.model,observable:this.vehicleService.getVehicleModel(a[0].id,this.estimateId)},setTimeout(()=>{this.model.triggerObservable()})),this.formModel.year={...this.formModel.year,selectedOption:{name:o.data.modelYearRange}},this.vehicleFormData.make=o.data.vehicleMake,this.vehicleFormData.model=o.data.vehicleModel,this.vehicleFormData.year=o.data.modelYearRange,this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!0,this.enableDropdowns()}else this.vinGTMotive=null,this.commonService.showInfoToast(5e3,"show-info | "+o?.message),this.resetDropdown();setTimeout(()=>{this.make.dropdownValidationMessage="",this.make.dropdownContainer.dropdownConfig.isTouched=!1,this.make.dropdownContainer.dropdownConfig.isDirty=!1,this.model.dropdownValidationMessage="",this.model.dropdownContainer.dropdownConfig.isTouched=!1,this.model.dropdownContainer.dropdownConfig.isDirty=!1,this.year.dropdownValidationMessage="",this.year.dropdownContainer.dropdownConfig.isTouched=!1,this.year.dropdownContainer.dropdownConfig.isDirty=!1},0),this.validate()},complete:()=>{this.commonService.hideLoading()}})),this.preventVinCall&&17==t.length&&(this.preventVinCall=!1)}}):(this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!1,this.enableDropdowns())}resetDropdown(){this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!1,this.vehicleFormData.make="",this.vehicleFormData.model="",this.vehicleFormData.year=null,this.formModel.model.options=[],this.formModel.year.options=[],this.formModel.make={...this.formModel.make,selectedOption:{}},this.formModel.model={...this.formModel.model,selectedOption:{}},this.formModel.year={...this.formModel.year,selectedOption:{}}}get currentStatus(){return!this.status&&!this.commonService.isViewOnly||!this.commonService.isViewOnly&&-1===["reject","rejected","approved","closed","repairestimation","complete"].indexOf(this.status?.toLowerCase())}getLabourData(t,o,i,a,s){var d=this;return(0,q.Z)(function*(){return d.monitorService.logEvent("getLabourData",["ChqNewVehicleComponent","addenda-quote",{caseId:d.caseId}]),(0,Y.z)(d.labourService.getLabourData(t,a,N(d.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00"),d.caseCreatedDate)).then(m=>{m.data&&(d.labourData={tariffId:m.data.id,tariffDiscountRates:m.data.tariffDiscountRates,tariffLabourRates:m.data.tariffLaborRates,isEditable:o,partnershipId:i})})})()}getDomainId(){this.mediaCollectionService.getMediaTemplate().subscribe({next:t=>{t?.data.length>0&&(this.domainID=t.data[0].domainID)}})}ngOnDestroy(){this.monitorService.logEvent("ngOnDestroy",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.formModel=(0,H.br)(),this.commonService.accessRight.unsubscribe(),this.commonService.isViewOnly=!1}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.F0),e.Y36(l.v),e.Y36(w.gz),e.Y36(b.n),e.Y36(ue.f),e.Y36($.a),e.Y36(f.M),e.Y36(fe.T),e.Y36(ge.m),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chq-new-vehicle"]],viewQuery:function(t,o){if(1&t&&(e.Gf(ve,5),e.Gf(Ce,5),e.Gf(_e,5)),2&t){let i;e.iGM(i=e.CRH())&&(o.make=i.first),e.iGM(i=e.CRH())&&(o.model=i.first),e.iGM(i=e.CRH())&&(o.year=i.first)}},decls:2,vars:2,consts:[["class","new-vehicle-container",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"new-vehicle-container",3,"ngClass"],[3,"chqModel"],[1,"label"],[1,"search-box",3,"ngClass"],[1,"col-4",3,"inputModel","controlOutput"],[1,"form-container"],[1,"vehicle-brand-wrapper","row",3,"ngClass"],["id","input-make",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["make",""],["id","input-model",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["model",""],["id","input-year",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["year",""],[1,"vehicle-info-wrapper","row",3,"ngClass"],[1,"col-4","registration-date",3,"inputModel","controlOutput"],[1,"image-car"],["src","assets/img/half-car.png"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],[1,"footer-button-wrapper"],[3,"buttonModel",4,"ngIf"],[3,"buttonModel"]],template:function(t,o){1&t&&(e.YNc(0,De,28,34,"div",0),e.YNc(1,xe,1,0,"no-access-error",1)),2&t&&(e.Q6J("ngIf",!o.showNoAccess),e.xp6(1),e.Q6J("ngIf",o.showNoAccess))},dependencies:[_.mk,_.O5,v._,F.D,x.E,S.U,I.X$],styles:[".new-vehicle-container[_ngcontent-%COMP%]{padding-bottom:1.5vw}.new-vehicle-container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:10px;display:block;font-weight:600}.new-vehicle-container[_ngcontent-%COMP%]     .disable-controls input{opacity:.6!important}.new-vehicle-container[_ngcontent-%COMP%]   .disable-input[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .partial-disable-info[_ngcontent-%COMP%]{pointer-events:none}.new-vehicle-container[_ngcontent-%COMP%]   .registration-date[_ngcontent-%COMP%]     .input-wrapper input{pointer-events:none}.new-vehicle-container[_ngcontent-%COMP%]   .registration-date[_ngcontent-%COMP%]     .input-wrapper input[readonly]{opacity:1}.new-vehicle-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]{margin-bottom:20px}.new-vehicle-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%]   .extra-position[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]   .extra-position[_ngcontent-%COMP%]{top:5px;position:relative}.new-vehicle-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;flex:1}.new-vehicle-container[_ngcontent-%COMP%]   .image-car[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:654px;position:fixed;bottom:76px}.new-vehicle-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:20px}.new-vehicle-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   chq-input[_ngcontent-%COMP%]{width:242px}@media (max-height: 640px){.image-car[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none!important}}@media (orientation: portrait){.search-box[_ngcontent-%COMP%]{margin-top:20px}.search-box[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{flex-basis:auto;max-width:none;width:375px!important}.form-container[_ngcontent-%COMP%]{margin-left:5px}.form-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:0!important}.form-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{flex-basis:auto;max-width:none;width:375px!important;margin-bottom:20px;padding-left:0;padding-right:0}}"]}),n})();const qe={approve:{status:"Approve Case",info:"Please fill out a reason why you are approving this case.",buttonModel:{label:"Approve Case",type:"success",icon:"check"},imageGallery:!1,gallery:[]},reject:{status:"Reject Case",info:"Please fill out a reason why you are rejecting this case.",buttonModel:{label:"Reject Case",type:"red",icon:"cross"},imageGallery:!1,gallery:[]},close:{status:"Close Case",info:"Please fill out a reason why you are closing this case.",buttonModel:{label:"Close Case",type:"primary",icon:"folder-plus"},imageGallery:!1,gallery:[]},complete:{status:"Complete Case",info:"Please fill out a reason why you are completing this case.",buttonModel:{label:"Complete Case",type:"primary",icon:"folder-plus"},imageGallery:!1,gallery:[]}};var Pe=r(25015),Se=r(50617),Ne=r(4128),Te=r(70262),Fe=r(39646),ke=r(14368),K=r(75983),Ee=r(87855),Re=r(7274),Ve=r(9988),Ze=r(8851),Je=r(48262),Ae=r(72076),z=r(65504);const Ge=["anchor"];function Le(n,c){if(1&n&&(e.TgZ(0,"div",17)(1,"div",18)(2,"div",19)(3,"label"),e._uU(4),e.qZA()(),e.TgZ(5,"div",20)(6,"label"),e._uU(7),e.qZA(),e.TgZ(8,"span"),e._uU(9),e.qZA()()(),e.TgZ(10,"div",21),e._UZ(11,"img",22),e.TgZ(12,"div",20),e._UZ(13,"a",23,24),e.TgZ(15,"label"),e._uU(16),e.qZA(),e.TgZ(17,"span"),e._uU(18),e.qZA()()()()),2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.customerData.initial),e.xp6(3),e.Oqu(t.customerData.firstName+" "+t.customerData.lastName),e.xp6(2),e.Oqu(t.customerData.countryCode+" "+t.customerData.mobileNumber),e.xp6(4),e.Q6J("href",t.downloadUrl,e.LSH)("hidden",!0)("download",t.pdfName),e.xp6(3),e.Oqu(null==t.caseData?null:t.caseData.vehicleMake),e.xp6(2),e.Oqu(null==t.caseData?null:t.caseData.vehicleModel)}}function Ye(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-estimate-details",25),e.NdJ("downloadPdf",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.downloadPdf())}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("estimateResponse",t.estimateResponse)("editEstimate",t.editEstimate)("estimateSource",t.estimateSource)("i18n",t.i18n)}}function He(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.booking("create",""))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.createBooking)}}function Qe(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.booking("view",i.repairId))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.viewBooking)}}function je(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.changeCaseStatusDialog(i.closeCaseButton))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.closeCaseButton)}}function Be(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.changeCaseStatusDialog(i.approveCaseButton))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.approveCaseButton)}}function Ue(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.changeCaseStatusDialog(i.rejectButton))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.rejectButton)}}function $e(n,c){if(1&n&&e._UZ(0,"chq-button",30),2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.calculationButton)}}function Ke(n,c){if(1&n&&(e.TgZ(0,"div",26),e.YNc(1,He,1,1,"chq-button",27),e.YNc(2,Qe,1,1,"chq-button",27),e.YNc(3,je,1,1,"chq-button",27),e.YNc(4,Be,1,1,"chq-button",27),e.YNc(5,Ue,1,1,"chq-button",27),e.YNc(6,$e,1,1,"chq-button",28),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&!t.repairId&&"rejected"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&t.repairId),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&t.currentRejStatus&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&t.currentStatus&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&t.currentRejStatus&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase()))}}function ze(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-dropdown",33),e.NdJ("selected",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.changeCaseStatusDialog(i))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("dropdownModel",t.dropdownModelFilter)}}function Xe(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.booking("create",""))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.createBooking)}}function We(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.booking("view",i.repairId))}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.viewBooking)}}function et(n,c){if(1&n&&(e.TgZ(0,"div",31),e.YNc(1,ze,1,1,"chq-dropdown",32),e.YNc(2,Xe,1,1,"chq-button",27),e.YNc(3,We,1,1,"chq-button",27),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&(t.commonService.repairPermission||"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())&&!t.commonService.repairPermission)),e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&!t.repairId&&"rejected"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&t.repairId)}}const tt=function(n){return{hidden:n}};function ot(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"chq-step-header",4),e.NdJ("back",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.handleBack(i))}),e.qZA(),e.YNc(2,Le,19,8,"div",5),e.TgZ(3,"div",6)(4,"div",7),e.YNc(5,Ye,1,4,"chq-estimate-details",8),e._UZ(6,"chq-customloader",9),e.qZA()(),e.TgZ(7,"div",10)(8,"div",11)(9,"div",12),e._UZ(10,"img",13),e.qZA()(),e.YNc(11,Ke,7,6,"div",14),e.YNc(12,et,4,3,"div",15),e.qZA(),e.TgZ(13,"history",16),e.NdJ("toggleExpand",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.getCaseHistory())}),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(10,tt,t.showDamageAnalysis)),e.xp6(1),e.Q6J("chqModel",t.header)("showButton",!0),e.xp6(1),e.Q6J("ngIf",t.pageReady),e.xp6(3),e.Q6J("ngIf",t.showData),e.xp6(1),e.Q6J("showLoading",!t.showData),e.xp6(5),e.Q6J("ngIf",t.estimateResponse&&!t.commonService.isViewOnly),e.xp6(1),e.Q6J("ngIf",t.estimateResponse&&!t.commonService.isViewOnly),e.xp6(1),e.Q6J("history",t.history)("isLoading",t.isHistoryLoading)}}function it(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"damage-analysis",34),e.NdJ("backEvent",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.handleBack(i))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("hideNext",!0)("caseDetail",t.caseResult)}}function nt(n,c){1&n&&e._UZ(0,"no-access-error")}const at={title:"create_estimate",step:5,description:"create_estimate_msg",stepName:"step_five"};let st=(()=>{class n{constructor(t,o,i,a,s,d,m,h,p,g){this.cd=t,this.commonService=o,this.caseService=i,this.repairEstimateService=a,this.route=s,this.monitorService=d,this.inspectionService=m,this.dialog=h,this.datePipe=p,this.router=g,this.header=at,this.customerFormData={jobNumber:"1212",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",companyId:0,partnershipId:0,firstName:"John",lastName:"Doe",driverCode:"+971",driverPhone:502302030,carOwnerSelector:"Person",email:""},this.isInitCalled=!1,this.dialogData=qe,this.showGen=!0,this.pageReady=!1,this.showData=!1,this.showInspection=!1,this.pdfName="",this.showNoAccess=!1,this.editEstimate=!1,this.estimateSource="",this.dropdownModelFilter={options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}],placeHolder:"Options",label:"",appearance:"button",placeHolderIcon:"settings",name:"option",displayValue:"label",selectedOption:{}},this.history=[],this.isHistoryLoading=!1,this.commonService.accessRight.closed&&(this.commonService.accessRight=new T.X(!0)),this.commonService.userProfileData.subscribe(C=>{if(C&&C.data){const{organizationDetail:M}=C.data;M&&(this.currentOrgId=M.id)}}),this.i18n=this.commonService.geti18nInfo()}get isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}handleVisibilityChange(t){!this.isInitCalled||!this.isiOS||!this.orgName||0==this.estimateResponse?.estimateCharges?.length&&this.getEstimationDetail(this.orgName)}onPopState(t){sessionStorage.setItem("update","0")}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0","estimate"),this.cd.detectChanges(),this.showGen=!1,this.monitorService.logEvent("ngAfterViewInit",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}handleBack(t){this.showDamageAnalysis=!t.back,this.monitorService.logEvent("handleBack",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}ngOnInit(){this.caseGuid=this.route.parent?.snapshot.paramMap.get("id"),this.getCaseDetail(),this.isInitCalled=!0,this.closeCaseButton={label:"Complete",type:"primary",icon:"folderplus"},this.approveCaseButton={label:"Approve",type:"success",icon:"check"},this.rejectButton={label:"Reject",type:"outline-danger",icon:"cross"},this.calculationButton={label:"Edit Calculations",type:"outline",icon:"edit",onclick:this.editGtMotive.bind(this)},this.createBooking={label:"Create Booking",type:"outline",icon:"calendar"},this.viewBooking={label:"View Booking",type:"outline",icon:"view"},this.commonService.accessRight.subscribe({next:o=>{o||(this.showNoAccess=!0)}});const t=document.querySelector(".addenda-container");t&&(t.scrollTop=0),this.monitorService.logEvent("ngOnInit",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}editGtMotive(){this.repairId?this.commonService.showChangeWarningMessage(this.redirectToGtEstimate.bind(this),K.j.repair):this.redirectToGtEstimate()}changeCaseStatusDialog(t){let o=null,i="";if("Edit Calculations"!=t?.value?.label&&"Edit Calculations"!=t?.label){if("Approve"==t?.value?.label||"Approve"==t?.label)o=this.dialogData.approve,i="Approved";else if("Complete"==t?.value?.label||"Complete"==t?.label)o=this.dialogData.complete,i="Complete";else if("Reject"==t?.value?.label||"Reject"==t?.label)o=this.dialogData.reject,i="Rejected";else{if("View Booking"==t?.value?.label||"View Booking"==t?.label)return void this.booking("view",this.repairId);if("Create Booking"==t?.value?.label||"Create Booking"==t?.label)return void this.booking("create","")}this.monitorService.logEvent("changeCaseStatusDialog",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status:i}]),this.dialog.open(Pe.z,{autoFocus:!1,data:o}).afterClosed().subscribe({next:s=>{this.commonService.showLoading(),s?this.caseService.updateCaseStatus(this.caseGuid,i,s.data).subscribe({next:()=>{this.monitorService.logEvent("updateCaseStatus",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status:i}]),this.caseStatus=i,this.toggleOption(i)},complete:()=>{this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}}):this.commonService.hideLoading()}})}else this.repairId?this.commonService.showChangeWarningMessage(this.redirectToGtEstimate.bind(this),K.j.repair):this.redirectToGtEstimate()}redirectToGtEstimate(){this.commonService.showLoading(),this.monitorService.logEvent("redirectToGtEstimate",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status}]),this.route.snapshot.queryParams.send&&"true"==this.route.snapshot.queryParams.send&&this.router.navigate([],{relativeTo:this.route,queryParams:{send:"false"},queryParamsHandling:"merge"}),this.repairEstimateService.createEstimate(this.caseGuid,this.inspectionId,this.vehicleId,this.domainId).subscribe({next:t=>{t&&(location.href=t.data.url,sessionStorage.setItem("update","1"))},complete:()=>{this.commonService.hideLoading()}})}downloadPdf(){this.commonService.showLoading(),this.monitorService.logEvent("downloadPdf",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}]),this.repairEstimateService.getXADownloadUrl(this.caseGuid).subscribe({next:o=>{window.open(o.data.url,"_top"),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}})}get currentRejStatus(){return!!this.caseStatus&&-1===["approved","closed","complete"].indexOf(this.caseStatus?.toLowerCase())}get currentStatus(){return!!this.caseStatus&&-1===["approved","closed","complete"].indexOf(this.caseStatus?.toLowerCase())}getCaseHistory(){this.history=[],this.isHistoryLoading=!0,this.caseService.getCaseHistory(this.caseGuid,this.domainId).subscribe({next:t=>{if(t){let o=[];for(let s=0;s<t.length;s++)o=[...o,...t[s].auditTrailResponseDetails];const i=o.map(s=>({...s,auditDate:this.datePipe.transform(s.actionedOn,"dd/MM/YYYY")})),a=[];for(let s=0;s<i.length;s++){const d=a.find(m=>m.auditDate===i[s].auditDate);d?d.auditTrailResponseDetails.push(i[s]):a.push({auditDate:i[s].auditDate,auditTrailResponseDetails:[i[s]]})}this.history=a}},complete:()=>{this.isHistoryLoading=!1}})}getCaseDetail(){this.caseService.getCaseDetail(this.caseGuid).subscribe({next:t=>{if(t?.data){const{inspections:o,vehicleId:i,status:a,orgName:s,repairGuid:d,domainID:m}=t.data;if(this.commonService.caseStatus.next(a),this.inspectionId=o?o[0]?.inspectionId:"",-1===["uploadphotos","repairestimation","closed","rejected","approved","complete","pendingapproval","readytoinvoice","invoiceready"].indexOf(a.toLowerCase()))return;this.vehicleId=i,this.repairId=d,this.caseStatus=a,this.domainId=m,this.toggleOption(a),this.header.caseNumber=t.data.caseNumber,this.caseResult=t.data,this.customerData=t.data.caseDetail,this.orgName=s,this.customerData={...this.customerData,initial:this.customerData.firstName?.substring(0,1).toUpperCase()+this.customerData.lastName?.substring(0,1).toUpperCase()},this.pageReady=!0,this.commonService.isViewOnly=this.currentOrgId!=t.data.organizationDetail?.organizationId;const h=sessionStorage.getItem("update")||"0";"0"===h?(this.getEstimationDetail(s),this.commonService.updatePage("/quote/case/0","estimate")):"1"===h&&this.route.snapshot.queryParams.send&&"true"==this.route.snapshot.queryParams.send?this.repairEstimateService.readUpdateEstimate(this.caseGuid,t.data.inspections[0].inspectionId,t.data.vehicleId,"put",this.domainId).subscribe({next:()=>{sessionStorage.setItem("update","0"),this.getEstimationDetail(s),this.router.navigate([],{relativeTo:this.route,queryParams:{send:"false"},queryParamsHandling:"merge"}),this.commonService.hideLoading(),setTimeout(()=>{this.commonService.updatePage("/quote/case/0","estimate")})}}):this.getEstimationDetail(s)}},error:()=>{this.commonService.hideLoading()}})}getEstimationDetail(t){this.repairEstimateService.getEstimate(this.caseGuid,this.inspectionId,this.vehicleId,this.domainId).subscribe({next:o=>{this.estimateResponse=o.data,this.caseData={vehicleMake:this.estimateResponse.make,vehicleModel:this.estimateResponse.modelCode},this.estimateResponse.orgName=t,this.estimateSource=o.data?.externalSource,this.estimateResponse.currencyCode||(this.estimateResponse.currencyCode=this.i18n.currencySymbol),0==this.estimateResponse?.estimateCharges?.length?(this.commonService.hideLoading(),this.showConfirmationPopup()):(this.getInspection(),this.showData=!0),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}})}getInspection(){this.inspectionService.getInspectionTemplateList().subscribe({next:t=>{const o=t?.data;o?.length>0&&(this.commonService.repairInspectionTemplate=o[0],(0,Ne.D)({inspectionTemplate:this.inspectionService.getInspectionTemplate(o[0].id),inspectionDetail:this.inspectionService.getInspection(this.inspectionId)}).pipe((0,Te.K)(s=>(0,Fe.of)(s))).subscribe(s=>{const d=s.inspectionTemplate?.inspectionItemTemplates,m=s.inspectionDetail,h=d?.filter(p=>"Bulk Upload Image"===p.name);this.images=m?.inspectionItems?.filter(p=>("Bulk Upload Image"==p.name||p.inspectionItemTemplateID===h[0].id)&&""!=p.rawAzureBlobUrl).map(p=>p.rawAzureBlobUrl),0==this.images?.length&&(this.images=m?.inspectionItems?.filter(p=>"Bulk Upload Image"!=p.name&&""!=p.rawAzureBlobUrl).map(p=>p.rawAzureBlobUrl)),this.showInspection=!0}))}})}showConfirmationPopup(){this.dialog.open(ke.I,{disableClose:!0,data:{message:"The estimate values are 0. Press continue to navigate to gtmotive."},backdropClass:"confirmation-popup-backdrop"}).afterClosed().subscribe({next:o=>{console.log(o),o&&this.redirectToGtEstimate()}})}toggleOption(t){this.dropdownModelFilter="reject"===t.toLowerCase()||"rejected"===t.toLowerCase()?{...this.dropdownModelFilter,options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}]}:"approved"===t.toLowerCase()?{...this.dropdownModelFilter,options:[{label:"Complete",dropdownItemIcon:"folderplus"}]}:"complete"===t.toLowerCase()?{...this.dropdownModelFilter,options:[]}:{...this.dropdownModelFilter,options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}]}}booking(t,o){"create"===t?this.router.navigate(["repair/booking/0"],{queryParams:{caseId:this.caseGuid}}):this.router.navigate([`repair/booking/${o}`])}ngOnDestroy(){this.commonService.accessRight.unsubscribe(),this.monitorService.logEvent("ngOnDestroy",["ChqRepairEstimateComponent","addenda-quote"]),this.commonService.isViewOnly=!1}isGTEstimate(){return"GTMotive"===this.estimateSource}isPendingApproval(){return"pendingapproval"===this.caseStatus?.toLowerCase()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.sBO),e.Y36(l.v),e.Y36(b.n),e.Y36(Ee.H),e.Y36(w.gz),e.Y36(f.M),e.Y36($.a),e.Y36(Re.uw),e.Y36(_.uU),e.Y36(w.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chq-repair-estimate"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Se.y,5),e.Gf(Ge,5)),2&t){let i;e.iGM(i=e.CRH())&&(o.elementRef=i.first),e.iGM(i=e.CRH())&&(o.anchor=i.first)}},hostBindings:function(t,o){1&t&&e.NdJ("visibilitychange",function(a){return o.handleVisibilityChange(a)},!1,e.evT)("popstate",function(a){return o.onPopState(a)},!1,e.Jf7)},inputs:{customerFormData:"customerFormData"},decls:3,vars:3,consts:[["class","estimate-container",3,"ngClass",4,"ngIf"],[3,"hideNext","caseDetail","backEvent",4,"ngIf"],[4,"ngIf"],[1,"estimate-container",3,"ngClass"],[1,"header",3,"chqModel","showButton","back"],["class","info-container",4,"ngIf"],[1,"estimate-block","row"],[1,"quote-estimate-step","col-12"],["serviceType","repair",3,"estimateResponse","editEstimate","estimateSource","i18n","downloadPdf",4,"ngIf"],[3,"showLoading"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],["class","footer-button-wrapper show-md",4,"ngIf"],["class","footer-button-wrapper show-sm",4,"ngIf"],["serviceType","quote",3,"history","isLoading","toggleExpand"],[1,"info-container"],[1,"info-block"],[1,"avatar"],[1,"text-block"],[1,"vehicle-block"],["src","assets/img/default_car.png"],[3,"href","hidden","download"],["anchor",""],["serviceType","repair",3,"estimateResponse","editEstimate","estimateSource","i18n","downloadPdf"],[1,"footer-button-wrapper","show-md"],[3,"buttonModel","click",4,"ngIf"],[3,"buttonModel",4,"ngIf"],[3,"buttonModel","click"],[3,"buttonModel"],[1,"footer-button-wrapper","show-sm"],["class","option-dropdown",3,"dropdownModel","selected",4,"ngIf"],[1,"option-dropdown",3,"dropdownModel","selected"],[3,"hideNext","caseDetail","backEvent"]],template:function(t,o){1&t&&(e.YNc(0,ot,14,12,"div",0),e.YNc(1,it,1,2,"damage-analysis",1),e.YNc(2,nt,1,0,"no-access-error",2)),2&t&&(e.Q6J("ngIf",!o.showNoAccess),e.xp6(1),e.Q6J("ngIf",o.showDamageAnalysis),e.xp6(1),e.Q6J("ngIf",o.showNoAccess))},dependencies:[_.mk,_.O5,Ve.wm,v._,Ze.I,x.E,Je.h,Ae.r,S.U,z.u],styles:[".estimate-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]{display:flex;flex-direction:row}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]{padding:10px 32px;display:flex;flex-direction:row;align-items:center;border:1px solid var(--xa-light-gray);flex:1}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]{margin-left:12px;display:flex;flex-direction:column}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:20px;line-height:25px;display:flex;align-items:center;letter-spacing:-.25px}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:auto;width:auto;max-height:45px;max-width:102px}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]{border-left:none}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]{border-left:none;border-right:none}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]{display:flex;margin:0}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]{padding:20px 20px 0 0;position:relative}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .image-slider[_ngcontent-%COMP%]{padding:20px 0 0 10px;position:relative}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]{border-right:1px solid var(--xa-light-gray)}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]   chq-customloader[_ngcontent-%COMP%]{margin:auto}.hidden[_ngcontent-%COMP%]{display:none!important}.avatar[_ngcontent-%COMP%]{width:60px;height:61px;background:rgba(26,34,51,.2);border-radius:100px;display:flex;flex-direction:row;justify-content:center;align-items:center}.avatar[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:20px;line-height:25px}.show-sm[_ngcontent-%COMP%]{display:none!important}@media (max-width: 985px){.show-md[_ngcontent-%COMP%]{display:none!important}.show-sm[_ngcontent-%COMP%]{display:flex!important}}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container{border:1px solid var(--xa-form-border);border-radius:8px;background:var(--xa-white);margin-top:25px;margin-bottom:25px;padding:0 32px 32px}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container chq-customloader{margin:auto}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-label{margin-top:25px}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-label, .quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container{margin-left:calc(6px + 1.5vw);margin-right:calc(5px + 1.5vw)}.option-dropdown[_ngcontent-%COMP%]{width:180px}"]}),n})();var X=r(98889),rt=r(55386),Q=r(11481),E=r(74743),ct=r(88784),lt=r(44466),dt=r(4704),mt=r(64307);let W=(()=>{class n extends Q.hm{constructor(){super(...arguments),this.overrides={swipe:{velocity:.4,threshold:20,direction:rt.DIRECTION_ALL,enabled:!0}}}}return n.\u0275fac=function(){let c;return function(o){return(c||(c=e.n5z(n)))(o||n)}}(),n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();const ht=[{path:"",component:U,canDeactivate:[X.I],resolve:{version:E.n}},{path:"vehicle",component:Ie,resolve:{version:E.n}},{path:"document",component:mt.O,resolve:{version:E.n}},{path:"photos",component:dt.X,resolve:{version:E.n}},{path:"estimate",component:st,resolve:{version:E.n}},{path:"refresh",component:U}];let pt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[X.I,{provide:Q.ok,useClass:W}],imports:[Q.t6,_.ez,O.Ps,u.p,lt.m,w.Bz.forChild(ht),R.H,ct.T,I.aw,z.u]}),n})()},25268:function(B){B.exports=function(){"use strict";var P="minute",r=/[+-]\d\d(?::?\d\d)?/g,_=/([+-]|\d\d)/g;return function(w,R,O){var u=R.prototype;O.utc=function(l){return new R({date:l,utc:!0,args:arguments})},u.utc=function(l){var f=O(this.toDate(),{locale:this.$L,utc:!0});return l?f.add(this.utcOffset(),P):f},u.local=function(){return O(this.toDate(),{locale:this.$L,utc:!1})};var V=u.parse;u.parse=function(l){l.utc&&(this.$u=!0),this.$utils().u(l.$offset)||(this.$offset=l.$offset),V.call(this,l)};var T=u.init;u.init=function(){if(this.$u){var l=this.$d;this.$y=l.getUTCFullYear(),this.$M=l.getUTCMonth(),this.$D=l.getUTCDate(),this.$W=l.getUTCDay(),this.$H=l.getUTCHours(),this.$m=l.getUTCMinutes(),this.$s=l.getUTCSeconds(),this.$ms=l.getUTCMilliseconds()}else T.call(this)};var e=u.utcOffset;u.utcOffset=function(l,f){var b=this.$utils().u;if(b(l))return this.$u?0:b(this.$offset)?e.call(this):this.$offset;if("string"==typeof l&&null===(l=function(x){void 0===x&&(x="");var S=x.match(r);if(!S)return null;var I=(""+S[0]).match(_)||["-",0,0],k=60*+I[1]+ +I[2];return 0===k?0:"+"===I[0]?k:-k}(l)))return this;var D=Math.abs(l)<=16?60*l:l,v=this;if(f)return v.$offset=D,v.$u=0===l,v;if(0!==l){var F=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(v=this.local().add(D+F,P)).$offset=D,v.$x.$localOffset=F}else v=this.utc();return v};var A=u.format;u.format=function(l){return A.call(this,l||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":""))},u.valueOf=function(){var l=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*l},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var G=u.toDate;u.toDate=function(l){return"s"===l&&this.$offset?O(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():G.call(this)};var y=u.diff;u.diff=function(l,f,b){if(l&&this.$u===l.$u)return y.call(this,l,f,b);var D=this.local(),v=O(l).local();return y.call(D,v,f,b)}}}()}}]);