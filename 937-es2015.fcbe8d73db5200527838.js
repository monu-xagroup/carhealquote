"use strict";(self.webpackChunkcar_heal_quote=self.webpackChunkcar_heal_quote||[]).push([[937],{40937:function(e,t,i){i.r(t),i.d(t,{ChqNewCaseModule:function(){return mt},MyHammerConfig:function(){return lt}});var o=i(38583),n=i(55278),a=i(89993),s=i(76627),r=i(25852),c=i(7408),l=i(54121),d=i(37716);let m=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=d.Xpm({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class h extends m{canDeactivate(){return!this.checkDataChanged()}}var p=i(83853),u=i(4893),g=i(95016),v=i(38709),f=i(85567),b=i(35782),M=i(67017),C=i(36978),O=i(54135),w=i(29790);const x=["companyOrg"],y=["licenseId"],I=["driverPhone"],D=["driverCode"],q=["orgType"];function P(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-input",33),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw(2).onFormUpdate(t)}),d.qZA()}if(2&e){const e=d.oxw(2);d.Q6J("inputModel",e.formModel.claimNumber)}}const S=function(e){return{hide:e}};function Z(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",34),d.TgZ(1,"div",35),d.TgZ(2,"div",36),d.TgZ(3,"label",10),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.TgZ(6,"chq-input",37),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw(2).onFormUpdate(t)}),d.qZA(),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw(2);d.Q6J("ngClass",d.VKq(5,S,e.isFormConfirmed)),d.xp6(4),d.Oqu(d.lcZ(5,3,"car_owner_details")),d.xp6(2),d.Q6J("inputModel",e.formModel.carOwnerSelector)}}const _=function(e){return{"disable-input disable-controls":e}};function T(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",5),d.TgZ(1,"div",35),d.TgZ(2,"div",36),d.TgZ(3,"label",10),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.TgZ(6,"chq-input",38,39),d.NdJ("clicked",function(t){return d.CHM(e),d.oxw(2).hideDropdown(t)})("controlOutput",function(t){return d.CHM(e),d.oxw(2).onFormUpdate(t)}),d.qZA(),d.TgZ(8,"chq-input",40,41),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw(2).onFormUpdate(t)}),d.qZA(),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw(2);d.xp6(4),d.Oqu(e.isRetailProvider&&e.isFormConfirmed?"car_owner_details":d.lcZ(5,4,"company_details")),d.xp6(2),d.Q6J("inputModel",e.formModel.companyName),d.xp6(2),d.Q6J("ngClass",d.VKq(6,_,"select"===e.formModel.companyName.type))("inputModel",e.formModel.licenseId)}}function F(e,t){if(1&e&&d._UZ(0,"chq-button",42),2&e){const e=d.oxw(2);d.Q6J("buttonModel",e.confirmButtonModel)}}function N(e,t){if(1&e&&d._UZ(0,"chq-button",42),2&e){const e=d.oxw(2);d.Q6J("buttonModel",e.nextButtonModel)}}const k=function(e){return{"text-mode":e}};function j(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",2),d._UZ(1,"chq-step-header",3),d.TgZ(2,"form",4),d.TgZ(3,"div",5),d.TgZ(4,"div",6),d.TgZ(5,"chq-input",7),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"div",5),d.TgZ(7,"div",8),d.TgZ(8,"div",9),d.TgZ(9,"label",10),d._uU(10),d.ALo(11,"translate"),d.qZA(),d.TgZ(12,"chq-input",11,12),d.NdJ("clicked",function(t){return d.CHM(e),d.oxw().hideDropdown(t)})("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.YNc(14,P,1,1,"chq-input",13),d.qZA(),d.qZA(),d.qZA(),d.YNc(15,Z,7,7,"div",14),d.YNc(16,T,10,8,"div",15),d.TgZ(17,"div",5),d.TgZ(18,"div",16),d.TgZ(19,"div",17),d.TgZ(20,"label",10),d._uU(21),d.ALo(22,"translate"),d.qZA(),d.TgZ(23,"div",18),d.TgZ(24,"chq-input",19),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(25,"chq-input",19),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(26,"div",20),d.TgZ(27,"div",18),d.TgZ(28,"chq-input",21),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(29,"div",22),d.TgZ(30,"div",18),d.TgZ(31,"chq-input",23,24),d.NdJ("clicked",function(t){return d.CHM(e),d.oxw().hideDropdown(t)})("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(33,"chq-input",25,26),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(35,"div",27),d.TgZ(36,"div",28),d.TgZ(37,"div",29),d._UZ(38,"img",30),d.qZA(),d.qZA(),d.TgZ(39,"div",31),d.YNc(40,F,1,1,"chq-button",32),d.YNc(41,N,1,1,"chq-button",32),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.Q6J("ngClass",d.VKq(20,k,e.isFormConfirmed)),d.xp6(1),d.Q6J("chqModel",e.header),d.xp6(4),d.Q6J("inputModel",e.formModel.jobNumber),d.xp6(5),d.Oqu(d.lcZ(11,16,"work_provider_details")),d.xp6(2),d.Q6J("inputModel",e.formModel.companyOrgType),d.xp6(2),d.Q6J("ngIf","Insurance Company"===e.customerFormData.companyOrgType),d.xp6(1),d.Q6J("ngIf",e.isRetailProvider),d.xp6(1),d.Q6J("ngIf",!e.isRetailProvider||e.customerFormData[e.formModel.carOwnerSelector.name]&&"Person"!==e.customerFormData[e.formModel.carOwnerSelector.name]),d.xp6(5),d.Oqu(e.isRetailProvider&&e.isFormConfirmed&&e.customerFormData[e.formModel.carOwnerSelector.name]&&"Person"===e.customerFormData[e.formModel.carOwnerSelector.name]?"car_owner_details":d.lcZ(22,18,"drivers_details")),d.xp6(3),d.Q6J("inputModel",e.formModel.firstName),d.xp6(1),d.Q6J("inputModel",e.formModel.lastName),d.xp6(3),d.Q6J("inputModel",e.formModel.email),d.xp6(3),d.Q6J("inputModel",e.formModel.driverCode),d.xp6(2),d.Q6J("inputModel",e.formModel.driverPhone),d.xp6(7),d.Q6J("ngIf",e.currentCaseStatus),d.xp6(1),d.Q6J("ngIf",e.isFormConfirmed&&!e.commonService.isViewOnly)}}function A(e,t){1&e&&d._UZ(0,"no-access-error")}let J=(()=>{class e extends h{constructor(e,t,i,o,n,a){super(),this.router=e,this.commonService=t,this.monitorService=i,this.caseService=o,this.coreService=n,this.route=a,this.header=p.XJ,this.isApiLoading=!0,this.confirmButtonModel={label:"",type:"primary"},this.nextButtonModel={label:"",type:"primary"},this.isFormConfirmed=!1,this.isRetail=!0,this.customerFormData={jobNumber:"",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",firstName:"",lastName:"",companyId:0,partnershipId:0,customerTypeID:1,driverCode:"",driverPhone:0,carOwnerSelector:"",email:""},this.caseId="0",this.caseObjectId=0,this.showNoAccess=!1,this.commonService.accessRight.closed&&(this.commonService.accessRight=new l.X(!0)),this.commonService.userProfileData.subscribe(e=>{if(e&&e.data){const{organizationDetail:t}=e.data;t&&(this.currentOrgId=t.id)}})}checkDataChanged(){return!this.isFormConfirmed&&(this.originalData?this.compareObjects(this.originalData,this.customerFormData):!!this.checkDataDirty())}compareObjects(e,t){const i=Object.keys(e);for(const o in i){const n=i[o];if(e[n]!==t[n])return!0}return!1}get isRetailProvider(){return!!this.customerFormData.companyOrgType&&"Retail"===this.customerFormData.companyOrgType}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0"),this.monitorService.logEvent("ngAfterViewInit",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}get isRetailAndCompanyProvider(){return!!this.customerFormData.companyOrgType&&("Retail"!==this.customerFormData.companyOrgType||"Retail"===this.customerFormData.companyOrgType&&this.customerFormData.carOwnerSelector&&"Person"!==this.customerFormData.carOwnerSelector)}get retail(){return this.customerFormData.companyOrgType?this.formModel.companyOrgType.selectedOption[this.formModel.companyOrgType.displayValue]:""}updateButton(){const e=Object.keys(this.formModel);for(const t in e){const i=e[t];this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{mode:this.isFormConfirmed?"value":"text"})}this.isFormConfirmed=!this.isFormConfirmed,this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:this.isFormConfirmed?"Change details":"Confirm",type:this.isFormConfirmed?"outline":"primary",icon:this.isFormConfirmed?"gobackward":"check"}),this.monitorService.logEvent("updateButton",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}setTextMode(){const e=Object.keys(this.formModel);for(const t in e){const i=e[t];if("companyOrgType"===i){const e={},{displayValue:t,fieldValue:o}=this.formModel[i];e[o]=this.customerFormData[i],e[t]="",e[t]=this.customerFormData[i],this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{mode:"text",selectedOption:e})}else this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{mode:"text"})}this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:"Change details",type:"outline",icon:"gobackward"}),this.monitorService.logEvent("setTextMode",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}confirmData(){if(this.monitorService.logEvent("confirmData",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}]),this.isFormConfirmed)return this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.selectedOption.name="",this.formModel.companyOrgType.observable=this.caseService.getProviders(),setTimeout(()=>{this.orgType.triggerObservable()})),void this.updateButton();this.commonService.showLoading();const e={companyOrgType:this.customerFormData.companyOrgType,caseTypeID:1,customerTypeID:"Retail"===this.customerFormData.companyOrgType?this.customerFormData.customerTypeID:null,domainID:2100,tariffId:this.customerFormData.tariffId,isTariffEditable:this.customerFormData.isTariffEditable,firstName:this.customerFormData.firstName,lastName:this.customerFormData.lastName,countryCode:this.customerFormData.driverCode,mobileNumber:this.customerFormData.driverPhone.toString(),email:this.customerFormData.email,companyId:this.customerFormData.companyId,partnershipId:this.customerFormData.partnershipId,claimNumber:"Insurance Company"===this.customerFormData.companyOrgType?this.customerFormData.claimNumber:"",companyName:this.isRetailAndCompanyProvider?this.customerFormData.companyName:"",companyLicenseNumber:this.isRetailAndCompanyProvider?this.customerFormData.licenseId:""};this.commonService.repairPermission||(e.externalID=this.customerFormData.jobNumber),"0"!=this.caseId?(e.caseId=this.caseObjectId,e.caseGuid=this.caseId,this.caseService.updateCase(e).subscribe({next:e=>{e&&(this.updateButton(),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])),this.commonService.hideLoading()},error:e=>{this.commonService.hideLoading(),this.monitorService.logException(e,c._.Error)}})):this.caseService.saveNewCase(e).subscribe({next:e=>{e&&(this.caseId=e.data.caseGuid,this.commonService.caseId.next(this.caseId),this.caseObjectId=e.data.id,this.header.caseNumber=e.data.caseNumber,this.updateButton(),this.router.navigate([`/quote/case/${this.caseId}`],{replaceUrl:!0}),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])),this.commonService.hideLoading()},error:e=>{this.commonService.hideLoading(),this.monitorService.logException(e,c._.Error)}})}hideDropdown(e){var t,i,o,n;e===this.formModel.companyOrgType.name?(this.driverCode.closeDropdown(),null===(t=this.companyOrg)||void 0===t||t.closeDropdown()):e===this.formModel.companyName.name?(this.driverCode.closeDropdown(),null===(i=this.orgType)||void 0===i||i.closeDropdown()):(null===(o=this.orgType)||void 0===o||o.closeDropdown(),null===(n=this.companyOrg)||void 0===n||n.closeDropdown())}onObservableLoad(e){var t;if(this.commonService.hideLoading(),e&&e&&e.length>0){const i=e.filter(e=>{var t;return e.phoneCountryCode===(null===(t=this.formModel.driverCode.selectedOption)||void 0===t?void 0:t.phoneCountryCode)});if(i.length>0){const e=i[0],t=e.regExpression;this.formModel.driverCode=Object.assign(Object.assign({},this.formModel.driverCode),{selectedOption:e}),this.driverPhone.updateCurrentValidation(t,!0)}const o=null===(t=this.route.parent)||void 0===t?void 0:t.snapshot.paramMap.get("id");(!o||"0"===o)&&this.setPrefillData(e)}}onFormUpdate(e){var t,i,o,n;if(this.monitorService.logEvent("onFormUpdate",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId,output:e}]),"driverCode"===e.name&&this.driverPhone.updateCurrentValidation(e.value.regExpression),"select"===e.type){const a=this.customerFormData[e.name],s=this.formModel[e.name].fieldValue||this.formModel[e.name].displayValue;if((null===(t=this.formModel[e.name])||void 0===t?void 0:t.selectedOption)&&(null===(i=this.formModel[e.name])||void 0===i?void 0:i.selectedOption[s])===(null==e?void 0:e.value[s]))return;this.formModel[e.name]=Object.assign(Object.assign({},this.formModel[e.name]),{selectedOption:e.value}),this.customerFormData[e.name]=e.value[s],"companyOrgType"===e.name&&(a!==this.customerFormData[e.name]&&setTimeout(()=>{var e,t;null===(e=this.companyOrg)||void 0===e||e.setUnTouched(),null===(t=this.licenseId)||void 0===t||t.setUnTouched()}),e.value[s]&&"Insurance Company"!==e.value[this.formModel[e.name].displayValue]&&(this.formModel.claimNumber=Object.assign(Object.assign({},this.formModel.claimNumber),{value:""})),e.value[s]&&"Retail"!==e.value[this.formModel[e.name].displayValue]?(this.formModel.companyName=Object.assign(Object.assign({},this.formModel.companyName),{displayValue:"companyName",fieldValue:"companyName",onObservableLoad:this.updateCaseData.bind(this),placeHolder:"Select...",value:"",type:"select",observable:this.caseService.getCompanyData(e.value[s],"")}),this.formModel.companyName.selectedOption&&(null===(o=this.formModel.companyName.selectedOption)||void 0===o?void 0:o.tariffId)&&(this.customerFormData.companyId=null,this.customerFormData.companyName=null,this.formModel.companyName.selectedOption={}),this.customerFormData.licenseId="",this.formModel.licenseId=Object.assign(Object.assign({},this.formModel.licenseId),{value:""}),setTimeout(()=>{var e;a&&"Retail"!==a&&this.currentStatus&&(null===(e=this.companyOrg)||void 0===e||e.triggerObservable())})):(e.value[s]&&"Retail"===e.value[this.formModel[e.name].displayValue]&&(this.formModel.claimNumber=Object.assign(Object.assign({},this.formModel.claimNumber),{value:""}),this.formModel.companyName=Object.assign(Object.assign({},this.formModel.companyName),{placeHolder:"Company Name"}),this.customerFormData.claimNumber="",this.currentStatus&&this.caseService.getCompanyData(e.value[s],"").subscribe({next:e=>{var t,i,o;if(e&&(null===(t=e.data)||void 0===t?void 0:t.length)>0){const t=e.data[0];this.customerFormData.companyId=t.companyId,this.customerFormData.tariffId=t.tariffId,this.formModel.companyName.selectedOption&&(null===(i=this.formModel.companyName.selectedOption)||void 0===i?void 0:i.tariffId)&&(this.customerFormData.licenseId="",this.formModel.licenseId=Object.assign(Object.assign({},null===(o=this.formModel)||void 0===o?void 0:o.licenseId),{value:""})),"Person"===this.customerFormData[this.formModel.carOwnerSelector.name]&&(this.customerFormData.companyName=null,this.formModel.companyName.value=""),this.customerFormData.isTariffEditable=t.isEditable,this.customerFormData.partnershipId=t.partnershipId,this.formModel.companyName.selectedOption=t[0],this.checkForFormValidation()}},error:()=>{this.customerFormData.tariffId=0,this.customerFormData.isTariffEditable=!1}})),this.formModel.companyName=Object.assign(Object.assign({},this.formModel.companyName),{type:"text"}))),"companyName"===e.name&&e.value&&(this.customerFormData.companyId=e.value.companyId,this.customerFormData.tariffId=e.value.tariffId,this.customerFormData.isTariffEditable=e.value.isEditable,this.customerFormData.licenseId=e.value.licenseId.toString(),this.formModel.licenseId=Object.assign(Object.assign({},null===(n=this.formModel)||void 0===n?void 0:n.licenseId),{value:e.value.licenseId.toString()}),this.customerFormData.partnershipId=e.value.partnershipId),this.customerFormData[this.formModel[e.name].idField]=e.value[this.formModel[e.name].displayValue]}else"carOwnerSelector"===e.name&&e.keyFieldValue&&this.formModel[e.name].idField&&(this.customerFormData[this.formModel[e.name].idField]=e.keyFieldValue),e.isValid?(this.formModel[e.name].value=e.value,this.customerFormData[e.name]=e.value):(this.formModel[e.name].value="",this.customerFormData[e.name]="driverPhone"!==e.name?"":0);this.customerFormData=Object.assign({},this.customerFormData),this.checkForFormValidation()}navigateToVehicle(){this.monitorService.logEvent("navigateToVehicle",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])}updateCaseData(e){var t;if(e&&this.customerFormData.companyId&&!this.customerFormData.tariffId){const i=e.filter(e=>e.companyId===this.customerFormData.companyId);i.length>0&&(this.customerFormData.tariffId=i[0].tariffId,this.customerFormData.isTariffEditable=i[0].isEditable,this.formModel.licenseId=Object.assign(Object.assign({},null===(t=this.formModel)||void 0===t?void 0:t.licenseId),{value:i[0].licenseId.toString()}),this.customerFormData.partnershipId=i[0].partnershipId,this.formModel.companyName.selectedOption=i[0])}}get currentStatus(){var e,t,i;return!(null===(e=this.caseResponse)||void 0===e?void 0:e.status)&&!this.isFormConfirmed||-1===["reject","rejected","approved","closed","repairestimation"].indexOf(null===(i=null===(t=this.caseResponse)||void 0===t?void 0:t.status)||void 0===i?void 0:i.toLowerCase())&&!this.isFormConfirmed}get currentCaseStatus(){var e,t,i,o,n;return!(null===(e=this.caseResponse)||void 0===e?void 0:e.status)&&this.currentOrgId===(null===(i=null===(t=this.caseResponse)||void 0===t?void 0:t.organizationDetail)||void 0===i?void 0:i.organizationId)||!this.commonService.isViewOnly&&-1===["reject","rejected","approved","closed","repairestimation","complete"].indexOf(null===(n=null===(o=this.caseResponse)||void 0===o?void 0:o.status)||void 0===n?void 0:n.toLowerCase())}loadCaseDetails(){var e;const t=Object.keys(this.formModel),i=null===(e=this.route.parent)||void 0===e?void 0:e.snapshot.paramMap.get("id");if(i&&"0"!=i)this.caseId=i,this.isApiLoading=!0,this.commonService.caseId.next(this.caseId),this.commonService.showLoading(),this.caseService.getCaseDetail(this.caseId).subscribe({next:e=>{var i,o;this.caseResponse=e.data,this.caseObjectId=this.caseResponse.id,this.commonService.caseStatus.next(this.caseResponse.status),this.caseResponse.inspections.length>0&&this.commonService.inspectionId.next(this.caseResponse.inspections[0].inspectionId),this.commonService.isViewOnly=this.currentOrgId!=(null===(o=null===(i=this.caseResponse)||void 0===i?void 0:i.organizationDetail)||void 0===o?void 0:o.organizationId),(!this.currentStatus||this.commonService.isViewOnly)&&(this.setTextMode(),this.isFormConfirmed=!0),this.header.caseNumber=this.caseResponse.caseNumber,this.formDataFromResponse=(0,p.Wk)(this.caseResponse),this.customerFormData=(0,p.Qb)(this.formDataFromResponse),this.originalData=JSON.parse(JSON.stringify(this.customerFormData));for(const n in t){const e=this.formModel[t[n]],{type:i,displayValue:o,fieldValue:a}=e;if(this.customerFormData[t[n]])if("select"===i){const e={};e[o]="",e[a]=this.customerFormData[t[n]],!this.currentStatus&&"companyOrgType"===t[n]&&(e[o]=this.customerFormData[t[n]]),this.formModel[t[n]]=Object.assign(Object.assign({},this.formModel[t[n]]),{value:"",selectedOption:e})}else{let e={};"companyName"===t[n]&&(e={companyName:this.customerFormData[t[n]]}),this.formModel[t[n]]=Object.assign(Object.assign({},this.formModel[t[n]]),{value:this.customerFormData[t[n]],selectedOption:e})}}this.checkRouteParams(),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()},complete:()=>{this.isApiLoading=!1}});else{this.isApiLoading=!1,this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.observable=this.caseService.getProviders());for(const e in t){const i=t[e];"driverCode"!==i?this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{value:"",selectedOption:{}}):(this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{value:"",selectedOption:{phoneCountryCode:"+91"}}),this.customerFormData.driverCode="+91")}}}setPrefillData(e){var t,i,o,n,a,s,r;const c=this.commonService.getSessionStorage("selectedSearchItem");if(c){const l=JSON.parse(c);if(this.formModel.email=Object.assign(Object.assign({},this.formModel.email),{value:l.email,selectedOption:{}}),this.customerFormData.email=l.email,l.firstName&&(this.customerFormData.firstName=l.firstName,this.formModel.firstName=Object.assign(Object.assign({},this.formModel.firstName),{value:this.customerFormData.firstName,selectedOption:{}})),l.lastName&&(this.customerFormData.lastName=l.lastName,this.formModel.lastName=Object.assign(Object.assign({},this.formModel.lastName),{value:this.customerFormData.lastName,selectedOption:{}})),l.phoneNumber){const c=null===(t=l.phoneNumber)||void 0===t?void 0:t.substring(0,3),d=null===(i=l.phoneNumber)||void 0===i?void 0:i.substring(0,4);let m="",h=e.filter(e=>e.phoneCountryCode===c);if(0===h.length?(m=null===(o=l.phoneNumber)||void 0===o?void 0:o.substring(4,null===(n=l.phoneNumber)||void 0===n?void 0:n.length),h=e.filter(e=>e.phoneCountryCode===d)):m=null===(a=l.phoneNumber)||void 0===a?void 0:a.substring(3,null===(s=l.phoneNumber)||void 0===s?void 0:s.length),h.length>0){const e=h[0],t=e.regExpression;this.customerFormData.driverCode=null==e?void 0:e.phoneCountryCode,this.formModel.driverCode=Object.assign(Object.assign({},this.formModel.driverCode),{selectedOption:e}),null===(r=this.driverPhone)||void 0===r||r.updateCurrentValidation(t,!0)}this.formModel.driverPhone=Object.assign(Object.assign({},this.formModel.driverPhone),{value:m,selectedOption:{}}),this.customerFormData.driverPhone=parseInt(m)}if(l.email||l.phoneNumber||l.firstName){if(l.make||l.model||l.vin||l.plate)return;this.commonService.setSessionStorage("selectedSearchItem","")}}}checkDataDirty(){return Object.keys(this.customerFormData),this.compareObjects(this.customerFormData,{jobNumber:"",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",firstName:"",lastName:"",companyId:0,partnershipId:0,customerTypeID:1,driverCode:"+91",driverPhone:0,carOwnerSelector:"",email:""})}checkForFormValidation(){const e=Object.keys(this.customerFormData);let t=[];"Retail"===this.retail?"Person"===this.customerFormData.carOwnerSelector?t=["companyName","claimNumber","licenseId","companyId"]:"Company"===this.customerFormData.carOwnerSelector&&(t=["claimNumber","companyId"]):"Insurance Company"!=this.customerFormData.companyOrgType&&(t=["claimNumber"]),this.commonService.repairPermission&&t.push("jobNumber");let i=!0;for(const o in e){const n=e[o];"carOwnerSelector"===n||"isTariffEditable"===n||-1!==t.indexOf(n)||this.customerFormData[n]||(i=!1)}if(this.isFormConfirmed)this.confirmButtonModel.type="outline";else if(i){if(this.isFormConfirmed)return void(this.confirmButtonModel.type="outline");this.confirmButtonModel.type="primary"}else this.confirmButtonModel.type="disabled";this.monitorService.logEvent("checkForFormValidation",["ChqNewCustomerComponent","addenda-quote",{validationStatus:i?"Form is valid":"Form is invalid"}])}checkRouteParams(){this.route.queryParams.subscribe(e=>{const t=e.isBack;"true"===t||!0===t?(this.isFormConfirmed=!0,this.setTextMode()):this.currentStatus&&(this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.observable=this.caseService.getProviders()))})}ngOnInit(){this.monitorService.logEvent("ngOnInit",["ChqNewCustomerComponent","addenda-quote"]),this.formModel=(0,p.U6)(),this.commonService.repairPermission&&(this.formModel.jobNumber=Object.assign(Object.assign({},this.formModel.jobNumber),{disabled:!0,validation:null})),this.confirmButtonModel={label:"Confirm",type:"primary",icon:"check",onclick:this.confirmData.bind(this)},this.nextButtonModel={label:"Next add vehicle",type:"primary",icon:"plus-filled",onclick:this.navigateToVehicle.bind(this)},this.formModel.driverCode.observable||(this.formModel.driverCode.observable=this.coreService.getPhoneNumber(),this.formModel.driverCode.onObservableLoad=this.onObservableLoad.bind(this)),this.header.caseNumber="",this.checkForFormValidation(),this.loadCaseDetails(),this.commonService.accessRight.subscribe({next:e=>{e||(this.showNoAccess=!0)}});const e=document.querySelector(".addenda-container");e&&(e.scrollTop=0)}ngOnDestroy(){this.monitorService.logEvent("ngOnDestroy",["ChqNewCustomerComponent","addenda-quote"]),this.commonService.accessRight.unsubscribe(),this.commonService.isViewOnly=!1}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(n.F0),d.Y36(u.v),d.Y36(g.M),d.Y36(v.n),d.Y36(f.p),d.Y36(n.gz))},e.\u0275cmp=d.Xpm({type:e,selectors:[["chq-new-case"]],viewQuery:function(e,t){if(1&e&&(d.Gf(x,5),d.Gf(y,5),d.Gf(I,5),d.Gf(D,5),d.Gf(q,5)),2&e){let e;d.iGM(e=d.CRH())&&(t.companyOrg=e.first),d.iGM(e=d.CRH())&&(t.licenseId=e.first),d.iGM(e=d.CRH())&&(t.driverPhone=e.first),d.iGM(e=d.CRH())&&(t.driverCode=e.first),d.iGM(e=d.CRH())&&(t.orgType=e.first)}},features:[d.qOj],decls:2,vars:2,consts:[["class","new-case-container mh-0",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"new-case-container","mh-0",3,"ngClass"],[3,"chqModel"],[1,"form-container"],[1,"row"],[1,"job-number","col-3"],[3,"inputModel","controlOutput"],[1,"work-provider","col-6"],[1,"work-input-wrapper","row"],[1,"col-12","sub-heading"],[1,"col-6",3,"inputModel","clicked","controlOutput"],["orgType",""],["class","col-6",3,"inputModel","controlOutput",4,"ngIf"],["class","row",3,"ngClass",4,"ngIf"],["class","row",4,"ngIf"],[1,"driver-details","col-12"],[1,"driver-input-wrapper","row"],[1,"driver-fields-wrapper"],[1,"driver-field",3,"inputModel","controlOutput"],[1,"driver-address-wrapper","row"],[1,"driver-field","basis-272",3,"inputModel","controlOutput"],[1,"driver-field","basis-272"],[1,"driver-field","driver-code-field","no-padding",3,"inputModel","clicked","controlOutput"],["driverCode",""],[1,"driver-field","no-padding",3,"inputModel","controlOutput"],["driverPhone",""],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],[1,"footer-button-wrapper"],[3,"buttonModel",4,"ngIf"],[1,"col-6",3,"inputModel","controlOutput"],[1,"row",3,"ngClass"],[1,"insurer-details","col-12"],[1,"insurance-input-wrapper","row"],[1,"company-input","col-3",3,"inputModel","controlOutput"],[1,"company-input","col-6",3,"inputModel","clicked","controlOutput"],["companyOrg",""],[1,"col-6",3,"ngClass","inputModel","controlOutput"],["licenseId",""],[3,"buttonModel"]],template:function(e,t){1&e&&(d.YNc(0,j,42,22,"div",0),d.YNc(1,A,1,0,"no-access-error",1)),2&e&&(d.Q6J("ngIf",!t.isApiLoading&&!t.showNoAccess),d.xp6(1),d.Q6J("ngIf",t.showNoAccess))},directives:[o.O5,o.mk,b._,M.D,C.E,O.U],pipes:[w.X$],styles:[".new-case-container[_ngcontent-%COMP%]{height:calc(100vh - 76px - calc(5px + 1.5vw + 58px + 1.6vw + 1.5vw));overflow:hidden;overflow-y:auto;padding:0 calc(5px + 1.5vw);padding-bottom:1.5vw}.new-case-container[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]{font-weight:700;font-size:14px;line-height:20px;color:var(--xa-black)}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;flex:1}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .job-number[_ngcontent-%COMP%]{margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]{flex-direction:column;margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   .work-input-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   .car-owner-wrapper[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]{margin-bottom:10px;flex-direction:column}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]   .insurance-input-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]{flex:4;display:flex;flex-direction:column}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-input-wrapper[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-address-wrapper[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-input-wrapper[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-address-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field[_ngcontent-%COMP%]{flex:1 1 120px;padding:10px;width:120px}@media (max-width: 850px){.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field[_ngcontent-%COMP%]{padding:6px}}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.no-padding[_ngcontent-%COMP%]{padding:0}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.driver-code-field[_ngcontent-%COMP%]{min-width:120px;max-width:120px;padding-right:20px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.basis-272[_ngcontent-%COMP%]{flex-basis:272px}.new-case-container[_ngcontent-%COMP%]   .hide[_ngcontent-%COMP%]{display:none}.new-case-container[_ngcontent-%COMP%]   .disable-input[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .partial-disable-info[_ngcontent-%COMP%]{pointer-events:none}.text-mode[_ngcontent-%COMP%]   .job-number[_ngcontent-%COMP%]{padding-left:9px}  .disable-controls input{opacity:.6!important}"]}),e})();var E=i(97582),R=i(57445),L=i(49517),V=i(60562),Q=i(48873),Y=i(4093),G=i(13975),H=i(50356),U=i(74178);const B=["make"],z=["model"],X=["year"];function K(e,t){if(1&e&&d._UZ(0,"chq-button",25),2&e){const e=d.oxw(2);d.Q6J("buttonModel",e.confirmButtonModel)}}function $(e,t){if(1&e&&d._UZ(0,"chq-button",25),2&e){const e=d.oxw(2);d.Q6J("buttonModel",e.nextButtonModel)}}const W=function(e){return{"text-mode":e}},ee=function(e){return{"partial-disable-info":e}},te=function(e){return{"disable-input disable-controls":e}},ie=function(e){return{"partial-disable-info disable-controls":e}};function oe(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",2),d._UZ(1,"chq-step-header",3),d.TgZ(2,"label",4),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"div",5),d.TgZ(6,"chq-input",6),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.qZA(),d.TgZ(7,"form",7),d.TgZ(8,"div",8),d.TgZ(9,"chq-input",9,10),d.NdJ("clicked",function(t){return d.CHM(e),d.oxw().hideDropdown(t)})("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(11,"chq-input",11,12),d.NdJ("clicked",function(t){return d.CHM(e),d.oxw().hideDropdown(t)})("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(13,"chq-input",13,14),d.NdJ("clicked",function(t){return d.CHM(e),d.oxw().hideDropdown(t)})("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.qZA(),d.TgZ(15,"div",15),d.TgZ(16,"chq-input",6),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(17,"chq-input",6),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.TgZ(18,"chq-input",16),d.NdJ("controlOutput",function(t){return d.CHM(e),d.oxw().onFormUpdate(t)}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(19,"div",17),d._UZ(20,"img",18),d.qZA(),d.TgZ(21,"div",19),d.TgZ(22,"div",20),d.TgZ(23,"div",21),d._UZ(24,"img",22),d.qZA(),d.qZA(),d.TgZ(25,"div",23),d.YNc(26,K,1,1,"chq-button",24),d.YNc(27,$,1,1,"chq-button",24),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.Q6J("ngClass",d.VKq(20,W,e.isFormConfirmed)),d.xp6(1),d.Q6J("chqModel",e.vehicleHeader),d.xp6(2),d.Oqu(d.lcZ(4,18,"vehicle_detail")),d.xp6(2),d.Q6J("ngClass",d.VKq(22,ee,e.searchDisabled)),d.xp6(1),d.Q6J("inputModel",e.formModel.vin),d.xp6(2),d.Q6J("ngClass",d.VKq(24,te,e.inputDisabled)),d.xp6(1),d.Q6J("inputModel",e.formModel.make)("ngClass",d.VKq(26,te,e.makeDisabled)),d.xp6(2),d.Q6J("inputModel",e.formModel.model)("ngClass",d.VKq(28,te,e.modelDisabled)),d.xp6(2),d.Q6J("inputModel",e.formModel.year)("ngClass",d.VKq(30,te,e.yearDisabled)),d.xp6(2),d.Q6J("ngClass",d.VKq(32,ie,e.infoDisabled)),d.xp6(1),d.Q6J("inputModel",e.formModel.licensePlate),d.xp6(1),d.Q6J("inputModel",e.formModel.carMilege),d.xp6(1),d.Q6J("inputModel",e.formModel.registrationDate),d.xp6(8),d.Q6J("ngIf",e.currentStatus),d.xp6(1),d.Q6J("ngIf",e.isFormConfirmed&&!e.commonService.isViewOnly)}}function ne(e,t){1&e&&d._UZ(0,"no-access-error")}let ae=(()=>{class e{constructor(e,t,i,o,n,a,s,r,c,d){this.router=e,this.commonService=t,this.route=i,this.caseService=o,this.vehicleService=n,this.inspectionService=a,this.monitorService=s,this.labourService=r,this.mediaCollectionService=c,this.cd=d,this.vehicleHeader=V.mo,this.caseId="0",this.status="",this.tariffId=0,this.vehicleFormData={vin:"",make:"",model:"",year:"",carMilege:"",licensePlate:"",registrationDate:""},this.isFormConfirmed=!1,this.serviceName="vin",this.inputDisabled=!0,this.infoDisabled=!0,this.searchDisabled=!1,this.importTerms=[],this.vehicleId=0,this.inspections={},this.domainID=0,this.partnershipId=0,this.labourData=null,this.makeDisabled=!1,this.preventVinCall=!1,this.caseCreatedDate="",this.umc="",this.originalVin="",this.modelDisabled=!1,this.yearDisabled=!1,this.inspectionTemplateId=0,this.showNoAccess=!1,this.customerName="",this.email="",this.originalTariffObject={},this.userPermission={},this.commonService.eventfromToastComponent$.subscribe(e=>{e&&(this.monitorService.logEvent("eventfromToastComponent",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/document`]))}),this.commonService.accessRight.closed&&(this.commonService.accessRight=new l.X(!0)),this.commonService.userProfileData.subscribe(e=>{if(e&&e.data){const{userPermission:t,vehicleSourceType:i,organizationDetail:o}=e.data;this.userPermission=t||{},this.estimateId=i,o&&(this.currentOrgId=o.id)}})}checkGTEstimatePermission(){const{orgPackages:e=[]}=this.userPermission,t=e.filter(e=>"Repair Estimate"===e.automotiveServiceName);if(t&&t.length>0){const{permissions:e}=t[0],i=e.filter(e=>"gt.estimate"===e.permissionName||"gt.estimate.vinquery"===e.permissionName);if(i&&i.length>0)return!0}return!1}process(e){return(0,E.mG)(this,void 0,void 0,function*(){if(this.caseId=e,this.commonService.showLoading(),yield this.populateReadonlyFields(e).then(e=>{var t,i,o,n,a,s;if(null==e.data)return void this.commonService.hideLoading();this.vehicleId=e.data.vehicleId||0,this.vehicleHeader.caseNumber=e.data.caseNumber;const{vinNumber:r,licensePlateNumber:c,vehicleMileage:l,registrationDate:d,vehicleMake:m,vehicleModel:h,modelYear:p,status:u,tariffs:g,domainID:v,umc:f,id:b}=e.data;this.id=b,0!=this.vehicleId&&(this.infoDisabled=!1,this.searchDisabled=!1,this.inputDisabled=!1,this.preventVinCall=!0,this.originalVin=r,this.labourData=g.length>0?g[0]:[]),this.customerName=null===(t=e.data.caseDetail)||void 0===t?void 0:t.firstName,this.email=null===(i=e.data.caseDetail)||void 0===i?void 0:i.email,this.vehicleHeader.caseNumber=e.data.caseNumber,this.caseCreatedDate=e.data.createdDate,this.formModel.vin=Object.assign(Object.assign({},this.formModel.vin),{value:r}),this.status=u,this.commonService.caseStatus.next(u),this.formModel.licensePlate=Object.assign(Object.assign({},this.formModel.licensePlate),{value:c}),this.formModel.carMilege=Object.assign(Object.assign({},this.formModel.carMilege),{value:l}),this.formModel.registrationDate=Object.assign(Object.assign({},this.formModel.registrationDate),{value:d}),this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{name:m}}),this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{name:p||e.data.modelYearRange}}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{modelDescription:h}}),this.umc=f,this.tariffId=null===(o=g[0])||void 0===o?void 0:o.tariffId,this.isTariffEditable=null===(n=g[0])||void 0===n?void 0:n.isEditable,this.partnershipId=null===(a=g[0])||void 0===a?void 0:a.partnershipId,this.domainID=v,this.inspections=e.data.inspections[0],this.inspections&&this.commonService.inspectionId.next(this.inspections.inspectionId),this.originalTariffObject={make:m,partnershipId:this.partnershipId,registrationDate:Q(d).format("YYYY-MM-DDT00:00:00")},this.vehicleFormData=Object.assign(Object.assign({},this.vehicleFormData),{vin:r,make:m,model:h,year:p||e.data.modelYearRange,carMilege:l,licensePlate:c,registrationDate:d}),this.commonService.isViewOnly=this.currentOrgId!=(null===(s=e.data.organizationDetail)||void 0===s?void 0:s.organizationId),this.validate(),this.commonService.hideLoading()}).catch(()=>{this.commonService.hideLoading()}),this.prefillVehicleData(),0!=this.vehicleId||this.commonService.isViewOnly)return this.setTextMode(),void(this.isFormConfirmed=!0);yield this.populateDropdowns()})}prefillVehicleData(){const e=this.commonService.getSessionStorage("selectedSearchItem");if(e){const t=JSON.parse(e);t.vin&&!this.vehicleFormData.vin&&(this.preventVinCall=!0,this.vehicleFormData.vin=t.vin,this.formModel.vin=Object.assign(Object.assign({},this.formModel.vin),{value:t.vin})),t.make&&!this.vehicleFormData.make&&(this.vehicleFormData.make=t.make,this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{name:t.make}})),t.model&&!this.vehicleFormData.model&&(this.vehicleFormData.model=t.model,this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{modelDescription:t.model}})),t.importInterval&&!this.vehicleFormData.year&&(this.vehicleFormData.year=t.importInterval,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{value:t.importInterval,selectedOption:{name:t.importInterval}})),t.plate&&!this.vehicleFormData.licensePlate&&(this.vehicleFormData.licensePlate=t.plate,this.formModel.licensePlate=Object.assign(Object.assign({},this.formModel.licensePlate),{value:t.plate})),(t.make||t.model||t.vin||t.plate)&&(this.commonService.setSessionStorage("selectedSearchItem",""),this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!0,this.enableDropdowns())}}populateDropdowns(){return(0,E.mG)(this,void 0,void 0,function*(){const e=yield(0,R.z)(this.vehicleService.getVehicleMake());this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{options:e.sort((e,t)=>e.name.localeCompare(t.name))});const t=this.formModel.make.options.filter(e=>e.name===this.vehicleFormData.make);t.length>0&&this.vehicleService.getVehicleModel(t[0].id,this.estimateId).subscribe(e=>{var t,i;this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{options:e});const o=null===(t=this.formModel.model.options)||void 0===t?void 0:t.filter(e=>e.umc==this.umc);o.length>0&&(null===(i=this.vehicleService.getVehicleYearByModel(o[0].id,this.estimateId))||void 0===i||i.subscribe(e=>{this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{options:e})}))})})}populateReadonlyFields(e){return(0,E.mG)(this,void 0,void 0,function*(){if(e&&"0"!=e)return this.caseId=e,this.commonService.showLoading(),(0,R.z)(this.caseService.getCaseDetail(e))})}navigateToDocument(){this.monitorService.logEvent("navigateToDocument",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/document`])}ngOnInit(){var e,t,i,o;return(0,E.mG)(this,void 0,void 0,function*(){this.formModel=(0,V.br)(),this.confirmButtonModel={label:"Confirm",type:"primary",icon:"check",onclick:this.confirmData.bind(this)},this.nextButtonModel={label:"Next add documents",type:"primary",icon:"plus-filled",onclick:this.navigateToDocument.bind(this)};const n=null===(o=null===(i=null===(t=null===(e=this.route)||void 0===e?void 0:e.parent)||void 0===t?void 0:t.snapshot)||void 0===i?void 0:i.paramMap)||void 0===o?void 0:o.get("id");this.monitorService.logEvent("ngOnInit",["ChqNewVehicleComponent","addenda-quote",{caseId:n}]),this.commonService.accessRight.subscribe({next:e=>{e||(this.showNoAccess=!0)}}),this.inspectionService.getInspectionTemplateList().subscribe({next:e=>{const t=null==e?void 0:e.data;t.length>0&&(this.inspectionTemplateId=t[0].id)}}),yield this.process(n);const a=document.querySelector(".addenda-container");a&&(a.scrollTop=0)})}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0","vehicle"),this.monitorService.logEvent("ngAfterViewInit",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}])}setTextMode(){this.inputDisabled=!1,this.makeDisabled=!1;const e=Object.keys(this.formModel);for(const t in e){const i=e[t];this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{mode:"text"})}this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:"Change car",type:"outline",icon:"gobackward"})}updateButton(){return(0,E.mG)(this,void 0,void 0,function*(){const e=Object.keys(this.formModel);for(const t in e){const i=e[t];this.formModel[i]=Object.assign(Object.assign({},this.formModel[i]),{mode:this.isFormConfirmed?"value":"text"})}"Change car"==this.confirmButtonModel.label&&(this.preventVinCall=!0,this.vehicleService.getVinDecoder(this.vehicleFormData.vin).subscribe({next:e=>{this.makeDisabled=!!(null==e?void 0:e.success)}}),this.commonService.showLoading(),yield this.populateDropdowns(),this.commonService.hideLoading()),this.isFormConfirmed=!this.isFormConfirmed,this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:this.isFormConfirmed?"Change car":"Confirm",type:this.isFormConfirmed?"outline":"primary",icon:this.isFormConfirmed?"refresh":"check"})})}confirmData(){if(this.isFormConfirmed)this.updateButton();else if(this.commonService.showLoading(),this.vehicleId&&this.vehicleFormData.vin===this.originalVin)this.updateVehicle();else{const e={vin:this.vehicleFormData.vin,vehicleCountryId:1,umc:this.umc,make:this.vehicleFormData.make,model:this.vehicleFormData.model,mileage:Number(this.vehicleFormData.carMilege),firstRegistrationDate:Q(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00"),registrationNumber:this.vehicleFormData.licensePlate,condition:1,ModelYearRange:this.vehicleFormData.year,InspectionTemplateId:this.inspectionTemplateId,CustomerName:this.customerName,CustomerEmail:this.email};this.vehicleService.addVehicle(e,this.domainID,this.id).subscribe({next:e=>{e&&(this.vehicleId=e.id,this.inspections={},this.inspections.inspectionId=e.inspectionId,this.inspections.inspectionGuid=e.inspectionGuid,this.updateVehicle())},error:e=>{this.commonService.hideLoading()}})}}updateVehicle(){var e,t,i;return(0,E.mG)(this,void 0,void 0,function*(){this.monitorService.logEvent("updateVehicle",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.commonService.showLoading();const o={vin:this.vehicleFormData.vin,umc:this.umc,vehicleMake:this.vehicleFormData.make,vehicleModel:this.vehicleFormData.model,modelYearRange:(null===(e=this.vinGTMotive)||void 0===e?void 0:e.modelYearRange)||this.vehicleFormData.year,vehicleID:this.vehicleId,licensePlateNumber:this.vehicleFormData.licensePlate,vehicleMileage:Number(this.vehicleFormData.carMilege),registrationDate:Q(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00")},n={inspectionID:this.inspections.inspectionId,inspectionGuid:this.inspections.inspectionGuid},a=Q(this.vehicleFormData.registrationDate).year().toString();(this.originalTariffObject.make!=this.vehicleFormData.make||this.partnershipId!=this.originalTariffObject.partnershipId||Q(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00")!=this.originalTariffObject.registrationDate||!(null===(i=null===(t=this.labourData)||void 0===t?void 0:t.tariffLabourRates)||void 0===i?void 0:i.length))&&(yield this.getLabourData(this.tariffId,this.isTariffEditable,this.partnershipId,this.vehicleFormData.make,a)),this.vehicleService.updateVehicleCase({vehicle:o,inspection:n,tariff:this.labourData},this.caseId).subscribe({next:e=>{if(e){if(this.labourData.isEditable){let e=!0;if(this.labourData.tariffLabourRates.forEach(t=>{t.amount>0&&(e=!1)}),e){const e={objectId:this.caseId,link:"here",labourData:this.labourData};return this.commonService.hideLoading(),void this.commonService.showInfoToast(5e5,"labour_value_update",e)}}this.router.navigate([`/quote/case/${this.caseId}/document`])}this.commonService.hideLoading()},error:e=>{this.commonService.hideLoading()}})})}onFormUpdate(e){this.monitorService.logEvent("onFormUpdate",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId,output:e}]),"select"===e.type?(this.formModel[e.name]=Object.assign(Object.assign({},this.formModel[e.name]),{selectedOption:e.value}),this.vehicleFormData[e.name]=e.value[this.formModel[e.name].fieldValue],"make"==e.name?(this.vehicleFormData.model="",this.vehicleFormData.year=null,this.modelDisabled=!0,this.yearDisabled=!0,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{},options:[],observable:null}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{}}),e.value&&(this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{observable:this.vehicleService.getVehicleModel(e.value.id,this.estimateId),onObservableLoad:this.enableDropdowns.bind(this)}),setTimeout(()=>{this.model.triggerObservable()}))):"model"==e.name&&(this.yearDisabled=!0,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{},observable:null,options:[]}),this.vehicleFormData.year=null,e.value&&(this.umc=e.value.umc,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{observable:this.vehicleService.getVehicleYearByModel(e.value.id,this.estimateId),onObservableLoad:this.enableDropdowns.bind(this)}),setTimeout(()=>{this.year.triggerObservable()})))):e.isValid?(this.formModel[e.name].value=e.value,this.vehicleFormData[e.name]=e.value):(this.formModel[e.name].value="",this.vehicleFormData[e.name]=""),this.vehicleFormData=Object.assign({},this.vehicleFormData),"vin"==e.name&&e.isValid&&this.populateForm(),this.validate()}enableDropdowns(){this.modelDisabled=!1,this.yearDisabled=!1}hideDropdown(e){e===this.formModel.make.name?(this.model.closeDropdown(),this.year.closeDropdown()):e===this.formModel.model.name?(this.make.closeDropdown(),this.year.closeDropdown()):(this.model.closeDropdown(),this.make.closeDropdown())}validate(){const e=Object.keys(this.vehicleFormData);this.monitorService.logEvent("validate",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]);let t=!0;for(const i in e)if(!this.vehicleFormData[e[i]]){t=!1;break}this.confirmButtonModel.type=this.isFormConfirmed?"outline":t?"primary":"disabled"}populateForm(){var e;const t=null===(e=this.formModel.vin.value)||void 0===e?void 0:e.toLocaleString();this.monitorService.logEvent("populateForm",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),(0,L.D)(t).pipe().subscribe({complete:()=>{17==t.length&&!this.isFormConfirmed&&!this.preventVinCall&&(this.commonService.showLoading(),this.vehicleService.getVinDecoder(t).subscribe({error:()=>{this.commonService.hideLoading(),this.vinGTMotive=null,this.resetDropdown()},next:e=>{var t;if(null==e?void 0:e.success){this.vinGTMotive=e.data,this.umc=null===(t=this.vinGTMotive)||void 0===t?void 0:t.umc,this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{name:e.data.vehicleMake}}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{modelDescription:e.data.vehicleModel}});const i=this.formModel.make.options.filter(t=>t.name===e.data.vehicleMake);i.length>0&&(this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{observable:this.vehicleService.getVehicleModel(i[0].id,this.estimateId)}),setTimeout(()=>{this.model.triggerObservable()})),this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{name:e.data.modelYearRange}}),this.vehicleFormData.make=e.data.vehicleMake,this.vehicleFormData.model=e.data.vehicleModel,this.vehicleFormData.year=e.data.modelYearRange,this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!0,this.enableDropdowns()}else this.vinGTMotive=null,this.commonService.showInfoToast(5e3,"show-info | "+(null==e?void 0:e.message)),this.resetDropdown();setTimeout(()=>{this.make.dropdownValidationMessage="",this.make.dropdownContainer.dropdownConfig.isTouched=!1,this.make.dropdownContainer.dropdownConfig.isDirty=!1,this.model.dropdownValidationMessage="",this.model.dropdownContainer.dropdownConfig.isTouched=!1,this.model.dropdownContainer.dropdownConfig.isDirty=!1,this.year.dropdownValidationMessage="",this.year.dropdownContainer.dropdownConfig.isTouched=!1,this.year.dropdownContainer.dropdownConfig.isDirty=!1},0),this.validate()},complete:()=>{this.commonService.hideLoading()}})),this.preventVinCall&&17==t.length&&(this.preventVinCall=!1)}})}resetDropdown(){this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!1,this.vehicleFormData.make="",this.vehicleFormData.model="",this.vehicleFormData.year=null,this.formModel.model.options=[],this.formModel.year.options=[],this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{}}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{}}),this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{}})}get currentStatus(){var e;return!this.status&&!this.commonService.isViewOnly||!this.commonService.isViewOnly&&-1===["reject","rejected","approved","closed","repairestimation","complete"].indexOf(null===(e=this.status)||void 0===e?void 0:e.toLowerCase())}getLabourData(e,t,i,o,n){return(0,E.mG)(this,void 0,void 0,function*(){return this.monitorService.logEvent("getLabourData",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),(0,R.z)(this.labourService.getLabourData(e,o,Q(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00"),this.caseCreatedDate)).then(e=>{e.data&&(this.labourData={tariffId:e.data.id,tariffDiscountRates:e.data.tariffDiscountRates,tariffLabourRates:e.data.tariffLaborRates,isEditable:t,partnershipId:i})})})}getDomainId(){this.mediaCollectionService.getMediaTemplate().subscribe({next:e=>{(null==e?void 0:e.data.length)>0&&(this.domainID=e.data[0].domainID)}})}ngOnDestroy(){this.monitorService.logEvent("ngOnDestroy",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.formModel=(0,V.br)(),this.commonService.accessRight.unsubscribe(),this.commonService.isViewOnly=!1}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(n.F0),d.Y36(u.v),d.Y36(n.gz),d.Y36(v.n),d.Y36(Y.f),d.Y36(G.a),d.Y36(g.M),d.Y36(H.T),d.Y36(U.m),d.Y36(d.sBO))},e.\u0275cmp=d.Xpm({type:e,selectors:[["chq-new-vehicle"]],viewQuery:function(e,t){if(1&e&&(d.Gf(B,5),d.Gf(z,5),d.Gf(X,5)),2&e){let e;d.iGM(e=d.CRH())&&(t.make=e.first),d.iGM(e=d.CRH())&&(t.model=e.first),d.iGM(e=d.CRH())&&(t.year=e.first)}},decls:2,vars:2,consts:[["class","new-vehicle-container",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"new-vehicle-container",3,"ngClass"],[3,"chqModel"],[1,"label"],[1,"search-box",3,"ngClass"],[1,"col-4",3,"inputModel","controlOutput"],[1,"form-container"],[1,"vehicle-brand-wrapper","row",3,"ngClass"],["id","input-make",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["make",""],["id","input-model",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["model",""],["id","input-year",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["year",""],[1,"vehicle-info-wrapper","row",3,"ngClass"],[1,"col-4","registration-date",3,"inputModel","controlOutput"],[1,"image-car"],["src","assets/img/half-car.png"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],[1,"footer-button-wrapper"],[3,"buttonModel",4,"ngIf"],[3,"buttonModel"]],template:function(e,t){1&e&&(d.YNc(0,oe,28,34,"div",0),d.YNc(1,ne,1,0,"no-access-error",1)),2&e&&(d.Q6J("ngIf",!t.showNoAccess),d.xp6(1),d.Q6J("ngIf",t.showNoAccess))},directives:[o.O5,o.mk,b._,M.D,C.E,O.U],pipes:[w.X$],styles:[".new-vehicle-container[_ngcontent-%COMP%]{padding-bottom:1.5vw}.new-vehicle-container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:10px;display:block;font-weight:600}.new-vehicle-container[_ngcontent-%COMP%]     .disable-controls input{opacity:.6!important}.new-vehicle-container[_ngcontent-%COMP%]   .disable-input[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .partial-disable-info[_ngcontent-%COMP%]{pointer-events:none}.new-vehicle-container[_ngcontent-%COMP%]   .registration-date[_ngcontent-%COMP%]     .input-wrapper input{pointer-events:none}.new-vehicle-container[_ngcontent-%COMP%]   .registration-date[_ngcontent-%COMP%]     .input-wrapper input[readonly]{opacity:1}.new-vehicle-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]{margin-bottom:20px}.new-vehicle-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%]   .extra-position[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]   .extra-position[_ngcontent-%COMP%]{top:5px;position:relative}.new-vehicle-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;flex:1}.new-vehicle-container[_ngcontent-%COMP%]   .image-car[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:654px;position:fixed;bottom:76px}.new-vehicle-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:20px}.new-vehicle-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   chq-input[_ngcontent-%COMP%]{width:242px}@media (max-height: 640px){.image-car[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none!important}}@media (orientation: portrait){.search-box[_ngcontent-%COMP%]{margin-top:20px}.search-box[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{flex-basis:auto;max-width:none;width:375px!important}.form-container[_ngcontent-%COMP%]{margin-left:5px}.form-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:0!important}.form-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{flex-basis:auto;max-width:none;width:375px!important;margin-bottom:20px;padding-left:0;padding-right:0}}"]}),e})();const se={approve:{status:"Approve Case",info:"Please fill out a reason why you are approving this case.",buttonModel:{label:"Approve Case",type:"success",icon:"check"},imageGallery:!1,gallery:[]},reject:{status:"Reject Case",info:"Please fill out a reason why you are rejecting this case.",buttonModel:{label:"Reject Case",type:"red",icon:"cross"},imageGallery:!1,gallery:[]},close:{status:"Close Case",info:"Please fill out a reason why you are closing this case.",buttonModel:{label:"Close Case",type:"primary",icon:"folder-plus"},imageGallery:!1,gallery:[]},complete:{status:"Complete Case",info:"Please fill out a reason why you are completing this case.",buttonModel:{label:"Complete Case",type:"primary",icon:"folder-plus"},imageGallery:!1,gallery:[]}};var re=i(3679),ce=i(22238),le=i(51927),de=i(79034),me=i(48262),he=i(6690);const pe=["nav"];function ue(e,t){1&e&&(d.TgZ(0,"div",17),d._uU(1," Please enter comment "),d.qZA())}const ge=function(e){return{"invalid-label":e}};function ve(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",4),d.TgZ(1,"div",5),d.TgZ(2,"div",6),d._uU(3),d.qZA(),d.TgZ(4,"div",7),d.TgZ(5,"mat-icon",8),d.NdJ("click",function(){return d.CHM(e),d.oxw().cancelDialog()}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"div",9),d._uU(7),d.qZA(),d.TgZ(8,"div",10),d.TgZ(9,"form",11),d.TgZ(10,"label",12),d._uU(11,"Comments"),d.qZA(),d._UZ(12,"textarea",13),d.YNc(13,ue,2,0,"div",14),d.qZA(),d.qZA(),d.TgZ(14,"div",15),d.TgZ(15,"chq-button",16),d.NdJ("click",function(){return d.CHM(e),d.oxw().processCase()}),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.xp6(3),d.hij(" ",e.data.status," "),d.xp6(2),d.Q6J("svgIcon","cross"),d.xp6(2),d.hij(" ",e.data.info," "),d.xp6(2),d.Q6J("formGroup",e.commentForm),d.xp6(1),d.Q6J("ngClass",d.VKq(7,ge,(e.formControl.dirty||e.formControl.touched)&&e.formControl.errors)),d.xp6(3),d.Q6J("ngIf",(e.formControl.dirty||e.formControl.touched)&&e.formControl.errors),d.xp6(2),d.Q6J("buttonModel",e.data.buttonModel)}}function fe(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",30),d.TgZ(1,"mat-icon",31),d.NdJ("click",function(){return d.CHM(e),d.oxw(2).prevImageClick()}),d.qZA(),d.qZA()}}function be(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",32),d.TgZ(1,"mat-icon",33),d.NdJ("click",function(){return d.CHM(e),d.oxw(2).nextImageClick()}),d.qZA(),d.qZA()}}function Me(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",34),d.TgZ(1,"mat-icon",31),d.NdJ("click",function(){return d.CHM(e),d.oxw(2).prevImageClick()}),d.qZA(),d.qZA()}}function Ce(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",35),d.TgZ(1,"mat-icon",33),d.NdJ("click",function(){return d.CHM(e),d.oxw(2).nextImageClick()}),d.qZA(),d.qZA()}}const Oe=function(){return{width:"75px",height:"75px"}};function we(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",18),d.TgZ(1,"div",5),d.TgZ(2,"div",7),d.TgZ(3,"mat-icon",8),d.NdJ("click",function(){return d.CHM(e),d.oxw().cancelDialog()}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"div",19),d.YNc(5,fe,2,0,"div",20),d.TgZ(6,"img",21),d.NdJ("error",function(){return d.CHM(e),d.oxw().updateLoading()})("load",function(){return d.CHM(e),d.oxw().updateLoading()}),d.qZA(),d._UZ(7,"chq-customloader",22),d.YNc(8,be,2,0,"div",23),d.qZA(),d.TgZ(9,"div",24),d.YNc(10,Me,2,0,"div",25),d.TgZ(11,"ng-image-slider",26,27),d.NdJ("imageClick",function(t){return d.CHM(e),d.oxw().showImage(t)}),d.qZA(),d.YNc(13,Ce,2,0,"div",28),d.qZA(),d.TgZ(14,"div",29),d.TgZ(15,"span"),d._uU(16),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.xp6(3),d.Q6J("svgIcon","cross"),d.xp6(2),d.Q6J("ngIf",e.thumbnails.length>1),d.xp6(1),d.Q6J("src",e.currentImage,d.LSH),d.xp6(1),d.Q6J("showLoading",e.showLoading),d.xp6(1),d.Q6J("ngIf",e.thumbnails.length>1),d.xp6(2),d.Q6J("ngIf",e.thumbnails.length>1),d.xp6(1),d.Q6J("images",e.thumbnails)("infinite",!1)("autoSlide",1)("imageSize",d.DdM(15,Oe))("imagePopup",!1)("showArrow",!1),d.xp6(2),d.Q6J("ngIf",e.thumbnails.length>1),d.xp6(3),d.AsE("",e.index,"/",e.totalImages,"")}}function xe(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",36),d.TgZ(1,"div",37),d.TgZ(2,"div",7),d.TgZ(3,"mat-icon",8),d.NdJ("click",function(){return d.CHM(e),d.oxw().cancelDialog()}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"div",38),d.TgZ(5,"div",39),d._uU(6),d.qZA(),d.TgZ(7,"div",40),d._uU(8),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.xp6(3),d.Q6J("svgIcon","cross"),d.xp6(3),d.hij(" ",e.data.status," "),d.xp6(2),d.hij(" ",e.comments," ")}}function ye(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",41),d.TgZ(1,"div",37),d.TgZ(2,"div",7),d.TgZ(3,"mat-icon",8),d.NdJ("click",function(){return d.CHM(e),d.oxw().cancelDialog()}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"div",42),d._uU(5),d.qZA(),d.TgZ(6,"div",43),d.TgZ(7,"p"),d.TgZ(8,"strong"),d._uU(9),d.ALo(10,"translate"),d.qZA(),d._uU(11),d.qZA(),d.TgZ(12,"p"),d.TgZ(13,"strong"),d._uU(14),d.ALo(15,"translate"),d.qZA(),d._uU(16),d.qZA(),d._UZ(17,"div",44),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.xp6(3),d.Q6J("svgIcon","cross"),d.xp6(2),d.Oqu(null==e.data?null:e.data.status),d.xp6(4),d.hij("",d.lcZ(10,7,"to"),":"),d.xp6(2),d.hij(" ",e.emailContent.To,""),d.xp6(3),d.hij("",d.lcZ(15,9,"subject"),":"),d.xp6(2),d.hij(" ",e.emailContent.Subject,""),d.xp6(1),d.Q6J("innerHTML",e.emailContent.Content,d.oJD)}}let Ie=(()=>{class e{constructor(e,t,i,o,n){this.dialogRef=e,this.data=t,this.changeDedectionRef=i,this.monitorService=o,this.formBuilder=n,this.thumbnails=[],this.index=1,this.showComment=!1,this.showLoading=!0,this.showEmail=!1}ngOnInit(){var e,t,i,o,n;this.monitorService.logEvent("ngOnInit",["ChqRepairDialogComponent","addenda-quote"]),(null===(e=this.data)||void 0===e?void 0:e.email)&&(this.showEmail=!0,this.emailContent=JSON.parse(null===(t=this.data)||void 0===t?void 0:t.email)),(null===(i=this.data)||void 0===i?void 0:i.imageGallery)?this.getImages():(null===(o=this.data)||void 0===o?void 0:o.comment)?(this.showComment=!0,this.comments=null===(n=this.data)||void 0===n?void 0:n.comment):(this.commentForm=this.formBuilder.group({comment:["",[re.kI.required,e=>e.value&&""===e.value.trim()?{noEmptySpaces:!0}:null]]}),this.data&&this.data.buttonModel&&(this.data.buttonModel.type=this.commentForm.invalid?"disabled":"Approve Case"===this.data.buttonModel.label?"success":"Reject Case"===this.data.buttonModel.label?"red":"primary"),this.commentForm.get("comment").valueChanges.pipe((0,le.O)(null),(0,de.G)()).subscribe(([e,t])=>{this.data.buttonModel.type=(null==t?void 0:t.trim())?"Approve Case"===this.data.buttonModel.label?"success":"Reject Case"===this.data.buttonModel.label?"red":"primary":"disabled"}))}ngAfterContentChecked(){this.changeDedectionRef.detectChanges()}cancelDialog(){this.monitorService.logEvent("cancelDialog",["ChqRepairDialogComponent","addenda-quote"]),this.dialogRef.close()}processCase(){this.commentForm.invalid||this.dialogRef.close({data:this.commentForm.controls.comment.value})}getImages(){this.thumbnails=this.data.gallery,this.totalImages=this.thumbnails.length,this.showLoading=!0,this.currentImage=this.thumbnails[0].thumbImage}showImage(e){this.index=e+1,this.showLoading=!0,this.currentImage=this.thumbnails[e].thumbImage}prevImageClick(){this.index>1&&(this.index=this.index-1,this.slider.prev(),this.showLoading=!0,this.currentImage=this.thumbnails[this.index-1].thumbImage)}nextImageClick(){this.index<this.slider.totalImages&&(this.index=this.index+1,this.slider.next(),this.showLoading=!0,this.currentImage=this.thumbnails[this.index-1].thumbImage)}get formControl(){return this.commentForm.controls.comment}updateLoading(){this.showLoading=!this.showLoading}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(ce.so),d.Y36(ce.WI),d.Y36(d.sBO),d.Y36(g.M),d.Y36(re.qu))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-chq-repair-dialog"]],viewQuery:function(e,t){if(1&e&&d.Gf(pe,5),2&e){let e;d.iGM(e=d.CRH())&&(t.slider=e.first)}},decls:4,vars:4,consts:[["class","repair dialog-container",4,"ngIf"],["class","dialog-container-image",4,"ngIf"],["class","dialog-container dialog-container-comment",4,"ngIf"],["class","dialog-container dialog-container-email",4,"ngIf"],[1,"repair","dialog-container"],[1,"heading"],[1,"heading-content"],[1,"close-icon"],[3,"svgIcon","click"],[1,"info"],[1,"content"],[3,"formGroup"],[3,"ngClass"],["rows","8","formControlName","comment","maxlength","500","placeholder","",1,"input-wrapper"],["class","invalid",4,"ngIf"],[1,"button"],[3,"buttonModel","click"],[1,"invalid"],[1,"dialog-container-image"],[1,"image-content"],["class","navigation prev-button",4,"ngIf"],[3,"src","error","load"],[3,"showLoading"],["class","navigation next-button",4,"ngIf"],[1,"slider"],["class","prev-button",4,"ngIf"],["slideImage","1",3,"images","infinite","autoSlide","imageSize","imagePopup","showArrow","imageClick"],["nav",""],["class","next-button",4,"ngIf"],[1,"footer"],[1,"navigation","prev-button"],["aria-hidden","false","aria-label","Example chevron left icon","fontIcon","chevron_left",3,"click"],[1,"navigation","next-button"],["aria-hidden","false","aria-label","Example chevron right icon","fontIcon","chevron_right",3,"click"],[1,"prev-button"],[1,"next-button"],[1,"dialog-container","dialog-container-comment"],[1,"heading","heading-comment"],[1,"comment-content"],[1,"comment-status"],[1,"comment"],[1,"dialog-container","dialog-container-email"],[1,"email-status"],[1,"email-content"],[3,"innerHTML"]],template:function(e,t){1&e&&(d.YNc(0,ve,16,9,"div",0),d.YNc(1,we,17,16,"div",1),d.YNc(2,xe,9,3,"div",2),d.YNc(3,ye,18,11,"div",3)),2&e&&(d.Q6J("ngIf",!(null!=t.data&&t.data.imageGallery||t.showComment||t.showEmail)),d.xp6(1),d.Q6J("ngIf",null==t.data?null:t.data.imageGallery),d.xp6(1),d.Q6J("ngIf",t.showComment),d.xp6(1),d.Q6J("ngIf",t.showEmail))},directives:[o.O5,s.Hw,re._Y,re.JL,re.sg,o.mk,re.Fj,re.JJ,re.u,re.nD,C.E,me.h,he.sN],pipes:[w.X$],styles:[".repair.dialog-container{display:flex;flex-direction:column;justify-content:flex-start;padding:30px;grid-gap:36px;gap:36px}.repair.dialog-container .heading{display:flex;flex-direction:row;justify-content:space-between}.repair.dialog-container .heading .heading-content{display:flex;font-weight:700;font-size:20px;line-height:25px;align-items:center}.repair.dialog-container .heading-comment{justify-content:flex-end}.repair.dialog-container .info{font-weight:500;font-size:12px;line-height:14px;color:#000}.repair.dialog-container .content{position:relative}.repair.dialog-container .content label{height:14px;font-weight:400;font-size:10px;line-height:14px;text-transform:uppercase;color:var(--xa-dark-gray);flex:none;order:0;flex-grow:0;position:absolute;top:-8px;z-index:2;top:-6px;left:12px;padding:0 4px;background:var(--xa-white)}.repair.dialog-container .button{display:flex;justify-content:flex-end}.repair.dialog-container textarea{border-radius:8px;width:100%;box-sizing:border-box;padding:10px}.dialog-container-image{padding:20px;min-width:724px;max-width:724px;height:558px}.dialog-container-image .image-content{padding:20px;height:345px;display:flex;justify-content:center;align-items:center}.dialog-container-image .image-content img{height:100%}.dialog-container-image .slider{margin-top:19px;display:flex;flex-direction:row;justify-content:space-evenly}.dialog-container-image .slider .prev-button,.dialog-container-image .slider .next-button{display:flex;flex-direction:column;justify-content:space-around}.dialog-container-image .slider .prev-button img,.dialog-container-image .slider .next-button img{height:25px}.dialog-container-image .slider ng-image-slider{width:100%;margin:0 20px}.dialog-container-image .slider .ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:75px!important;margin-left:5px!important;margin-right:0!important}.dialog-container-image .slider .selected-image{border:1px solid #EAB308}.dialog-container-image .footer{margin-top:20px;display:flex;justify-content:center}.dialog-container-image .footer span{text-align:center}.dialog-container-comment{min-width:450px;max-width:450px;padding:32px 20px;overflow-x:hidden}.dialog-container-comment .comment-content{font-weight:500;font-size:14px;max-height:200px}.dialog-container-comment .comment-content .comment-status{margin-bottom:10px;font-size:16px}.dialog-container-comment .comment-content .comment{overflow-y:auto;overflow-x:hidden;white-space:pre-line}.dialog-container-email{min-width:450px;max-width:450px;padding:32px 20px;overflow-x:hidden}.dialog-container-email .email-status{margin-bottom:10px;font-size:1rem;font-weight:700;padding:.625rem 1.375rem;border-bottom:1px solid var(--xa-dp-light-gray)}.dialog-container-email .email-content{font-weight:500;font-size:.75rem;max-height:500px;border-radius:.625rem;padding:.625rem 1.375rem;background-color:rgba(27,3,163,.05)}.dialog-container .heading .close-icon,.dialog-container-image .heading .close-icon{justify-content:flex-end;display:flex}.dialog-container .heading .close-icon mat-icon,.dialog-container-image .heading .close-icon mat-icon{height:36px!important;width:36px!important;background:black;border-radius:50%;text-align:center}.dialog-container .heading .close-icon mat-icon svg,.dialog-container-image .heading .close-icon mat-icon svg{height:16px;width:16px;vertical-align:middle;position:relative;top:7px}.dialog-container .heading .close-icon mat-icon svg path,.dialog-container-image .heading .close-icon mat-icon svg path{fill:#fff}@media (orientation: portrait){.dialog-container-image{min-width:570px;max-width:570px}}.invalid{margin-top:6px;font-style:normal;font-weight:400;font-size:12px;line-height:18px;color:var(--xa-red);flex:none;order:2;align-self:stretch;flex-grow:0}.invalid-label{color:var(--xa-red)!important}.input-wrapper.ng-touched.ng-invalid{border:1px solid var(--xa-red);color:var(--xa-red);outline:0}.navigation{position:absolute;top:calc(50% - 55px)}.navigation.prev-button{left:0}.navigation.next-button{right:0}.navigation .mat-icon{font-size:50px!important;height:50px!important;width:50px!important}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div .caption{padding:2px!important;background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,.6),rgba(0,0,0,.7),rgba(0,0,0,.8),rgba(0,0,0,.9))!important;font-size:10px}.email-content td{border-radius:5px!important;padding:5px!important}.email-content a{color:#fff!important;text-decoration:none!important;pointer-events:none!important}\n"],encapsulation:2}),e})();var De=i(50617),qe=i(84967),Pe=i(33568),Se=i(84945),Ze=i(14368),_e=i(75983),Te=i(87855),Fe=i(72076),Ne=i(8851),ke=i(9988);const je=["anchor"];function Ae(e,t){if(1&e&&(d.TgZ(0,"div",17),d.TgZ(1,"div",18),d.TgZ(2,"div",19),d.TgZ(3,"label"),d._uU(4),d.qZA(),d.qZA(),d.TgZ(5,"div",20),d.TgZ(6,"label"),d._uU(7),d.qZA(),d.TgZ(8,"span"),d._uU(9),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"div",21),d._UZ(11,"img",22),d.TgZ(12,"div",20),d._UZ(13,"a",23,24),d.TgZ(15,"label"),d._uU(16),d.qZA(),d.TgZ(17,"span"),d._uU(18),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&e){const e=d.oxw(2);d.xp6(4),d.Oqu(e.customerData.initial),d.xp6(3),d.Oqu(e.customerData.firstName+" "+e.customerData.lastName),d.xp6(2),d.Oqu(e.customerData.countryCode+" "+e.customerData.mobileNumber),d.xp6(4),d.Q6J("href",e.downloadUrl,d.LSH)("hidden",!0)("download",e.pdfName),d.xp6(3),d.Oqu(null==e.caseData?null:e.caseData.vehicleMake),d.xp6(2),d.Oqu(null==e.caseData?null:e.caseData.vehicleModel)}}function Je(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-estimate-details",25),d.NdJ("downloadPdf",function(){return d.CHM(e),d.oxw(2).downloadPdf()}),d.qZA()}if(2&e){const e=d.oxw(2);d.Q6J("estimateResponse",e.estimateResponse)("editEstimate",e.editEstimate)("estimateSource",e.estimateSource)("i18n",e.i18n)}}function Ee(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){return d.CHM(e),d.oxw(3).booking("create","")}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.createBooking)}}function Re(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){d.CHM(e);const t=d.oxw(3);return t.booking("view",t.repairId)}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.viewBooking)}}function Le(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){d.CHM(e);const t=d.oxw(3);return t.changeCaseStatusDialog(t.closeCaseButton)}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.closeCaseButton)}}function Ve(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){d.CHM(e);const t=d.oxw(3);return t.changeCaseStatusDialog(t.approveCaseButton)}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.approveCaseButton)}}function Qe(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){d.CHM(e);const t=d.oxw(3);return t.changeCaseStatusDialog(t.rejectButton)}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.rejectButton)}}function Ye(e,t){if(1&e&&d._UZ(0,"chq-button",30),2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.calculationButton)}}function Ge(e,t){if(1&e&&(d.TgZ(0,"div",26),d.YNc(1,Ee,1,1,"chq-button",27),d.YNc(2,Re,1,1,"chq-button",27),d.YNc(3,Le,1,1,"chq-button",27),d.YNc(4,Ve,1,1,"chq-button",27),d.YNc(5,Qe,1,1,"chq-button",27),d.YNc(6,Ye,1,1,"chq-button",28),d.qZA()),2&e){const e=d.oxw(2);d.xp6(1),d.Q6J("ngIf",e.commonService.repairPermission&&!e.repairId&&"rejected"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase())),d.xp6(1),d.Q6J("ngIf",e.commonService.repairPermission&&e.repairId),d.xp6(1),d.Q6J("ngIf",!e.isPendingApproval()&&e.isGTEstimate()&&"complete"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase())),d.xp6(1),d.Q6J("ngIf",!e.isPendingApproval()&&e.isGTEstimate()&&e.currentRejStatus&&"complete"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase())),d.xp6(1),d.Q6J("ngIf",!e.isPendingApproval()&&e.isGTEstimate()&&e.currentStatus&&"complete"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase())),d.xp6(1),d.Q6J("ngIf",!e.isPendingApproval()&&e.isGTEstimate()&&e.currentRejStatus&&"complete"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase()))}}function He(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-dropdown",33),d.NdJ("selected",function(t){return d.CHM(e),d.oxw(3).changeCaseStatusDialog(t)}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("dropdownModel",e.dropdownModelFilter)}}function Ue(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){return d.CHM(e),d.oxw(3).booking("create","")}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.createBooking)}}function Be(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"chq-button",29),d.NdJ("click",function(){d.CHM(e);const t=d.oxw(3);return t.booking("view",t.repairId)}),d.qZA()}if(2&e){const e=d.oxw(3);d.Q6J("buttonModel",e.viewBooking)}}function ze(e,t){if(1&e&&(d.TgZ(0,"div",31),d.YNc(1,He,1,1,"chq-dropdown",32),d.YNc(2,Ue,1,1,"chq-button",27),d.YNc(3,Be,1,1,"chq-button",27),d.qZA()),2&e){const e=d.oxw(2);d.xp6(1),d.Q6J("ngIf",!e.isPendingApproval()&&e.isGTEstimate()&&(e.commonService.repairPermission||"complete"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase())&&!e.commonService.repairPermission)),d.xp6(1),d.Q6J("ngIf",e.commonService.repairPermission&&!e.repairId&&"rejected"!==(null==e.caseStatus?null:e.caseStatus.toLowerCase())),d.xp6(1),d.Q6J("ngIf",e.commonService.repairPermission&&e.repairId)}}const Xe=function(e){return{hidden:e}};function Ke(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",3),d.TgZ(1,"chq-step-header",4),d.NdJ("back",function(t){return d.CHM(e),d.oxw().handleBack(t)}),d.qZA(),d.YNc(2,Ae,19,8,"div",5),d.TgZ(3,"div",6),d.TgZ(4,"div",7),d.YNc(5,Je,1,4,"chq-estimate-details",8),d._UZ(6,"chq-customloader",9),d.qZA(),d.qZA(),d.TgZ(7,"div",10),d.TgZ(8,"div",11),d.TgZ(9,"div",12),d._UZ(10,"img",13),d.qZA(),d.qZA(),d.YNc(11,Ge,7,6,"div",14),d.YNc(12,ze,4,3,"div",15),d.qZA(),d.TgZ(13,"history",16),d.NdJ("toggleExpand",function(){return d.CHM(e),d.oxw().getCaseHistory()}),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.Q6J("ngClass",d.VKq(10,Xe,e.showDamageAnalysis)),d.xp6(1),d.Q6J("chqModel",e.header)("showButton",!0),d.xp6(1),d.Q6J("ngIf",e.pageReady),d.xp6(3),d.Q6J("ngIf",e.showData),d.xp6(1),d.Q6J("showLoading",!e.showData),d.xp6(5),d.Q6J("ngIf",e.estimateResponse&&!e.commonService.isViewOnly),d.xp6(1),d.Q6J("ngIf",e.estimateResponse&&!e.commonService.isViewOnly),d.xp6(1),d.Q6J("history",e.history)("isLoading",e.isHistoryLoading)}}function $e(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"damage-analysis",34),d.NdJ("backEvent",function(t){return d.CHM(e),d.oxw().handleBack(t)}),d.qZA()}if(2&e){const e=d.oxw();d.Q6J("hideNext",!0)("caseDetail",e.caseResult)}}function We(e,t){1&e&&d._UZ(0,"no-access-error")}const et={title:"create_estimate",step:5,description:"create_estimate_msg",stepName:"step_five"};let tt=(()=>{class e{constructor(e,t,i,o,n,a,s,r,c){this.cd=e,this.commonService=t,this.caseService=i,this.repairEstimateService=o,this.route=n,this.monitorService=a,this.inspectionService=s,this.dialog=r,this.router=c,this.header=et,this.customerFormData={jobNumber:"1212",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",companyId:0,partnershipId:0,firstName:"John",lastName:"Doe",driverCode:"+971",driverPhone:502302030,carOwnerSelector:"Person",email:""},this.isInitCalled=!1,this.dialogData=se,this.showGen=!0,this.pageReady=!1,this.showData=!1,this.showInspection=!1,this.pdfName="",this.showNoAccess=!1,this.editEstimate=!1,this.estimateSource="",this.dropdownModelFilter={options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}],placeHolder:"Options",label:"",appearance:"button",placeHolderIcon:"settings",name:"option",displayValue:"label",selectedOption:{}},this.history=[],this.isHistoryLoading=!1,this.commonService.accessRight.closed&&(this.commonService.accessRight=new l.X(!0)),this.commonService.userProfileData.subscribe(e=>{if(e&&e.data){const{organizationDetail:t}=e.data;t&&(this.currentOrgId=t.id)}}),this.i18n=this.commonService.geti18nInfo()}get isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}handleVisibilityChange(e){var t,i;!this.isInitCalled||!this.isiOS||!this.orgName||0==(null===(i=null===(t=this.estimateResponse)||void 0===t?void 0:t.estimateCharges)||void 0===i?void 0:i.length)&&this.getEstimationDetail(this.orgName)}onPopState(e){sessionStorage.setItem("update","0")}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0","estimate"),this.cd.detectChanges(),this.showGen=!1,this.monitorService.logEvent("ngAfterViewInit",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}handleBack(e){this.showDamageAnalysis=!e.back,this.monitorService.logEvent("handleBack",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}ngOnInit(){var e;this.caseGuid=null===(e=this.route.parent)||void 0===e?void 0:e.snapshot.paramMap.get("id"),this.getCaseDetail(),this.isInitCalled=!0,this.closeCaseButton={label:"Complete",type:"primary",icon:"folderplus"},this.approveCaseButton={label:"Approve",type:"success",icon:"check"},this.rejectButton={label:"Reject",type:"outline-danger",icon:"cross"},this.calculationButton={label:"Edit Calculations",type:"outline",icon:"edit",onclick:this.editGtMotive.bind(this)},this.createBooking={label:"Create Booking",type:"outline",icon:"calendar"},this.viewBooking={label:"View Booking",type:"outline",icon:"view"},this.commonService.accessRight.subscribe({next:e=>{e||(this.showNoAccess=!0)}});const t=document.querySelector(".addenda-container");t&&(t.scrollTop=0),this.monitorService.logEvent("ngOnInit",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}editGtMotive(){this.repairId?this.commonService.showChangeWarningMessage(this.redirectToGtEstimate.bind(this),_e.j.repair):this.redirectToGtEstimate()}changeCaseStatusDialog(e){var t,i,o,n,a,s;let r=null,c="";if("Edit Calculations"!=(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.label)&&"Edit Calculations"!=(null==e?void 0:e.label)){if("Approve"==(null===(i=null==e?void 0:e.value)||void 0===i?void 0:i.label)||"Approve"==(null==e?void 0:e.label))r=this.dialogData.approve,c="Approved";else if("Complete"==(null===(o=null==e?void 0:e.value)||void 0===o?void 0:o.label)||"Complete"==(null==e?void 0:e.label))r=this.dialogData.complete,c="Complete";else if("Reject"==(null===(n=null==e?void 0:e.value)||void 0===n?void 0:n.label)||"Reject"==(null==e?void 0:e.label))r=this.dialogData.reject,c="Rejected";else{if("View Booking"==(null===(a=null==e?void 0:e.value)||void 0===a?void 0:a.label)||"View Booking"==(null==e?void 0:e.label))return void this.booking("view",this.repairId);if("Create Booking"==(null===(s=null==e?void 0:e.value)||void 0===s?void 0:s.label)||"Create Booking"==(null==e?void 0:e.label))return void this.booking("create","")}this.monitorService.logEvent("changeCaseStatusDialog",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status:c}]),this.dialog.open(Ie,{autoFocus:!1,data:r}).afterClosed().subscribe({next:e=>{this.commonService.showLoading(),e?this.caseService.updateCaseStatus(this.caseGuid,c,e.data).subscribe({next:()=>{this.monitorService.logEvent("updateCaseStatus",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status:c}]),this.caseStatus=c,this.toggleOption(c)},complete:()=>{this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}}):this.commonService.hideLoading()}})}else this.repairId?this.commonService.showChangeWarningMessage(this.redirectToGtEstimate.bind(this),_e.j.repair):this.redirectToGtEstimate()}redirectToGtEstimate(){this.commonService.showLoading(),this.monitorService.logEvent("redirectToGtEstimate",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status}]),this.route.snapshot.queryParams.send&&"true"==this.route.snapshot.queryParams.send&&this.router.navigate([],{relativeTo:this.route,queryParams:{send:"false"},queryParamsHandling:"merge"}),this.repairEstimateService.createEstimate(this.caseGuid,this.inspectionId,this.vehicleId,this.domainId).subscribe({next:e=>{e&&(location.href=e.data.url,sessionStorage.setItem("update","1"))},complete:()=>{this.commonService.hideLoading()}})}downloadPdf(){this.commonService.showLoading(),this.monitorService.logEvent("downloadPdf",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}]),this.repairEstimateService.getXADownloadUrl(this.caseGuid).subscribe({next:e=>{window.open(e.data.url,"_top"),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}})}get currentRejStatus(){var e;return!!this.caseStatus&&-1===["approved","closed","complete"].indexOf(null===(e=this.caseStatus)||void 0===e?void 0:e.toLowerCase())}get currentStatus(){var e;return!!this.caseStatus&&-1===["approved","closed","complete"].indexOf(null===(e=this.caseStatus)||void 0===e?void 0:e.toLowerCase())}getCaseHistory(){this.history=[],this.isHistoryLoading=!0,this.caseService.getCaseHistory(this.caseGuid,this.domainId).subscribe({next:e=>{this.history=e},complete:()=>{this.isHistoryLoading=!1}})}getCaseDetail(){this.caseService.getCaseDetail(this.caseGuid).subscribe({next:e=>{var t,i,o,n;if(null==e?void 0:e.data){const{inspections:a,vehicleId:s,status:r,orgName:c,repairGuid:l,domainID:d}=e.data;if(this.commonService.caseStatus.next(r),this.inspectionId=a?null===(t=a[0])||void 0===t?void 0:t.inspectionId:"",-1===["uploadphotos","repairestimation","closed","rejected","approved","complete","pendingapproval","readytoinvoice","invoiceready"].indexOf(r.toLowerCase()))return;this.vehicleId=s,this.repairId=l,this.caseStatus=r,this.domainId=d,this.toggleOption(r),this.header.caseNumber=e.data.caseNumber,this.caseResult=e.data,this.customerData=e.data.caseDetail,this.orgName=c,this.customerData=Object.assign(Object.assign({},this.customerData),{initial:(null===(i=this.customerData.firstName)||void 0===i?void 0:i.substring(0,1).toUpperCase())+(null===(o=this.customerData.lastName)||void 0===o?void 0:o.substring(0,1).toUpperCase())}),this.pageReady=!0,this.commonService.isViewOnly=this.currentOrgId!=(null===(n=e.data.organizationDetail)||void 0===n?void 0:n.organizationId);const m=sessionStorage.getItem("update")||"0";"0"===m?(this.getEstimationDetail(c),this.commonService.updatePage("/quote/case/0","estimate")):"1"===m&&this.route.snapshot.queryParams.send&&"true"==this.route.snapshot.queryParams.send?this.repairEstimateService.readUpdateEstimate(this.caseGuid,e.data.inspections[0].inspectionId,e.data.vehicleId,"put",this.domainId).subscribe({next:()=>{sessionStorage.setItem("update","0"),this.getEstimationDetail(c),this.router.navigate([],{relativeTo:this.route,queryParams:{send:"false"},queryParamsHandling:"merge"}),this.commonService.hideLoading(),setTimeout(()=>{this.commonService.updatePage("/quote/case/0","estimate")})}}):this.getEstimationDetail(c)}},error:()=>{this.commonService.hideLoading()}})}getEstimationDetail(e){this.repairEstimateService.getEstimate(this.caseGuid,this.inspectionId,this.vehicleId,this.domainId).subscribe({next:t=>{var i,o,n;this.estimateResponse=t.data,this.caseData={vehicleMake:this.estimateResponse.make,vehicleModel:this.estimateResponse.modelCode},this.estimateResponse.orgName=e,this.estimateSource=null===(i=t.data)||void 0===i?void 0:i.externalSource,this.estimateResponse.currencyCode||(this.estimateResponse.currencyCode=this.i18n.currencySymbol),0==(null===(n=null===(o=this.estimateResponse)||void 0===o?void 0:o.estimateCharges)||void 0===n?void 0:n.length)?(this.commonService.hideLoading(),this.showConfirmationPopup()):(this.getInspection(),this.showData=!0),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}})}getInspection(){this.inspectionService.getInspectionTemplateList().subscribe({next:e=>{const t=null==e?void 0:e.data;(null==t?void 0:t.length)>0&&(this.commonService.repairInspectionTemplate=t[0],(0,qe.D)({inspectionTemplate:this.inspectionService.getInspectionTemplate(t[0].id),inspectionDetail:this.inspectionService.getInspection(this.inspectionId)}).pipe((0,Pe.K)(e=>(0,Se.of)(e))).subscribe(e=>{var t,i,o,n;const a=null===(t=e.inspectionTemplate)||void 0===t?void 0:t.inspectionItemTemplates,s=e.inspectionDetail,r=null==a?void 0:a.filter(e=>"Bulk Upload Image"===e.name);this.images=null===(i=null==s?void 0:s.inspectionItems)||void 0===i?void 0:i.filter(e=>("Bulk Upload Image"==e.name||e.inspectionItemTemplateID===r[0].id)&&""!=e.rawAzureBlobUrl).map(e=>e.rawAzureBlobUrl),0==(null===(o=this.images)||void 0===o?void 0:o.length)&&(this.images=null===(n=null==s?void 0:s.inspectionItems)||void 0===n?void 0:n.filter(e=>"Bulk Upload Image"!=e.name&&""!=e.rawAzureBlobUrl).map(e=>e.rawAzureBlobUrl)),this.showInspection=!0}))}})}showConfirmationPopup(){this.dialog.open(Ze.I,{disableClose:!0,data:{message:"The estimate values are 0. Press continue to navigate to gtmotive."},backdropClass:"confirmation-popup-backdrop"}).afterClosed().subscribe({next:e=>{console.log(e),e&&this.redirectToGtEstimate()}})}toggleOption(e){this.dropdownModelFilter="reject"===e.toLowerCase()||"rejected"===e.toLowerCase()?Object.assign(Object.assign({},this.dropdownModelFilter),{options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}]}):"approved"===e.toLowerCase()?Object.assign(Object.assign({},this.dropdownModelFilter),{options:[{label:"Complete",dropdownItemIcon:"folderplus"}]}):"complete"===e.toLowerCase()?Object.assign(Object.assign({},this.dropdownModelFilter),{options:[]}):Object.assign(Object.assign({},this.dropdownModelFilter),{options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}]})}booking(e,t){"create"===e?this.router.navigate(["repair/booking/0"],{queryParams:{caseId:this.caseGuid}}):this.router.navigate([`repair/booking/${t}`])}ngOnDestroy(){this.commonService.accessRight.unsubscribe(),this.monitorService.logEvent("ngOnDestroy",["ChqRepairEstimateComponent","addenda-quote"]),this.commonService.isViewOnly=!1}isGTEstimate(){return"GTMotive"===this.estimateSource}isPendingApproval(){var e;return"pendingapproval"===(null===(e=this.caseStatus)||void 0===e?void 0:e.toLowerCase())}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(d.sBO),d.Y36(u.v),d.Y36(v.n),d.Y36(Te.H),d.Y36(n.gz),d.Y36(g.M),d.Y36(G.a),d.Y36(ce.uw),d.Y36(n.F0))},e.\u0275cmp=d.Xpm({type:e,selectors:[["chq-repair-estimate"]],viewQuery:function(e,t){if(1&e&&(d.Gf(De.y,5),d.Gf(je,5)),2&e){let e;d.iGM(e=d.CRH())&&(t.elementRef=e.first),d.iGM(e=d.CRH())&&(t.anchor=e.first)}},hostBindings:function(e,t){1&e&&d.NdJ("visibilitychange",function(e){return t.handleVisibilityChange(e)},!1,d.evT)("popstate",function(e){return t.onPopState(e)},!1,d.Jf7)},inputs:{customerFormData:"customerFormData"},decls:3,vars:3,consts:[["class","estimate-container",3,"ngClass",4,"ngIf"],[3,"hideNext","caseDetail","backEvent",4,"ngIf"],[4,"ngIf"],[1,"estimate-container",3,"ngClass"],[1,"header",3,"chqModel","showButton","back"],["class","info-container",4,"ngIf"],[1,"estimate-block","row"],[1,"quote-estimate-step","col-12"],["serviceType","repair",3,"estimateResponse","editEstimate","estimateSource","i18n","downloadPdf",4,"ngIf"],[3,"showLoading"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],["class","footer-button-wrapper show-md",4,"ngIf"],["class","footer-button-wrapper show-sm",4,"ngIf"],["serviceType","quote",3,"history","isLoading","toggleExpand"],[1,"info-container"],[1,"info-block"],[1,"avatar"],[1,"text-block"],[1,"vehicle-block"],["src","assets/img/default_car.png"],[3,"href","hidden","download"],["anchor",""],["serviceType","repair",3,"estimateResponse","editEstimate","estimateSource","i18n","downloadPdf"],[1,"footer-button-wrapper","show-md"],[3,"buttonModel","click",4,"ngIf"],[3,"buttonModel",4,"ngIf"],[3,"buttonModel","click"],[3,"buttonModel"],[1,"footer-button-wrapper","show-sm"],["class","option-dropdown",3,"dropdownModel","selected",4,"ngIf"],[1,"option-dropdown",3,"dropdownModel","selected"],[3,"hideNext","caseDetail","backEvent"]],template:function(e,t){1&e&&(d.YNc(0,Ke,14,12,"div",0),d.YNc(1,$e,1,2,"damage-analysis",1),d.YNc(2,We,1,0,"no-access-error",2)),2&e&&(d.Q6J("ngIf",!t.showNoAccess),d.xp6(1),d.Q6J("ngIf",t.showDamageAnalysis),d.xp6(1),d.Q6J("ngIf",t.showNoAccess))},directives:[o.O5,o.mk,b._,me.h,Fe.r,C.E,Ne.I,ke.wm,O.U],styles:[".estimate-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]{display:flex;flex-direction:row}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]{padding:10px 32px;display:flex;flex-direction:row;align-items:center;border:1px solid var(--xa-light-gray);flex:1}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]{margin-left:12px;display:flex;flex-direction:column}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:20px;line-height:25px;display:flex;align-items:center;letter-spacing:-.25px}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:auto;width:auto;max-height:45px;max-width:102px}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]{border-left:none}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]{border-left:none;border-right:none}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]{display:flex;margin:0}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]{padding:20px 20px 0 0;position:relative}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .image-slider[_ngcontent-%COMP%]{padding:20px 0 0 10px;position:relative}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]{border-right:1px solid var(--xa-light-gray)}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]   chq-customloader[_ngcontent-%COMP%]{margin:auto}.hidden[_ngcontent-%COMP%]{display:none!important}.avatar[_ngcontent-%COMP%]{width:60px;height:61px;background:rgba(26,34,51,.2);border-radius:100px;display:flex;flex-direction:row;justify-content:center;align-items:center}.avatar[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:20px;line-height:25px}.show-sm[_ngcontent-%COMP%]{display:none!important}@media (max-width: 985px){.show-md[_ngcontent-%COMP%]{display:none!important}.show-sm[_ngcontent-%COMP%]{display:flex!important}}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container{border:1px solid var(--xa-form-border);border-radius:8px;background:var(--xa-white);margin-top:25px;margin-bottom:25px;padding:0 32px 32px}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container chq-customloader{margin:auto}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-label{margin-top:25px}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-label, .quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container{margin-left:calc(6px + 1.5vw);margin-right:calc(5px + 1.5vw)}.option-dropdown[_ngcontent-%COMP%]{width:180px}"]}),e})();var it=i(42895),ot=i(39075),nt=i(74743),at=i(88784),st=i(44466),rt=i(4704),ct=i(64307);let lt=(()=>{class e extends ot.hm{}return e.\u0275fac=function(){let t;return function(i){return(t||(t=d.n5z(e)))(i||e)}}(),e.\u0275prov=d.Yz7({token:e,factory:e.\u0275fac}),e})();const dt=[{path:"",component:J,canDeactivate:[it.I],resolve:{version:nt.n}},{path:"vehicle",component:ae,resolve:{version:nt.n}},{path:"document",component:ct.O,resolve:{version:nt.n}},{path:"photos",component:rt.X,resolve:{version:nt.n}},{path:"estimate",component:tt,resolve:{version:nt.n}},{path:"refresh",component:J}];let mt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({providers:[it.I,{provide:ot.ok,useClass:lt}],imports:[[ot.t6,o.ez,s.Ps,r.p,st.m,n.Bz.forChild(dt),a.H,at.T,w.aw]]}),e})()}}]);