"use strict";(self.webpackChunkcar_heal_quote=self.webpackChunkcar_heal_quote||[]).push([[301],{75301:(V,M,r)=>{r.r(M),r.d(M,{CustomerTableModule:()=>qt});var D=r(38583),w=r(74743),A=r(55278),O=r(76627),I=r(79317),q=r(25852),y=r(89993),f=r(97582),g=r(57445),_=r(7772);const P={columns:[{id:"ContactId",sortable:!0,header:{text:"id",tooltip:""},selector:{field:"ContactId"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"FirstName",sortable:!0,selector:{field:"FirstName"},header:{text:"first_name",tooltip:""},widget:{type:"text"}},{id:"LastName",sortable:!0,selector:{field:"LastName"},header:{text:"last_name",tooltip:""},widget:{type:"text"}},{id:"MobileNumber",sortable:!0,selector:{field:"MobileNumber"},header:{text:"mobile_number",tooltip:""},widget:{type:"text"}},{id:"Email",sortable:!0,selector:{field:"Email"},header:{text:"email_address",tooltip:""},widget:{type:"text"}},{id:"Amount",sortable:!0,selector:{field:"FormattedTotalAmount"},cellStyle:"justify-content:center;",header:{text:"total_amount_invoiced",tooltip:""},widget:{type:"text"}},{id:"AmountReceived",sortable:!0,cellStyle:"justify-content:center;",selector:{field:"FormattedPaidAmount"},header:{text:"paid_amount",tooltip:""},widget:{type:"text"}},{id:"AmountDue",sortable:!0,cellStyle:"justify-content:center;",selector:{field:"FormattedDueAmount"},header:{text:"due_amount",tooltip:""},widget:{type:"html"}}]},H={columns:[{id:"ContactId",sortable:!0,header:{text:"id",tooltip:""},selector:{field:"ContactId"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"CompanyName",sortable:!0,selector:{field:"FormattedCompanyName"},header:{text:"company_name",tooltip:""},widget:{type:"html"}},{id:"Amount",sortable:!0,selector:{field:"FormattedTotalAmount"},header:{text:"total_amount_invoiced",tooltip:""},widget:{type:"text"},cellStyle:"justify-content:center;"},{id:"AmountReceived",sortable:!0,selector:{field:"FormattedPaidAmount"},header:{text:"paid_amount",tooltip:""},widget:{type:"text"},cellStyle:"justify-content:center;"},{id:"AmountDue",sortable:!0,selector:{field:"FormattedDueAmount"},header:{text:"due_amount",tooltip:""},widget:{type:"html"},cellStyle:"justify-content:center;"}]};var L=r(38588),T=r(7408),t=r(37716),R=r(95016),$=r(4893),x=r(92340),K=r(91841);let E=(()=>{class n{constructor(e){this.http=e}getCustomers(e,o=null){const i=(e.currentPage-1)*e.pageSize;return this.http.get(`${x.N.caseMgmtUrl}/odata/customerinvoice?${o=o?`$top=${e.pageSize}&$skip=${i}&${o}`:`$top=${e.pageSize}&$skip=${i}`}&$orderby=${e.orderBy} ${e.sortDirection}&count=true`)}getCompanyCustomers(e,o=""){const i=(e.currentPage-1)*e.pageSize;return this.http.get(`${x.N.caseMgmtUrl}/odata/companyinvoice?${o=o?`$top=${e.pageSize}&$skip=${i}&${o}`:`$top=${e.pageSize}&$skip=${i}`}&$orderby=${e.orderBy} ${e.sortDirection}&count=true`)}getCompanyWorkProviders(e=""){return this.http.get(`${x.N.caseMgmtUrl}/odata/companyinvoice?${e}`)}getReapirOrders(e,o,i){let d="";return d="company"===o?`&$filter=(companyId eq ${e})&companyIndividualType=1`:`&$filter=(contactId eq ${e})&companyIndividualType=2`,this.http.get(`${x.N.caseMgmtUrl}/odata/repairorder?$top=${i.pageSize}&$skip=${(i.currentPage-1)*i.pageSize}&$orderby=${i.orderBy} ${i.sortDirection}${d}&count=true`)}getCases(e,o,i){let d="";return d="company"===o?`&$filter=(companyId eq ${e})&companyIndividualType=1`:`&$filter=(contactId eq ${e})&companyIndividualType=2`,this.http.get(`${x.N.caseMgmtUrl}/odata/repairestimation?$top=${i.pageSize}&$skip=${(i.currentPage-1)*i.pageSize}&$orderby=${i.orderBy} ${i.sortDirection}${d}&count=true`)}getTotalDueAmountCompany(e=""){return this.http.get(`${x.N.caseMgmtUrl}/odata/companyinvoice?${e}`)}getTotalDueAmountPerson(e=""){return this.http.get(`${x.N.caseMgmtUrl}/odata/customerinvoice?${e}`)}getCompanyDetails(e){return this.http.get(`${x.N.caseMgmtUrl}/api/companyinvoice/${e}`)}getCustomerDetails(e){return this.http.get(`${x.N.caseMgmtUrl}/api/customerinvoice/${e}`)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(K.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var W=r(38709),S=r(93077),X=r(56785),k=r(77782),tt=r(8851),et=r(36978),ot=r(67017),U=r(63298),N=r(29790);const it=["companyName"],nt=["workProvider"];function at(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"chq-dropdown",17,18),t.NdJ("selected",function(i){return t.CHM(e),t.oxw(2).selectFilter(i)}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("dropdownModel",e.dropdownModelCompany)}}function st(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",12),t.TgZ(1,"chq-dropdown",13,14),t.NdJ("selected",function(i){return t.CHM(e),t.oxw().selectFilter(i)}),t.qZA(),t.YNc(3,at,2,1,"chq-dropdown",15),t._UZ(4,"chq-button",16),t._UZ(5,"chq-button",16),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("dropdownModel",e.dropdownModelFilter),t.xp6(2),t.Q6J("ngIf",e.input.companyName),t.xp6(1),t.Q6J("buttonModel",e.applyButtonModel),t.xp6(1),t.Q6J("buttonModel",e.resetButtonModel)}}function rt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"chq-input",22),t.NdJ("controlOutput",function(i){return t.CHM(e),t.oxw(2).updateInput(i)}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("inputModel",e.nameTextBox)}}function lt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",12),t.TgZ(1,"chq-dropdown",19,20),t.NdJ("selected",function(i){return t.CHM(e),t.oxw().selectFilter(i)}),t.qZA(),t.YNc(3,rt,1,1,"chq-input",21),t._UZ(4,"chq-button",16),t._UZ(5,"chq-button",16),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("dropdownModel",e.dropdownModelFilterPerson),t.xp6(2),t.Q6J("ngIf",e.input.personName),t.xp6(1),t.Q6J("buttonModel",e.applyButtonModel),t.xp6(1),t.Q6J("buttonModel",e.resetButtonModel)}}const B=function(n,c,e,o,i){return[n,c,e,o,i]};function ct(n,c){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"xaCurrency"),t.qZA()),2&n){const e=t.oxw(2);t.Tol(e.dueAmountPersonClass),t.xp6(1),t.Oqu(t.G7q(2,4,t.qbA(10,B,e.totalDueAmountPerson,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)))}}function dt(n,c){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.totalDueAmountPerson)}}function pt(n,c){if(1&n&&(t.TgZ(0,"div",23),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"translate"),t.YNc(4,ct,3,16,"span",24),t.YNc(5,dt,2,1,"span",25),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.hij("",t.lcZ(3,3,"total_due_amount"),": "),t.xp6(2),t.Q6J("ngIf","-"!==e.totalDueAmountPerson),t.xp6(1),t.Q6J("ngIf","-"===e.totalDueAmountPerson)}}function ut(n,c){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"xaCurrency"),t.qZA()),2&n){const e=t.oxw(2);t.Tol(e.dueAmountCompanyClass),t.xp6(1),t.Oqu(t.G7q(2,4,t.qbA(10,B,e.totalDueAmountCompany,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)))}}function mt(n,c){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.totalDueAmountCompany)}}function ht(n,c){if(1&n&&(t.TgZ(0,"div",23),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"translate"),t.YNc(4,ut,3,16,"span",24),t.YNc(5,mt,2,1,"span",25),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.hij("",t.lcZ(3,3,"total_due_amount"),": "),t.xp6(2),t.Q6J("ngIf","-"!==e.totalDueAmountCompany),t.xp6(1),t.Q6J("ngIf","-"===e.totalDueAmountCompany)}}function gt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"chq-paginator",31,32),t.NdJ("paginationChange",function(i){return t.CHM(e),t.oxw(2).handlePaginationChange(i)}),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.pagination)}}function Ct(n,c){if(1&n&&(t.TgZ(0,"div",26),t.TgZ(1,"div",27),t._UZ(2,"chq-mat-table",28),t.qZA(),t.YNc(3,gt,3,1,"div",29),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("config",e.tableConfig)("tableData",e.tableData)("sortChanged",e.handleSortChange)("pageChanged",e.pageChanged)("cellClicked",e.handleCellClick)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableData?null:e.tableData.length)>0&&e.pagination.count>e.pagination.pageSize)}}function vt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"chq-paginator",31,33),t.NdJ("paginationChange",function(i){return t.CHM(e),t.oxw(2).handlePaginationChangeCompany(i)}),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.paginationCompany)}}function ft(n,c){if(1&n&&(t.TgZ(0,"div",26),t.TgZ(1,"div",27),t._UZ(2,"chq-mat-table",28),t.qZA(),t.YNc(3,vt,3,1,"div",29),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("config",e.tableConfigCompany)("tableData",e.tableDataCompany)("sortChanged",e.handleSortChangeCompany)("pageChanged",e.pageChangedCompany)("cellClicked",e.handleCellClickCompany)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableDataCompany?null:e.tableDataCompany.length)>0&&e.paginationCompany.count>e.pagination.pageSize)}}const J={COMPANY:"company",PERSONAL:"individual"};let bt=(()=>{class n{constructor(e,o,i,a,s,l,d,h){this.monitorService=e,this.commonService=o,this.tableDataSer=i,this.router=a,this.route=s,this.caseService=l,this.xaCurrencyPipe=d,this.calendarService=h,this.pageChanged=!1,this.pagination=_.G,this.configData=P,this.textToSearch="",this.input={personName:!1,companyName:!1},this.customerListMenus=L.JU,this.activeTab="",this.activeTabOptions=J,this.pageChangedCompany=!1,this.paginationCompany=_.G,this.configDataCompany=H,this.workProviderFromBooking=[],this.selectedCompanyForFilter=[],this.dueAmountPersonClass="",this.dueAmountCompanyClass="",this.totalDueAmountCompany=0,this.totalDueAmountPerson=0,this.showTotalDueAmountCompany=!1,this.showTotalDueAmountPerson=!1,this.applyButtonModel={label:"apply",type:"disabled",icon:"",onclick:this.applyFilter.bind(this)},this.resetButtonModel={label:"reset_all",type:"outline",icon:"",onclick:this.reSetFilter.bind(this)},this.dropdownModelFilter={options:[],placeHolder:"select_type",label:"select_type",name:"filterDropdown",displayValue:"label",selectedOption:{label:""}},this.dropdownModelCompany={options:[],placeHolder:"company_name",label:"company_name",name:"companyDropdown",displayValue:"companyName",keyFieldName:"CompanyId",selectedOption:[],isMultiSelect:!0},this.dropdownModelFilterPerson={options:[{label:"Retail - Individual"}],placeHolder:"select_type",label:"select_type",name:"filterDropdownPerson",displayValue:"label",selectedOption:{label:""}},this.nameTextBox={placeHolder:"customer_name",label:"customer_name",name:"name",type:"text",value:"",required:!1},this.handleSortChange=p=>{p&&(this.pagination=Object.assign(Object.assign({},this.pagination),{orderBy:p.active,sortDirection:p.direction}),this.getCustomers())},this.handleSortChangeCompany=p=>{p&&(this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{orderBy:p.active,sortDirection:p.direction}),this.getCompanyCustomers())},this.handleCellClick=(p,C)=>{var v,u;if("ContactId"===C.id){const m=null===(u=null===(v=p.find(b=>b.id===C.id))||void 0===v?void 0:v.result)||void 0===u?void 0:u.value;if(m){const b=this.tableData.find(F=>F.ContactId===m);b&&this.commonService.customerDetails.next(b),m&&this.router.navigate([`/repair/customers/individual/${m}/${b.Id}/repair-order`])}}},this.handleCellClickCompany=(p,C)=>{var v,u;if("ContactId"===C.id){const m=null===(u=null===(v=p.find(b=>b.id===C.id))||void 0===v?void 0:v.result)||void 0===u?void 0:u.value;if(m){const b=this.tableDataCompany.find(F=>F.ContactId===m);b&&this.commonService.customerDetails.next(b),m&&this.router.navigate([`/repair/customers/company/${m}/${b.Id}/repair-order`])}}},this.i18n=this.commonService.geti18nInfo()}ngOnInit(){this.monitorService.logEvent("ngOnInit",["CustomerTableComponent","addenda-repair"]),this.tableConfig=this.configData,this.tableConfigCompany=this.configDataCompany,this.route.params.subscribe(e=>(0,f.mG)(this,void 0,void 0,function*(){if(this.activeTab=e.userType,this.activeTab===J.PERSONAL)this.pagination=Object.assign(Object.assign({},this.pagination),{count:0,currentPage:n.currentPage,orderBy:"CreatedDate",sortDirection:"desc"}),this.handlePaginationChange({currentPage:n.currentPage,offset:this.pagination.pageSize*(n.currentPage-1),pageSize:this.pagination.pageSize}),this.getTotalDueAmountPerson();else{this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{count:0,currentPage:n.currentPageCompnay,orderBy:"CreatedDate",sortDirection:"desc"}),this.commonService.showLoading();const o=yield(0,g.z)(this.tableDataSer.getCompanyWorkProviders("$apply=groupby((CompanyOrgType))"));o&&o.length>0&&(this.workProviderFromBooking=o.map(i=>i.CompanyOrgType)),this.getCompanyCustomers(),this.getTotalDueAmountCompany(),this.dropdownModelFilter.observable||(this.dropdownModelFilter=Object.assign(Object.assign({},this.dropdownModelFilter),{observable:this.caseService.getProviders(),onObservableLoad:this.onObservableLoadWorkProviderData.bind(this)}),this.workProvider.dropdownModel.observable=this.caseService.getProviders(),this.workProvider.getObservable())}})),this.subscription=this.commonService.userProfileData.subscribe(e=>{this.userDetail=null==e?void 0:e.data})}ngOnDestroy(){this.subscription.unsubscribe()}getCompanyCustomers(){var e;return(0,f.mG)(this,void 0,void 0,function*(){this.commonService.showLoading();let o="";return(null===(e=this.selectedCompanyForFilter)||void 0===e?void 0:e.length)>0&&(o=`$filter=(${this.selectedCompanyForFilter.map(i=>`ContactId eq ${i.CompanyId}`).join(" or ")})`),(0,g.z)(this.tableDataSer.getCompanyCustomers(this.paginationCompany,o)).then(i=>{const a=i.value;a.map(s=>{let l="";if(s.AmountDue=s.Amount-s.AmountReceived,s.Amount&&void 0!==s.AmountDue){const d=100*s.AmountDue/s.Amount;d>=30&&(l="color-xa-dark-red"),d<=10&&d>0&&(l="col-xa-orange2"),0==d&&(l="color-xa-repair-header")}s.FormattedTotalAmount=s.Amount?this.xaCurrencyPipe.transform(s.Amount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",s.FormattedPaidAmount=s.AmountReceived?this.xaCurrencyPipe.transform(s.AmountReceived,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",s.FormattedDueAmount=s.Amount?'<span class="'+l+'">'+this.xaCurrencyPipe.transform(s.AmountDue,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-</span>",s.FormattedCompanyName=s.CompanyName?`<span class="company-name">${s.CompanyName}${s.LicenseNumber?"-<i>"+s.LicenseNumber+"</i>":""}</span>`:""}),this.tableDataCompany=a,this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{count:i["@odata.count"]||0}),this.commonService.hideLoading()}).catch(i=>{this.monitorService.logException(i,T._.Error),this.commonService.hideLoading()})})}getCustomers(){var e;return(0,f.mG)(this,void 0,void 0,function*(){const o=null===(e=this.dropdownModelFilterPerson.selectedOption)||void 0===e?void 0:e.label;let i="";if("retail - individual"===(null==o?void 0:o.toLowerCase())&&""!=this.textToSearch){const a=this.textToSearch+"";i=`$filter=(contains(tolower(FirstName),'${a.toLowerCase()}')) or (contains(tolower(LastName),'${a.toLowerCase()}'))`}return this.commonService.showLoading(),(0,g.z)(this.tableDataSer.getCustomers(this.pagination,i)).then(a=>{const s=a.value;s.map(l=>{let d="";if(l.AmountDue=l.Amount-l.AmountReceived,l.Amount&&void 0!==l.AmountDue){const h=100*l.AmountDue/l.Amount;h>=30&&(d="color-xa-dark-red"),h<=10&&h>0&&(d="col-xa-orange2"),0==h&&(d="color-xa-repair-header")}l.FormattedTotalAmount=l.Amount?this.xaCurrencyPipe.transform(l.Amount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",l.FormattedPaidAmount=l.AmountReceived?this.xaCurrencyPipe.transform(l.AmountReceived,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",l.FormattedDueAmount=l.Amount&&void 0!==l.AmountDue?'<span class="'+d+'">'+this.xaCurrencyPipe.transform(l.AmountDue,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position)+"</span>":"-"}),this.tableData=s,this.pagination=Object.assign(Object.assign({},this.pagination),{count:a["@odata.count"]||0}),this.commonService.hideLoading()}).catch(a=>{this.monitorService.logException(a,T._.Error),this.commonService.hideLoading()})})}getTotalDueAmountCompany(){var e;return(0,f.mG)(this,void 0,void 0,function*(){this.showTotalDueAmountCompany=!1;let o="$apply=";return(null===(e=this.selectedCompanyForFilter)||void 0===e?void 0:e.length)>0&&(o+=`filter(${this.selectedCompanyForFilter.map(i=>`ContactId eq ${i.CompanyId}`).join(" or ")})/`),o+="aggregate(Amount with sum as TotalAmount, AmountReceived with sum as TotalAmountReceived)",(0,g.z)(this.tableDataSer.getTotalDueAmountCompany(o)).then(i=>{if(i&&i[0]&&(this.showTotalDueAmountCompany=!0,this.dueAmountCompanyClass="",this.totalDueAmountCompany=i[0].TotalAmount?i[0].TotalAmount-i[0].TotalAmountReceived:"-",i[0].TotalAmount)){const a=100*this.totalDueAmountCompany/i[0].TotalAmount;a>=30&&(this.dueAmountCompanyClass="color-xa-dark-red"),a<=10&&a>0&&(this.dueAmountCompanyClass="col-xa-orange2"),0==a&&(this.dueAmountCompanyClass="color-xa-repair-header")}}).catch(i=>{this.showTotalDueAmountCompany=!0,this.monitorService.logException(i,T._.Error)})})}getTotalDueAmountPerson(){var e;return(0,f.mG)(this,void 0,void 0,function*(){this.showTotalDueAmountPerson=!1;let o="$apply=";const i=null===(e=this.dropdownModelFilterPerson.selectedOption)||void 0===e?void 0:e.label;if("retail - individual"===(null==i?void 0:i.toLowerCase())&&""!=this.textToSearch){const a=this.textToSearch+"";o+=`filter(contains(tolower(FirstName),'${a.toLowerCase()}') or contains(tolower(LastName),'${a.toLowerCase()}'))/`}return o+="aggregate(Amount with sum as TotalAmount, AmountReceived with sum as TotalAmountReceived)",(0,g.z)(this.tableDataSer.getTotalDueAmountPerson(o)).then(a=>{if(a&&a[0]&&(this.showTotalDueAmountPerson=!0,this.dueAmountPersonClass="",this.totalDueAmountPerson=a[0].TotalAmount?a[0].TotalAmount-a[0].TotalAmountReceived:"-",a[0].TotalAmount)){const s=100*this.totalDueAmountPerson/a[0].TotalAmount;s>=30&&(this.dueAmountPersonClass="color-xa-dark-red"),s<=10&&s>0&&(this.dueAmountPersonClass="col-xa-orange2"),0==s&&(this.dueAmountPersonClass="color-xa-repair-header")}}).catch(a=>{this.showTotalDueAmountPerson=!0,this.monitorService.logException(a,T._.Error)})})}handlePaginationChange(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.pagination.currentPage=e.currentPage,this.pagination=Object.assign(Object.assign({},this.pagination),o),this.pageChanged=!0,this.getCustomers()}handlePaginationChangeCompany(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.paginationCompany.currentPage=e.currentPage,this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),o),this.pageChangedCompany=!0,this.getCompanyCustomers()}selectFilter(e){var o,i,a;if(this.monitorService.logEvent("selectFilter",["CustomerTableComponent","addenda-repair",{$event:e}]),"filterDropdown"==(null==e?void 0:e.name)){const s=`?$filter=( OrgId eq ${null===(i=null===(o=this.userDetail)||void 0===o?void 0:o.organizationDetail)||void 0===i?void 0:i.id} and CompanyOrgType eq '${e.value.label}' and IsIndividual eq false)`;this.dropdownModelFilter.selectedOption=e.value,this.hideShowDropdown("companyName"),this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{selectedOption:[],options:[],displayValue:"label",observable:this.calendarService.getCustomer(s),onObservableLoad:this.onObservableLoadCompanyData.bind(this)}),setTimeout(()=>{var l;null===(l=this.companyName)||void 0===l||l.getObservable()},100),this.updateApplyButtonState()}else"filterDropdownPerson"==e.name?"retail - individual"===(this.dropdownModelFilterPerson.selectedOption=e.value,null===(a=e.value[this.dropdownModelFilterPerson.displayValue])||void 0===a?void 0:a.toLowerCase())?(this.hideShowDropdown("personName"),this.nameTextBox.value=""):this.hideShowDropdown(""):"companyDropdown"==(null==e?void 0:e.name)&&(this.dropdownModelCompany.selectedOption=e.value,this.updateApplyButtonState())}updateInput(e){"name"==e.name&&(this.nameTextBox.value=e.value,this.updateApplyButtonState())}updateApplyButtonState(){var e;let o="disabled";this.activeTab===this.activeTabOptions.PERSONAL?this.nameTextBox.value&&this.nameTextBox.value.toString().length>=3&&(o="secondary"):this.activeTab===this.activeTabOptions.COMPANY&&(null===(e=this.dropdownModelCompany.selectedOption)||void 0===e?void 0:e.length)>0&&this.input.companyName&&(o="secondary"),this.applyButtonModel.type=o}hideShowDropdown(e){this.input[e]=!0,Object.keys(this.input).forEach(o=>{o!=e&&(this.input[o]=!1)})}navigate(e){var o,i,a,s;this.router.navigate([e.url]),(null===(o=this.dropdownModelFilter)||void 0===o?void 0:o.selectedOption)&&(this.input.companyName=!1,this.dropdownModelFilter=Object.assign(Object.assign({},this.dropdownModelFilter),{selectedOption:{}})),(null===(i=this.dropdownModelCompany)||void 0===i?void 0:i.selectedOption)&&(this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{selectedOption:[]})),(null===(a=this.dropdownModelFilterPerson)||void 0===a?void 0:a.selectedOption)&&(this.input.personName=!1,this.dropdownModelFilterPerson=Object.assign(Object.assign({},this.dropdownModelFilterPerson),{selectedOption:{}})),(null===(s=this.nameTextBox)||void 0===s?void 0:s.value)&&(this.nameTextBox=Object.assign(Object.assign({},this.nameTextBox),{value:""}))}applyFilter(){this.activeTab===this.activeTabOptions.COMPANY?(this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{currentPage:1}),this.selectedCompanyForFilter=[...this.dropdownModelCompany.selectedOption],this.getCompanyCustomers(),this.getTotalDueAmountCompany()):this.activeTab===this.activeTabOptions.PERSONAL&&(this.pagination=Object.assign(Object.assign({},this.pagination),{currentPage:1}),this.textToSearch=this.nameTextBox.value+"",this.getCustomers(),this.getTotalDueAmountPerson())}reSetFilter(){this.activeTab===this.activeTabOptions.COMPANY?(this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{selectedOption:[]}),this.dropdownModelFilter=Object.assign(Object.assign({},this.dropdownModelFilter),{selectedOption:{}}),this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{currentPage:1}),this.input.companyName=!1,this.selectedCompanyForFilter=[],this.updateApplyButtonState(),this.getCompanyCustomers(),this.getTotalDueAmountCompany()):this.activeTab===this.activeTabOptions.PERSONAL&&(this.nameTextBox=Object.assign(Object.assign({},this.nameTextBox),{value:""}),this.pagination=Object.assign(Object.assign({},this.pagination),{currentPage:1}),this.dropdownModelFilterPerson=Object.assign(Object.assign({},this.dropdownModelFilterPerson),{selectedOption:{}}),this.input.personName=!1,this.textToSearch="",this.getCustomers(),this.getTotalDueAmountPerson()),this.updateApplyButtonState()}onObservableLoadCompanyData(e){e&&e.length>0&&(e.forEach((o,i)=>{e[i]=Object.assign(Object.assign({},e[i]),{label:`${o.CompanyName}${o.LicenseNumber?"-"+o.LicenseNumber:""}`,html:`<span class="company-name-dropdown">${o.CompanyName}${o.LicenseNumber?"-<i>"+o.LicenseNumber+"</i>":""}</span>`})}),this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{options:e,selectedOption:e}),this.updateApplyButtonState())}onObservableLoadWorkProviderData(e){if(e&&e.length>0){const o=e.filter((i,a)=>-1!==this.workProviderFromBooking.indexOf(i.label));this.workProvider.dropdownOptions=o}}}return n.currentPage=1,n.currentPageCompnay=1,n.\u0275fac=function(e){return new(e||n)(t.Y36(R.M),t.Y36($.v),t.Y36(E),t.Y36(A.F0),t.Y36(A.gz),t.Y36(W.n),t.Y36(S.j),t.Y36(X.o))},n.\u0275cmp=t.Xpm({type:n,selectors:[["add-customer-table"]],viewQuery:function(e,o){if(1&e&&(t.Gf(it,5),t.Gf(nt,5)),2&e){let i;t.iGM(i=t.CRH())&&(o.companyName=i.first),t.iGM(i=t.CRH())&&(o.workProvider=i.first)}},decls:15,vars:8,consts:[[1,"main-customer-list","customer-list","fx-col"],[1,"header-container","fx-0"],[3,"mode","menuItems","menuItemClick"],["class","filter",4,"ngIf"],[1,"pending-amount","fx-0"],["class","total-due-amount",4,"ngIf"],[1,"table-section","fx-1"],["class","table-container",4,"ngIf"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-repair.png"],[1,"filter"],[1,"company-filter-dropdown",3,"dropdownModel","selected"],["workProvider",""],["class","bodyShop-filter-dropdown",3,"dropdownModel","selected",4,"ngIf"],[3,"buttonModel"],[1,"bodyShop-filter-dropdown",3,"dropdownModel","selected"],["companyName",""],[1,"person-filter-dropdown",3,"dropdownModel","selected"],["filterPerson",""],[3,"inputModel","controlOutput",4,"ngIf"],[3,"inputModel","controlOutput"],[1,"total-due-amount"],[3,"class",4,"ngIf"],[4,"ngIf"],[1,"table-container"],[1,"table-wrapper"],[3,"config","tableData","sortChanged","pageChanged","cellClicked","i18n"],["class","pagination-wrapper",4,"ngIf"],[1,"pagination-wrapper"],[3,"pagination","paginationChange"],["paginator",""],["paginatorCompany",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"chq-tabs",2),t.NdJ("menuItemClick",function(a){return o.navigate(a)}),t.qZA(),t.YNc(3,st,6,4,"div",3),t.YNc(4,lt,6,4,"div",3),t.qZA(),t.TgZ(5,"div",4),t.YNc(6,pt,6,5,"div",5),t.YNc(7,ht,6,5,"div",5),t.qZA(),t.TgZ(8,"div",6),t.YNc(9,Ct,4,7,"div",7),t.YNc(10,ft,4,7,"div",7),t.qZA(),t.TgZ(11,"div",8),t.TgZ(12,"div",9),t.TgZ(13,"div",10),t._UZ(14,"img",11),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("mode","button")("menuItems",o.customerListMenus),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.COMPANY),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.PERSONAL),t.xp6(2),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.PERSONAL&&(null==o.tableData?null:o.tableData.length)>0&&o.showTotalDueAmountPerson),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.COMPANY&&(null==o.tableDataCompany?null:o.tableDataCompany.length)>0&&o.showTotalDueAmountCompany),t.xp6(2),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.PERSONAL),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.COMPANY))},directives:[k.K,D.O5,tt.I,et.E,ot.D,U.B,_.l],pipes:[N.X$,S.j],styles:[".main-customer-list{height:calc(100vh - (5px + 1.5vw) - (5px + 1.5vw + 58px + 1.6vw) - 76px)}.main-customer-list .header-container{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:20px}.main-customer-list .header-container .header-content{font-weight:600;font-size:14px;line-height:20px}.main-customer-list .header-container .filter{display:flex;align-items:flex-end}.main-customer-list .header-container .filter chq-dropdown,.main-customer-list .header-container .filter chq-input{position:relative;width:150px;margin-left:16px;margin-top:4px}.main-customer-list .header-container .filter chq-button{margin-left:16px}.main-customer-list .header-container .filter chq-dropdown.user-dropdown{width:200px}.main-customer-list .header-container .filter chq-dropdown.person-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.retail-company-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.bodyShop-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.dealerShip-filter-dropdown{width:200px}.main-customer-list .header-container .filter chq-dropdown.company-filter-dropdown{width:170px}.main-customer-list .delete-container{display:flex;justify-content:flex-end;margin-top:30px;margin-bottom:25px}.main-customer-list .delete-container chq-button{width:180px;height:30px}.main-customer-list .table-section{overflow-y:auto}.main-customer-list .cdk-column-status mat-icon{height:17px;width:17px}.main-customer-list .total-due-amount{padding-bottom:18px;display:flex;justify-content:end;font-family:Inter;font-size:18px;font-style:normal;font-weight:500;line-height:24px;color:var(--xa-dark-gray)}.main-customer-list .pagination-wrapper{margin-top:15px}.main-customer-list .company-name i,.main-customer-list .company-name-dropdown i{font-weight:600}.mat-sort-header-arrow{margin:-2px!important}.customer-list .input-wrapper{position:inherit!important;top:0!important}@media (orientation: portrait){mat-cell{word-break:break-word}.mat-sort-header-arrow{margin:0!important}}::-webkit-scrollbar:horizontal{height:5px}.table-wrapper{box-shadow:0 0 4px rgba(0,0,0,.1)}\n"],encapsulation:2}),n})();const _t={columns:[{id:"Id",sortable:!0,header:{text:"booking_id",tooltip:""},selector:{field:"RepairNumber"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"VehicleMake",sortable:!0,header:{text:"vehicle_make",tooltip:""},selector:{field:"VehicleMake"},widget:{type:"text"}},{id:"VehicleModel",sortable:!0,header:{text:"vehicle_model",tooltip:""},selector:{field:"VehicleModel"},widget:{type:"text"}},{id:"LicensePlateNumber",sortable:!0,header:{text:"license_plate",tooltip:""},selector:{field:"LicensePlateNumber"},widget:{type:"text"}},{id:"BookingType",sortable:!0,header:{text:"booking_type",tooltip:""},selector:{field:"BookingType"},widget:{type:"text"}},{id:"RepairType",sortable:!0,header:{text:"repair_type",tooltip:""},selector:{field:"RepairType"},widget:{type:"text"}},{id:"TotalInvoiceAmount",sortable:!0,header:{text:"total_amount_invoiced",tooltip:""},selector:{field:"FormattedTotalAmount"},widget:{type:"text"}},{id:"PaidAmount",sortable:!0,header:{text:"paid_amount",tooltip:""},selector:{field:"FormattedPaidAmount"},widget:{type:"text"}},{id:"AmountDue",sortable:!0,header:{text:"due_amount",tooltip:""},selector:{field:"FormattedDueAmount"},widget:{type:"text"}},{id:"Status",sortable:!0,header:{text:"status",tooltip:""},selector:{field:"Status"},widget:{type:"text"}}]},xt={columns:[{id:"Id",sortable:!0,header:{text:"estimate_id",tooltip:""},selector:{field:"EstimateNumber"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"VehicleMake",sortable:!0,header:{text:"vehicle_make",tooltip:""},selector:{field:"VehicleMake"},widget:{type:"text"}},{id:"VehicleModel",sortable:!0,header:{text:"vehicle_model",tooltip:""},selector:{field:"VehicleModel"},widget:{type:"text"}},{id:"LicensePlateNumber",sortable:!0,header:{text:"license_plate",tooltip:""},selector:{field:"LicensePlateNumber"},widget:{type:"text"}},{id:"TotalEstimateAmount ",sortable:!0,header:{text:"total_estimate_amount",tooltip:""},selector:{field:"FormattedTotalEstimateAmount"},widget:{type:"text"}},{id:"EstimationStatus",sortable:!0,header:{text:"estimation_status",tooltip:""},selector:{field:"EstimationStatus"},widget:{type:"text"}}]};var z=r(17771),Z=r(90171);function yt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"chq-tabs",13),t.NdJ("menuItemClick",function(i){return t.CHM(e),t.oxw().navigate(i)}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("mode","button")("menuItems",e.customerDetailsMenus)}}const j=function(n,c,e,o,i){return[n,c,e,o,i]};function Tt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"mat-accordion"),t.TgZ(1,"mat-expansion-panel",15),t.NdJ("opened",function(){return t.CHM(e),t.oxw(2).panelOpenState=!0})("closed",function(){return t.CHM(e),t.oxw(2).panelOpenState=!1}),t.TgZ(2,"mat-expansion-panel-header"),t.TgZ(3,"mat-panel-title"),t.TgZ(4,"h4"),t._uU(5),t.qZA(),t.TgZ(6,"p",16),t.TgZ(7,"label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._uU(10),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div"),t.TgZ(12,"p",17),t.TgZ(13,"label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._uU(16),t.ALo(17,"date"),t.qZA(),t.TgZ(18,"p",17),t.TgZ(19,"label"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t._uU(22),t.ALo(23,"xaCurrency"),t.qZA(),t.TgZ(24,"p",17),t.TgZ(25,"label"),t._uU(26),t.ALo(27,"translate"),t.qZA(),t._uU(28),t.ALo(29,"xaCurrency"),t.qZA(),t.TgZ(30,"p",17),t.TgZ(31,"label"),t._uU(32),t.ALo(33,"translate"),t.qZA(),t._uU(34),t.ALo(35,"xaCurrency"),t.qZA(),t.TgZ(36,"p",17),t.TgZ(37,"label"),t._uU(38),t.ALo(39,"translate"),t.qZA(),t._uU(40),t.qZA(),t.TgZ(41,"p",17),t.TgZ(42,"label"),t._uU(43),t.ALo(44,"translate"),t.qZA(),t._uU(45),t.qZA(),t.TgZ(46,"p",17),t.TgZ(47,"label"),t._uU(48),t.ALo(49,"translate"),t.qZA(),t._uU(50),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(5),t.Oqu(null==e.userDetails?null:e.userDetails.companyName),t.xp6(3),t.hij("",t.lcZ(9,17,"contact_id"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactId," "),t.xp6(4),t.hij("",t.lcZ(15,19,"creation_date"),":"),t.xp6(2),t.hij(" ",t.xi3(17,21,null==e.userDetails?null:e.userDetails.createdDate,"dd/MM/YYYY hh:mm:ss"),""),t.xp6(4),t.hij("",t.lcZ(21,24,"total_invoiced"),":"),t.xp6(2),t.hij(" ",t.G7q(23,26,t.qbA(54,j,null==e.userDetails?null:e.userDetails.amount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)),""),t.xp6(4),t.hij("",t.lcZ(27,32,"paid_amount"),":"),t.xp6(2),t.hij(" ",t.G7q(29,34,t.qbA(60,j,null==e.userDetails?null:e.userDetails.amountReceived,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)),""),t.xp6(4),t.hij("",t.lcZ(33,40,"due_amount"),":"),t.xp6(2),t.hij(" ",t.G7q(35,42,t.qbA(66,j,null==e.userDetails?null:e.userDetails.amountDue,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)),""),t.xp6(4),t.hij("",t.lcZ(39,48,"contact_name"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactName,""),t.xp6(3),t.hij("",t.lcZ(44,50,"contact_phone"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactPhoneNumber,""),t.xp6(3),t.hij("",t.lcZ(49,52,"contact_email"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactEmail,"")}}function At(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"mat-accordion"),t.TgZ(1,"mat-expansion-panel",15),t.NdJ("opened",function(){return t.CHM(e),t.oxw(2).panelOpenState=!0})("closed",function(){return t.CHM(e),t.oxw(2).panelOpenState=!1}),t.TgZ(2,"mat-expansion-panel-header"),t.TgZ(3,"mat-panel-title"),t.TgZ(4,"h4"),t._uU(5),t.qZA(),t.TgZ(6,"p",16),t.TgZ(7,"label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._uU(10),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div"),t.TgZ(12,"p",17),t.TgZ(13,"label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._uU(16),t.qZA(),t.TgZ(17,"p",17),t.TgZ(18,"label"),t._uU(19),t.ALo(20,"translate"),t.qZA(),t._uU(21),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(5),t.AsE("",null==e.userDetails?null:e.userDetails.firstName," ",null==e.userDetails?null:e.userDetails.lastName,""),t.xp6(3),t.hij("",t.lcZ(9,8,"contact_id"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactId,""),t.xp6(4),t.hij("",t.lcZ(15,10,"email"),":"),t.xp6(2),t.hij(" ",e.userDetails.email,""),t.xp6(3),t.hij("",t.lcZ(20,12,"phone_number"),":"),t.xp6(2),t.hij(" ",e.userDetails.mobileNumber,"")}}function Dt(n,c){if(1&n&&(t.TgZ(0,"div",14),t.YNc(1,Tt,51,72,"mat-accordion",8),t.YNc(2,At,22,14,"mat-accordion",8),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf","company"===e.userType),t.xp6(1),t.Q6J("ngIf","individual"===e.userType)}}function wt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",22),t.TgZ(1,"chq-paginator",23,24),t.NdJ("paginationChange",function(i){return t.CHM(e),t.oxw(2).handlePaginationChangeReapir(i)}),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.paginationRepair)}}function Ot(n,c){if(1&n&&(t.TgZ(0,"section"),t.TgZ(1,"div",18),t.TgZ(2,"div",19),t._UZ(3,"chq-mat-table",20),t.qZA(),t.YNc(4,wt,3,1,"div",21),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("config",e.tableConfigRepair)("tableData",e.tableDataRepair)("cellClicked",e.handleCellClickRepair)("sortChanged",e.handleSortChangeRepair)("pageChanged",e.pageChangedRepair)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableDataRepair?null:e.tableDataRepair.length)>0&&e.paginationRepair.count>e.paginationRepair.pageSize)}}function Pt(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",22),t.TgZ(1,"chq-paginator",23,24),t.NdJ("paginationChange",function(i){return t.CHM(e),t.oxw(2).handlePaginationChangeCase(i)}),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.paginationCase)}}function Zt(n,c){if(1&n&&(t.TgZ(0,"section"),t.TgZ(1,"div",18),t.TgZ(2,"div",19),t._UZ(3,"chq-mat-table",20),t.qZA(),t.YNc(4,Pt,3,1,"div",21),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("config",e.tableConfigCase)("tableData",e.tableDataCase)("cellClicked",e.handleCellClickCase)("sortChanged",e.handleSortChangeCase)("pageChanged",e.pageChangedCase)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableDataCase?null:e.tableDataCase.length)>0&&e.paginationCase.count>e.paginationCase.pageSize)}}const Y={repair:"repair-order",cases:"estimates"},Q=z.D,G=z.A;let Mt=(()=>{class n{constructor(e,o,i,a,s,l){this.monitorService=e,this.customerService=o,this.route=i,this.commonService=a,this.router=s,this.xaCurrencyPipe=l,this.panelOpenState=!1,this.pageChangedRepair=!1,this.paginationRepair=_.G,this.totalCountRepair=0,this.configDataRepair=_t,this.pageChangedCase=!1,this.paginationCase=_.G,this.totalCountCase=0,this.configDataCase=xt,this.userDetails={},this.customerId="",this.uniqueId="",this.userType="",this.haveQuotePermissions=!1,this.userDetailsLoading=!1,this.customerDetailsMenus=L.yx,this.activeTab="",this.tabOptions=Y,this.handleCellClickRepair=(d,h)=>{var p,C;if("Id"===h.id){const v=null===(C=null===(p=d.find(u=>u.id===h.id))||void 0===p?void 0:p.result)||void 0===C?void 0:C.value;if(v){const u=this.tableDataRepair.find(m=>m.RepairNumber===v);if(u){const m=G[u.Status.toLowerCase()]||G.others;this.router.navigate([m.replace("{{repairGUID}}",u.RepairGuid)])}}}},this.handleCellClickCase=(d,h)=>{var p,C;if("Id"===h.id){const v=null===(C=null===(p=d.find(u=>u.id===h.id))||void 0===p?void 0:p.result)||void 0===C?void 0:C.value;if(v){const u=this.tableDataCase.find(m=>m.EstimateNumber===v);if(u){const m=Q[u.EstimationStatus.toLowerCase()]||Q.others;this.router.navigate([m.replace("{{caseGUID}}",u.CaseGuid)])}}}},this.handleSortChangeRepair=d=>{d&&(this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),{orderBy:d.active,sortDirection:d.direction}),this.getRepairOrders())},this.handleSortChangeCase=d=>{d&&(this.paginationCase=Object.assign(Object.assign({},this.paginationCase),{orderBy:d.active,sortDirection:d.direction}),this.getCases())},this.i18n=this.commonService.geti18nInfo()}ngOnInit(){return(0,f.mG)(this,void 0,void 0,function*(){this.monitorService.logEvent("ngOnInit",["CustomerDetailsComponent","addenda-repair"]),this.commonService.userProfileData.subscribe(e=>{var o,i;const a=(null===(i=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.userPermission)||void 0===i?void 0:i.automotiveServices)||[];this.haveQuotePermissions=a.find(s=>"Carheal Quote"===s.automotiveServiceName)}),this.route.params.subscribe(e=>{this.customerId=e.contactId,this.uniqueId=e.id,this.userType=e.userType,this.activeTab=e.orderType,this.tableConfigRepair=this.configDataRepair,this.tableConfigCase=this.configDataCase,this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),{count:this.totalCountRepair,currentPage:n.currentPageRepair,orderBy:"CreatedDate",sortDirection:"desc"}),this.paginationCase=Object.assign(Object.assign({},this.paginationCase),{count:this.totalCountCase,currentPage:n.currentPageCase,orderBy:"CreatedDate",sortDirection:"desc"}),this.activeTab===Y.repair?this.getRepairOrders():this.getCases(),this.getUserDetails()})})}getUserDetails(){return(0,f.mG)(this,void 0,void 0,function*(){return"company"===this.userType?(this.userDetailsLoading=!0,(0,g.z)(this.customerService.getCompanyDetails(this.customerId)).then(e=>{(null==e?void 0:e.data)&&(this.userDetails=e.data,this.userDetails.amount||(this.userDetails.amount=0),this.userDetails.amountReceived||(this.userDetails.amountReceived=0),this.userDetails.amountDue||(this.userDetails.amountDue=0),this.userDetailsLoading=!1)}).catch(e=>{this.monitorService.logException(e,T._.Error)})):(this.userDetailsLoading=!0,(0,g.z)(this.customerService.getCustomerDetails(this.uniqueId)).then(e=>{(null==e?void 0:e.data)&&(this.userDetails=e.data,this.userDetailsLoading=!1)}).catch(e=>{this.monitorService.logException(e,T._.Error)}))})}getRepairOrders(){return(0,f.mG)(this,void 0,void 0,function*(){return this.commonService.showLoading(),(0,g.z)(this.customerService.getReapirOrders(this.customerId,this.userType,this.paginationRepair)).then(e=>{const o=e.value;o.map(i=>{i.AmountDue=i.TotalInvoiceAmount-i.PaidAmount,i.FormattedTotalAmount=i.TotalInvoiceAmount?this.xaCurrencyPipe.transform(i.TotalInvoiceAmount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",i.FormattedPaidAmount=i.PaidAmount?this.xaCurrencyPipe.transform(i.PaidAmount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",i.FormattedDueAmount=i.TotalInvoiceAmount?this.xaCurrencyPipe.transform(i.AmountDue,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-"}),this.tableDataRepair=o,this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),{count:e["@odata.count"]||0}),this.commonService.hideLoading()}).catch(e=>{this.monitorService.logException(e,T._.Error),this.commonService.hideLoading()})})}getCases(){return(0,f.mG)(this,void 0,void 0,function*(){return this.commonService.showLoading(),(0,g.z)(this.customerService.getCases(this.customerId,this.userType,this.paginationCase)).then(e=>{const o=e.value;o.map(i=>{i.FormattedTotalEstimateAmount=i.TotalEstimateAmount?this.xaCurrencyPipe.transform(i.TotalEstimateAmount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-"}),this.tableDataCase=o,this.paginationCase=Object.assign(Object.assign({},this.paginationCase),{count:e["@odata.count"]||0}),this.commonService.hideLoading()}).catch(e=>{this.monitorService.logException(e,T._.Error),this.commonService.hideLoading()})})}handlePaginationChangeReapir(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.paginationRepair.currentPage=e.currentPage,this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),o),this.pageChangedRepair=!0,this.getRepairOrders()}handlePaginationChangeCase(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.paginationCase.currentPage=e.currentPage,this.paginationCase=Object.assign(Object.assign({},this.paginationCase),o),this.pageChangedCase=!0,this.getCases()}navigate(e){this.userType&&this.customerId&&this.router.navigate([e.url.replace("{userType}",this.userType).replace("{customerId}",this.customerId).replace("{id}",this.uniqueId)])}handleBackClick(){this.router.navigate(["/repair/customers/{userType}".replace("{userType}",this.userType)])}}return n.currentPageRepair=1,n.currentPageCase=1,n.\u0275fac=function(e){return new(e||n)(t.Y36(R.M),t.Y36(E),t.Y36(A.gz),t.Y36($.v),t.Y36(A.F0),t.Y36(S.j))},n.\u0275cmp=t.Xpm({type:n,selectors:[["customer-details"]],decls:19,vars:11,consts:[[1,"main-customer-details","fx-col"],[1,"header","d-flex","align-center","position-relative","fx-0"],[1,""],[1,"back-section","d-flex","align-center",3,"click"],[1,"cross",3,"svgIcon"],[3,"mode","menuItems","menuItemClick",4,"ngIf"],["class","user-details",4,"ngIf"],[1,"table-section","fx-1"],[4,"ngIf"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-repair.png"],[3,"mode","menuItems","menuItemClick"],[1,"user-details"],[3,"opened","closed"],[1,"sub-heading"],[1,"expanded-sub-heading"],[1,"table-container"],[1,"table-wrapper"],[3,"config","tableData","cellClicked","sortChanged","pageChanged","i18n"],["class","pagination-wrapper",4,"ngIf"],[1,"pagination-wrapper"],[3,"pagination","paginationChange"],["paginator",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"section",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.NdJ("click",function(){return o.handleBackClick()}),t._UZ(4,"mat-icon",4),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"translate"),t.ALo(8,"translate"),t.qZA(),t.qZA(),t.YNc(9,yt,1,2,"chq-tabs",5),t.qZA(),t.YNc(10,Dt,3,2,"div",6),t.qZA(),t.TgZ(11,"div",7),t.YNc(12,Ot,5,7,"section",8),t.YNc(13,Zt,5,7,"section",8),t.qZA(),t.TgZ(14,"footer"),t.TgZ(15,"div",9),t.TgZ(16,"div",10),t.TgZ(17,"div",11),t._UZ(18,"img",12),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("svgIcon","left-arrow"),t.xp6(2),t.AsE("",t.lcZ(7,7,"back")," / ",t.lcZ(8,9,o.userType)," "),t.xp6(3),t.Q6J("ngIf",o.haveQuotePermissions),t.xp6(1),t.Q6J("ngIf",o.userDetails&&!o.userDetailsLoading),t.xp6(2),t.Q6J("ngIf",o.activeTab===o.tabOptions.repair),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.tabOptions.cases))},directives:[O.Hw,D.O5,k.K,Z.pp,Z.ib,Z.yz,Z.yK,U.B,_.l],pipes:[N.X$,D.uU,S.j],styles:[".main-customer-details[_ngcontent-%COMP%]{height:calc(100vh - (5px + 1.5vw) - (5px + 1.5vw + 58px + 1.6vw) - 76px)}.main-customer-details[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{overflow-y:auto}.main-customer-details[_ngcontent-%COMP%]   .border-bottom[_ngcontent-%COMP%]{border-bottom:1px solid var(--xa-gray)}.main-customer-details[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:40px;min-height:64px}.main-customer-details[_ngcontent-%COMP%]   .pagination-wrapper[_ngcontent-%COMP%]{margin-top:15px}.main-customer-details[_ngcontent-%COMP%]   .back-section[_ngcontent-%COMP%]{margin-bottom:17px;text-transform:capitalize;cursor:pointer}.main-customer-details[_ngcontent-%COMP%]   .back-section[_ngcontent-%COMP%]     mat-icon{margin-left:5px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{width:32%;position:absolute;right:0;top:9px;z-index:1}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]{font-weight:500;font-size:9px;color:var(--xa-black-medium);margin-bottom:0;margin-top:5px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--xa-black);opacity:.6}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .expanded-sub-heading[_ngcontent-%COMP%]{font-weight:400;font-size:10px;color:var(--xa-black-medium);margin-bottom:0;margin-top:8px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .expanded-sub-heading[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--xa-black);opacity:.6}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{padding:8px 20px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{border-radius:11px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0 20px 16px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]     .mat-expansion-indicator:after{color:var(--xa-black)}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{background:var(--xa-bold-gray)}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expanded[_ngcontent-%COMP%]{background:var(--xa-white)}"]}),n})();var St=r(44466);const It=[{path:":userType",component:bt,resolve:{version:w.n}},{path:":userType/:contactId/:id/:orderType",component:Mt,resolve:{version:w.n}}];let qt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[D.ez,O.Ps,q.p,A.Bz.forChild(It),I.Tx,y.H,Z.To,N.aw,St.m]]}),n})()},74743:(V,M,r)=>{r.d(M,{n:()=>q});var D=r(27969),w=r(84945),A=r(33568),O=r(37716),I=r(4893);let q=(()=>{class y{constructor(g){this.commonService=g}resolve(){return this.commonService.showLoading(),this.commonService.checkVersion().pipe((0,D.U)(g=>{this.commonService.hideLoading();const _=localStorage.getItem("appVersion"),P=g.buildRevision;return _&&_!=P?(localStorage.setItem("appVersion",P),setTimeout(()=>{location.reload()},10),(0,w.of)("new version available")):(localStorage.setItem("appVersion",P),(0,w.of)("new version is not available"))}),(0,A.K)(()=>(this.commonService.hideLoading(),(0,w.of)("data not available at this time"))))}}return y.\u0275fac=function(g){return new(g||y)(O.LFG(I.v))},y.\u0275prov=O.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()}}]);