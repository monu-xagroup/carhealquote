"use strict";(self.webpackChunkcar_heal_quote=self.webpackChunkcar_heal_quote||[]).push([[551],{57551:(j,M,s)=>{s.r(M),s.d(M,{CustomerTableModule:()=>Ie});var T=s(36895),A=s(74743),b=s(81390),D=s(97392),O=s(81561),I=s(25852),x=s(9655),C=s(15861),h=s(83905),y=s(7772);const w={columns:[{id:"ContactId",sortable:!0,header:{text:"id",tooltip:""},selector:{field:"ContactId"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"FirstName",sortable:!0,selector:{field:"FirstName"},header:{text:"first_name",tooltip:""},widget:{type:"text"}},{id:"LastName",sortable:!0,selector:{field:"LastName"},header:{text:"last_name",tooltip:""},widget:{type:"text"}},{id:"MobileNumber",sortable:!0,selector:{field:"MobileNumber"},header:{text:"mobile_number",tooltip:""},widget:{type:"text"}},{id:"Email",sortable:!0,selector:{field:"Email"},header:{text:"email_address",tooltip:""},widget:{type:"text"}},{id:"Amount",sortable:!0,selector:{field:"FormattedTotalAmount"},cellStyle:"justify-content:center;",header:{text:"total_amount_invoiced",tooltip:""},widget:{type:"text"}},{id:"AmountReceived",sortable:!0,cellStyle:"justify-content:center;",selector:{field:"FormattedPaidAmount"},header:{text:"paid_amount",tooltip:""},widget:{type:"text"}},{id:"AmountDue",sortable:!0,cellStyle:"justify-content:center;",selector:{field:"FormattedDueAmount"},header:{text:"due_amount",tooltip:""},widget:{type:"html"}}]},G={columns:[{id:"ContactId",sortable:!0,header:{text:"id",tooltip:""},selector:{field:"ContactId"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"CompanyName",sortable:!0,selector:{field:"FormattedCompanyName"},header:{text:"company_name",tooltip:""},widget:{type:"html"}},{id:"Amount",sortable:!0,selector:{field:"FormattedTotalAmount"},header:{text:"total_amount_invoiced",tooltip:""},widget:{type:"text"},cellStyle:"justify-content:center;"},{id:"AmountReceived",sortable:!0,selector:{field:"FormattedPaidAmount"},header:{text:"paid_amount",tooltip:""},widget:{type:"text"},cellStyle:"justify-content:center;"},{id:"AmountDue",sortable:!0,selector:{field:"FormattedDueAmount"},header:{text:"due_amount",tooltip:""},widget:{type:"html"},cellStyle:"justify-content:center;"}]};var F=s(38588),_=s(56969),t=s(94650),R=s(12484),L=s(47074),v=s(92340),V=s(80529);let $=(()=>{class n{constructor(e){this.http=e}getCustomers(e,o=null){const a=(e.currentPage-1)*e.pageSize;return this.http.get(`${v.N.caseMgmtUrl}/odata/customerinvoice?${o=o?`$top=${e.pageSize}&$skip=${a}&${o}`:`$top=${e.pageSize}&$skip=${a}`}&$orderby=${e.orderBy} ${e.sortDirection}&count=true`)}getCompanyCustomers(e,o=""){const a=(e.currentPage-1)*e.pageSize;return this.http.get(`${v.N.caseMgmtUrl}/odata/companyinvoice?${o=o?`$top=${e.pageSize}&$skip=${a}&${o}`:`$top=${e.pageSize}&$skip=${a}`}&$orderby=${e.orderBy} ${e.sortDirection}&count=true`)}getCompanyWorkProviders(e=""){return this.http.get(`${v.N.caseMgmtUrl}/odata/companyinvoice?${e}`)}getReapirOrders(e,o,a){let c="";return c="company"===o?`&$filter=(companyId eq ${e})&companyIndividualType=1`:`&$filter=(contactId eq ${e})&companyIndividualType=2`,this.http.get(`${v.N.caseMgmtUrl}/odata/repairorder?$top=${a.pageSize}&$skip=${(a.currentPage-1)*a.pageSize}&$orderby=${a.orderBy} ${a.sortDirection}${c}&count=true`)}getCases(e,o,a){let c="";return c="company"===o?`&$filter=(companyId eq ${e})&companyIndividualType=1`:`&$filter=(contactId eq ${e})&companyIndividualType=2`,this.http.get(`${v.N.caseMgmtUrl}/odata/repairestimation?$top=${a.pageSize}&$skip=${(a.currentPage-1)*a.pageSize}&$orderby=${a.orderBy} ${a.sortDirection}${c}&count=true`)}getTotalDueAmountCompany(e=""){return this.http.get(`${v.N.caseMgmtUrl}/odata/companyinvoice?${e}`)}getTotalDueAmountPerson(e=""){return this.http.get(`${v.N.caseMgmtUrl}/odata/customerinvoice?${e}`)}getCompanyDetails(e){return this.http.get(`${v.N.caseMgmtUrl}/api/companyinvoice/${e}`)}getCustomerDetails(e){return this.http.get(`${v.N.caseMgmtUrl}/api/customerinvoice/${e}`)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(V.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var H=s(38709),S=s(93077),K=s(56785),E=s(63298),W=s(14315),X=s(8851),ee=s(36978),k=s(77782),Z=s(89383);const te=["companyName"],oe=["workProvider"];function ne(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"chq-dropdown",17,18),t.NdJ("selected",function(a){t.CHM(e);const i=t.oxw(2);return t.KtG(i.selectFilter(a))}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("dropdownModel",e.dropdownModelCompany)}}function ae(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",12)(1,"chq-dropdown",13,14),t.NdJ("selected",function(a){t.CHM(e);const i=t.oxw();return t.KtG(i.selectFilter(a))}),t.qZA(),t.YNc(3,ne,2,1,"chq-dropdown",15),t._UZ(4,"chq-button",16)(5,"chq-button",16),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("dropdownModel",e.dropdownModelFilter),t.xp6(2),t.Q6J("ngIf",e.input.companyName),t.xp6(1),t.Q6J("buttonModel",e.applyButtonModel),t.xp6(1),t.Q6J("buttonModel",e.resetButtonModel)}}function ie(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"chq-input",22),t.NdJ("controlOutput",function(a){t.CHM(e);const i=t.oxw(2);return t.KtG(i.updateInput(a))}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("inputModel",e.nameTextBox)}}function re(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",12)(1,"chq-dropdown",19,20),t.NdJ("selected",function(a){t.CHM(e);const i=t.oxw();return t.KtG(i.selectFilter(a))}),t.qZA(),t.YNc(3,ie,1,1,"chq-input",21),t._UZ(4,"chq-button",16)(5,"chq-button",16),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("dropdownModel",e.dropdownModelFilterPerson),t.xp6(2),t.Q6J("ngIf",e.input.personName),t.xp6(1),t.Q6J("buttonModel",e.applyButtonModel),t.xp6(1),t.Q6J("buttonModel",e.resetButtonModel)}}const U=function(n,l,e,o,a){return[n,l,e,o,a]};function se(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"xaCurrency"),t.qZA()),2&n){const e=t.oxw(2);t.Tol(e.dueAmountPersonClass),t.xp6(1),t.Oqu(t.G7q(2,4,t.qbA(10,U,e.totalDueAmountPerson,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)))}}function le(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.totalDueAmountPerson)}}function ce(n,l){if(1&n&&(t.TgZ(0,"div",23)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.YNc(4,se,3,16,"span",24),t.YNc(5,le,2,1,"span",25),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.hij("",t.lcZ(3,3,"total_due_amount"),": "),t.xp6(2),t.Q6J("ngIf","-"!==e.totalDueAmountPerson),t.xp6(1),t.Q6J("ngIf","-"===e.totalDueAmountPerson)}}function de(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"xaCurrency"),t.qZA()),2&n){const e=t.oxw(2);t.Tol(e.dueAmountCompanyClass),t.xp6(1),t.Oqu(t.G7q(2,4,t.qbA(10,U,e.totalDueAmountCompany,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)))}}function pe(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.totalDueAmountCompany)}}function ue(n,l){if(1&n&&(t.TgZ(0,"div",23)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.YNc(4,de,3,16,"span",24),t.YNc(5,pe,2,1,"span",25),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.hij("",t.lcZ(3,3,"total_due_amount"),": "),t.xp6(2),t.Q6J("ngIf","-"!==e.totalDueAmountCompany),t.xp6(1),t.Q6J("ngIf","-"===e.totalDueAmountCompany)}}function me(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",30)(1,"chq-paginator",31,32),t.NdJ("paginationChange",function(a){t.CHM(e);const i=t.oxw(2);return t.KtG(i.handlePaginationChange(a))}),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.pagination)}}function ge(n,l){if(1&n&&(t.TgZ(0,"div",26)(1,"div",27),t._UZ(2,"chq-mat-table",28),t.qZA(),t.YNc(3,me,3,1,"div",29),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("config",e.tableConfig)("tableData",e.tableData)("sortChanged",e.handleSortChange)("pageChanged",e.pageChanged)("cellClicked",e.handleCellClick)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableData?null:e.tableData.length)>0&&e.pagination.count>e.pagination.pageSize)}}function he(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",30)(1,"chq-paginator",31,33),t.NdJ("paginationChange",function(a){t.CHM(e);const i=t.oxw(2);return t.KtG(i.handlePaginationChangeCompany(a))}),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.paginationCompany)}}function Ce(n,l){if(1&n&&(t.TgZ(0,"div",26)(1,"div",27),t._UZ(2,"chq-mat-table",28),t.qZA(),t.YNc(3,he,3,1,"div",29),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("config",e.tableConfigCompany)("tableData",e.tableDataCompany)("sortChanged",e.handleSortChangeCompany)("pageChanged",e.pageChangedCompany)("cellClicked",e.handleCellClickCompany)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableDataCompany?null:e.tableDataCompany.length)>0&&e.paginationCompany.count>e.pagination.pageSize)}}const B={COMPANY:"company",PERSONAL:"individual"};let fe=(()=>{class n{constructor(e,o,a,i,r,d,c,g){this.monitorService=e,this.commonService=o,this.tableDataSer=a,this.router=i,this.route=r,this.caseService=d,this.xaCurrencyPipe=c,this.calendarService=g,this.pageChanged=!1,this.pagination=y.G,this.configData=w,this.textToSearch="",this.input={personName:!1,companyName:!1},this.customerListMenus=F.JU,this.activeTab="",this.activeTabOptions=B,this.pageChangedCompany=!1,this.paginationCompany=y.G,this.configDataCompany=G,this.workProviderFromBooking=[],this.selectedCompanyForFilter=[],this.dueAmountPersonClass="",this.dueAmountCompanyClass="",this.totalDueAmountCompany=0,this.totalDueAmountPerson=0,this.showTotalDueAmountCompany=!1,this.showTotalDueAmountPerson=!1,this.applyButtonModel={label:"apply",type:"disabled",icon:"",onclick:this.applyFilter.bind(this)},this.resetButtonModel={label:"reset_all",type:"outline",icon:"",onclick:this.reSetFilter.bind(this)},this.dropdownModelFilter={options:[],placeHolder:"select_type",label:"select_type",name:"filterDropdown",displayValue:"label",selectedOption:{label:""}},this.dropdownModelCompany={options:[],placeHolder:"company_name",label:"company_name",name:"companyDropdown",displayValue:"companyName",keyFieldName:"CompanyId",selectedOption:[],isMultiSelect:!0},this.dropdownModelFilterPerson={options:[{label:"Retail - Individual"}],placeHolder:"select_type",label:"select_type",name:"filterDropdownPerson",displayValue:"label",selectedOption:{label:""}},this.nameTextBox={placeHolder:"customer_name",label:"customer_name",name:"name",type:"text",value:"",required:!1},this.handleSortChange=p=>{p&&(this.pagination={...this.pagination,orderBy:p.active,sortDirection:p.direction},this.getCustomers())},this.handleSortChangeCompany=p=>{p&&(this.paginationCompany={...this.paginationCompany,orderBy:p.active,sortDirection:p.direction},this.getCompanyCustomers())},this.handleCellClick=(p,u)=>{if("ContactId"===u.id){const m=p.find(f=>f.id===u.id)?.result?.value;if(m){const f=this.tableData.find(q=>q.ContactId===m);f&&this.commonService.customerDetails.next(f),m&&this.router.navigate([`/repair/customers/individual/${m}/${f.Id}/repair-order`])}}},this.handleCellClickCompany=(p,u)=>{if("ContactId"===u.id){const m=p.find(f=>f.id===u.id)?.result?.value;if(m){const f=this.tableDataCompany.find(q=>q.ContactId===m);f&&this.commonService.customerDetails.next(f),m&&this.router.navigate([`/repair/customers/company/${m}/${f.Id}/repair-order`])}}},this.i18n=this.commonService.geti18nInfo()}ngOnInit(){var e=this;this.monitorService.logEvent("ngOnInit",["CustomerTableComponent","addenda-repair"]),this.tableConfig=this.configData,this.tableConfigCompany=this.configDataCompany,this.route.params.subscribe(function(){var o=(0,C.Z)(function*(a){if(e.activeTab=a.userType,e.activeTab===B.PERSONAL)e.pagination={...e.pagination,count:0,currentPage:n.currentPage,orderBy:"CreatedDate",sortDirection:"desc"},e.handlePaginationChange({currentPage:n.currentPage,offset:e.pagination.pageSize*(n.currentPage-1),pageSize:e.pagination.pageSize}),e.getTotalDueAmountPerson();else{e.paginationCompany={...e.paginationCompany,count:0,currentPage:n.currentPageCompnay,orderBy:"CreatedDate",sortDirection:"desc"},e.commonService.showLoading();const i=yield(0,h.z)(e.tableDataSer.getCompanyWorkProviders("$apply=groupby((CompanyOrgType))"));i&&i.length>0&&(e.workProviderFromBooking=i.map(r=>r.CompanyOrgType)),e.getCompanyCustomers(),e.getTotalDueAmountCompany(),e.dropdownModelFilter.observable||(e.dropdownModelFilter={...e.dropdownModelFilter,observable:e.caseService.getProviders(),onObservableLoad:e.onObservableLoadWorkProviderData.bind(e)},e.workProvider.dropdownModel.observable=e.caseService.getProviders(),e.workProvider.getObservable())}});return function(a){return o.apply(this,arguments)}}()),this.subscription=this.commonService.userProfileData.subscribe(o=>{this.userDetail=o?.data})}ngOnDestroy(){this.subscription.unsubscribe()}getCompanyCustomers(){var e=this;return(0,C.Z)(function*(){e.commonService.showLoading();let o="";return e.selectedCompanyForFilter?.length>0&&(o=`$filter=(${e.selectedCompanyForFilter.map(a=>`ContactId eq ${a.CompanyId}`).join(" or ")})`),(0,h.z)(e.tableDataSer.getCompanyCustomers(e.paginationCompany,o)).then(a=>{const i=a.value;i.map(r=>{let d="";if(r.AmountDue=r.Amount-r.AmountReceived,r.Amount&&void 0!==r.AmountDue){const c=100*r.AmountDue/r.Amount;c>=30&&(d="color-xa-dark-red"),c<=10&&c>0&&(d="col-xa-orange2"),0==c&&(d="color-xa-repair-header")}r.FormattedTotalAmount=r.Amount?e.xaCurrencyPipe.transform(r.Amount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-",r.FormattedPaidAmount=r.AmountReceived?e.xaCurrencyPipe.transform(r.AmountReceived,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-",r.FormattedDueAmount=r.Amount?'<span class="'+d+'">'+e.xaCurrencyPipe.transform(r.AmountDue,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-</span>",r.FormattedCompanyName=r.CompanyName?`<span class="company-name">${r.CompanyName}${r.LicenseNumber?"-<i>"+r.LicenseNumber+"</i>":""}</span>`:""}),e.tableDataCompany=i,e.paginationCompany={...e.paginationCompany,count:a["@odata.count"]||0},e.commonService.hideLoading()}).catch(a=>{e.monitorService.logException(a,_._.Error),e.commonService.hideLoading()})})()}getCustomers(){var e=this;return(0,C.Z)(function*(){const o=e.dropdownModelFilterPerson.selectedOption?.label;let a="";if("retail - individual"===o?.toLowerCase()&&""!=e.textToSearch){const i=encodeURIComponent(e.textToSearch.toString());a=`$filter=(contains(tolower(FirstName),'${i.toLowerCase()}')) or (contains(tolower(LastName),'${i.toLowerCase()}'))`}return e.commonService.showLoading(),(0,h.z)(e.tableDataSer.getCustomers(e.pagination,a)).then(i=>{const r=i.value;r.map(d=>{let c="";if(d.AmountDue=d.Amount-d.AmountReceived,d.Amount&&void 0!==d.AmountDue){const g=100*d.AmountDue/d.Amount;g>=30&&(c="color-xa-dark-red"),g<=10&&g>0&&(c="col-xa-orange2"),0==g&&(c="color-xa-repair-header")}d.FormattedTotalAmount=d.Amount?e.xaCurrencyPipe.transform(d.Amount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-",d.FormattedPaidAmount=d.AmountReceived?e.xaCurrencyPipe.transform(d.AmountReceived,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-",d.FormattedDueAmount=d.Amount&&void 0!==d.AmountDue?'<span class="'+c+'">'+e.xaCurrencyPipe.transform(d.AmountDue,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)+"</span>":"-"}),e.tableData=r,e.pagination={...e.pagination,count:i["@odata.count"]||0},e.commonService.hideLoading()}).catch(i=>{e.monitorService.logException(i,_._.Error),e.commonService.hideLoading()})})()}getTotalDueAmountCompany(){var e=this;return(0,C.Z)(function*(){e.showTotalDueAmountCompany=!1;let o="$apply=";return e.selectedCompanyForFilter?.length>0&&(o+=`filter(${e.selectedCompanyForFilter.map(a=>`ContactId eq ${a.CompanyId}`).join(" or ")})/`),o+="aggregate(Amount with sum as TotalAmount, AmountReceived with sum as TotalAmountReceived)",(0,h.z)(e.tableDataSer.getTotalDueAmountCompany(o)).then(a=>{if(a&&a[0]&&(e.showTotalDueAmountCompany=!0,e.dueAmountCompanyClass="",e.totalDueAmountCompany=a[0].TotalAmount?a[0].TotalAmount-a[0].TotalAmountReceived:"-",a[0].TotalAmount)){const i=100*e.totalDueAmountCompany/a[0].TotalAmount;i>=30&&(e.dueAmountCompanyClass="color-xa-dark-red"),i<=10&&i>0&&(e.dueAmountCompanyClass="col-xa-orange2"),0==i&&(e.dueAmountCompanyClass="color-xa-repair-header")}}).catch(a=>{e.showTotalDueAmountCompany=!0,e.monitorService.logException(a,_._.Error)})})()}getTotalDueAmountPerson(){var e=this;return(0,C.Z)(function*(){e.showTotalDueAmountPerson=!1;let o="$apply=";if("retail - individual"===e.dropdownModelFilterPerson.selectedOption?.label?.toLowerCase()&&""!=e.textToSearch){const i=encodeURIComponent(e.textToSearch.toString());o+=`filter(contains(tolower(FirstName),'${i.toLowerCase()}') or contains(tolower(LastName),'${i.toLowerCase()}'))/`}return o+="aggregate(Amount with sum as TotalAmount, AmountReceived with sum as TotalAmountReceived)",(0,h.z)(e.tableDataSer.getTotalDueAmountPerson(o)).then(i=>{if(i&&i[0]&&(e.showTotalDueAmountPerson=!0,e.dueAmountPersonClass="",e.totalDueAmountPerson=i[0].TotalAmount?i[0].TotalAmount-i[0].TotalAmountReceived:"-",i[0].TotalAmount)){const r=100*e.totalDueAmountPerson/i[0].TotalAmount;r>=30&&(e.dueAmountPersonClass="color-xa-dark-red"),r<=10&&r>0&&(e.dueAmountPersonClass="col-xa-orange2"),0==r&&(e.dueAmountPersonClass="color-xa-repair-header")}}).catch(i=>{e.showTotalDueAmountPerson=!0,e.monitorService.logException(i,_._.Error)})})()}handlePaginationChange(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.pagination.currentPage=e.currentPage,this.pagination={...this.pagination,...o},this.pageChanged=!0,this.getCustomers()}handlePaginationChangeCompany(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.paginationCompany.currentPage=e.currentPage,this.paginationCompany={...this.paginationCompany,...o},this.pageChangedCompany=!0,this.getCompanyCustomers()}selectFilter(e){if(this.monitorService.logEvent("selectFilter",["CustomerTableComponent","addenda-repair",{$event:e}]),"filterDropdown"==e?.name){const o=`?$filter=( OrgId eq ${this.userDetail?.organizationDetail?.id} and CompanyOrgType eq '${e.value.label}' and IsIndividual eq false)`;this.dropdownModelFilter.selectedOption=e.value,this.hideShowDropdown("companyName"),this.dropdownModelCompany={...this.dropdownModelCompany,selectedOption:[],options:[],displayValue:"label",observable:this.calendarService.getCustomer(o),onObservableLoad:this.onObservableLoadCompanyData.bind(this)},setTimeout(()=>{this.companyName?.getObservable()},100),this.updateApplyButtonState()}else"filterDropdownPerson"==e.name?"retail - individual"===(this.dropdownModelFilterPerson.selectedOption=e.value,e.value[this.dropdownModelFilterPerson.displayValue]?.toLowerCase())?(this.hideShowDropdown("personName"),this.nameTextBox.value=""):this.hideShowDropdown(""):"companyDropdown"==e?.name&&(this.dropdownModelCompany.selectedOption=e.value,this.updateApplyButtonState())}updateInput(e){"name"==e.name&&(this.nameTextBox.value=e.value,this.updateApplyButtonState())}updateApplyButtonState(){let e="disabled";this.activeTab===this.activeTabOptions.PERSONAL?this.nameTextBox.value&&this.nameTextBox.value.toString().length>=3&&(e="secondary"):this.activeTab===this.activeTabOptions.COMPANY&&this.dropdownModelCompany.selectedOption?.length>0&&this.input.companyName&&(e="secondary"),this.applyButtonModel.type=e}hideShowDropdown(e){this.input[e]=!0,Object.keys(this.input).forEach(o=>{o!=e&&(this.input[o]=!1)})}navigate(e){this.router.navigate([e.url]),this.dropdownModelFilter?.selectedOption&&(this.input.companyName=!1,this.dropdownModelFilter={...this.dropdownModelFilter,selectedOption:{}}),this.dropdownModelCompany?.selectedOption&&(this.dropdownModelCompany={...this.dropdownModelCompany,selectedOption:[]}),this.dropdownModelFilterPerson?.selectedOption&&(this.input.personName=!1,this.dropdownModelFilterPerson={...this.dropdownModelFilterPerson,selectedOption:{}}),this.nameTextBox?.value&&(this.nameTextBox={...this.nameTextBox,value:""})}applyFilter(){this.activeTab===this.activeTabOptions.COMPANY?(this.paginationCompany={...this.paginationCompany,currentPage:1},this.selectedCompanyForFilter=[...this.dropdownModelCompany.selectedOption],this.getCompanyCustomers(),this.getTotalDueAmountCompany()):this.activeTab===this.activeTabOptions.PERSONAL&&(this.pagination={...this.pagination,currentPage:1},this.textToSearch=(this.nameTextBox.value+"").trim(),this.getCustomers(),this.getTotalDueAmountPerson())}reSetFilter(){this.activeTab===this.activeTabOptions.COMPANY?(this.dropdownModelCompany={...this.dropdownModelCompany,selectedOption:[]},this.dropdownModelFilter={...this.dropdownModelFilter,selectedOption:{}},this.paginationCompany={...this.paginationCompany,currentPage:1},this.input.companyName=!1,this.selectedCompanyForFilter=[],this.updateApplyButtonState(),this.getCompanyCustomers(),this.getTotalDueAmountCompany()):this.activeTab===this.activeTabOptions.PERSONAL&&(this.nameTextBox={...this.nameTextBox,value:""},this.pagination={...this.pagination,currentPage:1},this.dropdownModelFilterPerson={...this.dropdownModelFilterPerson,selectedOption:{}},this.input.personName=!1,this.textToSearch="",this.getCustomers(),this.getTotalDueAmountPerson()),this.updateApplyButtonState()}onObservableLoadCompanyData(e){e&&e.length>0&&(e.forEach((o,a)=>{e[a]={...e[a],label:`${o.CompanyName}${o.LicenseNumber?"-"+o.LicenseNumber:""}`,html:`<span class="company-name-dropdown">${o.CompanyName}${o.LicenseNumber?"-<i>"+o.LicenseNumber+"</i>":""}</span>`}}),this.dropdownModelCompany={...this.dropdownModelCompany,options:e,selectedOption:e},this.updateApplyButtonState())}onObservableLoadWorkProviderData(e){if(e&&e.length>0){const o=e.filter((a,i)=>-1!==this.workProviderFromBooking.indexOf(a.label));this.workProvider.dropdownOptions=o}}}return n.currentPage=1,n.currentPageCompnay=1,n.\u0275fac=function(e){return new(e||n)(t.Y36(R.M),t.Y36(L.v),t.Y36($),t.Y36(b.F0),t.Y36(b.gz),t.Y36(H.n),t.Y36(S.j),t.Y36(K.o))},n.\u0275cmp=t.Xpm({type:n,selectors:[["add-customer-table"]],viewQuery:function(e,o){if(1&e&&(t.Gf(te,5),t.Gf(oe,5)),2&e){let a;t.iGM(a=t.CRH())&&(o.companyName=a.first),t.iGM(a=t.CRH())&&(o.workProvider=a.first)}},decls:15,vars:8,consts:[[1,"main-customer-list","customer-list","fx-col"],[1,"header-container","fx-0"],[3,"mode","menuItems","menuItemClick"],["class","filter",4,"ngIf"],[1,"pending-amount","fx-0"],["class","total-due-amount",4,"ngIf"],[1,"table-section","fx-1"],["class","table-container",4,"ngIf"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-repair.png"],[1,"filter"],[1,"company-filter-dropdown",3,"dropdownModel","selected"],["workProvider",""],["class","bodyShop-filter-dropdown",3,"dropdownModel","selected",4,"ngIf"],[3,"buttonModel"],[1,"bodyShop-filter-dropdown",3,"dropdownModel","selected"],["companyName",""],[1,"person-filter-dropdown",3,"dropdownModel","selected"],["filterPerson",""],[3,"inputModel","controlOutput",4,"ngIf"],[3,"inputModel","controlOutput"],[1,"total-due-amount"],[3,"class",4,"ngIf"],[4,"ngIf"],[1,"table-container"],[1,"table-wrapper"],[3,"config","tableData","sortChanged","pageChanged","cellClicked","i18n"],["class","pagination-wrapper",4,"ngIf"],[1,"pagination-wrapper"],[3,"pagination","paginationChange"],["paginator",""],["paginatorCompany",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"chq-tabs",2),t.NdJ("menuItemClick",function(i){return o.navigate(i)}),t.qZA(),t.YNc(3,ae,6,4,"div",3),t.YNc(4,re,6,4,"div",3),t.qZA(),t.TgZ(5,"div",4),t.YNc(6,ce,6,5,"div",5),t.YNc(7,ue,6,5,"div",5),t.qZA(),t.TgZ(8,"div",6),t.YNc(9,ge,4,7,"div",7),t.YNc(10,Ce,4,7,"div",7),t.qZA(),t.TgZ(11,"div",8)(12,"div",9)(13,"div",10),t._UZ(14,"img",11),t.qZA()()()()),2&e&&(t.xp6(2),t.Q6J("mode","button")("menuItems",o.customerListMenus),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.COMPANY),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.PERSONAL),t.xp6(2),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.PERSONAL&&(null==o.tableData?null:o.tableData.length)>0&&o.showTotalDueAmountPerson),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.COMPANY&&(null==o.tableDataCompany?null:o.tableDataCompany.length)>0&&o.showTotalDueAmountCompany),t.xp6(2),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.PERSONAL),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.activeTabOptions.COMPANY))},dependencies:[T.O5,E.B,W.D,X.I,ee.E,y.l,k.K,S.j,Z.X$],styles:[".main-customer-list{height:calc(100vh - (5px + 1.5vw) - (63px + 3.1vw) - 76px)}.main-customer-list .header-container{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:20px}.main-customer-list .header-container .header-content{font-weight:600;font-size:14px;line-height:20px}.main-customer-list .header-container .filter{display:flex;align-items:flex-end}.main-customer-list .header-container .filter chq-dropdown,.main-customer-list .header-container .filter chq-input{position:relative;width:150px;margin-left:16px;margin-top:4px}.main-customer-list .header-container .filter chq-button{margin-left:16px}.main-customer-list .header-container .filter chq-dropdown.user-dropdown{width:200px}.main-customer-list .header-container .filter chq-dropdown.person-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.retail-company-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.bodyShop-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.dealerShip-filter-dropdown{width:200px}.main-customer-list .header-container .filter chq-dropdown.company-filter-dropdown{width:170px}.main-customer-list .delete-container{display:flex;justify-content:flex-end;margin-top:30px;margin-bottom:25px}.main-customer-list .delete-container chq-button{width:180px;height:30px}.main-customer-list .table-section{overflow-y:auto}.main-customer-list .cdk-column-status mat-icon{height:17px;width:17px}.main-customer-list .total-due-amount{padding-bottom:18px;display:flex;justify-content:end;font-family:Inter;font-size:18px;font-style:normal;font-weight:500;line-height:24px;color:var(--xa-dark-gray)}.main-customer-list .pagination-wrapper{margin-top:15px}.main-customer-list .company-name i,.main-customer-list .company-name-dropdown i{font-weight:600}.mat-sort-header-arrow{margin:-2px!important}.customer-list .input-wrapper{position:inherit!important;top:0!important}@media (orientation: portrait){mat-cell{word-break:break-word}.mat-sort-header-arrow{margin:0!important}}::-webkit-scrollbar:horizontal{height:5px}.table-wrapper{box-shadow:0 0 4px #0000001a}\n"],encapsulation:2}),n})();const ye={columns:[{id:"Id",sortable:!0,header:{text:"booking_id",tooltip:""},selector:{field:"RepairNumber"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"VehicleMake",sortable:!0,header:{text:"vehicle_make",tooltip:""},selector:{field:"VehicleMake"},widget:{type:"text"}},{id:"VehicleModel",sortable:!0,header:{text:"vehicle_model",tooltip:""},selector:{field:"VehicleModel"},widget:{type:"text"}},{id:"LicensePlateNumber",sortable:!0,header:{text:"license_plate",tooltip:""},selector:{field:"LicensePlateNumber"},widget:{type:"text"}},{id:"BookingType",sortable:!0,header:{text:"booking_type",tooltip:""},selector:{field:"BookingType"},widget:{type:"text"}},{id:"RepairType",sortable:!0,header:{text:"repair_type",tooltip:""},selector:{field:"RepairType"},widget:{type:"text"}},{id:"TotalInvoiceAmount",sortable:!0,header:{text:"total_amount_invoiced",tooltip:""},selector:{field:"FormattedTotalAmount"},widget:{type:"text"}},{id:"PaidAmount",sortable:!0,header:{text:"paid_amount",tooltip:""},selector:{field:"FormattedPaidAmount"},widget:{type:"text"}},{id:"AmountDue",sortable:!0,header:{text:"due_amount",tooltip:""},selector:{field:"FormattedDueAmount"},widget:{type:"text"}},{id:"Status",sortable:!0,header:{text:"status",tooltip:""},selector:{field:"Status"},widget:{type:"text"}}]},ve={columns:[{id:"Id",sortable:!0,header:{text:"estimate_id",tooltip:""},selector:{field:"EstimateNumber"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"VehicleMake",sortable:!0,header:{text:"vehicle_make",tooltip:""},selector:{field:"VehicleMake"},widget:{type:"text"}},{id:"VehicleModel",sortable:!0,header:{text:"vehicle_model",tooltip:""},selector:{field:"VehicleModel"},widget:{type:"text"}},{id:"LicensePlateNumber",sortable:!0,header:{text:"license_plate",tooltip:""},selector:{field:"LicensePlateNumber"},widget:{type:"text"}},{id:"TotalEstimateAmount ",sortable:!0,header:{text:"total_estimate_amount",tooltip:""},selector:{field:"FormattedTotalEstimateAmount"},widget:{type:"text"}},{id:"EstimationStatus",sortable:!0,header:{text:"estimation_status",tooltip:""},selector:{field:"EstimationStatus"},widget:{type:"text"}}]};var J=s(17771),P=s(37084);function xe(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"chq-tabs",13),t.NdJ("menuItemClick",function(a){t.CHM(e);const i=t.oxw();return t.KtG(i.navigate(a))}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("mode","button")("menuItems",e.customerDetailsMenus)}}const N=function(n,l,e,o,a){return[n,l,e,o,a]};function _e(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"mat-accordion")(1,"mat-expansion-panel",15),t.NdJ("opened",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.panelOpenState=!0)})("closed",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.panelOpenState=!1)}),t.TgZ(2,"mat-expansion-panel-header")(3,"mat-panel-title")(4,"h4"),t._uU(5),t.qZA(),t.TgZ(6,"p",16)(7,"label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._uU(10),t.qZA()()(),t.TgZ(11,"div")(12,"p",17)(13,"label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._uU(16),t.ALo(17,"date"),t.qZA(),t.TgZ(18,"p",17)(19,"label"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t._uU(22),t.ALo(23,"xaCurrency"),t.qZA(),t.TgZ(24,"p",17)(25,"label"),t._uU(26),t.ALo(27,"translate"),t.qZA(),t._uU(28),t.ALo(29,"xaCurrency"),t.qZA(),t.TgZ(30,"p",17)(31,"label"),t._uU(32),t.ALo(33,"translate"),t.qZA(),t._uU(34),t.ALo(35,"xaCurrency"),t.qZA(),t.TgZ(36,"p",17)(37,"label"),t._uU(38),t.ALo(39,"translate"),t.qZA(),t._uU(40),t.qZA(),t.TgZ(41,"p",17)(42,"label"),t._uU(43),t.ALo(44,"translate"),t.qZA(),t._uU(45),t.qZA(),t.TgZ(46,"p",17)(47,"label"),t._uU(48),t.ALo(49,"translate"),t.qZA(),t._uU(50),t.qZA()()()()}if(2&n){const e=t.oxw(2);t.xp6(5),t.Oqu(null==e.userDetails?null:e.userDetails.companyName),t.xp6(3),t.hij("",t.lcZ(9,17,"contact_id"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactId," "),t.xp6(4),t.hij("",t.lcZ(15,19,"creation_date"),":"),t.xp6(2),t.hij(" ",t.xi3(17,21,null==e.userDetails?null:e.userDetails.createdDate,"dd/MM/YYYY hh:mm:ss"),""),t.xp6(4),t.hij("",t.lcZ(21,24,"total_invoiced"),":"),t.xp6(2),t.hij(" ",t.G7q(23,26,t.qbA(54,N,null==e.userDetails?null:e.userDetails.amount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)),""),t.xp6(4),t.hij("",t.lcZ(27,32,"paid_amount"),":"),t.xp6(2),t.hij(" ",t.G7q(29,34,t.qbA(60,N,null==e.userDetails?null:e.userDetails.amountReceived,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)),""),t.xp6(4),t.hij("",t.lcZ(33,40,"due_amount"),":"),t.xp6(2),t.hij(" ",t.G7q(35,42,t.qbA(66,N,null==e.userDetails?null:e.userDetails.amountDue,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position)),""),t.xp6(4),t.hij("",t.lcZ(39,48,"contact_name"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactName,""),t.xp6(3),t.hij("",t.lcZ(44,50,"contact_phone"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactPhoneNumber,""),t.xp6(3),t.hij("",t.lcZ(49,52,"contact_email"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactEmail,"")}}function be(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"mat-accordion")(1,"mat-expansion-panel",15),t.NdJ("opened",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.panelOpenState=!0)})("closed",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.panelOpenState=!1)}),t.TgZ(2,"mat-expansion-panel-header")(3,"mat-panel-title")(4,"h4"),t._uU(5),t.qZA(),t.TgZ(6,"p",16)(7,"label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._uU(10),t.qZA()()(),t.TgZ(11,"div")(12,"p",17)(13,"label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._uU(16),t.qZA(),t.TgZ(17,"p",17)(18,"label"),t._uU(19),t.ALo(20,"translate"),t.qZA(),t._uU(21),t.qZA()()()()}if(2&n){const e=t.oxw(2);t.xp6(5),t.AsE("",null==e.userDetails?null:e.userDetails.firstName," ",null==e.userDetails?null:e.userDetails.lastName,""),t.xp6(3),t.hij("",t.lcZ(9,8,"contact_id"),":"),t.xp6(2),t.hij(" ",null==e.userDetails?null:e.userDetails.contactId,""),t.xp6(4),t.hij("",t.lcZ(15,10,"email"),":"),t.xp6(2),t.hij(" ",e.userDetails.email,""),t.xp6(3),t.hij("",t.lcZ(20,12,"phone_number"),":"),t.xp6(2),t.hij(" ",e.userDetails.mobileNumber,"")}}function Te(n,l){if(1&n&&(t.TgZ(0,"div",14),t.YNc(1,_e,51,72,"mat-accordion",8),t.YNc(2,be,22,14,"mat-accordion",8),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf","company"===e.userType),t.xp6(1),t.Q6J("ngIf","individual"===e.userType)}}function Ae(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",22)(1,"chq-paginator",23,24),t.NdJ("paginationChange",function(a){t.CHM(e);const i=t.oxw(2);return t.KtG(i.handlePaginationChangeReapir(a))}),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.paginationRepair)}}function De(n,l){if(1&n&&(t.TgZ(0,"section")(1,"div",18)(2,"div",19),t._UZ(3,"chq-mat-table",20),t.qZA(),t.YNc(4,Ae,3,1,"div",21),t.qZA()()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("config",e.tableConfigRepair)("tableData",e.tableDataRepair)("cellClicked",e.handleCellClickRepair)("sortChanged",e.handleSortChangeRepair)("pageChanged",e.pageChangedRepair)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableDataRepair?null:e.tableDataRepair.length)>0&&e.paginationRepair.count>e.paginationRepair.pageSize)}}function we(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",22)(1,"chq-paginator",23,24),t.NdJ("paginationChange",function(a){t.CHM(e);const i=t.oxw(2);return t.KtG(i.handlePaginationChangeCase(a))}),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("pagination",e.paginationCase)}}function Pe(n,l){if(1&n&&(t.TgZ(0,"section")(1,"div",18)(2,"div",19),t._UZ(3,"chq-mat-table",20),t.qZA(),t.YNc(4,we,3,1,"div",21),t.qZA()()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("config",e.tableConfigCase)("tableData",e.tableDataCase)("cellClicked",e.handleCellClickCase)("sortChanged",e.handleSortChangeCase)("pageChanged",e.pageChangedCase)("i18n",e.i18n),t.xp6(1),t.Q6J("ngIf",(null==e.tableDataCase?null:e.tableDataCase.length)>0&&e.paginationCase.count>e.paginationCase.pageSize)}}const z={repair:"repair-order",cases:"estimates"},Y=J.D,Q=J.A;let Me=(()=>{class n{constructor(e,o,a,i,r,d){this.monitorService=e,this.customerService=o,this.route=a,this.commonService=i,this.router=r,this.xaCurrencyPipe=d,this.panelOpenState=!1,this.pageChangedRepair=!1,this.paginationRepair=y.G,this.totalCountRepair=0,this.configDataRepair=ye,this.pageChangedCase=!1,this.paginationCase=y.G,this.totalCountCase=0,this.configDataCase=ve,this.userDetails={},this.customerId="",this.uniqueId="",this.userType="",this.haveQuotePermissions=!1,this.userDetailsLoading=!1,this.customerDetailsMenus=F.yx,this.activeTab="",this.tabOptions=z,this.handleCellClickRepair=(c,g)=>{if("Id"===g.id){const p=c.find(u=>u.id===g.id)?.result?.value;if(p){const u=this.tableDataRepair.find(m=>m.RepairNumber===p);if(u){const m=Q[u.Status.toLowerCase()]||Q.others;this.router.navigate([m.replace("{{repairGUID}}",u.RepairGuid)])}}}},this.handleCellClickCase=(c,g)=>{if("Id"===g.id){const p=c.find(u=>u.id===g.id)?.result?.value;if(p){const u=this.tableDataCase.find(m=>m.EstimateNumber===p);if(u){const m=Y[u.EstimationStatus.toLowerCase()]||Y.others;this.router.navigate([m.replace("{{caseGUID}}",u.CaseGuid)])}}}},this.handleSortChangeRepair=c=>{c&&(this.paginationRepair={...this.paginationRepair,orderBy:c.active,sortDirection:c.direction},this.getRepairOrders())},this.handleSortChangeCase=c=>{c&&(this.paginationCase={...this.paginationCase,orderBy:c.active,sortDirection:c.direction},this.getCases())},this.i18n=this.commonService.geti18nInfo()}ngOnInit(){var e=this;return(0,C.Z)(function*(){e.monitorService.logEvent("ngOnInit",["CustomerDetailsComponent","addenda-repair"]),e.commonService.userProfileData.subscribe(o=>{e.haveQuotePermissions=(o?.data?.userPermission?.automotiveServices||[]).find(i=>"Carheal Quote"===i.automotiveServiceName)}),e.route.params.subscribe(o=>{e.customerId=o.contactId,e.uniqueId=o.id,e.userType=o.userType,e.activeTab=o.orderType,e.tableConfigRepair=e.configDataRepair,e.tableConfigCase=e.configDataCase,e.paginationRepair={...e.paginationRepair,count:e.totalCountRepair,currentPage:n.currentPageRepair,orderBy:"CreatedDate",sortDirection:"desc"},e.paginationCase={...e.paginationCase,count:e.totalCountCase,currentPage:n.currentPageCase,orderBy:"CreatedDate",sortDirection:"desc"},e.activeTab===z.repair?e.getRepairOrders():e.getCases(),e.getUserDetails()})})()}getUserDetails(){var e=this;return(0,C.Z)(function*(){return"company"===e.userType?(e.userDetailsLoading=!0,(0,h.z)(e.customerService.getCompanyDetails(e.customerId)).then(o=>{o?.data&&(e.userDetails=o.data,e.userDetails.amount||(e.userDetails.amount=0),e.userDetails.amountReceived||(e.userDetails.amountReceived=0),e.userDetails.amountDue||(e.userDetails.amountDue=0),e.userDetailsLoading=!1)}).catch(o=>{e.monitorService.logException(o,_._.Error)})):(e.userDetailsLoading=!0,(0,h.z)(e.customerService.getCustomerDetails(e.uniqueId)).then(o=>{o?.data&&(e.userDetails=o.data,e.userDetailsLoading=!1)}).catch(o=>{e.monitorService.logException(o,_._.Error)}))})()}getRepairOrders(){var e=this;return(0,C.Z)(function*(){return e.commonService.showLoading(),(0,h.z)(e.customerService.getReapirOrders(e.customerId,e.userType,e.paginationRepair)).then(o=>{const a=o.value;a.map(i=>{i.AmountDue=i.TotalInvoiceAmount-i.PaidAmount,i.FormattedTotalAmount=i.TotalInvoiceAmount?e.xaCurrencyPipe.transform(i.TotalInvoiceAmount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-",i.FormattedPaidAmount=i.PaidAmount?e.xaCurrencyPipe.transform(i.PaidAmount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-",i.FormattedDueAmount=i.TotalInvoiceAmount?e.xaCurrencyPipe.transform(i.AmountDue,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-"}),e.tableDataRepair=a,e.paginationRepair={...e.paginationRepair,count:o["@odata.count"]||0},e.commonService.hideLoading()}).catch(o=>{e.monitorService.logException(o,_._.Error),e.commonService.hideLoading()})})()}getCases(){var e=this;return(0,C.Z)(function*(){return e.commonService.showLoading(),(0,h.z)(e.customerService.getCases(e.customerId,e.userType,e.paginationCase)).then(o=>{const a=o.value;a.map(i=>{i.FormattedTotalEstimateAmount=i.TotalEstimateAmount?e.xaCurrencyPipe.transform(i.TotalEstimateAmount,e.i18n.currencySymbol,e.i18n.digitsInfo,e.i18n.locale,e.i18n.position):"-"}),e.tableDataCase=a,e.paginationCase={...e.paginationCase,count:o["@odata.count"]||0},e.commonService.hideLoading()}).catch(o=>{e.monitorService.logException(o,_._.Error),e.commonService.hideLoading()})})()}handlePaginationChangeReapir(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.paginationRepair.currentPage=e.currentPage,this.paginationRepair={...this.paginationRepair,...o},this.pageChangedRepair=!0,this.getRepairOrders()}handlePaginationChangeCase(e){const o={pageSize:e.pageSize,offset:e.offset,currentPage:e.currentPage};this.paginationCase.currentPage=e.currentPage,this.paginationCase={...this.paginationCase,...o},this.pageChangedCase=!0,this.getCases()}navigate(e){this.userType&&this.customerId&&this.router.navigate([e.url.replace("{userType}",this.userType).replace("{customerId}",this.customerId).replace("{id}",this.uniqueId)])}handleBackClick(){this.router.navigate(["/repair/customers/{userType}".replace("{userType}",this.userType)])}}return n.currentPageRepair=1,n.currentPageCase=1,n.\u0275fac=function(e){return new(e||n)(t.Y36(R.M),t.Y36($),t.Y36(b.gz),t.Y36(L.v),t.Y36(b.F0),t.Y36(S.j))},n.\u0275cmp=t.Xpm({type:n,selectors:[["customer-details"]],decls:19,vars:11,consts:[[1,"main-customer-details","fx-col"],[1,"header","d-flex","align-center","position-relative","fx-0"],[1,""],[1,"back-section","d-flex","align-center",3,"click"],[1,"cross",3,"svgIcon"],[3,"mode","menuItems","menuItemClick",4,"ngIf"],["class","user-details",4,"ngIf"],[1,"table-section","fx-1"],[4,"ngIf"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-repair.png"],[3,"mode","menuItems","menuItemClick"],[1,"user-details"],[3,"opened","closed"],[1,"sub-heading"],[1,"expanded-sub-heading"],[1,"table-container"],[1,"table-wrapper"],[3,"config","tableData","cellClicked","sortChanged","pageChanged","i18n"],["class","pagination-wrapper",4,"ngIf"],[1,"pagination-wrapper"],[3,"pagination","paginationChange"],["paginator",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"section",1)(2,"div",2)(3,"div",3),t.NdJ("click",function(){return o.handleBackClick()}),t._UZ(4,"mat-icon",4),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"translate"),t.ALo(8,"translate"),t.qZA()(),t.YNc(9,xe,1,2,"chq-tabs",5),t.qZA(),t.YNc(10,Te,3,2,"div",6),t.qZA(),t.TgZ(11,"div",7),t.YNc(12,De,5,7,"section",8),t.YNc(13,Pe,5,7,"section",8),t.qZA(),t.TgZ(14,"footer")(15,"div",9)(16,"div",10)(17,"div",11),t._UZ(18,"img",12),t.qZA()()()()()),2&e&&(t.xp6(4),t.Q6J("svgIcon","left-arrow"),t.xp6(2),t.AsE("",t.lcZ(7,7,"back")," / ",t.lcZ(8,9,o.userType)," "),t.xp6(3),t.Q6J("ngIf",o.haveQuotePermissions),t.xp6(1),t.Q6J("ngIf",o.userDetails&&!o.userDetailsLoading),t.xp6(2),t.Q6J("ngIf",o.activeTab===o.tabOptions.repair),t.xp6(1),t.Q6J("ngIf",o.activeTab===o.tabOptions.cases))},dependencies:[T.O5,D.Hw,E.B,y.l,k.K,P.pp,P.ib,P.yz,P.yK,T.uU,S.j,Z.X$],styles:[".main-customer-details[_ngcontent-%COMP%]{height:calc(100vh - (5px + 1.5vw) - (63px + 3.1vw) - 76px)}.main-customer-details[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{overflow-y:auto}.main-customer-details[_ngcontent-%COMP%]   .border-bottom[_ngcontent-%COMP%]{border-bottom:1px solid var(--xa-gray)}.main-customer-details[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:40px;min-height:64px}.main-customer-details[_ngcontent-%COMP%]   .pagination-wrapper[_ngcontent-%COMP%]{margin-top:15px}.main-customer-details[_ngcontent-%COMP%]   .back-section[_ngcontent-%COMP%]{margin-bottom:17px;text-transform:capitalize;cursor:pointer}.main-customer-details[_ngcontent-%COMP%]   .back-section[_ngcontent-%COMP%]     mat-icon{margin-left:5px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{width:32%;position:absolute;right:0;top:9px;z-index:1}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]{font-weight:500;font-size:9px;color:var(--xa-black-medium);margin-bottom:0;margin-top:5px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--xa-black);opacity:.6}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .expanded-sub-heading[_ngcontent-%COMP%]{font-weight:400;font-size:10px;color:var(--xa-black-medium);margin-bottom:0;margin-top:8px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .expanded-sub-heading[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--xa-black);opacity:.6}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{padding:8px 20px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{border-radius:11px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0 20px 16px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]     .mat-expansion-indicator:after{color:var(--xa-black)}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{background:var(--xa-bold-gray)}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expanded[_ngcontent-%COMP%]{background:var(--xa-white)}"]}),n})();var Se=s(44466);const Oe=[{path:":userType",component:fe,resolve:{version:A.n}},{path:":userType/:contactId/:id/:orderType",component:Me,resolve:{version:A.n}}];let Ie=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[T.ez,D.Ps,I.p,b.Bz.forChild(Oe),O.Tx,x.H,P.To,Z.aw,Se.m]}),n})()},74743:(j,M,s)=>{s.d(M,{n:()=>I});var T=s(54004),A=s(39646),b=s(70262),D=s(94650),O=s(47074);let I=(()=>{class x{constructor(h){this.commonService=h}resolve(){return this.commonService.showLoading(),this.commonService.checkVersion().pipe((0,T.U)(h=>{this.commonService.hideLoading();const y=localStorage.getItem("appVersion"),w=h.buildRevision;return y&&y!=w?(localStorage.setItem("appVersion",w),setTimeout(()=>{location.reload()},10),(0,A.of)("new version available")):(localStorage.setItem("appVersion",w),(0,A.of)("new version is not available"))}),(0,b.K)(()=>(this.commonService.hideLoading(),(0,A.of)("data not available at this time"))))}}return x.\u0275fac=function(h){return new(h||x)(D.LFG(O.v))},x.\u0275prov=D.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()}}]);