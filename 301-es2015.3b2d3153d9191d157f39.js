"use strict";(self.webpackChunkcar_heal_quote=self.webpackChunkcar_heal_quote||[]).push([[301],{75301:function(t,e,i){i.r(e),i.d(e,{CustomerTableModule:function(){return Ct}});var o=i(38583),n=i(74743),a=i(55278),s=i(76627),r=i(79317),l=i(25852),c=i(89993),d=i(97582),p=i(57445),u=i(7772);const m={columns:[{id:"ContactId",sortable:!0,header:{text:"id",tooltip:""},selector:{field:"ContactId"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"FirstName",sortable:!0,selector:{field:"FirstName"},header:{text:"first_name",tooltip:""},widget:{type:"text"}},{id:"LastName",sortable:!0,selector:{field:"LastName"},header:{text:"last_name",tooltip:""},widget:{type:"text"}},{id:"MobileNumber",sortable:!0,selector:{field:"MobileNumber"},header:{text:"mobile_number",tooltip:""},widget:{type:"text"}},{id:"Email",sortable:!0,selector:{field:"Email"},header:{text:"email_address",tooltip:""},widget:{type:"text"}},{id:"Amount",sortable:!0,selector:{field:"FormattedTotalAmount"},cellStyle:"justify-content:center;",header:{text:"total_amount_invoiced",tooltip:""},widget:{type:"text"}},{id:"AmountReceived",sortable:!0,cellStyle:"justify-content:center;",selector:{field:"FormattedPaidAmount"},header:{text:"paid_amount",tooltip:""},widget:{type:"text"}},{id:"AmountDue",sortable:!0,cellStyle:"justify-content:center;",selector:{field:"FormattedDueAmount"},header:{text:"due_amount",tooltip:""},widget:{type:"html"}}]},h={columns:[{id:"ContactId",sortable:!0,header:{text:"id",tooltip:""},selector:{field:"ContactId"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"CompanyName",sortable:!0,selector:{field:"FormattedCompanyName"},header:{text:"company_name",tooltip:""},widget:{type:"html"}},{id:"Amount",sortable:!0,selector:{field:"FormattedTotalAmount"},header:{text:"total_amount_invoiced",tooltip:""},widget:{type:"text"},cellStyle:"justify-content:center;"},{id:"AmountReceived",sortable:!0,selector:{field:"FormattedPaidAmount"},header:{text:"paid_amount",tooltip:""},widget:{type:"text"},cellStyle:"justify-content:center;"},{id:"AmountDue",sortable:!0,selector:{field:"FormattedDueAmount"},header:{text:"due_amount",tooltip:""},widget:{type:"html"},cellStyle:"justify-content:center;"}]};var g=i(38588),C=i(7408),v=i(37716),b=i(95016),f=i(4893),y=i(92340),x=i(91841);let A=(()=>{class t{constructor(t){this.http=t}getCustomers(t,e=null){const i=(t.currentPage-1)*t.pageSize;return this.http.get(`${y.N.caseMgmtUrl}/odata/customerinvoice?${e=e?`$top=${t.pageSize}&$skip=${i}&${e}`:`$top=${t.pageSize}&$skip=${i}`}&$orderby=${t.orderBy} ${t.sortDirection}&count=true`)}getCompanyCustomers(t,e=""){const i=(t.currentPage-1)*t.pageSize;return this.http.get(`${y.N.caseMgmtUrl}/odata/companyinvoice?${e=e?`$top=${t.pageSize}&$skip=${i}&${e}`:`$top=${t.pageSize}&$skip=${i}`}&$orderby=${t.orderBy} ${t.sortDirection}&count=true`)}getCompanyWorkProviders(t=""){return this.http.get(`${y.N.caseMgmtUrl}/odata/companyinvoice?${t}`)}getReapirOrders(t,e,i){let o="";return o="company"===e?`&$filter=(companyId eq ${t})&companyIndividualType=1`:`&$filter=(contactId eq ${t})&companyIndividualType=2`,this.http.get(`${y.N.caseMgmtUrl}/odata/repairorder?$top=${i.pageSize}&$skip=${(i.currentPage-1)*i.pageSize}&$orderby=${i.orderBy} ${i.sortDirection}${o}&count=true`)}getCases(t,e,i){let o="";return o="company"===e?`&$filter=(companyId eq ${t})&companyIndividualType=1`:`&$filter=(contactId eq ${t})&companyIndividualType=2`,this.http.get(`${y.N.caseMgmtUrl}/odata/repairestimation?$top=${i.pageSize}&$skip=${(i.currentPage-1)*i.pageSize}&$orderby=${i.orderBy} ${i.sortDirection}${o}&count=true`)}getTotalDueAmountCompany(t=""){return this.http.get(`${y.N.caseMgmtUrl}/odata/companyinvoice?${t}`)}getTotalDueAmountPerson(t=""){return this.http.get(`${y.N.caseMgmtUrl}/odata/customerinvoice?${t}`)}getCompanyDetails(t){return this.http.get(`${y.N.caseMgmtUrl}/api/companyinvoice/${t}`)}getCustomerDetails(t){return this.http.get(`${y.N.caseMgmtUrl}/api/customerinvoice/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(v.LFG(x.eN))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var w=i(38709),T=i(93077),O=i(56785),D=i(77782),P=i(8851),Z=i(36978),S=i(67017),_=i(63298),M=i(29790);const q=["companyName"],I=["workProvider"];function N(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"chq-dropdown",17,18),v.NdJ("selected",function(e){return v.CHM(t),v.oxw(2).selectFilter(e)}),v.qZA()}if(2&t){const t=v.oxw(2);v.Q6J("dropdownModel",t.dropdownModelCompany)}}function j(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"div",12),v.TgZ(1,"chq-dropdown",13,14),v.NdJ("selected",function(e){return v.CHM(t),v.oxw().selectFilter(e)}),v.qZA(),v.YNc(3,N,2,1,"chq-dropdown",15),v._UZ(4,"chq-button",16),v._UZ(5,"chq-button",16),v.qZA()}if(2&t){const t=v.oxw();v.xp6(1),v.Q6J("dropdownModel",t.dropdownModelFilter),v.xp6(2),v.Q6J("ngIf",t.input.companyName),v.xp6(1),v.Q6J("buttonModel",t.applyButtonModel),v.xp6(1),v.Q6J("buttonModel",t.resetButtonModel)}}function $(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"chq-input",22),v.NdJ("controlOutput",function(e){return v.CHM(t),v.oxw(2).updateInput(e)}),v.qZA()}if(2&t){const t=v.oxw(2);v.Q6J("inputModel",t.nameTextBox)}}function F(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"div",12),v.TgZ(1,"chq-dropdown",19,20),v.NdJ("selected",function(e){return v.CHM(t),v.oxw().selectFilter(e)}),v.qZA(),v.YNc(3,$,1,1,"chq-input",21),v._UZ(4,"chq-button",16),v._UZ(5,"chq-button",16),v.qZA()}if(2&t){const t=v.oxw();v.xp6(1),v.Q6J("dropdownModel",t.dropdownModelFilterPerson),v.xp6(2),v.Q6J("ngIf",t.input.personName),v.xp6(1),v.Q6J("buttonModel",t.applyButtonModel),v.xp6(1),v.Q6J("buttonModel",t.resetButtonModel)}}const k=function(t,e,i,o,n){return[t,e,i,o,n]};function L(t,e){if(1&t&&(v.TgZ(0,"span"),v._uU(1),v.ALo(2,"xaCurrency"),v.qZA()),2&t){const t=v.oxw(2);v.Tol(t.dueAmountPersonClass),v.xp6(1),v.Oqu(v.G7q(2,4,v.qbA(10,k,t.totalDueAmountPerson,t.i18n.currencySymbol,t.i18n.digitsInfo,t.i18n.locale,t.i18n.position)))}}function R(t,e){if(1&t&&(v.TgZ(0,"span"),v._uU(1),v.qZA()),2&t){const t=v.oxw(2);v.xp6(1),v.Oqu(t.totalDueAmountPerson)}}function U(t,e){if(1&t&&(v.TgZ(0,"div",23),v.TgZ(1,"span"),v._uU(2),v.ALo(3,"translate"),v.YNc(4,L,3,16,"span",24),v.YNc(5,R,2,1,"span",25),v.qZA(),v.qZA()),2&t){const t=v.oxw();v.xp6(2),v.hij("",v.lcZ(3,3,"total_due_amount"),": "),v.xp6(2),v.Q6J("ngIf","-"!==t.totalDueAmountPerson),v.xp6(1),v.Q6J("ngIf","-"===t.totalDueAmountPerson)}}function E(t,e){if(1&t&&(v.TgZ(0,"span"),v._uU(1),v.ALo(2,"xaCurrency"),v.qZA()),2&t){const t=v.oxw(2);v.Tol(t.dueAmountCompanyClass),v.xp6(1),v.Oqu(v.G7q(2,4,v.qbA(10,k,t.totalDueAmountCompany,t.i18n.currencySymbol,t.i18n.digitsInfo,t.i18n.locale,t.i18n.position)))}}function J(t,e){if(1&t&&(v.TgZ(0,"span"),v._uU(1),v.qZA()),2&t){const t=v.oxw(2);v.xp6(1),v.Oqu(t.totalDueAmountCompany)}}function z(t,e){if(1&t&&(v.TgZ(0,"div",23),v.TgZ(1,"span"),v._uU(2),v.ALo(3,"translate"),v.YNc(4,E,3,16,"span",24),v.YNc(5,J,2,1,"span",25),v.qZA(),v.qZA()),2&t){const t=v.oxw();v.xp6(2),v.hij("",v.lcZ(3,3,"total_due_amount"),": "),v.xp6(2),v.Q6J("ngIf","-"!==t.totalDueAmountCompany),v.xp6(1),v.Q6J("ngIf","-"===t.totalDueAmountCompany)}}function B(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"div",30),v.TgZ(1,"chq-paginator",31,32),v.NdJ("paginationChange",function(e){return v.CHM(t),v.oxw(2).handlePaginationChange(e)}),v.qZA(),v.qZA()}if(2&t){const t=v.oxw(2);v.xp6(1),v.Q6J("pagination",t.pagination)}}function Y(t,e){if(1&t&&(v.TgZ(0,"div",26),v.TgZ(1,"div",27),v._UZ(2,"chq-mat-table",28),v.qZA(),v.YNc(3,B,3,1,"div",29),v.qZA()),2&t){const t=v.oxw();v.xp6(2),v.Q6J("config",t.tableConfig)("tableData",t.tableData)("sortChanged",t.handleSortChange)("pageChanged",t.pageChanged)("cellClicked",t.handleCellClick)("i18n",t.i18n),v.xp6(1),v.Q6J("ngIf",(null==t.tableData?null:t.tableData.length)>0&&t.pagination.count>t.pagination.pageSize)}}function Q(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"div",30),v.TgZ(1,"chq-paginator",31,33),v.NdJ("paginationChange",function(e){return v.CHM(t),v.oxw(2).handlePaginationChangeCompany(e)}),v.qZA(),v.qZA()}if(2&t){const t=v.oxw(2);v.xp6(1),v.Q6J("pagination",t.paginationCompany)}}function G(t,e){if(1&t&&(v.TgZ(0,"div",26),v.TgZ(1,"div",27),v._UZ(2,"chq-mat-table",28),v.qZA(),v.YNc(3,Q,3,1,"div",29),v.qZA()),2&t){const t=v.oxw();v.xp6(2),v.Q6J("config",t.tableConfigCompany)("tableData",t.tableDataCompany)("sortChanged",t.handleSortChangeCompany)("pageChanged",t.pageChangedCompany)("cellClicked",t.handleCellClickCompany)("i18n",t.i18n),v.xp6(1),v.Q6J("ngIf",(null==t.tableDataCompany?null:t.tableDataCompany.length)>0&&t.paginationCompany.count>t.pagination.pageSize)}}const H={COMPANY:"company",PERSONAL:"individual"};let V=(()=>{class t{constructor(t,e,i,o,n,a,s,r){this.monitorService=t,this.commonService=e,this.tableDataSer=i,this.router=o,this.route=n,this.caseService=a,this.xaCurrencyPipe=s,this.calendarService=r,this.pageChanged=!1,this.pagination=u.G,this.configData=m,this.textToSearch="",this.input={personName:!1,companyName:!1},this.customerListMenus=g.JU,this.activeTab="",this.activeTabOptions=H,this.pageChangedCompany=!1,this.paginationCompany=u.G,this.configDataCompany=h,this.workProviderFromBooking=[],this.selectedCompanyForFilter=[],this.dueAmountPersonClass="",this.dueAmountCompanyClass="",this.totalDueAmountCompany=0,this.totalDueAmountPerson=0,this.showTotalDueAmountCompany=!1,this.showTotalDueAmountPerson=!1,this.applyButtonModel={label:"apply",type:"disabled",icon:"",onclick:this.applyFilter.bind(this)},this.resetButtonModel={label:"reset_all",type:"outline",icon:"",onclick:this.reSetFilter.bind(this)},this.dropdownModelFilter={options:[],placeHolder:"select_type",label:"select_type",name:"filterDropdown",displayValue:"label",selectedOption:{label:""}},this.dropdownModelCompany={options:[],placeHolder:"company_name",label:"company_name",name:"companyDropdown",displayValue:"companyName",keyFieldName:"CompanyId",selectedOption:[],isMultiSelect:!0},this.dropdownModelFilterPerson={options:[{label:"Retail - Individual"}],placeHolder:"select_type",label:"select_type",name:"filterDropdownPerson",displayValue:"label",selectedOption:{label:""}},this.nameTextBox={placeHolder:"customer_name",label:"customer_name",name:"name",type:"text",value:"",required:!1},this.handleSortChange=t=>{t&&(this.pagination=Object.assign(Object.assign({},this.pagination),{orderBy:t.active,sortDirection:t.direction}),this.getCustomers())},this.handleSortChangeCompany=t=>{t&&(this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{orderBy:t.active,sortDirection:t.direction}),this.getCompanyCustomers())},this.handleCellClick=(t,e)=>{var i,o;if("ContactId"===e.id){const n=null===(o=null===(i=t.find(t=>t.id===e.id))||void 0===i?void 0:i.result)||void 0===o?void 0:o.value;if(n){const t=this.tableData.find(t=>t.ContactId===n);t&&this.commonService.customerDetails.next(t),n&&this.router.navigate([`/repair/customers/individual/${n}/${t.Id}/repair-order`])}}},this.handleCellClickCompany=(t,e)=>{var i,o;if("ContactId"===e.id){const n=null===(o=null===(i=t.find(t=>t.id===e.id))||void 0===i?void 0:i.result)||void 0===o?void 0:o.value;if(n){const t=this.tableDataCompany.find(t=>t.ContactId===n);t&&this.commonService.customerDetails.next(t),n&&this.router.navigate([`/repair/customers/company/${n}/${t.Id}/repair-order`])}}},this.i18n=this.commonService.geti18nInfo()}ngOnInit(){this.monitorService.logEvent("ngOnInit",["CustomerTableComponent","addenda-repair"]),this.tableConfig=this.configData,this.tableConfigCompany=this.configDataCompany,this.route.params.subscribe(e=>(0,d.mG)(this,void 0,void 0,function*(){if(this.activeTab=e.userType,this.activeTab===H.PERSONAL)this.pagination=Object.assign(Object.assign({},this.pagination),{count:0,currentPage:t.currentPage,orderBy:"CreatedDate",sortDirection:"desc"}),this.handlePaginationChange({currentPage:t.currentPage,offset:this.pagination.pageSize*(t.currentPage-1),pageSize:this.pagination.pageSize}),this.getTotalDueAmountPerson();else{this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{count:0,currentPage:t.currentPageCompnay,orderBy:"CreatedDate",sortDirection:"desc"}),this.commonService.showLoading();const e=yield(0,p.z)(this.tableDataSer.getCompanyWorkProviders("$apply=groupby((CompanyOrgType))"));e&&e.length>0&&(this.workProviderFromBooking=e.map(t=>t.CompanyOrgType)),this.getCompanyCustomers(),this.getTotalDueAmountCompany(),this.dropdownModelFilter.observable||(this.dropdownModelFilter=Object.assign(Object.assign({},this.dropdownModelFilter),{observable:this.caseService.getProviders(),onObservableLoad:this.onObservableLoadWorkProviderData.bind(this)}),this.workProvider.dropdownModel.observable=this.caseService.getProviders(),this.workProvider.getObservable())}})),this.subscription=this.commonService.userProfileData.subscribe(t=>{this.userDetail=null==t?void 0:t.data})}ngOnDestroy(){this.subscription.unsubscribe()}getCompanyCustomers(){var t;return(0,d.mG)(this,void 0,void 0,function*(){this.commonService.showLoading();let e="";return(null===(t=this.selectedCompanyForFilter)||void 0===t?void 0:t.length)>0&&(e=`$filter=(${this.selectedCompanyForFilter.map(t=>`ContactId eq ${t.CompanyId}`).join(" or ")})`),(0,p.z)(this.tableDataSer.getCompanyCustomers(this.paginationCompany,e)).then(t=>{const e=t.value;e.map(t=>{let e="";if(t.AmountDue=t.Amount-t.AmountReceived,t.Amount&&void 0!==t.AmountDue){const i=100*t.AmountDue/t.Amount;i>=30&&(e="color-xa-dark-red"),i<=10&&i>0&&(e="col-xa-orange2"),0==i&&(e="color-xa-repair-header")}t.FormattedTotalAmount=t.Amount?this.xaCurrencyPipe.transform(t.Amount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",t.FormattedPaidAmount=t.AmountReceived?this.xaCurrencyPipe.transform(t.AmountReceived,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",t.FormattedDueAmount=t.Amount?'<span class="'+e+'">'+this.xaCurrencyPipe.transform(t.AmountDue,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-</span>",t.FormattedCompanyName=t.CompanyName?`<span class="company-name">${t.CompanyName}${t.LicenseNumber?"-<i>"+t.LicenseNumber+"</i>":""}</span>`:""}),this.tableDataCompany=e,this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{count:t["@odata.count"]||0}),this.commonService.hideLoading()}).catch(t=>{this.monitorService.logException(t,C._.Error),this.commonService.hideLoading()})})}getCustomers(){var t;return(0,d.mG)(this,void 0,void 0,function*(){const e=null===(t=this.dropdownModelFilterPerson.selectedOption)||void 0===t?void 0:t.label;let i="";if("retail - individual"===(null==e?void 0:e.toLowerCase())&&""!=this.textToSearch){const t=this.textToSearch+"";i=`$filter=(contains(tolower(FirstName),'${t.toLowerCase()}')) or (contains(tolower(LastName),'${t.toLowerCase()}'))`}return this.commonService.showLoading(),(0,p.z)(this.tableDataSer.getCustomers(this.pagination,i)).then(t=>{const e=t.value;e.map(t=>{let e="";if(t.AmountDue=t.Amount-t.AmountReceived,t.Amount&&void 0!==t.AmountDue){const i=100*t.AmountDue/t.Amount;i>=30&&(e="color-xa-dark-red"),i<=10&&i>0&&(e="col-xa-orange2"),0==i&&(e="color-xa-repair-header")}t.FormattedTotalAmount=t.Amount?this.xaCurrencyPipe.transform(t.Amount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",t.FormattedPaidAmount=t.AmountReceived?this.xaCurrencyPipe.transform(t.AmountReceived,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",t.FormattedDueAmount=t.Amount&&void 0!==t.AmountDue?'<span class="'+e+'">'+this.xaCurrencyPipe.transform(t.AmountDue,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position)+"</span>":"-"}),this.tableData=e,this.pagination=Object.assign(Object.assign({},this.pagination),{count:t["@odata.count"]||0}),this.commonService.hideLoading()}).catch(t=>{this.monitorService.logException(t,C._.Error),this.commonService.hideLoading()})})}getTotalDueAmountCompany(){var t;return(0,d.mG)(this,void 0,void 0,function*(){this.showTotalDueAmountCompany=!1;let e="$apply=";return(null===(t=this.selectedCompanyForFilter)||void 0===t?void 0:t.length)>0&&(e+=`filter(${this.selectedCompanyForFilter.map(t=>`ContactId eq ${t.CompanyId}`).join(" or ")})/`),e+="aggregate(Amount with sum as TotalAmount, AmountReceived with sum as TotalAmountReceived)",(0,p.z)(this.tableDataSer.getTotalDueAmountCompany(e)).then(t=>{if(t&&t[0]&&(this.showTotalDueAmountCompany=!0,this.dueAmountCompanyClass="",this.totalDueAmountCompany=t[0].TotalAmount?t[0].TotalAmount-t[0].TotalAmountReceived:"-",t[0].TotalAmount)){const e=100*this.totalDueAmountCompany/t[0].TotalAmount;e>=30&&(this.dueAmountCompanyClass="color-xa-dark-red"),e<=10&&e>0&&(this.dueAmountCompanyClass="col-xa-orange2"),0==e&&(this.dueAmountCompanyClass="color-xa-repair-header")}}).catch(t=>{this.showTotalDueAmountCompany=!0,this.monitorService.logException(t,C._.Error)})})}getTotalDueAmountPerson(){var t;return(0,d.mG)(this,void 0,void 0,function*(){this.showTotalDueAmountPerson=!1;let e="$apply=";const i=null===(t=this.dropdownModelFilterPerson.selectedOption)||void 0===t?void 0:t.label;if("retail - individual"===(null==i?void 0:i.toLowerCase())&&""!=this.textToSearch){const t=this.textToSearch+"";e+=`filter(contains(tolower(FirstName),'${t.toLowerCase()}') or contains(tolower(LastName),'${t.toLowerCase()}'))/`}return e+="aggregate(Amount with sum as TotalAmount, AmountReceived with sum as TotalAmountReceived)",(0,p.z)(this.tableDataSer.getTotalDueAmountPerson(e)).then(t=>{if(t&&t[0]&&(this.showTotalDueAmountPerson=!0,this.dueAmountPersonClass="",this.totalDueAmountPerson=t[0].TotalAmount?t[0].TotalAmount-t[0].TotalAmountReceived:"-",t[0].TotalAmount)){const e=100*this.totalDueAmountPerson/t[0].TotalAmount;e>=30&&(this.dueAmountPersonClass="color-xa-dark-red"),e<=10&&e>0&&(this.dueAmountPersonClass="col-xa-orange2"),0==e&&(this.dueAmountPersonClass="color-xa-repair-header")}}).catch(t=>{this.showTotalDueAmountPerson=!0,this.monitorService.logException(t,C._.Error)})})}handlePaginationChange(t){const e={pageSize:t.pageSize,offset:t.offset,currentPage:t.currentPage};this.pagination.currentPage=t.currentPage,this.pagination=Object.assign(Object.assign({},this.pagination),e),this.pageChanged=!0,this.getCustomers()}handlePaginationChangeCompany(t){const e={pageSize:t.pageSize,offset:t.offset,currentPage:t.currentPage};this.paginationCompany.currentPage=t.currentPage,this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),e),this.pageChangedCompany=!0,this.getCompanyCustomers()}selectFilter(t){var e,i,o;if(this.monitorService.logEvent("selectFilter",["CustomerTableComponent","addenda-repair",{$event:t}]),"filterDropdown"==(null==t?void 0:t.name)){const o=`?$filter=( OrgId eq ${null===(i=null===(e=this.userDetail)||void 0===e?void 0:e.organizationDetail)||void 0===i?void 0:i.id} and CompanyOrgType eq '${t.value.label}' and IsIndividual eq false)`;this.dropdownModelFilter.selectedOption=t.value,this.hideShowDropdown("companyName"),this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{selectedOption:[],options:[],displayValue:"label",observable:this.calendarService.getCustomer(o),onObservableLoad:this.onObservableLoadCompanyData.bind(this)}),setTimeout(()=>{var t;null===(t=this.companyName)||void 0===t||t.getObservable()},100),this.updateApplyButtonState()}else"filterDropdownPerson"==t.name?"retail - individual"===(this.dropdownModelFilterPerson.selectedOption=t.value,null===(o=t.value[this.dropdownModelFilterPerson.displayValue])||void 0===o?void 0:o.toLowerCase())?(this.hideShowDropdown("personName"),this.nameTextBox.value=""):this.hideShowDropdown(""):"companyDropdown"==(null==t?void 0:t.name)&&(this.dropdownModelCompany.selectedOption=t.value,this.updateApplyButtonState())}updateInput(t){"name"==t.name&&(this.nameTextBox.value=t.value,this.updateApplyButtonState())}updateApplyButtonState(){var t;let e="disabled";this.activeTab===this.activeTabOptions.PERSONAL?this.nameTextBox.value&&this.nameTextBox.value.toString().length>=3&&(e="secondary"):this.activeTab===this.activeTabOptions.COMPANY&&(null===(t=this.dropdownModelCompany.selectedOption)||void 0===t?void 0:t.length)>0&&this.input.companyName&&(e="secondary"),this.applyButtonModel.type=e}hideShowDropdown(t){this.input[t]=!0,Object.keys(this.input).forEach(e=>{e!=t&&(this.input[e]=!1)})}navigate(t){var e,i,o,n;this.router.navigate([t.url]),(null===(e=this.dropdownModelFilter)||void 0===e?void 0:e.selectedOption)&&(this.input.companyName=!1,this.dropdownModelFilter=Object.assign(Object.assign({},this.dropdownModelFilter),{selectedOption:{}})),(null===(i=this.dropdownModelCompany)||void 0===i?void 0:i.selectedOption)&&(this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{selectedOption:[]})),(null===(o=this.dropdownModelFilterPerson)||void 0===o?void 0:o.selectedOption)&&(this.input.personName=!1,this.dropdownModelFilterPerson=Object.assign(Object.assign({},this.dropdownModelFilterPerson),{selectedOption:{}})),(null===(n=this.nameTextBox)||void 0===n?void 0:n.value)&&(this.nameTextBox=Object.assign(Object.assign({},this.nameTextBox),{value:""}))}applyFilter(){this.activeTab===this.activeTabOptions.COMPANY?(this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{currentPage:1}),this.selectedCompanyForFilter=[...this.dropdownModelCompany.selectedOption],this.getCompanyCustomers(),this.getTotalDueAmountCompany()):this.activeTab===this.activeTabOptions.PERSONAL&&(this.pagination=Object.assign(Object.assign({},this.pagination),{currentPage:1}),this.textToSearch=this.nameTextBox.value+"",this.getCustomers(),this.getTotalDueAmountPerson())}reSetFilter(){this.activeTab===this.activeTabOptions.COMPANY?(this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{selectedOption:[]}),this.dropdownModelFilter=Object.assign(Object.assign({},this.dropdownModelFilter),{selectedOption:{}}),this.paginationCompany=Object.assign(Object.assign({},this.paginationCompany),{currentPage:1}),this.input.companyName=!1,this.selectedCompanyForFilter=[],this.updateApplyButtonState(),this.getCompanyCustomers(),this.getTotalDueAmountCompany()):this.activeTab===this.activeTabOptions.PERSONAL&&(this.nameTextBox=Object.assign(Object.assign({},this.nameTextBox),{value:""}),this.pagination=Object.assign(Object.assign({},this.pagination),{currentPage:1}),this.dropdownModelFilterPerson=Object.assign(Object.assign({},this.dropdownModelFilterPerson),{selectedOption:{}}),this.input.personName=!1,this.textToSearch="",this.getCustomers(),this.getTotalDueAmountPerson()),this.updateApplyButtonState()}onObservableLoadCompanyData(t){t&&t.length>0&&(t.forEach((e,i)=>{t[i]=Object.assign(Object.assign({},t[i]),{label:`${e.CompanyName}${e.LicenseNumber?"-"+e.LicenseNumber:""}`,html:`<span class="company-name-dropdown">${e.CompanyName}${e.LicenseNumber?"-<i>"+e.LicenseNumber+"</i>":""}</span>`})}),this.dropdownModelCompany=Object.assign(Object.assign({},this.dropdownModelCompany),{options:t,selectedOption:t}),this.updateApplyButtonState())}onObservableLoadWorkProviderData(t){if(t&&t.length>0){const e=t.filter((t,e)=>-1!==this.workProviderFromBooking.indexOf(t.label));this.workProvider.dropdownOptions=e}}}return t.currentPage=1,t.currentPageCompnay=1,t.\u0275fac=function(e){return new(e||t)(v.Y36(b.M),v.Y36(f.v),v.Y36(A),v.Y36(a.F0),v.Y36(a.gz),v.Y36(w.n),v.Y36(T.j),v.Y36(O.o))},t.\u0275cmp=v.Xpm({type:t,selectors:[["add-customer-table"]],viewQuery:function(t,e){if(1&t&&(v.Gf(q,5),v.Gf(I,5)),2&t){let t;v.iGM(t=v.CRH())&&(e.companyName=t.first),v.iGM(t=v.CRH())&&(e.workProvider=t.first)}},decls:15,vars:8,consts:[[1,"main-customer-list","customer-list","fx-col"],[1,"header-container","fx-0"],[3,"mode","menuItems","menuItemClick"],["class","filter",4,"ngIf"],[1,"pending-amount","fx-0"],["class","total-due-amount",4,"ngIf"],[1,"table-section","fx-1"],["class","table-container",4,"ngIf"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-repair.png"],[1,"filter"],[1,"company-filter-dropdown",3,"dropdownModel","selected"],["workProvider",""],["class","bodyShop-filter-dropdown",3,"dropdownModel","selected",4,"ngIf"],[3,"buttonModel"],[1,"bodyShop-filter-dropdown",3,"dropdownModel","selected"],["companyName",""],[1,"person-filter-dropdown",3,"dropdownModel","selected"],["filterPerson",""],[3,"inputModel","controlOutput",4,"ngIf"],[3,"inputModel","controlOutput"],[1,"total-due-amount"],[3,"class",4,"ngIf"],[4,"ngIf"],[1,"table-container"],[1,"table-wrapper"],[3,"config","tableData","sortChanged","pageChanged","cellClicked","i18n"],["class","pagination-wrapper",4,"ngIf"],[1,"pagination-wrapper"],[3,"pagination","paginationChange"],["paginator",""],["paginatorCompany",""]],template:function(t,e){1&t&&(v.TgZ(0,"div",0),v.TgZ(1,"div",1),v.TgZ(2,"chq-tabs",2),v.NdJ("menuItemClick",function(t){return e.navigate(t)}),v.qZA(),v.YNc(3,j,6,4,"div",3),v.YNc(4,F,6,4,"div",3),v.qZA(),v.TgZ(5,"div",4),v.YNc(6,U,6,5,"div",5),v.YNc(7,z,6,5,"div",5),v.qZA(),v.TgZ(8,"div",6),v.YNc(9,Y,4,7,"div",7),v.YNc(10,G,4,7,"div",7),v.qZA(),v.TgZ(11,"div",8),v.TgZ(12,"div",9),v.TgZ(13,"div",10),v._UZ(14,"img",11),v.qZA(),v.qZA(),v.qZA(),v.qZA()),2&t&&(v.xp6(2),v.Q6J("mode","button")("menuItems",e.customerListMenus),v.xp6(1),v.Q6J("ngIf",e.activeTab===e.activeTabOptions.COMPANY),v.xp6(1),v.Q6J("ngIf",e.activeTab===e.activeTabOptions.PERSONAL),v.xp6(2),v.Q6J("ngIf",e.activeTab===e.activeTabOptions.PERSONAL&&(null==e.tableData?null:e.tableData.length)>0&&e.showTotalDueAmountPerson),v.xp6(1),v.Q6J("ngIf",e.activeTab===e.activeTabOptions.COMPANY&&(null==e.tableDataCompany?null:e.tableDataCompany.length)>0&&e.showTotalDueAmountCompany),v.xp6(2),v.Q6J("ngIf",e.activeTab===e.activeTabOptions.PERSONAL),v.xp6(1),v.Q6J("ngIf",e.activeTab===e.activeTabOptions.COMPANY))},directives:[D.K,o.O5,P.I,Z.E,S.D,_.B,u.l],pipes:[M.X$,T.j],styles:[".main-customer-list{height:calc(100vh - (5px + 1.5vw) - (5px + 1.5vw + 58px + 1.6vw) - 76px)}.main-customer-list .header-container{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:20px}.main-customer-list .header-container .header-content{font-weight:600;font-size:14px;line-height:20px}.main-customer-list .header-container .filter{display:flex;align-items:flex-end}.main-customer-list .header-container .filter chq-dropdown,.main-customer-list .header-container .filter chq-input{position:relative;width:150px;margin-left:16px;margin-top:4px}.main-customer-list .header-container .filter chq-button{margin-left:16px}.main-customer-list .header-container .filter chq-dropdown.user-dropdown{width:200px}.main-customer-list .header-container .filter chq-dropdown.person-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.retail-company-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.bodyShop-filter-dropdown,.main-customer-list .header-container .filter chq-dropdown.dealerShip-filter-dropdown{width:200px}.main-customer-list .header-container .filter chq-dropdown.company-filter-dropdown{width:170px}.main-customer-list .delete-container{display:flex;justify-content:flex-end;margin-top:30px;margin-bottom:25px}.main-customer-list .delete-container chq-button{width:180px;height:30px}.main-customer-list .table-section{overflow-y:auto}.main-customer-list .cdk-column-status mat-icon{height:17px;width:17px}.main-customer-list .total-due-amount{padding-bottom:18px;display:flex;justify-content:end;font-family:Inter;font-size:18px;font-style:normal;font-weight:500;line-height:24px;color:var(--xa-dark-gray)}.main-customer-list .pagination-wrapper{margin-top:15px}.main-customer-list .company-name i,.main-customer-list .company-name-dropdown i{font-weight:600}.mat-sort-header-arrow{margin:-2px!important}.customer-list .input-wrapper{position:inherit!important;top:0!important}@media (orientation: portrait){mat-cell{word-break:break-word}.mat-sort-header-arrow{margin:0!important}}::-webkit-scrollbar:horizontal{height:5px}.table-wrapper{box-shadow:0 0 4px rgba(0,0,0,.1)}\n"],encapsulation:2}),t})();const K={columns:[{id:"Id",sortable:!0,header:{text:"booking_id",tooltip:""},selector:{field:"RepairNumber"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"VehicleMake",sortable:!0,header:{text:"vehicle_make",tooltip:""},selector:{field:"VehicleMake"},widget:{type:"text"}},{id:"VehicleModel",sortable:!0,header:{text:"vehicle_model",tooltip:""},selector:{field:"VehicleModel"},widget:{type:"text"}},{id:"LicensePlateNumber",sortable:!0,header:{text:"license_plate",tooltip:""},selector:{field:"LicensePlateNumber"},widget:{type:"text"}},{id:"BookingType",sortable:!0,header:{text:"booking_type",tooltip:""},selector:{field:"BookingType"},widget:{type:"text"}},{id:"RepairType",sortable:!0,header:{text:"repair_type",tooltip:""},selector:{field:"RepairType"},widget:{type:"text"}},{id:"TotalInvoiceAmount",sortable:!0,header:{text:"total_amount_invoiced",tooltip:""},selector:{field:"FormattedTotalAmount"},widget:{type:"text"}},{id:"PaidAmount",sortable:!0,header:{text:"paid_amount",tooltip:""},selector:{field:"FormattedPaidAmount"},widget:{type:"text"}},{id:"AmountDue",sortable:!0,header:{text:"due_amount",tooltip:""},selector:{field:"FormattedDueAmount"},widget:{type:"text"}},{id:"Status",sortable:!0,header:{text:"status",tooltip:""},selector:{field:"Status"},widget:{type:"text"}}]},W={columns:[{id:"Id",sortable:!0,header:{text:"estimate_id",tooltip:""},selector:{field:"EstimateNumber"},widget:{type:"text"},cellStyle:"text-decoration: underline; color: var(--xa-primary);"},{id:"CreatedDate",sortable:!0,header:{text:"creation_date",tooltip:""},selector:{field:"CreatedDate"},widget:{type:"dateTime"}},{id:"VehicleMake",sortable:!0,header:{text:"vehicle_make",tooltip:""},selector:{field:"VehicleMake"},widget:{type:"text"}},{id:"VehicleModel",sortable:!0,header:{text:"vehicle_model",tooltip:""},selector:{field:"VehicleModel"},widget:{type:"text"}},{id:"LicensePlateNumber",sortable:!0,header:{text:"license_plate",tooltip:""},selector:{field:"LicensePlateNumber"},widget:{type:"text"}},{id:"TotalEstimateAmount ",sortable:!0,header:{text:"total_estimate_amount",tooltip:""},selector:{field:"FormattedTotalEstimateAmount"},widget:{type:"text"}},{id:"EstimationStatus",sortable:!0,header:{text:"estimation_status",tooltip:""},selector:{field:"EstimationStatus"},widget:{type:"text"}}]};var X=i(17771),tt=i(90171);function et(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"chq-tabs",13),v.NdJ("menuItemClick",function(e){return v.CHM(t),v.oxw().navigate(e)}),v.qZA()}if(2&t){const t=v.oxw();v.Q6J("mode","button")("menuItems",t.customerDetailsMenus)}}const it=function(t,e,i,o,n){return[t,e,i,o,n]};function ot(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"mat-accordion"),v.TgZ(1,"mat-expansion-panel",15),v.NdJ("opened",function(){return v.CHM(t),v.oxw(2).panelOpenState=!0})("closed",function(){return v.CHM(t),v.oxw(2).panelOpenState=!1}),v.TgZ(2,"mat-expansion-panel-header"),v.TgZ(3,"mat-panel-title"),v.TgZ(4,"h4"),v._uU(5),v.qZA(),v.TgZ(6,"p",16),v.TgZ(7,"label"),v._uU(8),v.ALo(9,"translate"),v.qZA(),v._uU(10),v.qZA(),v.qZA(),v.qZA(),v.TgZ(11,"div"),v.TgZ(12,"p",17),v.TgZ(13,"label"),v._uU(14),v.ALo(15,"translate"),v.qZA(),v._uU(16),v.ALo(17,"date"),v.qZA(),v.TgZ(18,"p",17),v.TgZ(19,"label"),v._uU(20),v.ALo(21,"translate"),v.qZA(),v._uU(22),v.ALo(23,"xaCurrency"),v.qZA(),v.TgZ(24,"p",17),v.TgZ(25,"label"),v._uU(26),v.ALo(27,"translate"),v.qZA(),v._uU(28),v.ALo(29,"xaCurrency"),v.qZA(),v.TgZ(30,"p",17),v.TgZ(31,"label"),v._uU(32),v.ALo(33,"translate"),v.qZA(),v._uU(34),v.ALo(35,"xaCurrency"),v.qZA(),v.TgZ(36,"p",17),v.TgZ(37,"label"),v._uU(38),v.ALo(39,"translate"),v.qZA(),v._uU(40),v.qZA(),v.TgZ(41,"p",17),v.TgZ(42,"label"),v._uU(43),v.ALo(44,"translate"),v.qZA(),v._uU(45),v.qZA(),v.TgZ(46,"p",17),v.TgZ(47,"label"),v._uU(48),v.ALo(49,"translate"),v.qZA(),v._uU(50),v.qZA(),v.qZA(),v.qZA(),v.qZA()}if(2&t){const t=v.oxw(2);v.xp6(5),v.Oqu(null==t.userDetails?null:t.userDetails.companyName),v.xp6(3),v.hij("",v.lcZ(9,17,"contact_id"),":"),v.xp6(2),v.hij(" ",null==t.userDetails?null:t.userDetails.contactId," "),v.xp6(4),v.hij("",v.lcZ(15,19,"creation_date"),":"),v.xp6(2),v.hij(" ",v.xi3(17,21,null==t.userDetails?null:t.userDetails.createdDate,"dd/MM/YYYY hh:mm:ss"),""),v.xp6(4),v.hij("",v.lcZ(21,24,"total_invoiced"),":"),v.xp6(2),v.hij(" ",v.G7q(23,26,v.qbA(54,it,null==t.userDetails?null:t.userDetails.amount,t.i18n.currencySymbol,t.i18n.digitsInfo,t.i18n.locale,t.i18n.position)),""),v.xp6(4),v.hij("",v.lcZ(27,32,"paid_amount"),":"),v.xp6(2),v.hij(" ",v.G7q(29,34,v.qbA(60,it,null==t.userDetails?null:t.userDetails.amountReceived,t.i18n.currencySymbol,t.i18n.digitsInfo,t.i18n.locale,t.i18n.position)),""),v.xp6(4),v.hij("",v.lcZ(33,40,"due_amount"),":"),v.xp6(2),v.hij(" ",v.G7q(35,42,v.qbA(66,it,null==t.userDetails?null:t.userDetails.amountDue,t.i18n.currencySymbol,t.i18n.digitsInfo,t.i18n.locale,t.i18n.position)),""),v.xp6(4),v.hij("",v.lcZ(39,48,"contact_name"),":"),v.xp6(2),v.hij(" ",null==t.userDetails?null:t.userDetails.contactName,""),v.xp6(3),v.hij("",v.lcZ(44,50,"contact_phone"),":"),v.xp6(2),v.hij(" ",null==t.userDetails?null:t.userDetails.contactPhoneNumber,""),v.xp6(3),v.hij("",v.lcZ(49,52,"contact_email"),":"),v.xp6(2),v.hij(" ",null==t.userDetails?null:t.userDetails.contactEmail,"")}}function nt(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"mat-accordion"),v.TgZ(1,"mat-expansion-panel",15),v.NdJ("opened",function(){return v.CHM(t),v.oxw(2).panelOpenState=!0})("closed",function(){return v.CHM(t),v.oxw(2).panelOpenState=!1}),v.TgZ(2,"mat-expansion-panel-header"),v.TgZ(3,"mat-panel-title"),v.TgZ(4,"h4"),v._uU(5),v.qZA(),v.TgZ(6,"p",16),v.TgZ(7,"label"),v._uU(8),v.ALo(9,"translate"),v.qZA(),v._uU(10),v.qZA(),v.qZA(),v.qZA(),v.TgZ(11,"div"),v.TgZ(12,"p",17),v.TgZ(13,"label"),v._uU(14),v.ALo(15,"translate"),v.qZA(),v._uU(16),v.qZA(),v.TgZ(17,"p",17),v.TgZ(18,"label"),v._uU(19),v.ALo(20,"translate"),v.qZA(),v._uU(21),v.qZA(),v.qZA(),v.qZA(),v.qZA()}if(2&t){const t=v.oxw(2);v.xp6(5),v.AsE("",null==t.userDetails?null:t.userDetails.firstName," ",null==t.userDetails?null:t.userDetails.lastName,""),v.xp6(3),v.hij("",v.lcZ(9,8,"contact_id"),":"),v.xp6(2),v.hij(" ",null==t.userDetails?null:t.userDetails.contactId,""),v.xp6(4),v.hij("",v.lcZ(15,10,"email"),":"),v.xp6(2),v.hij(" ",t.userDetails.email,""),v.xp6(3),v.hij("",v.lcZ(20,12,"phone_number"),":"),v.xp6(2),v.hij(" ",t.userDetails.mobileNumber,"")}}function at(t,e){if(1&t&&(v.TgZ(0,"div",14),v.YNc(1,ot,51,72,"mat-accordion",8),v.YNc(2,nt,22,14,"mat-accordion",8),v.qZA()),2&t){const t=v.oxw();v.xp6(1),v.Q6J("ngIf","company"===t.userType),v.xp6(1),v.Q6J("ngIf","individual"===t.userType)}}function st(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"div",22),v.TgZ(1,"chq-paginator",23,24),v.NdJ("paginationChange",function(e){return v.CHM(t),v.oxw(2).handlePaginationChangeReapir(e)}),v.qZA(),v.qZA()}if(2&t){const t=v.oxw(2);v.xp6(1),v.Q6J("pagination",t.paginationRepair)}}function rt(t,e){if(1&t&&(v.TgZ(0,"section"),v.TgZ(1,"div",18),v.TgZ(2,"div",19),v._UZ(3,"chq-mat-table",20),v.qZA(),v.YNc(4,st,3,1,"div",21),v.qZA(),v.qZA()),2&t){const t=v.oxw();v.xp6(3),v.Q6J("config",t.tableConfigRepair)("tableData",t.tableDataRepair)("cellClicked",t.handleCellClickRepair)("sortChanged",t.handleSortChangeRepair)("pageChanged",t.pageChangedRepair)("i18n",t.i18n),v.xp6(1),v.Q6J("ngIf",(null==t.tableDataRepair?null:t.tableDataRepair.length)>0&&t.paginationRepair.count>t.paginationRepair.pageSize)}}function lt(t,e){if(1&t){const t=v.EpF();v.TgZ(0,"div",22),v.TgZ(1,"chq-paginator",23,24),v.NdJ("paginationChange",function(e){return v.CHM(t),v.oxw(2).handlePaginationChangeCase(e)}),v.qZA(),v.qZA()}if(2&t){const t=v.oxw(2);v.xp6(1),v.Q6J("pagination",t.paginationCase)}}function ct(t,e){if(1&t&&(v.TgZ(0,"section"),v.TgZ(1,"div",18),v.TgZ(2,"div",19),v._UZ(3,"chq-mat-table",20),v.qZA(),v.YNc(4,lt,3,1,"div",21),v.qZA(),v.qZA()),2&t){const t=v.oxw();v.xp6(3),v.Q6J("config",t.tableConfigCase)("tableData",t.tableDataCase)("cellClicked",t.handleCellClickCase)("sortChanged",t.handleSortChangeCase)("pageChanged",t.pageChangedCase)("i18n",t.i18n),v.xp6(1),v.Q6J("ngIf",(null==t.tableDataCase?null:t.tableDataCase.length)>0&&t.paginationCase.count>t.paginationCase.pageSize)}}const dt={repair:"repair-order",cases:"estimates"},pt=X.D,ut=X.A;let mt=(()=>{class t{constructor(t,e,i,o,n,a){this.monitorService=t,this.customerService=e,this.route=i,this.commonService=o,this.router=n,this.xaCurrencyPipe=a,this.panelOpenState=!1,this.pageChangedRepair=!1,this.paginationRepair=u.G,this.totalCountRepair=0,this.configDataRepair=K,this.pageChangedCase=!1,this.paginationCase=u.G,this.totalCountCase=0,this.configDataCase=W,this.userDetails={},this.customerId="",this.uniqueId="",this.userType="",this.haveQuotePermissions=!1,this.userDetailsLoading=!1,this.customerDetailsMenus=g.yx,this.activeTab="",this.tabOptions=dt,this.handleCellClickRepair=(t,e)=>{var i,o;if("Id"===e.id){const n=null===(o=null===(i=t.find(t=>t.id===e.id))||void 0===i?void 0:i.result)||void 0===o?void 0:o.value;if(n){const t=this.tableDataRepair.find(t=>t.RepairNumber===n);if(t){const e=ut[t.Status.toLowerCase()]||ut.others;this.router.navigate([e.replace("{{repairGUID}}",t.RepairGuid)])}}}},this.handleCellClickCase=(t,e)=>{var i,o;if("Id"===e.id){const n=null===(o=null===(i=t.find(t=>t.id===e.id))||void 0===i?void 0:i.result)||void 0===o?void 0:o.value;if(n){const t=this.tableDataCase.find(t=>t.EstimateNumber===n);if(t){const e=pt[t.EstimationStatus.toLowerCase()]||pt.others;this.router.navigate([e.replace("{{caseGUID}}",t.CaseGuid)])}}}},this.handleSortChangeRepair=t=>{t&&(this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),{orderBy:t.active,sortDirection:t.direction}),this.getRepairOrders())},this.handleSortChangeCase=t=>{t&&(this.paginationCase=Object.assign(Object.assign({},this.paginationCase),{orderBy:t.active,sortDirection:t.direction}),this.getCases())},this.i18n=this.commonService.geti18nInfo()}ngOnInit(){return(0,d.mG)(this,void 0,void 0,function*(){this.monitorService.logEvent("ngOnInit",["CustomerDetailsComponent","addenda-repair"]),this.commonService.userProfileData.subscribe(t=>{var e,i;const o=(null===(i=null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.userPermission)||void 0===i?void 0:i.automotiveServices)||[];this.haveQuotePermissions=o.find(t=>"Carheal Quote"===t.automotiveServiceName)}),this.route.params.subscribe(e=>{this.customerId=e.contactId,this.uniqueId=e.id,this.userType=e.userType,this.activeTab=e.orderType,this.tableConfigRepair=this.configDataRepair,this.tableConfigCase=this.configDataCase,this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),{count:this.totalCountRepair,currentPage:t.currentPageRepair,orderBy:"CreatedDate",sortDirection:"desc"}),this.paginationCase=Object.assign(Object.assign({},this.paginationCase),{count:this.totalCountCase,currentPage:t.currentPageCase,orderBy:"CreatedDate",sortDirection:"desc"}),this.activeTab===dt.repair?this.getRepairOrders():this.getCases(),this.getUserDetails()})})}getUserDetails(){return(0,d.mG)(this,void 0,void 0,function*(){return"company"===this.userType?(this.userDetailsLoading=!0,(0,p.z)(this.customerService.getCompanyDetails(this.customerId)).then(t=>{(null==t?void 0:t.data)&&(this.userDetails=t.data,this.userDetails.amount||(this.userDetails.amount=0),this.userDetails.amountReceived||(this.userDetails.amountReceived=0),this.userDetails.amountDue||(this.userDetails.amountDue=0),this.userDetailsLoading=!1)}).catch(t=>{this.monitorService.logException(t,C._.Error)})):(this.userDetailsLoading=!0,(0,p.z)(this.customerService.getCustomerDetails(this.uniqueId)).then(t=>{(null==t?void 0:t.data)&&(this.userDetails=t.data,this.userDetailsLoading=!1)}).catch(t=>{this.monitorService.logException(t,C._.Error)}))})}getRepairOrders(){return(0,d.mG)(this,void 0,void 0,function*(){return this.commonService.showLoading(),(0,p.z)(this.customerService.getReapirOrders(this.customerId,this.userType,this.paginationRepair)).then(t=>{const e=t.value;e.map(t=>{t.AmountDue=t.TotalInvoiceAmount-t.PaidAmount,t.FormattedTotalAmount=t.TotalInvoiceAmount?this.xaCurrencyPipe.transform(t.TotalInvoiceAmount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",t.FormattedPaidAmount=t.PaidAmount?this.xaCurrencyPipe.transform(t.PaidAmount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-",t.FormattedDueAmount=t.TotalInvoiceAmount?this.xaCurrencyPipe.transform(t.AmountDue,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-"}),this.tableDataRepair=e,this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),{count:t["@odata.count"]||0}),this.commonService.hideLoading()}).catch(t=>{this.monitorService.logException(t,C._.Error),this.commonService.hideLoading()})})}getCases(){return(0,d.mG)(this,void 0,void 0,function*(){return this.commonService.showLoading(),(0,p.z)(this.customerService.getCases(this.customerId,this.userType,this.paginationCase)).then(t=>{const e=t.value;e.map(t=>{t.FormattedTotalEstimateAmount=t.TotalEstimateAmount?this.xaCurrencyPipe.transform(t.TotalEstimateAmount,this.i18n.currencySymbol,this.i18n.digitsInfo,this.i18n.locale,this.i18n.position):"-"}),this.tableDataCase=e,this.paginationCase=Object.assign(Object.assign({},this.paginationCase),{count:t["@odata.count"]||0}),this.commonService.hideLoading()}).catch(t=>{this.monitorService.logException(t,C._.Error),this.commonService.hideLoading()})})}handlePaginationChangeReapir(t){const e={pageSize:t.pageSize,offset:t.offset,currentPage:t.currentPage};this.paginationRepair.currentPage=t.currentPage,this.paginationRepair=Object.assign(Object.assign({},this.paginationRepair),e),this.pageChangedRepair=!0,this.getRepairOrders()}handlePaginationChangeCase(t){const e={pageSize:t.pageSize,offset:t.offset,currentPage:t.currentPage};this.paginationCase.currentPage=t.currentPage,this.paginationCase=Object.assign(Object.assign({},this.paginationCase),e),this.pageChangedCase=!0,this.getCases()}navigate(t){this.userType&&this.customerId&&this.router.navigate([t.url.replace("{userType}",this.userType).replace("{customerId}",this.customerId).replace("{id}",this.uniqueId)])}handleBackClick(){this.router.navigate(["/repair/customers/{userType}".replace("{userType}",this.userType)])}}return t.currentPageRepair=1,t.currentPageCase=1,t.\u0275fac=function(e){return new(e||t)(v.Y36(b.M),v.Y36(A),v.Y36(a.gz),v.Y36(f.v),v.Y36(a.F0),v.Y36(T.j))},t.\u0275cmp=v.Xpm({type:t,selectors:[["customer-details"]],decls:19,vars:11,consts:[[1,"main-customer-details","fx-col"],[1,"header","d-flex","align-center","position-relative","fx-0"],[1,""],[1,"back-section","d-flex","align-center",3,"click"],[1,"cross",3,"svgIcon"],[3,"mode","menuItems","menuItemClick",4,"ngIf"],["class","user-details",4,"ngIf"],[1,"table-section","fx-1"],[4,"ngIf"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-repair.png"],[3,"mode","menuItems","menuItemClick"],[1,"user-details"],[3,"opened","closed"],[1,"sub-heading"],[1,"expanded-sub-heading"],[1,"table-container"],[1,"table-wrapper"],[3,"config","tableData","cellClicked","sortChanged","pageChanged","i18n"],["class","pagination-wrapper",4,"ngIf"],[1,"pagination-wrapper"],[3,"pagination","paginationChange"],["paginator",""]],template:function(t,e){1&t&&(v.TgZ(0,"div",0),v.TgZ(1,"section",1),v.TgZ(2,"div",2),v.TgZ(3,"div",3),v.NdJ("click",function(){return e.handleBackClick()}),v._UZ(4,"mat-icon",4),v.TgZ(5,"span"),v._uU(6),v.ALo(7,"translate"),v.ALo(8,"translate"),v.qZA(),v.qZA(),v.YNc(9,et,1,2,"chq-tabs",5),v.qZA(),v.YNc(10,at,3,2,"div",6),v.qZA(),v.TgZ(11,"div",7),v.YNc(12,rt,5,7,"section",8),v.YNc(13,ct,5,7,"section",8),v.qZA(),v.TgZ(14,"footer"),v.TgZ(15,"div",9),v.TgZ(16,"div",10),v.TgZ(17,"div",11),v._UZ(18,"img",12),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.qZA()),2&t&&(v.xp6(4),v.Q6J("svgIcon","left-arrow"),v.xp6(2),v.AsE("",v.lcZ(7,7,"back")," / ",v.lcZ(8,9,e.userType)," "),v.xp6(3),v.Q6J("ngIf",e.haveQuotePermissions),v.xp6(1),v.Q6J("ngIf",e.userDetails&&!e.userDetailsLoading),v.xp6(2),v.Q6J("ngIf",e.activeTab===e.tabOptions.repair),v.xp6(1),v.Q6J("ngIf",e.activeTab===e.tabOptions.cases))},directives:[s.Hw,o.O5,D.K,tt.pp,tt.ib,tt.yz,tt.yK,_.B,u.l],pipes:[M.X$,o.uU,T.j],styles:[".main-customer-details[_ngcontent-%COMP%]{height:calc(100vh - (5px + 1.5vw) - (5px + 1.5vw + 58px + 1.6vw) - 76px)}.main-customer-details[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{overflow-y:auto}.main-customer-details[_ngcontent-%COMP%]   .border-bottom[_ngcontent-%COMP%]{border-bottom:1px solid var(--xa-gray)}.main-customer-details[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:40px;min-height:64px}.main-customer-details[_ngcontent-%COMP%]   .pagination-wrapper[_ngcontent-%COMP%]{margin-top:15px}.main-customer-details[_ngcontent-%COMP%]   .back-section[_ngcontent-%COMP%]{margin-bottom:17px;text-transform:capitalize;cursor:pointer}.main-customer-details[_ngcontent-%COMP%]   .back-section[_ngcontent-%COMP%]     mat-icon{margin-left:5px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{width:32%;position:absolute;right:0;top:9px;z-index:1}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]{font-weight:500;font-size:9px;color:var(--xa-black-medium);margin-bottom:0;margin-top:5px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--xa-black);opacity:.6}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .expanded-sub-heading[_ngcontent-%COMP%]{font-weight:400;font-size:10px;color:var(--xa-black-medium);margin-bottom:0;margin-top:8px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .expanded-sub-heading[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--xa-black);opacity:.6}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{padding:8px 20px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{border-radius:11px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0 20px 16px}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]     .mat-expansion-indicator:after{color:var(--xa-black)}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{background:var(--xa-bold-gray)}.main-customer-details[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .mat-expanded[_ngcontent-%COMP%]{background:var(--xa-white)}"]}),t})();var ht=i(44466);const gt=[{path:":userType",component:V,resolve:{version:n.n}},{path:":userType/:contactId/:id/:orderType",component:mt,resolve:{version:n.n}}];let Ct=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({imports:[[o.ez,s.Ps,l.p,a.Bz.forChild(gt),r.Tx,c.H,tt.To,M.aw,ht.m]]}),t})()},74743:function(t,e,i){i.d(e,{n:function(){return l}});var o=i(27969),n=i(84945),a=i(33568),s=i(37716),r=i(4893);let l=(()=>{class t{constructor(t){this.commonService=t}resolve(){return this.commonService.showLoading(),this.commonService.checkVersion().pipe((0,o.U)(t=>{this.commonService.hideLoading();const e=localStorage.getItem("appVersion"),i=t.buildRevision;return e&&e!=i?(localStorage.setItem("appVersion",i),setTimeout(()=>{location.reload()},10),(0,n.of)("new version available")):(localStorage.setItem("appVersion",i),(0,n.of)("new version is not available"))}),(0,a.K)(()=>(this.commonService.hideLoading(),(0,n.of)("data not available at this time"))))}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(r.v))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);