{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAAe,eAAoDA,oBAApD,GAAwE,CAAxE;AAAmM,OAAlN,CAAkN,IAAlN,EAAkN;AAAkB;;AAAa;AAAA;AAAA;AAAyD;AAAuB;AAAkBC;AAAkB;AAAOC,qBAAP;AAAOC,qBAAP;AAAOC;AAAP;AAAqC;AAAgB,WAAvE,EAAuEC;AAAmB;AAAuBC,6BAAvB;AAAuBH;AAAvB;AAA+C;AAAqC,WAA9K,EAA8KE;AAAoB;AAAwBC,6BAAxB;AAAwBH;AAAxB;AAA8C,WAAhP;AAAmP;;AAAcE;AAAoBE;AAAA,WAApB;;AAA6G;;AAAaF;AAAkB;AAAY;AAAc;AAA4M,aAAtO,MAAsOG;AAAA,WAAxP;;AAA2Q;;AAAkBH;AAA0B;AAAsB;AAAmE;AAAsC;AAAmB;AAAiB;AAAkB;AAAA;AAAA;AAA6D;AAA4B,aAArL,CAAqLI,CAArL,GAAqL,UAArL,GAAqL;AAA0B;AAAA;AAAoC;;AAAqC;AAAU;AAAoE;AAA0D,aAAxI,MAAwIC;;AAAkB;AAAA,WAAriB;;AAA+iB;AAAeL;AAAqB;AAA+C;AAAsB,WAA1F,EAA0FA;AAAsB;AAAuG;AAA+B,WAAtP,EAAsPA;AAAoB;AAAgB,WAA1R,EAA0RA;AAA0B;AAAmC,WAAvV,EAAuVA;AAAuB;AAAA,WAA9W;AAAkZ;;AAAeA;AAAqB;AAAA,WAArB;;AAAkH;;AAAaA;AAAuB;AAA+C;AAAA;AAAkC;AAAA,WAAxG;AAAwG,SAAv4D;AAAg6D,OAA1sE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACCIM;;;;;;AAAiBA;;;;;;AAITA;;AACIA;;AAA0BA;;;;AAA0CA;;AACpEA;;AAAuBA;;;;AAAoCA;;AAC3DA;;AACIA;;;;AACJA;;AACAA;;AACJA;;;;;;AAN8BA;;AAAAA;;AACHA;;AAAAA;;AAEnBA;;AAAAA;;AAEQA;;AAAAA;;;;;;AAEhBA;;AACIA;;AAA0BA;;;;AAA+BA;;AACzDA;;AAAuBA;;;;AAAiCA;;AACxDA;;AACIA;;;;AACJA;;AACAA;;AACJA;;;;;;AAN8BA;;AAAAA;;AACHA;;AAAAA;;AAEnBA;;AAAAA;;AAEQA;;AAAAA;;;;;;AAhBxBA;;AACIA;;AACIA;;AAQAA;;AAQJA;;AASJA;;;;;;AAzB2BA;;AAAAA;;AAQAA;;AAAAA;;;;;;AAkB3BA;;AACIA;;AACIA;;AACAA;;AACIA;;;;AACJA;;AAEJA;;AACJA;;;;;;AAJYA;;AAAAA;;;;;;AAWAA;;;;;;AAAYA;;;;;;AAEZA;;;;;;AACIA;;;;ACrCpB,UAAMC,YAAY,GAA0B;AAC1CC,aAAK,EAAE,mBADmC;AAE1CC,YAAI,EAAE,CAFoC;AAG1CC,mBAAW,EAAE,mBAH6B;AAI1CC,gBAAQ,EAAE;AAJgC,OAA5C;;UAWaC;AAoCX;;;AAGA,qCAAqBC,cAArB,EACSC,aADT,EAEUC,KAFV,EAGUC,MAHV,EAIUC,WAJV,EAKUC,MALV,EAMUC,iBANV,EAOUC,eAPV,EAQUC,eARV,EAQ0C;AAAA;;AARrB;AACZ;AACC;AACA;AACA;AACA;AACA;AACA;AACA;AA9CA,sBAAyC,IAAIf,uDAAJ,EAAzC;AAGD,8BAAuB,KAAvB;AAIF,4BAAoC;AACzCgB,iBAAK,EAAE,sBADkC;AAEzCC,gBAAI,EAAE,SAFmC;AAGzCC,iBAAK,EAAE,SAHkC;AAIzCC,gBAAI,EAAE;AAJmC,WAApC;AAME,8BAAsClB,YAAtC;AA0DF,mCAA2C;AAChDe,iBAAK,EAAE,eADyC;AAEhDC,gBAAI,EAAE,SAF0C;AAGhDE,gBAAI,EAAE,QAH0C;AAIhDD,iBAAK,EAAE,SAJyC;AAKhDE,mBAAO,EAAE,KAAKC,iBAAL,CAAuBC,IAAvB,CAA4B,IAA5B;AALuC,WAA3C;AAOA,uCAA+C;AACpDN,iBAAK,EAAE,iBAD6C;AAEpDC,gBAAI,EAAE,SAF8C;AAGpDE,gBAAI,EAAE,QAH8C;AAIpDD,iBAAK,EAAE,SAJ6C;AAKpDE,mBAAO,EAAE,KAAKG,mBAAL,CAAyBD,IAAzB,CAA8B,IAA9B;AAL2C,WAA/C;AAQA,mCAA2C;AAChDN,iBAAK,EAAE,gBADyC;AAEhDC,gBAAI,EAAE,gBAF0C;AAGhDG,mBAAO,EAAE,KAAKI,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB;AAHuC,WAA3C;AAxCuC;AA9B9C;;;;;;;iBAGA,6BAAiB;AACf,iBAAKG,IAAL,CAAUC,IAAV,CAAe;AAAE,sBAAQ;AAAV,aAAf;AACD;AAED;;;;;;eAGA,eAAc;;;AACZ,gBAAI,YAAKC,UAAL,MAAe,IAAf,IAAeC,aAAf,GAAe,MAAf,GAAeA,GAAEC,UAAjB,KAA+B,kBAAKF,UAAL,MAAe,IAAf,IAAeG,aAAf,GAAe,MAAf,GAAeA,GAAEC,MAAjB,MAAuB,IAAvB,IAAuBC,aAAvB,GAAuB,MAAvB,GAAuBA,GAAEC,WAAF,EAAvB,MAA2C,OAA9E,EAAuF;AACrF,qBAAO,IAAP;AACD,aAFD,MAEO,IAAI,YAAKN,UAAL,MAAe,IAAf,IAAeO,aAAf,GAAe,MAAf,GAAeA,GAAEL,UAAjB,KAA+B,YAAKF,UAAL,MAAe,IAAf,IAAeQ,aAAf,GAAe,MAAf,GAAeA,GAAEC,iCAAjB,KAAsD,IAArF,IAA6F,kBAAKT,UAAL,MAAe,IAAf,IAAeU,aAAf,GAAe,MAAf,GAAeA,GAAEN,MAAjB,MAAuB,IAAvB,IAAuBO,aAAvB,GAAuB,MAAvB,GAAuBA,GAAEL,WAAF,EAAvB,KAA0C,kBAA3I,EAA+J;AACpK,qBAAO,IAAP;AACD;;AACD,mBAAO,KAAP;AACD;AAeD;;;;;;;iBAIA,qBAAYM,OAAZ,EAAkC;AAChC,iBAAKhC,cAAL,CAAoBiC,QAApB,CAA6B,qBAA7B,EAAoD,CAAE,uBAAF,EAA2B,eAA3B,EAA4C;AAC9FD,qBAAO,EAAPA;AAD8F,aAA5C,CAApD;;AAGA,gBAAIA,OAAJ,EAAa;AACX,kBAAIA,OAAO,CAAC,YAAD,CAAP,IAAyBA,OAAO,CAAC,YAAD,CAAP,CAAsBE,YAAnD,EAAiE;AAC/D,qBAAKxC,YAAL,GAAiByC,gCAAQ,KAAKzC,YAAb,GAAyB;AAAE0C,4BAAU,EAAE,KAAKA;AAAnB,iBAAzB,CAAjB;AACD;AACF;AACF;AAED;;;;;;iBAGA,+BAAmB;AACjB,iBAAKpC,cAAL,CAAoBiC,QAApB,CAA6B,qBAA7B,EAAoD,CAAE,uBAAF,EAA2B,eAA3B,CAApD;AACA,iBAAKf,IAAL,CAAUC,IAAV,CAAe;AAAE,sBAAQ;AAAV,aAAf;AACD;AAuBD;;;;;;iBAGA,gCAAoB;AAAA;;AAElB,iBAAKlB,aAAL,CAAmBoC,WAAnB;AACA,iCAA+D,KAAKC,QAApE;AAAA,gBAAQd,MAAR,kBAAQA,MAAR;AAAA,gBAAgBe,QAAhB,kBAAgBA,QAAhB;AAAA,gBAA0BC,WAA1B,kBAA0BA,WAA1B;AAAA,gBAAuCC,SAAvC,kBAAuCA,SAAvC;AAAA,gBAAkDC,QAAlD,kBAAkDA,QAAlD;AACA,gBAAIC,YAAY,GAAG,CAAnB;;AACA,gBAAI,YAAW,SAAX,eAAW,WAAX,GAAW,MAAX,cAAW,CAAEC,MAAb,IAAsB,CAA1B,EAA6B;AAC3BD,0BAAY,GAAGH,WAAW,CAAC,CAAD,CAAX,CAAeG,YAA9B;AACD;;AACD,gBAAI,OAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEjB,WAAR,QAA0B,iBAA9B,EAAiD;AAC/C,mBAAK1B,cAAL,CAAoBiC,QAApB,CAA6B,sBAA7B,EAAqD,CAAE,4BAAF,EAAgC,eAAhC,EAAiD;AACpGY,sBAAM,EAAEN;AAD4F,eAAjD,CAArD;AAGA,mBAAKnC,WAAL,CAAiB0C,gBAAjB,CAAkCP,QAAlC,EAA4C,cAA5C,EAA4DQ,SAA5D,CAAsE;AACpEC,oBAAI,EAAE,cAACC,IAAD,EAAoB;AACxB,uBAAI,CAAC1C,eAAL,CAAqB2C,cAArB,CAAoCX,QAApC,EAA8CI,YAA9C,EAA4DF,SAA5D,EAAuEC,QAAvE,EAAiFK,SAAjF,CAA2F;AACzFC,wBAAI,EAAE,cAACC,IAAD,EAAc;;;AAClB,0BAAIA,IAAJ,EAAU;AACR,4BAAG,UAAI,SAAJ,QAAI,WAAJ,GAAI,MAAJ,OAAI,CAAEE,IAAN,MAAU,IAAV,IAAU9B,aAAV,GAAU,MAAV,GAAUA,GAAE+B,GAAf,EAAmB;AACjBC,kCAAQ,CAACC,IAAT,GAAgB,UAAI,SAAJ,QAAI,WAAJ,GAAI,MAAJ,OAAI,CAAEH,IAAN,MAAU,IAAV,IAAU5B,aAAV,GAAU,MAAV,GAAUA,GAAE6B,GAA5B;AACAG,wCAAc,CAACC,OAAf,CAAuB,QAAvB,EAAiC,GAAjC;AACD;AACF;AACF,qBARwF;AASzFC,4BAAQ,EAAE,oBAAK;AACb,2BAAI,CAACxD,aAAL,CAAmByD,WAAnB;AACD;AAXwF,mBAA3F;AAaD,iBAfmE;AAejEC,qBAAK,EAAE,iBAAK;AACb,uBAAI,CAAC1D,aAAL,CAAmByD,WAAnB;AACD;AAjBmE,eAAtE;AAmBD,aAvBD,MAuBM,IAAG,OAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEhC,WAAR,QAA0B,cAA7B,EAA4C;AAChD,mBAAK1B,cAAL,CAAoBiC,QAApB,CAA6B,sBAA7B,EAAqD,CAAE,4BAAF,EAAgC,eAAhC,EAAiD;AACpGY,sBAAM,EAAEN;AAD4F,eAAjD,CAArD;AAGA,mBAAKhC,eAAL,CAAqB2C,cAArB,CAAoCX,QAApC,EAA8CI,YAA9C,EAA4DF,SAA5D,EAAuEC,QAAvE,EAAiFK,SAAjF,CAA2F;AACzFC,oBAAI,EAAE,cAACC,IAAD,EAAc;AAClB,sBAAIA,IAAJ,EAAU;AACR,wBAAGA,IAAI,SAAJ,QAAI,WAAJ,GAAI,MAAJ,OAAI,CAAEE,IAAT,EAAc;AACZE,8BAAQ,CAACC,IAAT,GAAgBL,IAAI,CAACE,IAAL,CAAUC,GAA1B;AACAG,oCAAc,CAACC,OAAf,CAAuB,QAAvB,EAAiC,GAAjC;AACD;AACF;AACF,iBARwF;AASzFC,wBAAQ,EAAE,oBAAK;AACb,uBAAI,CAACxD,aAAL,CAAmByD,WAAnB;AACD;AAXwF,eAA3F;AAaD,aAjBK,MAiBC;AACL,mBAAK1D,cAAL,CAAoBiC,QAApB,CAA6B,8BAA7B,EAA6D,CAAE,4BAAF,EAAgC,eAAhC,EAAiD;AAC5GY,sBAAM,EAAEN;AADoG,eAAjD,CAA7D;AAGA,mBAAKlC,MAAL,CAAYuD,QAAZ,CAAqB,iBAAWrB,QAAX,eAArB;AACD;AAEF;AAED;;;;;;iBAGA,oBAAQ;AACN,gBAAMnB,UAAU,GAAG,KAAKA,UAAxB;AACA,iBAAKyC,UAAL,CAAgBhD,OAAhB,GAA0B,KAAKiD,oBAAL,CAA0B/C,IAA1B,CAA+B,IAA/B,CAA1B;AACD;AAED;;;;;;iBAGA,yBAAa;AAAA;;AACX,iBAAKd,aAAL,CAAmB8D,gBAAnB,GACGC,WADH,GACiBjB,SADjB,CAC2B,UAACI,IAAD,EAAS;;;AAChC,kBAAIA,IAAJ,EAAU;AACR,sBAAI,CAAClD,aAAL,CAAmBoC,WAAnB;;AACA,sBAAI,CAAC7B,eAAL,CAAqByD,aAArB,CAAmC,kBAAI,CAAC7C,UAAL,MAAe,IAAf,IAAeC,aAAf,GAAe,MAAf,GAAeA,GAAE6C,OAAjB,MAAwB,IAAxB,IAAwB3C,aAAxB,GAAwB,MAAxB,GAAwBA,GAAE4C,WAA7D,EAA0EpB,SAA1E,CAAoF;AAClFC,sBAAI,EAAE,gBAAK;AACT,0BAAI,CAAC/C,aAAL,CAAmByD,WAAnB;;AACA,0BAAI,CAACrD,MAAL,CAAYuD,QAAZ,CAAqB,CAAE,yBAAF,CAArB;AACD;AAJiF,iBAApF;AAMD;AACF,aAXH;AAYD;;;;;;;yBAjLU7D,qBAAkBN;AAAA;;;cAAlBM;AAAkBqE;AAAAC;AAAAjC;AAAAE;AAAAgC;AAAAC;AAAAnD;AAAA1B;AAAA8E;AAAAC;AAAA;AAAAC;AAAAxD;AAAA;AAAAyD;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADvB/BtF;;AACIA;;AAEAA;;AA4BAA;;AASAA;;AACIA;;AACIA;;AACIA;;AACJA;;AACAA;;AACIA;;AAEAA;;AAEJA;;AACJA;;AACJA;;AACJA;;;;AAnDSA;;AAAAA;;AACyBA;;AAAAA;;AA4BRA;;AAAAA;;AAYLA;;AAAAA;;AAIAA;;AAAAA;;AACQA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UElBhBuF;;;;;yBAAAA;AAAW;;;cAAXA;;;kBAbF,CACPC,yDADO,EAEPC,yDAFO,EAGPC,qEAHO,EAIPC,iEAJO,EAKPC,mEALO,EAMPC,6EANO,EAOPC,uEAPO,EAQPC,iEARO,EASPC,wEATO,GAWEP;;;;4HAEAF,cAAW;AAAAU,yBAfpBC,8FAeoB;AAfEC,oBAGtBX,yDAHsB,EAItBC,yDAJsB,EAKtBC,qEALsB,EAMtBC,iEANsB,EAOtBC,mEAPsB,EAQtBC,6EARsB,EAStBC,uEATsB,EAUtBC,iEAVsB,EAWtBC,wEAXsB,CAeF;AAJJI,oBAEPX,yDAFO,EAEOS,8FAFP;AAII;AAFyB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCrBpCG;;;;;yBAAAA;AAAsB;;;cAAtBA;AAAsB1B;AAAAQ;AAAAC;AAAAC;AAAAC;AAAA;ACPnCgB;;AACIA;;AACIA;;AACJA;;AACJA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACUAC,gDAAaC,6CAAb;;UAOaC;AAEX;;;;;AAKA,mCACU7F,MADV,EAEUH,KAFV,EAGUD,aAHV,EAIUE,MAJV,EAI2B;AAAA;;AAAA;;AAHjB;AACA;AACA;AACA;AAVV,uBAAQ6F,kCAAK,EAAb;AAmCU,8BAAqC,IAAIG,uDAAJ,EAArC;AACM,yBAAU,EAAV;AACP,4BAAa,KAAb;AACA,2BAAY,KAAZ;AAQT,gCAAiB,EAAjB;AACO,6BAAqC;AAC1C1F,iBAAK,EAAE,cADmC;AAE1CG,gBAAI,EAAE,MAFoC;AAG1CF,gBAAI,EAAE;AAHoC,WAArC;AAnCL,eAAKL,MAAL,CAAY+F,MAAZ,CAAmBrD,SAAnB,CAA6B;AAC3BC,gBAAI,EAAE,cAACG,IAAD,EAAS;AACb,kBAAG,MAAI,CAAC9C,MAAL,CAAY+C,GAAZ,CAAgBiD,OAAhB,CAAwB,GAAxB,MAAgC,CAAC,CAAjC,IAAsC,MAAI,CAAChG,MAAL,CAAY+C,GAAZ,CAAgBiD,OAAhB,CAAwB,cAAxB,MAA0C,CAAC,CAApF,EAAsF;AACpF,sBAAI,CAACC,UAAL,GAAkB,IAAlB;;AACA,sBAAI,CAACC,YAAL,CAAkBpF,IAAlB,CAAuB,MAAI,CAACmF,UAA5B;AACD;AACF;AAN0B,WAA7B;AAQA,eAAKpG,KAAL,CAAWsG,MAAX,CAAkBzD,SAAlB,CAA4B;AAC1BC,gBAAI,EAAE,cAACG,IAAD,EAAS;AACb,kBAAG,MAAI,CAAC9C,MAAL,CAAY+C,GAAZ,CAAgBiD,OAAhB,CAAwB,GAAxB,MAAgC,CAAC,CAAjC,IAAsC,MAAI,CAAChG,MAAL,CAAY+C,GAAZ,CAAgBiD,OAAhB,CAAwB,cAAxB,MAA0C,CAAC,CAApF,EAAsF;AACpF,sBAAI,CAACC,UAAL,GAAkB,IAAlB;;AACA,sBAAI,CAACC,YAAL,CAAkBpF,IAAlB,CAAuB,MAAI,CAACmF,UAA5B;AACD;AACF;AANyB,WAA5B;AASA,eAAKG,cAAL,GAAsB,KAAKxG,aAAL,CAAmByG,iBAAnB,EAAtB;AACD;AASD;;;;;;;iBAGA,iBAAK;AACH,iBAAKJ,UAAL,GAAkB,CAAC,KAAKA,UAAxB;AACA,iBAAKC,YAAL,CAAkBpF,IAAlB,CAAuB,KAAKmF,UAA5B;AACD;AAQD;;;;;;iBAGO,+BAAsBK,OAAtB,EAAqC;AAC1C,mBAAOX,uCAAUW,OAAV,EAAmBC,KAAnB,GAA2BC,MAA3B,CAAkC,SAAlC,CAAP;AACD;AACD;;;;;;iBAGA,0BAAiBrF,MAAjB,EAA8B;AAC5B,oBAAQA,MAAR;AACA,mBAAK,OAAL;AACE,uBAAO,cAAP;;AACF,mBAAK,kBAAL;AACE,uBAAO,gBAAP;;AACF,mBAAK,eAAL;AACE,uBAAO,eAAP;;AACF,mBAAK,iBAAL;AACE,uBAAO,wBAAP;;AACF;AACE,uBAAO,EAAP;AAVF;AAYD;AAED;;;;;;iBAGA,4BAAmBsF,WAAnB,EAAsC;AAAA;;AACpC,iBAAK7G,aAAL,CAAmBoC,WAAnB;AACA,iBAAKpC,aAAL,CAAmB8G,eAAnB,WAAsCC,iFAAtC,qCAAwFF,WAAxF,GAAuG/D,SAAvG,CAAiH;AAC/GC,kBAAI,EAAE,cAACG,IAAD,EAAc;AAClB8D,sBAAM,CAACC,IAAP,CAAY/D,IAAI,CAACgE,OAAjB,EAA0B,QAA1B;;AACA,sBAAI,CAAClH,aAAL,CAAmByD,WAAnB;AACD,eAJ8G;AAK/GC,mBAAK,EAAE,iBAAK;AACV,sBAAI,CAAC1D,aAAL,CAAmByD,WAAnB;AACD;AAP8G,aAAjH;AASD;AACD;;;;;;iBAGA,yBAAgB0D,QAAhB,EAAoCC,IAApC,EAAgD;AAC9C,gBAAMC,OAAO,GAAG,EAAhB;AAEAF,oBAAQ,CAACG,OAAT,CAAiB,UAACnE,GAAD,EAAQ;AACvB,kBAAIzD,KAAK,GAAG,EAAZ;AACA,kBAAI6H,QAAQ,GAAGpE,GAAf;;AAEA,kBAAIiE,IAAI,CAAChB,OAAL,CAAa,OAAb,MAA0B,CAAC,CAA3B,IAAgCgB,IAAI,CAAChB,OAAL,CAAa,UAAb,MAA6B,CAAC,CAAlE,EAAqE;AACnE1G,qBAAK,GAAGyD,GAAG,CAACqE,SAAJ,CAAc,CAAd,EAAiBrE,GAAG,CAACiD,OAAJ,CAAY,GAAZ,CAAjB,EAAmCqB,IAAnC,EAAR;AACAF,wBAAQ,GAAGpE,GAAG,CAACqE,SAAJ,CAAcrE,GAAG,CAACiD,OAAJ,CAAY,GAAZ,IAAmB,CAAjC,CAAX;AACD;;AAEDiB,qBAAO,CAACK,IAAR,CAAa;AACXC,qBAAK,EAAEJ,QADI;AAEXK,0BAAU,EAAEL,QAFD;AAGX;AACA7H,qBAAK,EAAEA;AAJI,eAAb;AAMD,aAfD;AAiBA,gBAAMwD,IAAI,GAAG;AAAE,8BAAgB,IAAlB;AAAwB,yBAAWmE;AAAnC,aAAb;AACA,iBAAKnH,MAAL,CAAY+G,IAAZ,CAAiBY,mHAAjB,EAA2C;AACzC3E,kBAAI,EACAA;AAFqC,aAA3C;AAID;AAED;;;;;;iBAGA,2BAAkB4E,OAAlB,EAAmCvG,MAAnC,EAAmDwG,KAAnD,EAA8D;AAC5D,gBAAM7E,IAAI,GAAG;AAAE,yBAAW4E,OAAb;AAAsB,wBAAUvG,MAAhC;AAAwC,uBAASwG;AAAjD,aAAb;AACA,iBAAK7H,MAAL,CAAY+G,IAAZ,CAAiBY,mHAAjB,EAA2C;AACzC3E,kBAAI,EACAA;AAFqC,aAA3C;AAID;;;;;;;yBApIU+C,mBAAgBC;AAAA;;;cAAhBD;AAAgB9B;AAAA6D;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpBzBxI;;AAC8CA;AAAAA;;AAAA;;AAAA;AAAA,aAAuC,aAAvC,EAAuC;AAAAA;;AAAA;;AAAA;AAAA,WAAvC;;AACoDA;;;;;;AAD9FA,oHAAyC,eAAzC,EAAyCyI,aAAzC,EAAyC,kBAAzC,EAAyCA,uBAAzC,EAAyC,QAAzC,EAAyCA,qBAAzC;;;;;;AAEJzI;;AACIA;;AACIA;;AACAA;;AACIA;;AACJA;;AAEJA;;AACAA;;AACIA;;AACAA;;AACAA;;AACAA;;AACJA;;AACJA;;;;;;AAEAA;;AACIA;;AACIA;;AACIA;;AACJA;;AACJA;;AACJA;;;;;;AAHiBA;;AAAAA;;;;;;AAvBrBA;;AACIA;;AAGAA;;AAgBAA;;AAOJA;;;;;;AA1B0CA;;AAAAA;;AAGhBA;;AAAAA;;AAgBhBA;;AAAAA;;;;;;AAQVA;;;;ACbA,UAAM0I,iBAAiB,GAA0B;AAC/CxI,aAAK,EAAE,eADwC;AAE/CC,YAAI,EAAE,CAFyC;AAG/CC,mBAAW,EAAE,mBAHkC;AAI/CC,gBAAQ,EAAE;AAJqC,OAAjD;;UAYasI;AAoCX;;;;AAIA,wCAAoBC,EAApB,EAAmDpI,aAAnD,EAAyFC,KAAzF,EACUE,WADV,EAEUJ,cAFV,EAGUsI,cAHV,EAIUC,sBAJV,EAIwD;AAAA;;AAJpC;AAA+B;AAAsC;AAC/E;AACA;AACA;AACA;AA3CD,gCAAwCJ,iBAAxC;AACF,kCAAsC,EAAtC;AACA,gCAAiB,CAAE,KAAF,EAAS,MAAT,EAAiB,KAAjB,CAAjB;AAEA,iCAAyC;AAC9C1H,iBAAK,EAAE,MADuC;AAE9CC,gBAAI,EAAE;AAFwC,WAAzC;AAKA,wBAAsB;AAC3B8H,gBAAI,EAAE,iBADqB;AAE3B5H,gBAAI,EAAE,QAFqB;AAG3BV,iBAAK,EAAE,mBAHoB;AAI3BuI,yBAAa,EAAE,EAJY;AAK3BjH,kBAAM,EAAE,iBALmB;AAM3BqB,kBAAM,EAAE;AANmB,WAAtB;AASA,mCAAoB,OAApB;AAKA,gCAAiB,KAAjB;AACC,0BAAkB,EAAlB;AACA,qCAAsB,EAAtB;AAKD,8BAAwB,KAAxB;AAGP,+BAAyB,KAAzB;;AAWE,cAAI5C,aAAa,CAACyI,QAAd,CAAuBC,MAA3B,EAAmC;AACjC1I,yBAAa,CAACyI,QAAd,GAAyB,IAAIE,iDAAJ,CAA4B,IAA5B,CAAzB;AACD;;AACD3I,uBAAa,CAACyI,QAAd,CAAuB1F,IAAvB,CAA4B,UAA5B;;AAEA,cAAG,KAAK/C,aAAL,CAAmB4I,WAAnB,CAA+BF,MAAlC,EAA0C;AACxC,iBAAK1I,aAAL,CAAmB4I,WAAnB,GAAiC,IAAID,iDAAJ,CAA6B,IAA7B,CAAjC;AACD;AACF;AAED;;;;;;;;iBAIA,2BAAe;AACb,iBAAK3I,aAAL,CAAmB6I,UAAnB,CAA8B,eAA9B,EAA+C,UAA/C;AACA,iBAAKT,EAAL,CAAQU,aAAR;AACA,iBAAK/I,cAAL,CAAoBiC,QAApB,CAA6B,iBAA7B,EAAgD,CAAE,0BAAF,EAA8B,eAA9B,CAAhD;AACD;AAED;;;;;;iBAGA,4BAAgB;AAAA;;;;AACd,uBAAK/B,KAAL,CAAW8I,WAAX,MAAsB,IAAtB,IAAsB3H,aAAtB,GAAsB,MAAtB,GAAsBA,GAAE0B,SAAF,CAAY,UAACyD,MAAD,EAAU;AAC1C,kBAAMyC,SAAS,GAAGzC,MAAM,CAAC,cAAD,CAAxB;;AACA,kBAAIyC,SAAS,KAAK,MAAd,IAAwBA,SAAS,KAAK,IAA1C,EAA+C;AAC7C,sBAAI,CAACC,gBAAL,GAAwB,MAAI,CAACA,gBAAL,CAAsBC,MAAtB,CAA6B,UAACvJ,IAAD,EAAwB;AAC3E,yBAAOA,IAAI,CAACE,QAAL,CAAcuG,OAAd,CAAsB,sBAAtB,KAAiD,CAAC,CAAzD;AACD,iBAFuB,CAAxB;AAGD;AACF,aAPqB,CAAtB;AAQD;AAED;;;;;;iBAGA,uBAAc+C,MAAd,EAAoC;AAClC,gBAAIA,MAAM,CAACC,YAAP,IAAuBD,MAAM,CAACE,gBAAlC,EAAoD;AAClD,mBAAKC,iBAAL,GAAyB,KAAKC,UAAL,CAAgBzI,IAAhB,CAAqB,IAArB,CAAzB;AACD,aAFD,MAEO;AACL,mBAAKwI,iBAAL,GAAyB,KAAKE,UAAL,CAAgB1I,IAAhB,CAAqB,IAArB,CAAzB;AACD;AACF;AAED;;;;;;iBAGA,oCAAwB;;;AACtB,iBAAK2I,kBAAL,GAA0B,KAAKzJ,aAAL,CAAmB0J,WAAnB,CAA+B,WAAKC,aAAL,MAAkB,IAAlB,IAAkBvI,aAAlB,GAAkB,MAAlB,GAAkBA,GAAEwI,cAAnD,EAAmE,oBAAnE,EAAyF,mBAAzF,EACxB;AAAE,4BAAc,MAAhB;AAAwB,2BAAa;AAArC,aADwB,CAA1B;;AAEA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKJ,kBAAL,CAAwB9G,MAA5C,EAAoDkH,CAAC,EAArD,EAAwD;AACtD,kBAAMC,SAAS,GAAG,KAAKL,kBAAL,CAAwBI,CAAxB,CAAlB;AACA,kBAAME,YAAY,GAAG,4IAAmBD,SAAnB,EAA8BD,CAA9B,CAArB;AACA,kBAAMG,iBAAiB,GAAGD,YAAY,CAAClK,QAAb,CAAsB4B,WAAtB,GAAoC2E,OAApC,CAA4C,qBAA5C,KAAsE,CAAC,CAAjG;AACA,kBAAM6D,sCAAsC,GAAGD,iBAAiB,IAAI,CAACD,YAAY,CAAC5G,GAAlF;AACA,mBAAK8F,gBAAL,CAAsBvB,IAAtB,CAA0BxF,gCACrB6H,YADqB,GACT;AAAEG,yBAAS,EAAEJ,SAAS,CAACI,SAAvB;AAAkCC,qBAAK,EAAEN,CAAzC;AACfI,sDAAsC,EAAtCA,sCADe;AAEfG,0BAAU,EAAEN,SAAS,CAACM,UAFP;AAGfC,uBAAO,EAAEP,SAAS,CAACQ,SAHJ;AAIfC,2BAAW,EAAET,SAAS,CAACU,aAAV,IAA2B,sCAA3B,GAAoEV,SAAS,CAACS,WAA9E,GAA2F,EAJzF;AAKfE,4BAAY,EAAEX,SAAS,CAACU,aAAV,IAA2B,sCAA3B,GAAoEV,SAAS,CAACY,WAA9E,GAA2F,EAL1F;AAMfC,wBAAQ,EAAE,KAAKA,QANA;AAMUC,wBAAQ,EAAE,KAAKA,QANzB;AAOfC,yBAAS,EAAEf,SAAS,CAACe,SAPN;AAOiBC,8BAAc,EAAEhB,SAAS,CAACgB,cAP3C;AAQfzB,gCAAgB,EAAES,SAAS,CAACU,aAAV,IAA2B,sCAA3B,GAAoEV,SAAS,CAACU,aAA9E,GAA8F,EARjG;AASfpB,4BAAY,EAAEU,SAAS,CAACiB,SAAV,IAAuB,sCAAvB,GAAgEjB,SAAS,CAACiB,SAA1E,GAAoF,EATnF;AAUfC,gCAAgB,EAAElB,SAAS,CAACmB,qBAVb;AAUoCC,4BAAY,EAAEpB,SAAS,CAAC,mBAAD;AAV3D,eADS,CAA1B;AAaA,mBAAKqB,gBAAL;AACD;AACF;AAED;;;;;;iBAGA,4BAAmBC,QAAnB,EAAkC;AAAA;;AAChC,gBAAG,CAAC,KAAKC,aAAT,EAAwB;AACtB,mBAAKA,aAAL,GAAqB,IAArB;AACA,mBAAKhD,cAAL,CAAoBiD,kBAApB,CAAuC,iBAAvC,EAA0DF,QAA1D,EAAoE,EAApE,EAAwEtI,SAAxE,CAAkF;AAChFC,oBAAI,EAAE,gBAAI;AACR,wBAAI,CAACwI,mBAAL,GAA2B,iBAA3B;AACA,wBAAI,CAACC,MAAL,CAAYhD,aAAZ,GAA4B,MAAI,CAAC+C,mBAAjC;;AACA,wBAAI,CAACvL,aAAL,CAAmBoC,WAAnB;;AACA,wBAAI,CAACiG,cAAL,CAAoBoD,qBAApB,CAA0C,MAAI,CAACL,QAA/C,EAAyDtI,SAAzD,CAAmE;AACjEC,wBAAI,EAAE,cAAO2I,MAAP;AAAA,6BAAuB;AAAA;AAAA;AAAA;AAC3B,kCAAIA,MAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAExI,IAAZ,EAAkB;AAChB,qCAAKlD,aAAL,CAAmB2L,aAAnB,CAAiC5I,IAAjC,CAAsC2I,MAAM,CAACxI,IAA7C;AACA,qCAAKlD,aAAL,CAAmB4L,SAAnB,CAA6B7I,IAA7B,CAAkC2I,MAAM,CAACxI,IAAP,CAAY2I,YAA9C;AACA,qCAAK7L,aAAL,CAAmByD,WAAnB;AACD;;AAL0B;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAvB;AAAA,qBAD2D;AAQjEC,yBAAK,EAAE,eAACoI,GAAD,EAAa;AAClB,4BAAI,CAAC/L,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCE,oFAAtC;;AACA,4BAAI,CAAChM,aAAL,CAAmByD,WAAnB;AACD;AAXgE,mBAAnE;AAaD;AAlB+E,eAAlF;AAoBD;AACF;AAED;;;;;;iBAGA,oBAAWwI,WAAX,EAAsC;AAAA;;AAEpC,gBAAMC,GAAG,GAAG;AACVC,+BAAiB,EAAE,KAAKxC,aAAL,CAAmByC,cAD5B;AAEVzB,sBAAQ,EAAE,KAAKA,QAFL;AAGVC,sBAAQ,EAAE,KAAKA,QAHL;AAIVyB,6BAAe,EAAEJ,WAAW,CAACf,YAJnB;AAKVoB,iCAAmB,EAAEL,WAAW,CAACjB;AALvB,aAAZ;AAOA,iBAAKjL,cAAL,CAAoBiC,QAApB,CAA6B,YAA7B,EAA2C,CAAE,0BAAF,EAA8B,eAA9B,EAA+C;AACxFkK,iBAAG,EAAHA;AADwF,aAA/C,CAA3C;AAGAD,uBAAW,CAACM,gBAAZ,GAA+B,IAA/B;AACAN,uBAAW,CAACO,SAAZ,GAAwB,KAAxB;AACAP,uBAAW,CAACQ,cAAZ,GAA6B,KAA7B;AACAR,uBAAW,CAACS,eAAZ,GAA8B,KAA9B;AACA,gBAAMC,mBAAmB,kJAAzB;AAEA,iBAAK3M,aAAL,CAAmB4M,gBAAnB,CAAoCD,mBAApC;AACA,iBAAKrE,sBAAL,CAA4BuE,cAA5B,CAA2CZ,WAAW,CAACa,SAAvD,EAAkEZ,GAAlE,EAAuEpJ,SAAvE,CAAkF;AAChFC,kBAAI,EAAE,cAACgK,GAAD,EAAkB;;;AACtB,oBAAMC,YAAY,GAAGD,GAAG,SAAH,OAAG,WAAH,GAAG,MAAH,MAAG,CAAE7J,IAA1B;AACA,oBAAM+J,iBAAiB,GAAG,YAAI,CAACxD,kBAAL,MAAuB,IAAvB,IAAuBrI,aAAvB,GAAuB,MAAvB,GAAuBA,GAAE8L,IAAF,CAAO,UAACC,CAAD;AAAA,yBAAYA,CAAC,CAAClC,qBAAF,KAA2B+B,YAAY,SAAZ,gBAAY,WAAZ,GAAY,MAAZ,eAAY,CAAEV,mBAAzC,CAAZ;AAAA,iBAAP,CAAjD;;AACA,oBAAGW,iBAAH,EAAsB;AACpBA,mCAAiB,CAAClC,SAAlB,GAA8BiC,YAAY,CAACjC,SAA3C;AACAkC,mCAAiB,CAACzC,aAAlB,GAAkCwC,YAAY,CAACxC,aAA/C;;AACA,sBAAGpH,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,KAAoC,aAAI,CAAC7B,mBAAL,MAAwB,IAAxB,IAAwBjK,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEG,WAAF,EAAxB,MAA4C,OAAnF,EAA2F;AACzF,0BAAI,CAAC6J,kBAAL,CAAwB,MAAI,CAACF,QAA7B;AACD;;AACD,sBAAGhI,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,KAAmC,aAAI,CAAC5B,MAAL,CAAYhD,aAAZ,MAAyB,IAAzB,IAAyBhH,aAAzB,GAAyB,MAAzB,GAAyBA,GAAEC,WAAF,EAAzB,MAA6C,gBAAnF,EAAoG;AAClG,0BAAI,CAAC4L,YAAL;AACD;;AACD,wBAAI,CAACC,cAAL,CAAoBC,kBAApB,CAAuC,SAAvC,EAAkDtB,WAAlD,EAA+D,IAA/D,EAAqEe,YAArE;AACD;AACF,eAf+E;AAgBhFtJ,mBAAK,EAAE,eAACoI,GAAD,EAAkB;AACvB,oBAAGA,GAAG,CAACvK,MAAJ,IAAc,GAAjB,EAAsB;AACpB,sBAAG;AACD,0BAAI,CAAC+L,cAAL,CAAoBC,kBAApB,CAAwC,QAAxC,EAAkDtB,WAAlD,EAA+DH,GAA/D;AACD,mBAFD,CAEC,OAAM0B,CAAN,EAAQ;AACP,0BAAI,CAACF,cAAL,CAAoBC,kBAApB,CAAuC,QAAvC,EAAiDtB,WAAjD;AACD;AACF;;AACD,sBAAI,CAAClM,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCE,oFAAtC;AACD,eAzB+E;AA0BhFxI,sBAAQ,EAAE;AAAA,uBAAW,MAAI,CAACxD,aAAL,CAAmByD,WAAnB,EAAX;AAAA;AA1BsE,aAAlF;AA4BD;AAED;;;;;;iBAGA,oBAAWwI,WAAX,EAAsC;AAAA;;AACpC,gBAAMC,GAAG,GAAG;AACVtB,sBAAQ,EAAE,KAAKA,QADL;AAEVG,uBAAS,EAAEkB,WAAW,CAAC7C,YAFb;AAGVoB,2BAAa,EAAEyB,WAAW,CAAC5C;AAHjB,aAAZ;AAMA,iBAAKtJ,cAAL,CAAoBiC,QAApB,CAA6B,YAA7B,EAA2C,CAAE,0BAAF,EAA8B,eAA9B,EAA+C;AACxFkK,iBAAG,EAAHA;AADwF,aAA/C,CAA3C;AAIAD,uBAAW,CAACM,gBAAZ,GAA+B,IAA/B;AACAN,uBAAW,CAACO,SAAZ,GAAwB,KAAxB;AACAP,uBAAW,CAACQ,cAAZ,GAA6B,KAA7B;AACAR,uBAAW,CAACS,eAAZ,GAA8B,KAA9B;AACA,iBAAKpE,sBAAL,CAA4BmF,cAA5B,CAA2CxB,WAAW,CAACa,SAAvD,EAAkEZ,GAAlE,EAAuEpJ,SAAvE,CAAiF;AAC/EC,kBAAI,EAAE,cAACgK,GAAD,EAAmB;AACvB,sBAAI,CAACO,cAAL,CAAoBC,kBAApB,CAAuC,SAAvC,EAAkDtB,WAAlD;AACD,eAH8E;AAI/EvI,mBAAK,EAAE,eAACoI,GAAD,EAAkB;AACvB,oBAAGA,GAAG,CAACvK,MAAJ,IAAc,GAAjB,EAAsB;AACpB,sBAAG;AACD,0BAAI,CAAC+L,cAAL,CAAoBC,kBAApB,CAAwC,QAAxC,EAAkDtB,WAAlD,EAA+DH,GAA/D;AACD,mBAFD,CAEC,OAAM0B,CAAN,EAAQ;AACP,0BAAI,CAACF,cAAL,CAAoBC,kBAApB,CAAuC,QAAvC,EAAiDtB,WAAjD;AACD;AACF;;AACD,sBAAI,CAAClM,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCE,oFAAtC;AACD,eAb8E;AAc/ExI,sBAAQ,EAAE;AAAA,uBAAU,MAAI,CAACxD,aAAL,CAAmByD,WAAnB,EAAV;AAAA;AAdqE,aAAjF;AAgBD;AAED;;;;;;iBAGA,wBAAY;AAAA;;AACV,gBAAG,CAAC,KAAK4H,aAAT,EAAwB;AACtB,mBAAKA,aAAL,GAAqB,IAArB;AACA,mBAAKtL,cAAL,CAAoBiC,QAApB,CAA6B,cAA7B,EAA6C,CAAE,0BAAF,EAA8B,eAA9B,EAA+C;AAC1FY,sBAAM,EAAE,KAAK4I,MAAL,CAAY5I;AADsE,eAA/C,CAA7C;AAGA,mBAAKzC,WAAL,CAAiB0C,gBAAjB,CAAkC,KAAK2I,MAAL,CAAY5I,MAA9C,EAAsD,iBAAtD,EAAyEE,SAAzE,CAAmF;AACjFC,oBAAI,EAAE,gBAAI;AACR,wBAAI,CAACyI,MAAL,GAAWtJ,gCAAQ,MAAI,CAACsJ,MAAb,GAAmB;AAAEjK,0BAAM,EAAE;AAAV,mBAAnB,CAAX;AACD;AAHgF,eAAnF;AAKD;AACF;AAED;;;;;;;iBAIA,0BAAiBmM,SAAjB,EAA+B;AAAA;;AAC7B,gBAAG,KAAK/D,aAAR,EAAuB;AACrB,kBAAI;AAAA,6CAC0D;AAC1D,sBAAMgE,KAAK,GAAG,OAAI,CAAChE,aAAL,CAAmBC,cAAnB,CAAkCC,CAAlC,CAAd;AACA,sBAAM+D,iBAAiB,GAAGF,SAAS,CAACR,IAAV,CAAe,UAACC,CAAD;AAAA,2BAAUA,CAAC,CAACU,iBAAF,IAAuBF,KAAK,CAACE,iBAAvC;AAAA,mBAAf,CAA1B;;AACA,sBAAGD,iBAAH,EAAsB;AAAA,mDAC+B;AACjD,0BAAM9D,SAAS,GAAG6D,KAAK,CAAClE,kBAAN,CAAyBqE,CAAzB,CAAlB;AACA,0BAAMC,aAAa,GAAGH,iBAAiB,CAACI,UAAlB,CAA6Bd,IAA7B,CAAkC,UAACC,CAAD;AAAA,+BAAWA,CAAC,CAAClC,qBAAF,IAA2BnB,SAAS,CAACmB,qBAAhD;AAAA,uBAAlC,CAAtB;AACAnB,+BAAS,CAACiB,SAAV,GAAsB6C,iBAAiB,CAAC7C,SAAxC;AACAjB,+BAAS,CAACU,aAAV,GAA0BuD,aAAa,CAACvD,aAAxC;AACAV,+BAAS,CAACY,WAAV,GAAwBqD,aAAa,CAACrD,WAAtC;AACAZ,+BAAS,CAACS,WAAV,GAAwBwD,aAAa,CAACxD,WAAtC;AACAT,+BAAS,CAACnC,KAAV,GAAkBoG,aAAa,CAACE,MAAhC;AACAnE,+BAAS,CAAC4C,eAAV,GAA4B,KAA5B;;AACA,0BAAG5C,SAAS,CAACU,aAAV,IAA2BV,SAAS,CAACU,aAAV,IAA2B,sCAAzD,EAAiG;AAC/FV,iCAAS,CAAC4C,eAAV,GAA4B,IAA5B;AACD;AACF,qBAbmB;;AACpB,yBAAI,IAAIoB,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACH,KAAK,CAAClE,kBAAN,CAAyB9G,MAAvC,EAA8CmL,CAAC,EAA/C;AAAA;AAAA;AAaD;AACF,iBAnBC;;AACF,qBAAI,IAAIjE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKF,aAAL,CAAmBC,cAAnB,CAAkCjH,MAAhD,EAAuDkH,CAAC,EAAxD;AAAA;AAAA;;AAmBA,qBAAKF,aAAL,GAAkBzH,kBAAQ,KAAKyH,aAAb,CAAlB;AAED,eAtBD,CAsBE,OAAOjG,KAAP,EAAc;AACdwK,uBAAO,CAACC,GAAR,CAAYzK,KAAZ;AACD;AACF;AACF;AAED;;;;;;iBAGA,oBAAQ;AAAA;;;;AACN,iBAAK1D,aAAL,CAAmBoC,WAAnB;AACA,gBAAMgM,EAAE,GAAG,WAAKnO,KAAL,CAAWoO,MAAX,MAAiB,IAAjB,IAAiBjN,aAAjB,GAAiB,MAAjB,GAAiBA,GAAEkN,QAAF,CAAWC,QAAX,CAAoBC,GAApB,CAAwB,IAAxB,CAA5B;AACA,iBAAKzO,cAAL,CAAoBiC,QAApB,CAA6B,UAA7B,EAAyC,CAAE,0BAAF,EAA8B,eAA9B,EAA+C;AACtFY,oBAAM,EAAEwL;AAD8E,aAA/C,CAAzC;AAGA,iBAAK5C,MAAL,GAAWtJ,gCAAQ,KAAKsJ,MAAb,GAAmB;AAAEvL,mBAAK,uBAAgBmO,EAAhB,YAAP;AAAoCxL,oBAAM,EAAEwL;AAA5C,aAAnB,CAAX;AAEA,iBAAKpO,aAAL,CAAmB4I,WAAnB,CAA+B9F,SAA/B,CAAyC;AACvCC,kBAAI,EAAE,cAACgK,GAAD,EAAiB;AACrB,oBAAI,CAACA,GAAL,EAAU;AACR,yBAAI,CAAC0B,YAAL,GAAoB,IAApB;AACD;AACF;AALsC,aAAzC;AAOA,gBAAMC,UAAU,GAAO;AACrB/E,2BAAa,EAAE,KAAKrB,sBAAL,CAA4BqG,gBAA5B;AADM,aAAvB;AAGA,gBAAIC,QAAQ,GAAG,KAAf;;AACA,gBAAGxL,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,CAAH,EAAoC;AAClCsB,wBAAU,CAACG,aAAX,GAA2B,KAAKxG,cAAL,CAAoBoD,qBAApB,CAA0C2C,EAA1C,CAA3B;AACAQ,sBAAQ,GAAG,IAAX;AACD,aAHD,MAGK;AACH,mBAAK5O,aAAL,CAAmB8O,eAAnB,CAAmChM,SAAnC,CAA6C,UAACiK,GAAD,EAAQ;AACnD,oBAAIA,GAAG,IAAIA,GAAG,CAAC7J,IAAf,EAAqB;AACnB,sBAAQ6L,kBAAR,GAA+BhC,GAAG,CAAC7J,IAAnC,CAAQ6L,kBAAR;AACA,yBAAI,CAACC,YAAL,GAAoBD,kBAAkB,CAACX,EAAvC;AACD;AACF,eALD;AAMAM,wBAAU,CAACO,UAAX,GAAwB,KAAK9O,WAAL,CAAiB+O,aAAjB,CAA+Bd,EAA/B,CAAxB;AACD;;AAED,gBAAM1C,MAAM,GAAG,iDAASgD,UAAT,EAAqBS,IAArB,CACb,mDAAW,eAAK;AAAA,qBAAI,2CAAGzL,KAAH,CAAJ;AAAA,aAAhB,CADa,CAAf;AAGAgI,kBAAM,CAAC5I,SAAP,CAAiB,UAACsM,IAAD,EAAc;AAC7B,kBAAIA,IAAJ,EAAU;AACR,oBAAMzF,aAAa,GAAGyF,IAAI,CAACzF,aAA3B;;AACA,oBAAIA,aAAJ,EAAmB;AACjB,sBAAM0F,qBAAqB,GAAG1F,aAAa,CAACzG,IAA5C;;AACA,sBAAIkM,IAAI,CAACH,UAAT,EAAqB;AACnB,gDAAgFG,IAAI,CAACH,UAAL,CAAgB/L,IAAhG;AAAA,wBAAQf,UAAR,yBAAQA,UAAR;AAAA,wBAAoBiM,GAApB,yBAAoBA,EAApB;AAAA,wBAAwB7M,MAAxB,yBAAwBA,MAAxB;AAAA,wBAAgCgB,WAAhC,yBAAgCA,WAAhC;AAAA,wBAA6ClB,UAA7C,yBAA6CA,UAA7C;AAAA,wBAAyD0N,kBAAzD,yBAAyDA,kBAAzD;;AAEA,wBAAI,OAAI,CAACC,YAAL,KAAqBD,kBAAkB,SAAlB,sBAAkB,WAAlB,GAAkB,MAAlB,qBAAkB,CAAEO,cAAzC,CAAJ,EAA6D;AAC3D,6BAAI,CAACtP,aAAL,CAAmBuP,UAAnB,GAAgC,IAAhC;AACD,qBAFD,MAEO;AACL,6BAAI,CAACvP,aAAL,CAAmBuP,UAAnB,GAAgC,KAAhC;AACD;;AAED,wBAAIhN,WAAW,CAACI,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B,6BAAI,CAAC3C,aAAL,CAAmB0C,YAAnB,CAAgCK,IAAhC,CAAqCR,WAAW,CAAC,CAAD,CAAX,CAAeG,YAApD;AACD;;AACD,2BAAI,CAAC1C,aAAL,CAAmBwP,UAAnB,CAA8BzM,IAA9B,CAAmCxB,MAAnC;;AACA,wBAAIA,MAAM,CAACE,WAAP,OAAyB,gBAA7B,EAA+C,CAC/C;AACC,qBAFD,MAEK;AACH,6BAAI,CAAC+J,MAAL,GAAWtJ,gCAAQ,OAAI,CAACsJ,MAAb,GAAmB;AAAEjK,8BAAM,EAAE;AAAV,uBAAnB,CAAX;AACD;;AACD,2BAAI,CAACiK,MAAL,CAAYhD,aAAZ,GAA4BjH,MAA5B;AACA,2BAAI,CAACkO,cAAL,CAAoBtN,UAApB,GAAiCA,UAAjC;AACA,2BAAI,CAACyI,QAAL,GAAgBwD,GAAhB;;AACA,wBAAI/M,UAAJ,EAAgB;AACd,6BAAI,CAACmK,MAAL,CAAYJ,QAAZ,GAAuB/J,UAAvB;AACA,6BAAI,CAACmK,MAAL,CAAYkE,IAAZ,GAAmB,OAAnB;AACD;AACF;;AACD,sBAAGN,IAAI,CAACP,aAAR,EAAsB;AACpB,gDAA4FO,IAAI,CAACP,aAAL,CAAmB3L,IAA/G;AAAA,wBAAQkL,IAAR,yBAAQA,EAAR;AAAA,wBAAY7M,OAAZ,yBAAYA,MAAZ;AAAA,wBAAoBF,WAApB,yBAAoBA,UAApB;AAAA,wBAAgCsO,OAAhC,yBAAgCA,OAAhC;AAAA,wBAAyC9D,YAAzC,yBAAyCA,YAAzC;AAAA,wBAAuD+D,uBAAvD,yBAAuDA,uBAAvD;AAAA,wBAAgF3L,OAAhF,yBAAgFA,OAAhF;AACA,2BAAI,CAAC2G,QAAL,GAAgBwD,IAAhB;AACA,2BAAI,CAAChD,QAAL,GAAgB/J,WAAhB,CAHoB,CAKpB;;AACA,wBAAGsO,OAAH,EAAY;AACV,6BAAI,CAACnE,MAAL,CAAY5I,MAAZ,GAAqB+M,OAArB;AACA,6BAAI,CAACnE,MAAL,CAAYkE,IAAZ,GAAmB,QAAnB;AACD;;AAED,2BAAI,CAAClE,MAAL,CAAYoE,uBAAZ,GAAsCA,uBAAtC;AACA,2BAAI,CAACpE,MAAL,CAAYJ,QAAZ,GAAuB/J,WAAvB;AACA,2BAAI,CAACmK,MAAL,CAAYI,SAAZ,GAAwB3H,OAAO,SAAP,WAAO,WAAP,GAAO,MAAP,UAAO,CAAEC,WAAjC;AACA,2BAAI,CAACsH,MAAL,CAAYhD,aAAZ,GAA4BjH,OAA5B;;AAEA,2BAAI,CAACvB,aAAL,CAAmB6P,YAAnB,CAAgC9M,IAAhC,CAAqCxB,OAArC,EAhBoB,CAiBpB;;;AAEA,2BAAI,CAACgK,mBAAL,GAA2BhK,OAA3B,CAnBoB,CAoBpB;;AACA,2BAAI,CAACvB,aAAL,CAAmB2L,aAAnB,CAAiC5I,IAAjC,CAAsCqM,IAAI,CAACP,aAAL,CAAmB3L,IAAzD;;AACA,2BAAI,CAAClD,aAAL,CAAmB4L,SAAnB,CAA6B7I,IAA7B,CAAkC8I,YAAlC;AACD;;AACD,sBAAIwD,qBAAqB,CAAC1M,MAAtB,GAA+B,CAAnC,EAAsC;AACpC,gDAA+B0M,qBAAqB,CAAC,CAAD,CAApD;AAAA,wBAAQjB,IAAR,yBAAQA,EAAR;AAAA,wBAAYhC,cAAZ,yBAAYA,cAAZ;AACA,2BAAI,CAACC,eAAL,GAAuB+B,IAAvB;AACA,2BAAI,CAACzD,QAAL,GAAgB,IAAhB;;AACA,wBAAGiE,QAAH,EAAY;AACV,6BAAI,CAACjE,QAAL,GAAgB,IAAhB;AACD;;AACD,2BAAI,CAACyB,cAAL,GAAsBA,cAAtB;AACA,wBAAM0D,YAAY,GAAG,iDAAS;AAC5BC,yCAAmB,EAAE,OAAI,CAACzH,sBAAL,CAA4B0H,oBAA5B,CAAiD5D,cAAjD,CADO;AAE5B6D,iCAAW,EAAE,OAAI,CAAC3H,sBAAL,CAA4B4H,oBAA5B,CAAiD9B,IAAjD,EAAqD,OAAI,CAACxD,QAA1D,EAAoE,OAAI,CAACD,QAAzE;AAFe,qBAAT,EAGlBwE,IAHkB,CAInB,mDAAW,eAAK;AAAA,6BAAI,2CAAGzL,KAAH,CAAJ;AAAA,qBAAhB,CAJmB,CAArB;AAMAoM,gCAAY,CAAChN,SAAb,CAAuB,UAACqN,UAAD,EAAoB;AACzC,0BAAIA,UAAJ,EAAgB;AACd,4BAAQJ,mBAAR,GAA6CI,UAA7C,CAAQJ,mBAAR;AAAA,4BAA6BE,WAA7B,GAA6CE,UAA7C,CAA6BF,WAA7B;AACA,+BAAI,CAACtG,aAAL,GAAqBoG,mBAAmB,CAAC7M,IAAzC;AACA,+BAAI,CAACyG,aAAL,CAAmBC,cAAnB,GAAoCmG,mBAAmB,CAAC7M,IAApB,CAAyB0G,cAAzB,CAAwCwG,IAAxC,CAA6C,UAACzC,KAAD,EAAa0C,MAAb,EAA4B;AAC3G,iCAAO1C,KAAK,CAAC2C,WAAN,GAAoBD,MAAM,CAACC,WAAlC;AACD,yBAFmC,CAApC;;AAGA,4BAAIL,WAAW,CAAC/M,IAAhB,EAAsB;AACpB,iCAAI,CAACqN,gBAAL,CAAsBN,WAAW,CAAC/M,IAAZ,CAAiBsN,MAAvC;AACD;;AACD,+BAAI,CAACC,wBAAL;AACD;;AACD,6BAAI,CAACzQ,aAAL,CAAmByD,WAAnB;AACD,qBAbD,EAaG,UAACqI,GAAD,EAAQ;AACT,6BAAI,CAAC9L,aAAL,CAAmByD,WAAnB;;AACA,6BAAI,CAAC1D,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCE,oFAAtC;AACD,qBAhBD;AAkBD,mBAhCD,MAgCO;AACL,2BAAI,CAAChM,aAAL,CAAmByD,WAAnB;AACD;AACF,iBAvFD,MAuFM;AACJ,yBAAI,CAACiN,cAAL,GAAsB,IAAtB;;AACA,yBAAI,CAAC1Q,aAAL,CAAmByD,WAAnB;AACD;AAEF,eA9FD,MA8FO;AACL,uBAAI,CAACiN,cAAL,GAAsB,IAAtB;;AACA,uBAAI,CAAC1Q,aAAL,CAAmByD,WAAnB;AACD;AACF,aAnGD;AAoGA,gBAAMkN,SAAS,GAAQC,QAAQ,CAACC,aAAT,CAAuB,oBAAvB,CAAvB;;AACA,gBAAGF,SAAH,EAAa;AACXA,uBAAS,CAACG,SAAV,GAAsB,CAAtB;AACD;AAEF;AAED;;;;;;iBAGA,uBAAW;;;AACT,gBAAG1N,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,KAAoC,YAAK7B,mBAAL,MAAwB,IAAxB,IAAwBnK,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEK,WAAF,EAAxB,MAA4C,OAAnF,EAA2F;AACzF,mBAAK6J,kBAAL,CAAwB,KAAKF,QAA7B;AACD;;AACD,gBAAGhI,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,KAAmC,YAAK5B,MAAL,CAAYhD,aAAZ,MAAyB,IAAzB,IAAyBlH,aAAzB,GAAyB,MAAzB,GAAyBA,GAAEG,WAAF,EAAzB,MAA6C,gBAAnF,EAAoG;AAClG,mBAAK4L,YAAL;AACD;AACF;AAED;;;;;;iBAGA,uBAAW;AACT,iBAAKtN,cAAL,CAAoBiC,QAApB,CAA6B,aAA7B,EAA4C,CAAE,yBAAF,EAA6B,eAA7B,CAA5C;AACA,iBAAKhC,aAAL,CAAmB4I,WAAnB,CAA+BmI,WAA/B;;AAEA,gBAAG3N,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,CAAH,EAAmC;AACjC,mBAAKpN,aAAL,CAAmBuP,UAAnB,GAAgC,KAAhC;AACD;AACF;;;;;;;yBArcUpH,wBAAqB3I;AAAA;;;cAArB2I;AAAqBhE;AAAA6D;AAAA;;;;;;;;;;;;;;;;;;AD3BlCxI;;AA4BAA;;;;AA5BMA;;AA4BYA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AE1BVwR;;AACqCA;AAAAA;;AAAA;;AAAA;AAAA;;AACsDA;;;;;;AAF/EA,iGAAqB,YAArB,EAAqBC,8BAArB,EAAqB,SAArB,EAAqBA,uBAArB,EAAqB,cAArB,EAAqBA,sBAArB,EAAqB,QAArB,EAAqBA,kBAArB,EAAqB,cAArB,EAAqBA,yBAArB,EAAqB,YAArB,EAAqBA,mBAArB;;;;;;AADhBD;;AACIA;;AAGJA;;;;;;AAFsEA;;AAAAA;;;;;;AAItEA;;AACIA;;AACIA;;AACAA;;AACIA;;;;AACJA;;AAEJA;;AACAA;;AACIA;;AACAA;;AACAA;;AACAA;;AACJA;;AACJA;;;;AAVYA;;AAAAA;;;;;;AAYZA;;AACIA;;AACIA;;AACIA;;AACJA;;AACJA;;AACJA;;;;;;AAHiBA;;AAAAA;;;;;;;;AAKjBA;;AAAqEA;AAAAA;;AAAA;;AAAA;AAAA,aAA0C,cAA1C,EAA0C;AAAAA;;AAAA;;AAAA;AAAA,WAA1C,EAA0C,kBAA1C,EAA0C;AAAAA;;AAAA;;AAAA;AAAA,WAA1C,EAA0C,aAA1C,EAA0C;AAAAA;;AAAA;;AAAA;AAAA,WAA1C;;AAM2CA;;;;;;AAN3FA,kIAA+C,+BAA/C,EAA+CE,oCAA/C,EAA+C,qBAA/C,EAA+CA,wBAA/C,EAA+C,eAA/C,EAA+CA,aAA/C,EAA+C,cAA/C,EAA+CA,uBAA/C,EAA+C,kBAA/C,EAA+C,IAA/C,EAA+C,kBAA/C,EAA+CA,uBAA/C,EAA+C,QAA/C,EAA+CA,mBAA/C,EAA+C,cAA/C,EAA+CA,mBAA/C,EAA+C,YAA/C,EAA+C,QAA/C;;;;;;;;AAOrBF;;AAGIA;AAAAA;;AAAA;;AAAA;AAAA;;AAAiCA;;;;;;AAHOA,6GAAiC,kBAAjC,EAAiCG,4BAAjC,EAAiC,YAAjC,EAAiCA,+CAAjC,EAAiC,OAAjC,EAAiCA,uBAAjC,EAAiC,gBAAjC,EAAiCA,kCAAjC;;;;;;;;;;;;AAtChDH;;AACIA;;AAMAA;;AAgBAA;;AAQAA;;AAOAA;;AAIJA;;;;;;AA1C2BA;;AACRA;;AAAAA;;AAMOA;;AAAAA;;AAgBhBA;;AAAAA;;AAYDA;;AAAAA;;AAGaA;;AAAAA;;;;;;AAKtBA;;;;ACzBA,UAAMvR,YAAY,GAA0B;AAC1CC,aAAK,EAAE,mBADmC;AAE1CC,YAAI,EAAE,CAFoC;AAG1CC,mBAAW,EAAE,mBAH6B;AAI1CC,gBAAQ,EAAE;AAJgC,OAA5C;;UAYauR;AA0GX;;;;AAIA,qCAAoBhJ,EAApB,EAAmDpI,aAAnD,EACUC,KADV,EAEUG,MAFV,EAEkCD,WAFlC,EAGUJ,cAHV,EAIUM,iBAJV,EAKUgI,cALV,EAMU/H,eANV,EAMgD;AAAA;;AAN5B;AAA+B;AACzC;AACA;AAAwB;AACxB;AACA;AACA;AACA;AAnHD,8BAAsCb,YAAtC;AACC,mCAAqE,IAAIuR,wDAAJ,EAArE;AAEH,kCAAsC,EAAtC;AACA,+BAAyB,KAAzB;AACA,kCAA4B,KAA5B;AACA,mCAA6B,KAA7B;AACA,4BAAa,EAAb;AACA,wBAAiB,GAAjB;AAEA,2BAAoB,EAApB;AAMA,uCAAgC,CAAhC;AACA,6BAAuB,IAAvB;AACA,+CAAgC,KAAhC;AAMA,+BAAgB,KAAhB;AACC,6BAAmB,EAAnB;AACA,4BAAa,EAAb;AACD,8BAAuB,KAAvB;AACC,0BAAmB,EAAnB;AACD,+CAAgC,EAAhC;AACC,qCAAsB,EAAtB;AAUD,+BAAmC,EAAnC;AACA,8BAAwB,KAAxB;AACA,wBAAsB;AAC3BzI,gBAAI,EAAE,sBADqB;AAE3B5H,gBAAI,EAAE,WAFqB;AAG3BV,iBAAK,EAAE,SAHoB;AAI3BsB,kBAAM,EAAE,cAJmB;AAK3BqB,kBAAM,EAAE,EALmB;AAM3B4F,yBAAa,EAAE,EANY;AAO3B6I,sBAAU,EAAE,IAPe;AAQ3BC,4BAAgB,EAAE;AARS,WAAtB;AAWP,+BAAyB,KAAzB;;AA+DE,cAAItR,aAAa,CAACyI,QAAd,CAAuBC,MAA3B,EAAmC;AACjC1I,yBAAa,CAACyI,QAAd,GAAyB,IAAI8I,kDAAJ,CAA4B,IAA5B,CAAzB;AACD;;AACDvR,uBAAa,CAACyI,QAAd,CAAuB1F,IAAvB,CAA4B,QAA5B;;AAEA,cAAI,KAAK/C,aAAL,CAAmB4I,WAAnB,CAA+BF,MAAnC,EAA2C;AACzC,iBAAK1I,aAAL,CAAmB4I,WAAnB,GAAiC,IAAI2I,kDAAJ,CAA6B,IAA7B,CAAjC;AACD;AACF;AApED;;;;;;;iBAGA,oBAAWpI,MAAX,EAAoC;AAClC,iBAAKqI,kBAAL,GAA0B,CAACrI,MAAM,CAACsI,IAAlC;AACD;AAED;;;;;;eAGA,eAAoB;AAClB,gBAAIrO,QAAQ,CAACC,IAAT,CAAc+C,OAAd,CAAsB,QAAtB,MAAoC,CAAC,CAAzC,EAA4C;AAC1C,qBAAO,IAAP;AACD;;AAED,gBAAI,KAAKsL,UAAL,KAAoB,QAAxB,EAAkC;AAChC,qBAAO,IAAP;AACD;;AAED,mBAAO,KAAKC,WAAL,CAAiBzI,MAAjB,CAAwB,UAAC0I,CAAD,EAAM;AACnC,qBAAOA,CAAC,CAACC,iBAAF,KAAwB,MAAxB,IAAkCD,CAAC,CAACC,iBAAF,KAAwB,OAAjE;AACD,aAFM,EAEJlP,MAFI,GAEK,CAFZ;AAGD;AAED;;;;;;iBAGA,gCAAoB;AAAA;;;;AAClB,iBAAK3C,aAAL,CAAmBoC,WAAnB;;AACA,gBAAI,YAAKoN,UAAL,MAAe,IAAf,IAAepO,aAAf,GAAe,MAAf,GAAeA,GAAEK,WAAF,EAAf,MAAmC,iBAAnC,IAAwD,YAAK+N,UAAL,MAAe,IAAf,IAAelO,aAAf,GAAe,MAAf,GAAeA,GAAEG,WAAF,EAAf,MAAmC,cAA/F,EAA+G;AAC7G,mBAAKnB,eAAL,CAAqB2C,cAArB,CAAoC,KAAKL,MAAzC,EAAiD,KAAKF,YAAtD,EAAoE,KAAKF,SAAzE,EAAoF,KAAKmI,QAAzF,EAAmG7H,SAAnG,CAA6G;AAC3GC,oBAAI,EAAE,cAACC,IAAD,EAAc;;;AAClB,sBAAIA,IAAJ,EAAU;AACR,wBAAI,UAAI,SAAJ,QAAI,WAAJ,GAAI,MAAJ,OAAI,CAAEE,IAAN,MAAU,IAAV,IAAU9B,aAAV,GAAU,MAAV,GAAUA,GAAE+B,GAAhB,EAAqB;AACnBC,8BAAQ,CAACC,IAAT,GAAgBL,IAAI,CAACE,IAAL,CAAUC,GAA1B;AACAG,oCAAc,CAACC,OAAf,CAAuB,QAAvB,EAAiC,GAAjC;AACD;AACF;AACF,iBAR0G;AAS3GC,wBAAQ,EAAE,oBAAK;AACb,yBAAI,CAACxD,aAAL,CAAmByD,WAAnB;AACD;AAX0G,eAA7G;AAaD,aAdD,MAcO;AACL,mBAAKrD,MAAL,CAAYuD,QAAZ,CAAqB,uBAAiB,KAAKf,MAAtB,eAArB;AACD;AAEF;AAuBD;;;;;;iBAGA,6BAAoBuG,MAApB,EAA0B;AACxB,iBAAKpJ,cAAL,CAAoBiC,QAApB,CAA6B,qBAA7B,EAAoD,CAAE,uBAAF,EAA2B,eAA3B,EAA4C;AAC9FY,oBAAM,EAAEuG;AADsF,aAA5C,CAApD;;AAGA,gBAAIA,MAAM,CAAC2I,OAAX,EAAoB;AAClB,mBAAKC,cAAL;AACA;AACD;;AACD,iBAAKC,aAAL,GAAqB,IAArB,CARwB,CAUxB;AACA;AAEA;AACA;AACA;AACA;AACA;;AACA,iBAAKC,oBAAL,CAA0B9I,MAAM,CAAC+I,KAAjC;AACD;AAED;;;;;;iBAGA,2BAAe;AACb,iBAAKH,cAAL;AACD;AAED;;;;;;iBAGA,2BAAe;AACb,iBAAK/R,aAAL,CAAmB6I,UAAnB,CAA8B,eAA9B,EAA+C,QAA/C;AACA,iBAAKT,EAAL,CAAQU,aAAR;AACA,iBAAK/I,cAAL,CAAoBiC,QAApB,CAA6B,iBAA7B,EAAgD,CAAE,uBAAF,EAA2B,eAA3B,CAAhD;AACD;AAED;;;;;;;iBAIA,8BAAqBmQ,OAArB,EAA+C;AAAA;;AAAA,4CACH;AAExC,kBAAMC,GAAG,GAAG,IAAIC,KAAJ,EAAZ;AACAD,iBAAG,CAACE,GAAJ,GAAUH,OAAO,CAACtI,CAAD,CAAP,CAAWlC,KAArB;;AACAyK,iBAAG,CAACG,MAAJ,GAAa,YAAW;AACtB,oBAAMC,YAAY,GAAG;AACnB,4BAAUJ,GAAG,CAACK,MADK;AAEnB,2BAASL,GAAG,CAACM,KAFM;AAGnB,kCAAgB,OAAI,CAAChQ,YAHF;AAInB,gCAAc,OAAI,CAACiQ,oBAJA;AAKnB,0BAAQ,OAAI,CAACC,WAAL,IAAoB,EALT;AAMnB,4BAAU;AANS,iBAArB;AAQA,oBAAMjT,IAAI,GAAGwS,OAAO,CAACtI,CAAD,CAApB;AACAlK,oBAAI,CAAC4M,gBAAL,GAAwB,IAAxB;AACA5M,oBAAI,CAAC6M,SAAL,GAAiB,KAAjB;AACA7M,oBAAI,CAAC8M,cAAL,GAAsB,KAAtB;AACA9M,oBAAI,CAAC+M,eAAL,GAAuB,KAAvB;;AACA,uBAAI,CAAC3M,cAAL,CAAoBiC,QAApB,CAA6B,sBAA7B,EAAqD,CAAE,uBAAF,EAA2B,eAA3B,EAA4C;AAC/FwQ,8BAAY,EAAZA;AAD+F,iBAA5C,CAArD;;AAGA,uBAAI,CAACnS,iBAAL,CAAuBwS,eAAvB,CAAuCL,YAAvC,EAAqD7S,IAAI,CAACmN,SAA1D,EAAqEhK,SAArE,CAA+E;AAC7EC,sBAAI,EAAE,cAACG,IAAD,EAAc;;;AAClBvD,wBAAI,CAACwD,GAAL,GAAW,UAAI,CAAC2P,QAAL,MAAa,IAAb,IAAa1R,aAAb,GAAa,MAAb,GAAaA,GAAE2R,eAA1B;AACApT,wBAAI,CAACqT,cAAL,GAAsB9P,IAAtB;AACAvD,wBAAI,CAACsT,cAAL,GAAsB,mBAAtB;;AACA,2BAAI,CAAC3F,cAAL,CAAoBC,kBAApB,CAAuC,SAAvC,EAAkD5N,IAAlD,EAAwD,IAAxD,EAA8DuD,IAA9D;;AACA,2BAAI,CAACsI,MAAL,GAAWtJ,gCAAQ,OAAI,CAACsJ,MAAb,GAAmB;AAAE8F,sCAAgB,EAAE;AAApB,qBAAnB,CAAX;;AACA,wBAAIlO,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,MAAqC,cAAI,CAAC7B,mBAAL,MAAwB,IAAxB,IAAwBjK,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEG,WAAF,EAAxB,MAA4C,OAA5C,IAAuD,cAAI,CAAC8J,mBAAL,MAAwB,IAAxB,IAAwB/J,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEC,WAAF,EAAxB,MAA4C,iBAAxI,CAAJ,EAAgK;AAC9J,6BAAI,CAAC6J,kBAAL,CAAwB,OAAI,CAACF,QAA7B;AACD;;AACD,wBAAIhI,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,KAAoC,cAAI,CAAC5B,MAAL,CAAYhD,aAAZ,MAAyB,IAAzB,IAAyB9G,aAAzB,GAAyB,MAAzB,GAAyBA,GAAED,WAAF,EAAzB,MAA6C,iBAArF,EAAyG;AACvG,6BAAI,CAAC4L,YAAL;AACD;AACF,mBAb4E;AAc7E3J,uBAAK,EAAE,eAACoI,GAAD,EAAa;AAClB,wBAAIA,GAAG,CAACvK,MAAJ,IAAc,GAAlB,EAAuB;AACrB,6BAAI,CAAC+L,cAAL,CAAoBrE,gBAApB,GAAuC,OAAI,CAACqE,cAAL,CAAoBrE,gBAApB,CAAqCC,MAArC,CAA4C,UAACgK,EAAD,EAAwB;AACzG,+BAAQA,EAAE,CAAC/I,KAAH,KAAaxK,IAAI,CAACwK,KAAlB,IAA2B+I,EAAE,CAACrT,QAAH,KAAgBF,IAAI,CAACE,QAAhD,IAA4DqT,EAAE,CAAC3G,gBAAH,KAAwB,IAA5F;AACD,uBAFsC,CAAvC;;AAGA,6BAAI,CAACe,cAAL,CAAoBC,kBAApB,CAAuC,QAAvC,EAAiD5N,IAAjD,EAAuDmM,GAAvD,EAA4D,IAA5D,EAAkE,IAAlE;AACD;;AACD,2BAAI,CAAC/L,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCqH,oFAAtC;AACD;AAtB4E,iBAA/E;AAwBD,eAzCD;AA2CD,aAhD4C;;AAC7C,iBAAK,IAAItJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAGsI,OAAO,SAAP,WAAO,WAAP,GAAO,MAAP,UAAO,CAAExP,MAAZ,CAAjB,EAAqCkH,CAAC,EAAtC;AAAA;AAAA;AAiDD;AAGD;;;;;;iBAGA,4BAAmBuB,QAAnB,EAAmC;AAAA;;AACjC,gBAAG,CAAC,KAAKC,aAAT,EAAwB;AACtB,mBAAKA,aAAL,GAAqB,IAArB;AACA,mBAAKhD,cAAL,CAAoBiD,kBAApB,CAAuC,cAAvC,EAAuDF,QAAvD,EAAiE,EAAjE,EAAqEtI,SAArE,CAA+E;AAC7EC,oBAAI,EAAE,gBAAK;AACT,yBAAI,CAACwI,mBAAL,GAA2B,cAA3B;AACA,yBAAI,CAACC,MAAL,CAAYhD,aAAZ,GAA4B,OAAI,CAAC+C,mBAAjC;;AACA,yBAAI,CAACvL,aAAL,CAAmBoC,WAAnB;;AACA,yBAAI,CAACiG,cAAL,CAAoBoD,qBAApB,CAA0C,OAAI,CAACL,QAA/C,EAAyDtI,SAAzD,CAAmE;AACjEC,wBAAI,EAAE,cAAO2I,MAAP;AAAA,6BAAuB;AAAA;AAAA;AAAA;AAC3B,kCAAIA,MAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAExI,IAAZ,EAAkB;AAChB,qCAAKlD,aAAL,CAAmB2L,aAAnB,CAAiC5I,IAAjC,CAAsC2I,MAAM,CAACxI,IAA7C;AACA,qCAAKlD,aAAL,CAAmB4L,SAAnB,CAA6B7I,IAA7B,CAAkC2I,MAAM,CAACxI,IAAP,CAAY2I,YAA9C;AACA,qCAAK7L,aAAL,CAAmByD,WAAnB;AACD;;AAL0B;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAvB;AAAA,qBAD2D;AAQjEC,yBAAK,EAAE,eAACoI,GAAD,EAAa;AAClB,6BAAI,CAAC/L,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCqH,oFAAtC;;AACA,6BAAI,CAACnT,aAAL,CAAmByD,WAAnB;AACD;AAXgE,mBAAnE;AAaD;AAlB4E,eAA/E;AAoBD;AAEF;AAED;;;;;;iBAGA,oBAAWwI,WAAX,EAAuC;AAAA;;AACrC,gBAAMuG,YAAY,GAAG;AACnB,wBAAUvG,WAAW,CAACmH,WADH;AAEnB,uBAASnH,WAAW,CAACoH,UAFF;AAGnB,8BAAgB,KAAK3Q,YAHF;AAInB,4BAAc,KAAKiQ,oBAJA;AAKnB,kCAAoB1G,WAAW,CAAC+G,cAAZ,CAA2B5E,EAL5B;AAMnB,sBAAQ,KAAKwE,WAAL,IAAoB,EANT;AAOnB,wBAAU;AAPS,aAArB;AAUA,iBAAK7S,cAAL,CAAoBiC,QAApB,CAA6B,YAA7B,EAA2C,CAAE,uBAAF,EAA2B,eAA3B,EAA4C;AACrFwQ,0BAAY,EAAZA;AADqF,aAA5C,CAA3C;AAIAvG,uBAAW,CAACM,gBAAZ,GAA+B,IAA/B;AACAN,uBAAW,CAACO,SAAZ,GAAwB,KAAxB;AACAP,uBAAW,CAACQ,cAAZ,GAA6B,KAA7B;AACAR,uBAAW,CAACS,eAAZ,GAA8B,KAA9B;AACA,iBAAK1M,aAAL,CAAmBsT,eAAnB,CAAmCvQ,IAAnC,CAAwC,CAAxC;AACA,iBAAKyI,MAAL,GAAWtJ,gCAAQ,KAAKsJ,MAAb,GAAmB;AAAE8F,8BAAgB,EAAE;AAApB,aAAnB,CAAX;AACA,iBAAKtR,aAAL,CAAmB4M,gBAAnB,4BAAmDX,WAAW,CAACpM,QAA/D;AAEA,iBAAKQ,iBAAL,CAAuBwS,eAAvB,CAAuCL,YAAvC,EAAqDvG,WAAW,CAACa,SAAjE,EAA4EhK,SAA5E,CAAsF;AACpFC,kBAAI,EAAE,cAACG,IAAD,EAAc;;;AAClB,oBAAMqQ,GAAG,8BAAkBtH,WAAW,CAACpM,QAA9B,qCAAT;;AACA,uBAAI,CAACG,aAAL,CAAmB4M,gBAAnB,CAAoC2G,GAApC;;AACA,oBAAMP,cAAc,GAAG,aAAI,CAACQ,uBAAL,MAA4B,IAA5B,IAA4BpS,aAA5B,GAA4B,MAA5B,GAA4BA,GAAE8L,IAAF,CAAO,UAACC,CAAD;AAAA,yBAAYA,CAAC,CAAC6F,cAAF,CAAiB5E,EAAjB,KAAuBlL,IAAI,SAAJ,QAAI,WAAJ,GAAI,MAAJ,OAAI,CAAEkL,EAA7B,CAAZ;AAAA,iBAAP,CAAnD;AACA4E,8BAAc,CAACA,cAAf,CAA8BD,eAA9B,GAAgD,UAAI,CAACD,QAAL,MAAa,IAAb,IAAaxR,aAAb,GAAa,MAAb,GAAaA,GAAEyR,eAA/D;;AACA,oBAAIC,cAAJ,EAAoB;AAClB/G,6BAAW,CAAC9I,GAAZ,GAAkB,UAAI,CAAC2P,QAAL,MAAa,IAAb,IAAatR,aAAb,GAAa,MAAb,GAAaA,GAAEuR,eAAjC;;AACA,yBAAI,CAACzF,cAAL,CAAoBC,kBAApB,CAAuC,SAAvC,EAAkDtB,WAAlD,EAA+D,IAA/D,EAAqE/I,IAArE;AACD;;AACD,oBAAIE,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,MAAqC,OAAI,CAAC7B,mBAAL,IAA4B,OAA5B,IAAuC,OAAI,CAACA,mBAAL,KAA6B,iBAAzG,CAAJ,EAAiI;AAC/H,yBAAI,CAACD,kBAAL,CAAwB,OAAI,CAACF,QAA7B;AACD;;AACD,oBAAIhI,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,KAAoC,cAAI,CAAC5B,MAAL,CAAYhD,aAAZ,MAAyB,IAAzB,IAAyB9G,aAAzB,GAAyB,MAAzB,GAAyBA,GAAED,WAAF,EAAzB,MAA6C,iBAArF,EAAyG;AACvG,yBAAI,CAAC4L,YAAL;AACD;AACF,eAhBmF;AAiBpF3J,mBAAK,EAAE,eAACoI,GAAD,EAAa;AAClB,oBAAIA,GAAG,CAACvK,MAAJ,IAAc,GAAlB,EAAuB;AACrB,sBAAMgS,GAAG,8BAAkBtH,WAAW,CAACpM,QAA9B,yDAAT;;AACA,yBAAI,CAACG,aAAL,CAAmB4M,gBAAnB,CAAoC2G,GAApC;;AACA,yBAAI,CAACjG,cAAL,CAAoBC,kBAApB,CAAuC,QAAvC,EAAiDtB,WAAjD,EAA8DH,GAA9D;;AACA,yBAAI,CAAC/L,cAAL,CAAoBgM,YAApB,CAAiCD,GAAjC,EAAsCqH,oFAAtC;AACD;AACF;AAxBmF,aAAtF;AA0BD;AAED;;;;;;iBAGA,uBAAW;AACT,iBAAKnT,aAAL,CAAmByI,QAAnB,CAA4BsI,WAA5B;AACA,iBAAK/Q,aAAL,CAAmB4I,WAAnB,CAA+BmI,WAA/B;;AACA,gBAAG3N,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,CAAH,EAAmC;AACjC,mBAAKpN,aAAL,CAAmBuP,UAAnB,GAAgC,KAAhC;AACD;;AACD,iBAAKxP,cAAL,CAAoBiC,QAApB,CAA6B,aAA7B,EAA4C,CAAE,uBAAF,EAA2B,eAA3B,CAA5C;AACD;AAED;;;;;;eAGA,eAAsB;;;AACpB,mBAAO,YAAKyR,yBAAL,MAA8B,IAA9B,IAA8BrS,aAA9B,GAA8B,MAA9B,GAA8BA,GAAEsS,aAAhC,MAAkD,CAAlD,IAAuD,YAAKF,uBAAL,MAA4B,IAA5B,IAA4BlS,aAA5B,GAA4B,MAA5B,GAA4BA,GAAE4H,MAAF,CAAS,UAACyK,KAAD,EAA6B;AAC9H,qBAAOA,KAAK,CAACC,aAAN,KAAwB,IAA/B;AACD,aAFyF,EAEvFjR,MAF2D,MAEhD,CAFd;AAGD;AAED;;;;;;;iBAIA,uBAAckR,cAAd,EAAiC;AAAA;;;;AAC/B,gBAAIA,cAAJ,EAAoB;AAClB,kBAAI;AACF,qBAAKC,UAAL,GAAkBD,cAAlB;AACA,qBAAKE,UAAL,GAAkB,KAAKD,UAAL,CAAgBC,UAAlC;AACA,oBAAIC,WAAW,GAAG,KAAlB;;AACA,oBAAI,KAAKD,UAAT,EAAqB;AACnB,uBAAKvI,MAAL,GAAWtJ,gCAAQ,KAAKsJ,MAAb,GAAmB;AAAE8F,oCAAgB,EAAE;AAApB,mBAAnB,CAAX;AACD;;AACD,oBAAI,KAAKyC,UAAL,KAAoB,MAAxB,EAAgC;AAC9BC,6BAAW,GAAG,MAAd;AACD;;AACD,oBAAMC,sBAAsB,GAAG,WAAKC,mBAAL,MAAwB,IAAxB,IAAwB9S,aAAxB,GAAwB,MAAxB,GAAwBA,GAAE8H,MAAF,CAAS,cAAI;AAAA,yBAAIvJ,IAAI,CAACyH,IAAL,KAAc,mBAAlB;AAAA,iBAAb,CAAvD;AACA,oBAAM+M,2BAA2B,GAAG,WAAKL,UAAL,CAAgBM,eAAhB,MAA+B,IAA/B,IAA+B9S,aAA/B,GAA+B,MAA/B,GAA+BA,GAAE4H,MAAF,CAAS,UAACvJ,IAAD,EAAS;AACnF,yBAAO,CAACA,IAAI,CAACyH,IAAL,KAAc,mBAAd,IAAqCzH,IAAI,CAAC0U,wBAAL,KAAkCJ,sBAAsB,CAAC,CAAD,CAAtB,CAA0B7F,EAAlG,KACAzO,IAAI,CAACoT,eADZ;AAED,iBAHkE,CAAnE;;AAIA,oBAAI,4BAA2B,SAA3B,+BAA2B,WAA3B,GAA2B,MAA3B,8BAA2B,CAAEpQ,MAA7B,IAAsC,CAAtC,IAA2C,KAAKoR,UAAL,KAAoB,MAAnE,EAA2E;AACzE,sBAAMO,eAAe,GAAG,EAAxB;AACA,uBAAKC,iBAAL,CAAuBrT,IAAvB,CAA4B;AAAE,4BAAQ;AAAV,mBAA5B;;AACA,uBAAK,IAAM2I,CAAX,IAAgBsK,2BAAhB,EAA6C;AAC3C,wBAAMK,UAAU,mCACXP,sBAAsB,CAAC,CAAD,CADX,GACc;AAAE7M,0BAAI,EAAE+M,2BAA2B,CAACtK,CAAD,CAA3B,CAA+BzC,IAA/B,IAAuC6M,sBAAsB,CAAC,CAAD,CAAtB,CAA0B7M,IAAzE;AAC5B4L,oCAAc,EAAEmB,2BAA2B,CAACtK,CAAD;AADf,qBADd,CAAhB;AAIAyK,mCAAe,CAAC5M,IAAhB,CAAqB8M,UAArB;AACD;;AACD,uBAAKhB,uBAAL,GAA+Bc,eAA/B;AACD,iBAXD,MAWO;AAEL,uBAAKC,iBAAL,CAAuBrT,IAAvB,CAA4B;AAAE,4BAAQ;AAAV,mBAA5B;AACA,6BAAKgT,mBAAL,MAAwB,IAAxB,IAAwB1S,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEiT,GAAF,CAAM,UAACC,iBAAD,EAAyC;;;AACrE,wBAAMC,IAAI,GAAG,aAAI,CAACb,UAAL,CAAgBM,eAAhB,MAA+B,IAA/B,IAA+BhT,aAA/B,GAA+B,MAA/B,GAA+BA,GAAE8L,IAAF,CAAO,UAAC0H,EAAD;AAAA,6BAAaA,EAAE,CAACP,wBAAH,IAA+BK,iBAAiB,CAACtG,EAA9D;AAAA,qBAAP,CAA5C;;AACA,wBAAIuG,IAAJ,EAAU;AACRD,uCAAiB,CAAC,gBAAD,CAAjB,GAAsCC,IAAtC;AACD;AACF,mBALuB,CAAxB;AAMA,uBAAKnB,uBAAL,GAA+B,WAAKU,mBAAL,MAAwB,IAAxB,IAAwBxS,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEwH,MAAF,CAAS,cAAI;AAAA,2BAAIvJ,IAAI,CAACyH,IAAL,IAAa,mBAAjB;AAAA,mBAAb,CAAvD;AACD;;AACD,oBAAG,uBAAsB,SAAtB,0BAAsB,WAAtB,GAAsB,MAAtB,yBAAsB,CAAEzE,MAAxB,IAAiC,CAApC,EAAuC,KAAKgQ,oBAAL,GAA4BsB,sBAAsB,CAAC,CAAD,CAAtB,CAA0B7F,EAAtD;AAEvC,2BAAKoF,uBAAL,MAA4B,IAA5B,IAA4B7R,aAA5B,GAA4B,MAA5B,GAA4BA,GAAE8S,GAAF,CAAM,UAACtH,CAAD,EAAyB;;;AACzD,sBAAI,OAAC,CAAC6F,cAAF,MAAgB,IAAhB,IAAgB5R,aAAhB,GAAgB,MAAhB,GAAgBA,GAAE2R,eAAtB,EAAuC;AACrC5F,qBAAC,CAACT,eAAF,GAAoB,IAApB;AACAS,qBAAC,CAACxF,KAAF,GAAU,OAAC,CAACqL,cAAF,MAAgB,IAAhB,IAAgB1R,aAAhB,GAAgB,MAAhB,GAAgBA,GAAEyR,eAA5B;AACD,mBAHD,MAGO;AACL,wBAAI,CAAC5F,CAAC,CAAC6F,cAAP,EAAuB;AACrB7F,uBAAC,CAAC6F,cAAF,GAAmB;AAAED,uCAAe,EAAE;AAAnB,uBAAnB;AACD;;AACD5F,qBAAC,CAAC6F,cAAF,CAAiBD,eAAjB,GAAmC,EAAnC;AACA5F,qBAAC,CAACV,cAAF,GAAmB,KAAnB;AACAU,qBAAC,CAACT,eAAF,GAAoB,KAApB;AACAS,qBAAC,CAACZ,gBAAF,GAAqB,KAArB;AACD;AACF,iBAb2B,CAA5B;;AAcA,oBAAI,KAAKwH,UAAT,EAAqB;AACnB,sBAAIC,WAAW,KAAK,KAApB,EAA2B;AACzB,yBAAKa,gBAAL,GAAwB,KAAxB;AACA,yBAAK7C,aAAL,GAAqB,IAArB;;AACA,wBAAI,KAAK8C,eAAL,CAAqBC,cAAzB,EAAyC;AACvC,2BAAKtV,YAAL,GAAiByC,gCAAQ,KAAKzC,YAAb,GAAyB;AAAEC,6BAAK,EAAE;AAAT,uBAAzB,CAAjB;AACD;;AACD,yBAAKsV,qBAAL,GAA6B,WAAKxB,uBAAL,MAA4B,IAA5B,IAA4B3R,aAA5B,GAA4B,MAA5B,GAA4BA,GAAEqH,MAAF,CAAS,UAACyK,KAAD,EAA6B;AAC7F,6BAAOA,KAAK,CAACC,aAAN,KAAwB,IAA/B;AACD,qBAFwD,EAEtDjR,MAFH;AAGA,yBAAK2G,iBAAL,GAAyB,KAAKE,UAAL,CAAgB1I,IAAhB,CAAqB,IAArB,CAAzB;AACD,mBAVD,MAUO;AACL,yBAAKwI,iBAAL,GAAyB,KAAK2I,oBAAL,CAA0BnR,IAA1B,CAA+B,IAA/B,CAAzB;AACA,yBAAK+T,gBAAL,GAAwB,IAAxB;AACA,yBAAKG,qBAAL,GAA6B,KAAKvB,yBAAL,CAA+BC,aAA5D;AACA,yBAAKuB,iBAAL,GAAyB,IAAzB;AACA,yBAAKC,cAAL,GAAsB,IAAtB;;AACA,wBAAI,KAAKJ,eAAL,CAAqBC,cAAzB,EAAyC;AACvC,2BAAKtV,YAAL,GAAiByC,gCAAQ,KAAKzC,YAAb,GAAyB;AAAEC,6BAAK,EAAE;AAAT,uBAAzB,CAAjB;AACD;AACF;AACF;AACF,eA3ED,CA2EE,OAAOgE,KAAP,EAAmB;AACnBwK,uBAAO,CAACC,GAAR,CAAYzK,KAAZ;AACD;AACF;AACF;AAED;;;;;;iBAGA,yCAA6B;;;AAC3B,iBAAK,IAAImG,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAG,WAAK2J,uBAAL,MAA4B,IAA5B,IAA4BpS,aAA5B,GAA4B,MAA5B,GAA4BA,GAAEuB,MAAjC,CAAjB,EAA0DkH,CAAC,EAA3D,EAA+D;AAC7D,kBAAMsL,YAAY,GAAG,KAAK3B,uBAAL,CAA6B3J,CAA7B,CAArB;AACA,kBAAMuL,cAAc,GAAG,kJAAyBD,YAAzB,EAAuCtL,CAAvC,CAAvB;AACA,kBAAMG,iBAAiB,GAAG,qBAAc,CAACnK,QAAf,MAAuB,IAAvB,IAAuByB,aAAvB,GAAuB,MAAvB,GAAuBA,GAAEG,WAAF,GAAgB2E,OAAhB,CAAwB,kBAAxB,CAAvB,KAAsE,CAAC,CAAjG;AACA,kBAAMiP,YAAY,GAAG,qBAAc,CAACxV,QAAf,MAAuB,IAAvB,IAAuB2B,aAAvB,GAAuB,MAAvB,GAAuBA,GAAEC,WAAF,GAAgB2E,OAAhB,CAAwB,mBAAxB,CAAvB,KAAuE,CAAC,CAA7F;AACA,kBAAM6D,sCAAsC,GAAGD,iBAAiB,IAAI,CAACoL,cAAc,CAACjS,GAApF;AACA,mBAAK8F,gBAAL,CAAsBvB,IAAtB,CAA0BxF,gCACrBkT,cADqB,GACP;AAAElL,yBAAS,EAAE,CAACiL,YAAY,CAACvB,aAA3B;AAA0CzJ,qBAAK,EAAEN,CAAjD;AACjBI,sDAAsC,EAAtCA,sCADiB;AAEjBoL,4BAAY,EAAZA,YAFiB;AAGjB9K,2BAAW,EAAE6K,cAAc,CAACjS,GAAf,GAAqB,kBAAY,SAAZ,gBAAY,WAAZ,GAAY,MAAZ,eAAY,CAAE6P,cAAd,MAA4B,IAA5B,IAA4BtR,aAA5B,GAA4B,MAA5B,GAA4BA,GAAE6I,WAAnD,GAAiE,EAH7D;AAIjBE,4BAAY,EAAE2K,cAAc,CAACjS,GAAf,GAAqB,kBAAY,SAAZ,gBAAY,WAAZ,GAAY,MAAZ,eAAY,CAAE6P,cAAd,MAA4B,IAA5B,IAA4BrR,aAA5B,GAA4B,MAA5B,GAA4BA,GAAE2T,OAAnD,GAA6D,EAJ1D;AAKjB3K,wBAAQ,EAAE,KAAKA,QALE;AAKQC,wBAAQ,EAAE,KAAKA,QALvB;AAMjBvB,gCAAgB,EAAE,EAND;AAOjBD,4BAAY,EAAE;AAPG,eADO,CAA1B;AAUD;AACF;AAED;;;;;;iBAGA,wBAAY;AAAA;;AACV,gBAAG,CAAC,KAAKiC,aAAT,EAAwB;AACtB,mBAAKA,aAAL,GAAqB,IAArB;AACA,mBAAKtL,cAAL,CAAoBiC,QAApB,CAA6B,cAA7B,EAA6C,CAAE,uBAAF,EAA2B,eAA3B,CAA7C;AACA,mBAAK7B,WAAL,CAAiB0C,gBAAjB,CAAkC,KAAKD,MAAvC,EAA+C,cAA/C,EAA+DE,SAA/D,CAAyE;AACvEC,oBAAI,EAAE,gBAAK;AACT,yBAAI,CAACyI,MAAL,GAAWtJ,gCAAQ,OAAI,CAACsJ,MAAb,GAAmB;AAAEjK,0BAAM,EAAE;AAAV,mBAAnB,CAAX;AACA,yBAAI,CAACgU,iBAAL,CAAuBhU,MAAvB,GAAgC,cAAhC;AACD;AAJsE,eAAzE;AAMD;AACF;AAED;;;;;;iBAGA,uBAAW;;;AACT,gBAAI6B,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,MAAqC,YAAK7B,mBAAL,MAAwB,IAAxB,IAAwBnK,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEK,WAAF,EAAxB,MAA4C,OAA5C,IAAuD,YAAK8J,mBAAL,MAAwB,IAAxB,IAAwBjK,aAAxB,GAAwB,MAAxB,GAAwBA,GAAEG,WAAF,EAAxB,MAA4C,iBAAxI,CAAJ,EAAgK;AAC9J,mBAAK6J,kBAAL,CAAwB,KAAKF,QAA7B;AACD;;AACD,gBAAIhI,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,OAAvB,KAAoC,YAAK5B,MAAL,CAAYhD,aAAZ,MAAyB,IAAzB,IAAyBhH,aAAzB,GAAyB,MAAzB,GAAyBA,GAAEC,WAAF,EAAzB,MAA6C,iBAArF,EAAyG;AACvG,mBAAK4L,YAAL;AACD;AACF;AAED;;;;;;iBAGA,qBAAYe,EAAZ,EAAsB;AAAA;;AACpB,gBAAIA,EAAE,IAAIA,EAAE,IAAI,GAAhB,EAAqB;AACnB,mBAAKxL,MAAL,GAAcwL,EAAd;AACA,mBAAKxC,SAAL,GAAiBwC,EAAjB;AACA,mBAAKpO,aAAL,CAAmBoC,WAAnB;AACA,mBAAK/B,iBAAL,CAAuBmV,yBAAvB,GAAmD1S,SAAnD,CAA6D;AAC3DC,oBAAI,EAAE,cAAC0S,cAAD,EAAwB;AAC5B,sBAAI7G,QAAQ,GAAG,KAAf;AACA,sBAAI+D,oBAAoB,GAAG,CAA3B;;AACA,sBAAIvP,QAAQ,CAACC,IAAT,CAAc+J,QAAd,CAAuB,QAAvB,CAAJ,EAAsC;AACpCwB,4BAAQ,GAAG,IAAX;AACD;;AACD,sBAAM8G,wBAAwB,GAAGD,cAAc,SAAd,kBAAc,WAAd,GAAc,MAAd,iBAAc,CAAEvS,IAAjD;;AAEA,sBAAI,yBAAwB,SAAxB,4BAAwB,WAAxB,GAAwB,MAAxB,2BAAwB,CAAEP,MAA1B,IAAmC,CAAvC,EAA0C;AACxC,2BAAI,CAAC3C,aAAL,CAAmB0V,wBAAnB,GAA8CA,wBAAwB,CAAC,CAAD,CAAtE;AACA/C,wCAAoB,GAAG+C,wBAAwB,CAAC,CAAD,CAAxB,CAA4BtH,EAAnD;AACD;;AACD,sBAAMM,UAAU,GAAQ,EAAxB;AACAA,4BAAU,CAACiH,kBAAX,GAAgC,OAAI,CAACtV,iBAAL,CAAuBuV,qBAAvB,CAA6CjD,oBAA7C,CAAhC;;AACA,sBAAI/D,QAAJ,EAAc;AACZF,8BAAU,CAACG,aAAX,GAA2B,OAAI,CAACxG,cAAL,CAAoBoD,qBAApB,CAA0C2C,EAA1C,CAA3B;AAED,mBAHD,MAGO;AACL,2BAAI,CAACpO,aAAL,CAAmB8O,eAAnB,CAAmChM,SAAnC,CAA6C,UAACiK,GAAD,EAAQ;AACnD,0BAAIA,GAAG,IAAIA,GAAG,CAAC7J,IAAf,EAAqB;AACnB,4BAAQ6L,kBAAR,GAA+BhC,GAAG,CAAC7J,IAAnC,CAAQ6L,kBAAR;AACA,+BAAI,CAACC,YAAL,GAAoBD,kBAAkB,CAACX,EAAvC;AACD;AACF,qBALD;;AAMAM,8BAAU,CAACO,UAAX,GAAwB,OAAI,CAAC9O,WAAL,CAAiB+O,aAAjB,CAA+Bd,EAA/B,CAAxB;AACD;;AACD,sBAAMyH,aAAa,GAAG,iDAASnH,UAAT,EAAqBS,IAArB,CACpB,mDAAW,eAAK;AAAA,2BAAI,2CAAGzL,KAAH,CAAJ;AAAA,mBAAhB,CADoB,CAAtB;AAGAmS,+BAAa,CAAC/S,SAAd,CAAwB;AACtBC,wBAAI,EAAE,cAAC+S,SAAD,EAAmB;AACvB,0BAAIA,SAAS,CAACH,kBAAd,EAAkC;AAEhC,4BAAMI,wBAAwB,GAAGD,SAAS,CAACH,kBAAV,CAA6BnC,uBAA9D;AACA,+BAAI,CAACC,yBAAL,GAAiCqC,SAAS,CAACH,kBAA3C;;AACA,4BAAIG,SAAS,CAACE,gBAAd,EAAgC;AAC9B,iCAAI,CAACA,gBAAL,GAAwBF,SAAS,CAACE,gBAAlC;AACD;;AACD,+BAAI,CAAC9B,mBAAL,GAA2B6B,wBAA3B;AACA,+BAAI,CAACE,6BAAL,GAAqCC,IAAI,CAACC,SAAL,CAAe,OAAI,CAACjC,mBAApB,CAArC;;AACA,4BAAI4B,SAAS,CAAC7G,UAAd,EAA0B;AACxB,sDAAiH6G,SAAS,CAAC7G,UAAV,CAAqB/L,IAAtI;AAAA,8BAAQf,UAAR,yBAAQA,UAAR;AAAA,8BAAoBiM,IAApB,yBAAoBA,EAApB;AAAA,8BAAwB7M,MAAxB,yBAAwBA,MAAxB;AAAA,8BAAgC6U,QAAhC,yBAAgCA,QAAhC;AAAA,8BAA0C3T,QAA1C,yBAA0CA,QAA1C;AAAA,8BAAoDF,WAApD,yBAAoDA,WAApD;AAAA,8BAAiE8T,YAAjE,yBAAiEA,YAAjE;AAAA,8BAA+E7T,SAA/E,yBAA+EA,SAA/E;AAAA,8BAA0FuM,kBAA1F,yBAA0FA,kBAA1F;AACA,iCAAI,CAAC1M,QAAL,GAAgByT,SAAS,CAAC7G,UAAV,CAAqB/L,IAArC;AACA,iCAAI,CAACqS,iBAAL,GAAyBO,SAAS,CAAC7G,UAAV,CAAqB/L,IAA9C;;AAEA,8BAAI,OAAI,CAAC8L,YAAL,KAAqBD,kBAAkB,SAAlB,sBAAkB,WAAlB,GAAkB,MAAlB,qBAAkB,CAAEO,cAAzC,CAAJ,EAA6D;AAC3D,mCAAI,CAACtP,aAAL,CAAmBuP,UAAnB,GAAgC,IAAhC;AACD,2BAFD,MAEO;AACL,mCAAI,CAACvP,aAAL,CAAmBuP,UAAnB,GAAgC,KAAhC;AACD;;AAED,iCAAI,CAACqD,WAAL,GAAmByD,YAAnB;AACA,iCAAI,CAAC7T,SAAL,GAAiBA,SAAjB;AACA,iCAAI,CAACmI,QAAL,GAAgBlI,QAAhB;;AACA,iCAAI,CAACzC,aAAL,CAAmBwP,UAAnB,CAA8BzM,IAA9B,CAAmCxB,MAAnC;;AACA,iCAAI,CAACiO,UAAL,GAAkBjO,MAAlB;;AACA,8BAAI,OAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEE,WAAR,QAA0B,iBAA9B,EAAiD,CAC/C;AACD,2BAFD,MAEO;AACL,mCAAI,CAAC+J,MAAL,GAAWtJ,gCAAQ,OAAI,CAACsJ,MAAb,GAAmB;AAAEjK,oCAAM,EAAE,EAAV;AAAcqB,oCAAM,EAAEwL;AAAtB,6BAAnB,CAAX;AACD;;AACD,iCAAI,CAAC5C,MAAL,CAAYhD,aAAZ,GAA4BjH,MAA5B;;AACA,8BAAI,YAAW,SAAX,eAAW,WAAX,GAAW,MAAX,cAAW,CAAEoB,MAAb,IAAsB,CAA1B,EAA6B;AAC3B,mCAAI,CAACD,YAAL,GAAoBH,WAAW,CAAC,CAAD,CAAX,CAAeG,YAAnC;;AACA,mCAAI,CAAC1C,aAAL,CAAmB0C,YAAnB,CAAgCK,IAAhC,CAAqC,OAAI,CAACL,YAA1C;AACD;;AACD,iCAAI,CAACjD,YAAL,CAAkB0C,UAAlB,GAA+BA,UAA/B;;AAEA,8BAAI,OAAI,CAACE,QAAL,CAAchB,UAAlB,EAA8B;AAC5B,mCAAI,CAACmK,MAAL,CAAYJ,QAAZ,GAAuB,OAAI,CAAC/I,QAAL,CAAchB,UAArC;AACA,mCAAI,CAACmK,MAAL,CAAYkE,IAAZ,GAAmB4G,yEAAnB;AACD;;AAED,iCAAI,CAAC1L,QAAL,GAAgBwD,IAAhB;AACD;;AACD,4BAAI0H,SAAS,CAACjH,aAAd,EAA6B;AAC3B,sDAA+IiH,SAAS,CAACjH,aAAV,CAAwB3L,IAAvK;AAAA,8BAAQkL,IAAR,yBAAQA,EAAR;AAAA,8BAAYmI,OAAZ,yBAAYA,OAAZ;AAAA,8BAAqBC,kBAArB,yBAAqBA,kBAArB;AAAA,8BAAyCnV,UAAzC,yBAAyCA,UAAzC;AAAA,8BAAqDsJ,QAArD,yBAAqDA,QAArD;AAAA,8BAA+DpJ,QAA/D,yBAA+DA,MAA/D;AAAA,8BAAuEoO,OAAvE,yBAAuEA,OAAvE;AAAA,8BAAgF+B,UAAhF,yBAAgFA,UAAhF;AAAA,8BAA4F7F,YAA5F,yBAA4FA,YAA5F;AAAA,8BAA0G5H,OAA1G,yBAA0GA,OAA1G;AAAA,8BAAmH2L,uBAAnH,yBAAmHA,uBAAnH;AACA,iCAAI,CAAC6G,YAAL,GAAoBX,SAAS,CAACjH,aAAV,CAAwB3L,IAA5C;AACA,8BAAQmT,aAAR,GAAoCE,OAApC,CAAQF,YAAR;AAAA,8BAAsB7T,UAAtB,GAAoC+T,OAApC,CAAsB/T,SAAtB;AAEA,iCAAI,CAACoI,QAAL,GAAgBwD,IAAhB;AACA,iCAAI,CAACzD,QAAL,GAAgBA,QAAhB;AACA,iCAAI,CAACS,QAAL,GAAgB/J,UAAhB;AACA,iCAAI,CAACkK,mBAAL,GAA2BhK,QAA3B;AACA,iCAAI,CAACoQ,WAAL,GAAmB6E,kBAAnB;AACA,iCAAI,CAAC9E,UAAL,GAAkBA,UAAlB;AACA,iCAAI,CAAChP,YAAL,GAAoB6T,OAAO,CAAC7T,YAA5B;AACA,iCAAI,CAACkQ,WAAL,GAAmByD,aAAnB;AACA,iCAAI,CAAC7T,SAAL,GAAiBA,UAAjB;AAEA,iCAAI,CAACgJ,MAAL,GAAWtJ,gCAAQ,OAAI,CAACsJ,MAAb,GAAmB;AAAEhD,yCAAa,EAAEjH,QAAjB;AAAyBwT,0CAAc,EAAE,IAAzC;AAA+CnS,kCAAM,EAAE+M,OAAvD;AAC5BD,gCAAI,EAAE4G,0EADsB;AACN3E,uCAAW,EAAE6E,kBADP;AAC2B5G,mDAAuB,EAAEA,uBADpD;AAC6EhE,qCAAS,EAAE3H,OAAO,SAAP,WAAO,WAAP,GAAO,MAAP,UAAO,CAAEC;AADjG,2BAAnB,CAAX,CAf2B,CAiB3B;;AACA,iCAAI,CAAClE,aAAL,CAAmB2L,aAAnB,CAAiC5I,IAAjC,CAAsC+S,SAAS,CAACjH,aAAV,CAAwB3L,IAA9D;;AACA,iCAAI,CAAClD,aAAL,CAAmB4L,SAAnB,CAA6B7I,IAA7B,CAAkC8I,YAAlC;;AACA,iCAAI,CAAC7L,aAAL,CAAmB6P,YAAnB,CAAgC9M,IAAhC,CAAqCxB,QAArC;AACD;;AAED,4BAAI,OAAI,CAACmB,YAAT,EAAuB;AACrB,iCAAI,CAACrC,iBAAL,CAAuBqW,aAAvB,CAAqC,OAAI,CAAChU,YAA1C,EAAwDI,SAAxD,CAAkE;AAChEC,gCAAI,EAAE,cAAC4T,wBAAD,EAAkC;AACtC,kCAAIA,wBAAJ,EAA8B;AAC5B,uCAAI,CAACC,aAAL,CAAmBD,wBAAnB;;AACA,uCAAI,CAACE,YAAL,GAAoB,KAApB;;AACA,uCAAI,CAACC,6BAAL;;AACAC,0CAAU,CAAC,YAAK;AACd,yCAAI,CAACC,WAAL,GAAmB,KAAnB;;AACA,sCAAI,OAAI,CAAC9B,cAAT,EAAyB;AACvB,2CAAI,CAAClD,aAAL,GAAqB,IAArB;AACA,2CAAI,CAAC6C,gBAAL,GAAwB,IAAxB;AACA,2CAAI,CAACoC,6BAAL,GAAqC,IAArC;AACD;;AACD,sCAAI,OAAI,CAAClD,UAAT,EAAqB;AACnB,2CAAI,CAACzG,cAAL,CAAoB4J,UAApB;AACD;AACF,iCAVS,CAAV;AAWD;AACF,6BAlB+D;AAmBhExT,iCAAK,EAAE,iBAAI;AACT,qCAAI,CAACmT,YAAL,GAAoB,IAApB;AACD,6BArB+D;AAsBhErT,oCAAQ,EAAE,oBAAK;AACb,qCAAI,CAACxD,aAAL,CAAmByD,WAAnB;AACD;AAxB+D,2BAAlE;AA0BD,yBA3BD,MA2BO;AACL,iCAAI,CAACoT,YAAL,GAAoB,IAApB;AACA,iCAAI,CAACG,WAAL,GAAmB,KAAnB;;AACA,iCAAI,CAAChX,aAAL,CAAmByD,WAAnB;AACD;AACF,uBAnGD,MAmGK;AACH,+BAAI,CAACoT,YAAL,GAAoB,IAApB;;AACA,+BAAI,CAAC7W,aAAL,CAAmByD,WAAnB;AACD;AACF;AAzGqB,mBAAxB;AA2GD,iBAzI0D;AAyIxDC,qBAAK,EAAE,iBAAI;AACZ,yBAAI,CAACmT,YAAL,GAAoB,IAApB;;AACA,yBAAI,CAAC7W,aAAL,CAAmByD,WAAnB;AACD;AA5I0D,eAA7D;AA+ID;AACF;AAID;;;;;;iBAGA,oBAAQ;AAAA;;;;AACN,gBAAM0T,eAAe,GAAG,WAAKlX,KAAL,CAAWoO,MAAX,MAAiB,IAAjB,IAAiBjN,aAAjB,GAAiB,MAAjB,GAAiBA,GAAEkN,QAAF,CAAWC,QAAX,CAAoBC,GAApB,CAAwB,IAAxB,CAAzC;AACA,iBAAKsG,eAAL,GAAoB5S,gCAAQ,KAAKzC,YAAb,GAAyB;AAAE2X,0BAAY,EAAE;AAAhB,aAAzB,CAApB;AACA,iBAAKrX,cAAL,CAAoBiC,QAApB,CAA6B,UAA7B,EAAyC,CAAE,uBAAF,EAA2B,eAA3B,EAA4C;AACnFY,oBAAM,EAAEuU,eAD2E;AAEnF/L,sBAAQ,EAAE+L;AAFyE,aAA5C,CAAzC;AAKA,iBAAK3L,MAAL,GAAWtJ,gCACN,KAAKsJ,MADC,GACK;AAAE5I,oBAAM,EAAE,KAAKnD,YAAL,CAAkBsV,cAAlB,GAAkC,EAAlC,GAAsCoC,eAAhD;AACd/L,sBAAQ,EAAE,KAAK3L,YAAL,CAAkBsV,cAAlB,GAAkCoC,eAAlC,GAAmD,EAD/C;AAEdE,wBAAU,EAAE,KAAKA,UAAL,CAAgBvW,IAAhB,CAAqB,IAArB,CAFE;AAGZwW,8BAAgB,EAAE,KAAKzT,oBAAL,CAA0B/C,IAA1B,CAA+B,IAA/B;AAHN,aADL,CAAX;AAMA,iBAAKd,aAAL,CAAmB4I,WAAnB,CAA+B9F,SAA/B,CAAyC;AACvCC,kBAAI,EAAE,cAACgK,GAAD,EAAiB;AACrB,oBAAI,CAACA,GAAL,EAAU;AACR,yBAAI,CAAC0B,YAAL,GAAoB,IAApB;AACD;AACF;AALsC,aAAzC;AAQA,iBAAK8I,WAAL,CAAiBJ,eAAjB;AACA,gBAAMxG,SAAS,GAAQC,QAAQ,CAACC,aAAT,CAAuB,oBAAvB,CAAvB;;AACA,gBAAIF,SAAJ,EAAe;AACbA,uBAAS,CAACG,SAAV,GAAsB,CAAtB;AACD;;AAED,iBAAKxH,iBAAL,GAAyB,KAAKE,UAAL,CAAgB1I,IAAhB,CAAqB,IAArB,CAAzB;AACD;AAED;;;;;;iBAGO,4BAAgB;AAAA;;AACrB,iBAAKd,aAAL,CAAmBoC,WAAnB;AACA,iBAAK8R,mBAAL,GAA2BgC,IAAI,CAACsB,KAAL,CAAW,KAAKvB,6BAAhB,CAA3B;;AACA,gBAAI,KAAKvT,YAAT,EAAuB;AACrB,mBAAKrC,iBAAL,CAAuBqW,aAAvB,CAAqC,KAAKhU,YAA1C,EAAwDI,SAAxD,CAAkE;AAChEC,oBAAI,EAAE,cAAC4T,wBAAD,EAAkC;AACtC,sBAAIA,wBAAJ,EAA8B;AAC5B,2BAAI,CAACC,aAAL,CAAmBD,wBAAnB;;AACA,2BAAI,CAACG,6BAAL;;AACA,2BAAI,CAACjC,gBAAL,GAAwB,KAAxB;AAEA,2BAAI,CAACK,cAAL,GAAsB,KAAtB;AACA,2BAAI,CAAC+B,6BAAL,GAAqC,KAArC;AACA,2BAAI,CAAChC,iBAAL,GAAyB,KAAzB;AACA8B,8BAAU,CAAC,YAAK;AACd,6BAAI,CAACC,WAAL,GAAmB,KAAnB;AACA,6BAAI,CAAChF,aAAL,GAAqB,IAArB;AACD,qBAHS,CAAV;AAKD;AACF,iBAhB+D;AAiBhExO,wBAAQ,EAAE,oBAAK;AACb,yBAAI,CAACxD,aAAL,CAAmByD,WAAnB;AACD;AAnB+D,eAAlE;AAqBD;AACF;AAGD;;;;;;iBAGA,0BAAc;AACZ,iBAAKuO,aAAL,GAAqB,KAArB;AACA,iBAAK/I,gBAAL,GAAwB,EAAxB;AACA,iBAAKgM,iBAAL,GAAyB,KAAzB;AACA,iBAAKC,cAAL,GAAsB,KAAtB;AACA,iBAAK5H,cAAL,CAAoBmK,eAApB,GAAsC,KAAtC;AACA,iBAAK5C,gBAAL,GAAwB,KAAxB;AACA,iBAAKoC,6BAAL,GAAqC,KAArC;AACD;AAED;;;;;;;iBAIA,oBAAW9N,MAAX,EAAsB;;;AACpB,iBAAKpJ,cAAL,CAAoBiC,QAApB,CAA6B,YAA7B,EAA2C,CAAE,uBAAF,EAA2B,eAA3B,EAA4C;AACrFmH,oBAAM,EAANA;AADqF,aAA5C,CAA3C;;AAGA,gBAAI,CAAC,KAAKzG,YAAV,EAAwB;AACtB,mBAAK6R,iBAAL,CAAuBrT,IAAvB,CAA4B;AAAE,wBAAQ,OAAV;AAAmB,sBAAM,KAAK0K;AAA9B,eAA5B;AACA;AACD;;AACD,iBAAK2I,iBAAL,CAAuBrT,IAAvB,CAA4BiI,MAA5B;;AAEA,gBAAIA,MAAM,CAAClI,IAAP,KAAgB,QAApB,EAA8B;AAE5B,kBAAI,YAAKgI,gBAAL,MAAqB,IAArB,IAAqB7H,aAArB,GAAqB,MAArB,GAAqBA,GAAEuB,MAAvB,MAAkC,CAAtC,EAAyC;AACvC,qBAAKkS,gBAAL,GAAwB,KAAxB;AACA,qBAAKK,cAAL,GAAsB,KAAtB;AACA,qBAAK+B,6BAAL,GAAqC,KAArC;AACA,qBAAKhC,iBAAL,GAAyB,KAAzB;AACA,qBAAKD,qBAAL,GAA6B,KAAKxB,uBAAL,CAA6BtK,MAA7B,CAAoC,UAACyK,KAAD,EAA6B;AAC5F,yBAAOA,KAAK,CAACC,aAAN,KAAwB,IAA/B;AACD,iBAF4B,EAE1BjR,MAFH;AAGA,qBAAK+U,gBAAL;AACD,eATD,MASO;AACL,qBAAK7C,gBAAL,GAAwB,KAAxB;AACA,qBAAK7C,aAAL,GAAqB,IAArB;AACA,qBAAKkD,cAAL,GAAsB,KAAtB;AACA,qBAAK+B,6BAAL,GAAqC,KAArC;AACA,qBAAKjC,qBAAL,GAA6B,KAAKvB,yBAAL,CAA+BC,aAA5D;AACA,qBAAKuB,iBAAL,GAAyB,KAAzB;AACD;;AAED,mBAAK3L,iBAAL,GAAyB,KAAKE,UAAL,CAAgB1I,IAAhB,CAAqB,IAArB,CAAzB;AACD,aArBD,MAqBO;AACL,mBAAKmI,gBAAL,GAAwB,EAAxB;AACA,mBAAKK,iBAAL,GAAyB,KAAK2I,oBAAL,CAA0BnR,IAA1B,CAA+B,IAA/B,CAAzB;AACA,mBAAK+T,gBAAL,GAAwB,IAAxB;AACA,mBAAKI,iBAAL,GAAyB,IAAzB;AACA,mBAAKjD,aAAL,GAAqB,IAArB;AACD;AACF;;;;;;;yBAxuBUZ,qBAAkBJ;AAAA;;;cAAlBI;AAAkBjN;AAAA6D;AAAA;;;;;;;;;;;;;;;;;;;;;AD9B/BgJ;;AA2CAA;;;;AA3CMA;;AA2CYA;;AAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;aE3BlB;;;UAiCa2G;;;;;yBAAAA;AAAY;;;cAAZA;;;mBAJA,CACTC,sGADS;AAEVjS,kBAnBQ,CACPkS,0DADO,EAEPC,kEAFO,EAGPC,sDAHO,EAIP1S,6EAJO,EAKP2S,+EALO,EAMPC,iEANO,EAOPC,qEAPO,EAQPC,wEARO,CAmBR;;;;6HAEUR,eAAY;AAAAlS,yBA3BrB2S,yFA2BqB,EA1BrBC,gFA0BqB,EAzBrBC,gFAyBqB,EAxBrBC,+FAwBqB,EAvBrBC,wEAuBqB;AAvBL7S,oBAGhBkS,0DAHgB,EAIhBC,kEAJgB,EAKhBC,sDALgB,EAMhB1S,6EANgB,EAOhB2S,+EAPgB,EAQhBC,iEARgB,EAShBC,qEATgB,EAUhBC,wEAVgB,CAuBK;AAbLvS,oBAGhBwS,yFAHgB,EAIhBC,gFAJgB,EAKhBC,gFALgB,EAMhBC,+FANgB;AAaK;AAPE;;;;","names":["module","n","date","utc","args","u","locale","t","r","s","o","_angular_core__WEBPACK_IMPORTED_MODULE_8__","photosHeader","title","step","description","stepName","AddPhotosComponent","monitorService","commonService","route","dialog","caseService","router","inspectionService","estimateService","calendarService","label","type","color","icon","onclick","allowSingleUpload","bind","allowMultipleUpload","cancelBooking","mode","emit","repairData","_a","repairGuid","_b","status","_c","toLowerCase","_d","_e","repairGuidisRepairCreatedFromCase","_f","_g","changes","logEvent","currentValue","Object","caseNumber","showLoading","caseData","caseGuid","inspections","vehicleId","domainID","inspectionId","length","caseId","updateCaseStatus","subscribe","next","resp","createEstimate","data","url","location","href","sessionStorage","setItem","complete","hideLoading","error","navigate","nextButton","redirectToGtEstimate","openDeleteDialog","afterClosed","deleteBooking","booking","bookingGuid","selectors","inputs","showEstimate","repairUnapproved","showSPI","hideBulk","outputs","features","decls","vars","consts","template","ErrorModule","_angular_common__WEBPACK_IMPORTED_MODULE_3__","_angular_router__WEBPACK_IMPORTED_MODULE_4__","_angular_material_button__WEBPACK_IMPORTED_MODULE_5__","_angular_material_icon__WEBPACK_IMPORTED_MODULE_6__","_angular_material_input__WEBPACK_IMPORTED_MODULE_7__","src_app_widgets_chq_widgets_module__WEBPACK_IMPORTED_MODULE_0__","_angular_material_sidenav__WEBPACK_IMPORTED_MODULE_8__","_angular_material_tabs__WEBPACK_IMPORTED_MODULE_9__","_angular_material_toolbar__WEBPACK_IMPORTED_MODULE_10__","declarations","_no_access_error_no_access_error_component__WEBPACK_IMPORTED_MODULE_1__","imports","exports","NoAccessErrorComponent","_angular_core__WEBPACK_IMPORTED_MODULE_0__","dayjs__WEBPACK_IMPORTED_MODULE_0__","dayjs_plugin_utc__WEBPACK_IMPORTED_MODULE_1__","HistoryComponent","_angular_core__WEBPACK_IMPORTED_MODULE_5__","events","indexOf","isMenuOpen","toggleExpand","params","currencySymbol","getCurrencySymbol","utcDate","local","format","referenceId","blobObservable1","src_environments_environment__WEBPACK_IMPORTED_MODULE_2__","window","open","fileURL","blobUrls","name","gallery","forEach","imageUrl","substring","trim","push","image","thumbImage","src_app_widgets_chq_repair_dialog_chq_repair_dialog_component__WEBPACK_IMPORTED_MODULE_3__","comment","email","viewQuery","ctx_r2","newDocumentHeader","NewDocumentsComponent","cd","bookingService","mediaCollectionService","text","currentStatus","pageName","closed","rxjs__WEBPACK_IMPORTED_MODULE_9__","accessRight","updatePage","detectChanges","queryParams","codeParam","imageStatusSteps","filter","$event","uploadedGuid","uploadedPartGuid","currentObservable","updateFile","uploadFile","mediaPartTemplates","getAllChild","mediaTemplate","mediaTemplates","i","mediaPart","documentStep","isAdditionalImage","isAdditionalDocumentFromReviewPageOnly","mandatory","index","parentName","isFront","frontSide","updatedDate","mediaPartGuid","uploadedDate","createdDate","domainId","objectId","sizeLimit","allowExtension","mediaGuid","partTemplateGuid","mediaPartTemplateGuid","templateGuid","checkRouteParams","repairId","statusUpdated","updateRepairStatus","currentRepairStatus","footer","getRepairDetailByGuid","result","repairDetails","bookingId","repairNumber","err","logException","_microsoft_applicationinsights_web__WEBPACK_IMPORTED_MODULE_11__","currentStep","obj","mediaCollectionId","collectionGuid","mediaTemplateId","mediaPartTemplateId","uploadInProgress","isSkipped","isUploadFailed","isUploadSuccess","messageForUploading","showNotification","uploadDocument","imageFile","res","responseData","mediaPartTemplate","find","x","includes","updateStatus","imageUploaders","updateUploadStatus","e","updateDocument","mediaData","media","mediaDataTemplate","mediaTemplateGuid","j","mediaDataPart","mediaParts","getURL","console","log","id","parent","snapshot","paramMap","get","showNoAccess","promiseApi","getMediaTemplate","isRepair","bookingDetail","userProfileData","organizationDetail","currentOrgId","caseDetail","getCaseDetail","pipe","dict","mediaTemplateSelected","organizationId","isViewOnly","caseStatus","documentHeader","from","quoteId","isRepairCreatedFromCase","repairStatus","detailResult","mediaTemplateDetail","getMediaTemplateById","mediaDetail","getMediaDocumentData","detailDict","sort","mediab","orderNumber","mapMediaTemplate","medias","getMediaTemplateByObject","noDocumentData","container","document","querySelector","scrollTop","unsubscribe","_angular_core__WEBPACK_IMPORTED_MODULE_13__","ctx_r7","ctx_r5","ctx_r6","NewPhotosComponent","showButton","showUploadOption","rxjs__WEBPACK_IMPORTED_MODULE_14__","showDamageAnalysis","back","repairType","repairTypes","v","repairServiceType","initial","setInitialMode","showUploading","uploadBulkUploadFile","steps","uploads","img","Image","src","onload","uploadObject","height","width","inspectionTemplateId","vehicelType","uploadImageBulk","rawImage","rawAzureBlobUrl","inspectionItem","procedureSteps","ig","_microsoft_applicationinsights_web__WEBPACK_IMPORTED_MODULE_15__","imageHeight","imageWidth","inProgressSteps","msg","inspectionItemTemplates","currentInspectionTemplate","minImageLimit","value","isSkipEnabled","inspectionData","inspection","uploadType","currentMode","bulkUploadTemplateItem","inspectionTemplates","bulkUploadedItemsWithImages","inspectionItems","inspectionItemTemplateID","massUploadItems","currentUploadMode","currentObj","map","chqInspectionStep","item","el","isMultipleUpload","addPhotosHeader","isRepairModule","minimumPhotosRequired","triggerMassUpload","isBulkUploaded","templatePart","inspectionStep","isMassUpload","created","partialCaseDetail","getInspectionTemplateList","inspectionList","repairInspectionTemplate","inspectionTemplate","getInspectionTemplate","serverDetails","resultMap","inspectionTemplateDetail","inspectionDetail","inspectionTemplatesJSONString","JSON","stringify","statusId","vehicleModel","src_app_model_chq_upload_model__WEBPACK_IMPORTED_MODULE_0__","vehicle","repairServiceTypes","repairDetail","getInspection","inspectionDetailResponse","mapInspection","noImagesData","getInspectionTemplateByObject","setTimeout","hideContent","currentAdditionalModeMultiple","goToReview","currentObjectId","isHeaderOnly","handleBack","finalRedirection","loadApiData","parse","isReviewSection","reloadInspection","SharedModule","src_app_guards_deactivate_gaurd_deactivate_gaurd_guard__WEBPACK_IMPORTED_MODULE_1__","_angular_common__WEBPACK_IMPORTED_MODULE_11__","_angular_material_icon__WEBPACK_IMPORTED_MODULE_12__","_icons_module__WEBPACK_IMPORTED_MODULE_6__","src_app_shared_error_page_error_module__WEBPACK_IMPORTED_MODULE_2__","_ngx_translate_core__WEBPACK_IMPORTED_MODULE_13__","_helper_directive_module__WEBPACK_IMPORTED_MODULE_8__","_angular_material_sidenav__WEBPACK_IMPORTED_MODULE_14__","_new_documents_new_documents_component__WEBPACK_IMPORTED_MODULE_3__","_new_photos_new_photos_component__WEBPACK_IMPORTED_MODULE_4__","_add_photos_add_photos_component__WEBPACK_IMPORTED_MODULE_5__","_damage_analysis_damage_analysis_component__WEBPACK_IMPORTED_MODULE_7__","_history_history_component__WEBPACK_IMPORTED_MODULE_9__"],"sources":["webpack:///node_modules/dayjs/plugin/utc.js","webpack:///src/app/shared/add-photos/add-photos.component.html","webpack:///src/app/shared/add-photos/add-photos.component.ts","webpack:///src/app/shared/error-page/error.module.ts","webpack:///src/app/shared/error-page/no-access-error/no-access-error.component.ts","webpack:///src/app/shared/error-page/no-access-error/no-access-error.component.html","webpack:///src/app/shared/history/history.component.ts","webpack:///src/app/shared/new-documents/new-documents.component.html","webpack:///src/app/shared/new-documents/new-documents.component.ts","webpack:///src/app/shared/new-photos/new-photos.component.html","webpack:///src/app/shared/new-photos/new-photos.component.ts","webpack:///src/app/shared/shared.module.ts"],"sourcesContent":["!function(t,i){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=i():\"function\"==typeof define&&define.amd?define(i):(t=\"undefined\"!=typeof globalThis?globalThis:t||self).dayjs_plugin_utc=i()}(this,(function(){\"use strict\";var t=\"minute\",i=/[+-]\\d\\d(?::?\\d\\d)?/g,e=/([+-]|\\d\\d)/g;return function(s,f,n){var u=f.prototype;n.utc=function(t){var i={date:t,utc:!0,args:arguments};return new f(i)},u.utc=function(i){var e=n(this.toDate(),{locale:this.$L,utc:!0});return i?e.add(this.utcOffset(),t):e},u.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var o=u.parse;u.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),o.call(this,t)};var r=u.init;u.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else r.call(this)};var a=u.utcOffset;u.utcOffset=function(s,f){var n=this.$utils().u;if(n(s))return this.$u?0:n(this.$offset)?a.call(this):this.$offset;if(\"string\"==typeof s&&(s=function(t){void 0===t&&(t=\"\");var s=t.match(i);if(!s)return null;var f=(\"\"+s[0]).match(e)||[\"-\",0,0],n=f[0],u=60*+f[1]+ +f[2];return 0===u?0:\"+\"===n?u:-u}(s),null===s))return this;var u=Math.abs(s)<=16?60*s:s,o=this;if(f)return o.$offset=u,o.$u=0===s,o;if(0!==s){var r=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(o=this.local().add(u+r,t)).$offset=u,o.$x.$localOffset=r}else o=this.utc();return o};var h=u.format;u.format=function(t){var i=t||(this.$u?\"YYYY-MM-DDTHH:mm:ss[Z]\":\"\");return h.call(this,i)},u.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var l=u.toDate;u.toDate=function(t){return\"s\"===t&&this.$offset?n(this.format(\"YYYY-MM-DD HH:mm:ss:SSS\")).toDate():l.call(this)};var c=u.diff;u.diff=function(t,i,e){if(t&&this.$u===t.$u)return c.call(this,t,i,e);var s=this.local(),f=n(t).local();return c.call(s,f,i,e)}}}));","<div class=\"add-photo-container\">\r\n    <chq-step-header [chqModel]=\"photosHeader\"\r\n        *ngIf=\"photosHeader.isRepairModule !== true  || photosHeader.isHeaderOnly === true\"></chq-step-header>\r\n    <div class=\"photo-container\" *ngIf=\"(showSPI || !hideBulk) && !repairUnapproved && !commonService.isViewOnly\">\r\n        <div class=\"card-container\">\r\n            <div class=\"card\" *ngIf=\"showSPI\">\r\n                <label class=\"card-title\">{{ 'smart_photo_inspection' | translate }}</label>\r\n                <p class=\"card-action\">{{ 'open_your_camera' | translate }}</p>\r\n                <p class=\"card-description\">\r\n                    {{ 'add_photo_msg' | translate }}\r\n                </p>\r\n                <chq-button [buttonModel]=\"cameraButtonModel\"></chq-button>\r\n            </div>\r\n            <div class=\"card\" *ngIf=\"!hideBulk\">\r\n                <label class=\"card-title\">{{ 'bulk_upload' | translate }}</label>\r\n                <p class=\"card-action\">{{ 'upload_device' | translate }}</p>\r\n                <p class=\"card-description\">\r\n                    {{ 'bulk_msg' | translate }}\r\n                </p>\r\n                <chq-button [buttonModel]=\"bulkUploadButtonModel\"></chq-button>\r\n            </div>\r\n        </div>\r\n        <!-- <div class=\"card-container\" *chqPermission=\"'technician'\">\r\n            <div class=\"no-document-div\">\r\n                <img src=\"assets/icons/no-document.svg\">    \r\n                <label class=\"no-vehicle-content\">\r\n                    {{ 'bulk_spi_disabled' | translate}}\r\n                </label>\r\n            </div>\r\n        </div> -->\r\n    </div>\r\n    <div class=\"wrapper\" *ngIf=\"(!showSPI && hideBulk) || repairUnapproved || commonService.isViewOnly\">\r\n        <div class=\"no-document-div\">\r\n            <img src=\"assets/icons/no-document.svg\">\r\n            <label class=\"no-vehicle-content\">\r\n                {{ (repairUnapproved ? 'start_job' : 'bulk_spi_disabled') | translate}}\r\n            </label>\r\n\r\n        </div>\r\n    </div>\r\n    <div class=\"footer-full-wrapper\">\r\n        <div class=\"footer-image-wrapper wrapper-flex\">\r\n            <div class=\"image-wrapper\">\r\n                <img src=\"assets/img/{{ + photosHeader.isRepairModule ?'addenda-repair.png':'addenda-quote.png'}}\" />\r\n            </div>\r\n            <div class=\"footer-button-wrapper\">\r\n                <chq-button [buttonModel]=\"cancelButtonModel\"\r\n                    *ngIf=\"showDelete && photosHeader?.isRepairModule\"></chq-button>\r\n                <chq-button *ngIf=\"showEstimate && !photosHeader.isRepairModule \" class=\"margin-right\"\r\n                    [buttonModel]=\"nextButton\"></chq-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","import { Component, EventEmitter, Input, OnChanges, OnInit, Output, SimpleChanges } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { ChqWidgetsButtonModel } from 'src/app/model/chq-widgets-button-model';\r\nimport { ChqWidgetsHeaderModel } from 'src/app/model/chq-widgets-header-model';\r\nimport { CalendarService } from 'src/app/services/calendar/calendar.service';\r\nimport { CaseService } from 'src/app/services/case/case.service';\r\nimport { CommonService } from 'src/app/services/common/common.service';\r\nimport { InspectionService } from 'src/app/services/inspection-service/inspection.service';\r\nimport { MonitorService } from 'src/app/services/monitor-service/monitor.service';\r\nimport { RepairEstimateService } from 'src/app/services/repair-estimate/repair-estimate.service';\r\n\r\nconst photosHeader: ChqWidgetsHeaderModel = {\r\n  title: 'add_damage_photos',\r\n  step: 4,\r\n  description: 'damage_photos_msg',\r\n  stepName: 'step_four',\r\n};\r\n@Component({\r\n  selector: 'add-photos',\r\n  templateUrl: './add-photos.component.html',\r\n  styleUrls: [ './add-photos.component.scss' ]\r\n})\r\nexport class AddPhotosComponent implements OnChanges {\r\n  @Output() mode: EventEmitter<{ 'mode': string }> = new EventEmitter();  \r\n  @Input() caseNumber: string;\r\n  @Input() caseData:any;\r\n  @Input() showEstimate:boolean = false;\r\n  @Input() repairUnapproved:boolean;\r\n  @Input() repairData: any;\r\n\r\n  public nextButton: ChqWidgetsButtonModel = {\r\n    label: 'Next create estimate',\r\n    type: 'primary',\r\n    color: 'primary',\r\n    icon: 'boardview'\r\n  }\r\n  @Input() photosHeader: ChqWidgetsHeaderModel = photosHeader;\r\n  @Input() showSPI:boolean;\r\n  @Input() hideBulk:boolean;\r\n  /**\r\n   * initialize single Upload\r\n   */\r\n  allowSingleUpload():void {\r\n    this.mode.emit({ 'mode': 'single' })\r\n  }\r\n\r\n  /**\r\n   * show delete\r\n   */\r\n  get showDelete(): boolean {\r\n    if (this.repairData?.repairGuid && this.repairData?.status?.toLowerCase() === 'draft') {\r\n      return true;\r\n    } else if (this.repairData?.repairGuid && this.repairData?.repairGuidisRepairCreatedFromCase == true && this.repairData?.status?.toLowerCase() == 'repairestimation') {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * constructor\r\n   */\r\n  constructor( private monitorService: MonitorService,\r\n    public commonService: CommonService,\r\n    private route: ActivatedRoute,\r\n    private dialog: MatDialog,\r\n    private caseService: CaseService,\r\n    private router: Router,\r\n    private inspectionService: InspectionService,\r\n    private estimateService: RepairEstimateService,\r\n    private calendarService: CalendarService) {}\r\n\r\n  /**\r\n   * detects changes in input attributes\r\n   * @param changes \r\n   */\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    this.monitorService.logEvent('allowMultipleUpload', [ 'ChqAddPhotosComponent', 'addenda-quote', {\r\n      changes\r\n    } ]);\r\n    if (changes) {\r\n      if (changes['caseNumber'] && changes['caseNumber'].currentValue) {\r\n        this.photosHeader = { ...this.photosHeader, caseNumber: this.caseNumber };    \r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * initialize multiple Upload\r\n   */\r\n  allowMultipleUpload():void {\r\n    this.monitorService.logEvent('allowMultipleUpload', [ 'ChqAddPhotosComponent', 'addenda-quote' ]);\r\n    this.mode.emit({ 'mode': 'multiple' })\r\n  }\r\n\r\n  public cameraButtonModel: ChqWidgetsButtonModel = {\r\n    label: 'camera_upload',\r\n    type: 'primary',\r\n    icon: 'camera',\r\n    color: 'primary',\r\n    onclick: this.allowSingleUpload.bind(this)\r\n  }\r\n  public bulkUploadButtonModel: ChqWidgetsButtonModel = {\r\n    label: 'btn_bulk_upload',\r\n    type: 'primary',\r\n    icon: 'upload',\r\n    color: 'primary',\r\n    onclick: this.allowMultipleUpload.bind(this)\r\n  }\r\n\r\n  public cancelButtonModel: ChqWidgetsButtonModel = {\r\n    label: 'Cancel Booking',\r\n    type: 'outline-danger',\r\n    onclick: this.cancelBooking.bind(this)\r\n  }\r\n\r\n  /**\r\n   * go to gtEstimate\r\n   */\r\n  redirectToGtEstimate():void {\r\n    \r\n    this.commonService.showLoading();\r\n    const { status, caseGuid, inspections, vehicleId, domainID } = this.caseData;\r\n    let inspectionId = 0;\r\n    if (inspections?.length > 0) {\r\n      inspectionId = inspections[0].inspectionId;\r\n    }\r\n    if (status?.toLowerCase() === 'uploaddocuments') {\r\n      this.monitorService.logEvent('redirectToGtEstimate', [ 'ChqDamageAnalysisComponent', 'addenda-quote', {\r\n        caseId: caseGuid\r\n      } ]);\r\n      this.caseService.updateCaseStatus(caseGuid, 'UploadPhotos').subscribe({\r\n        next: (resp: any): void => {\r\n          this.estimateService.createEstimate(caseGuid, inspectionId, vehicleId, domainID).subscribe({\r\n            next: (resp: any) => {\r\n              if (resp) {\r\n                if(resp?.data?.url){\r\n                  location.href = resp?.data?.url;\r\n                  sessionStorage.setItem('update', '1');\r\n                }\r\n              }\r\n            },\r\n            complete: () => {\r\n              this.commonService.hideLoading();\r\n            }\r\n          });\r\n        }, error: () => {\r\n          this.commonService.hideLoading();\r\n        }\r\n      })\r\n    }else if(status?.toLowerCase() === 'uploadphotos'){\r\n      this.monitorService.logEvent('redirectToGtEstimate', [ 'ChqDamageAnalysisComponent', 'addenda-quote', {\r\n        caseId: caseGuid\r\n      } ]);\r\n      this.estimateService.createEstimate(caseGuid, inspectionId, vehicleId, domainID).subscribe({\r\n        next: (resp: any) => {\r\n          if (resp) {\r\n            if(resp?.data){\r\n              location.href = resp.data.url;\r\n              sessionStorage.setItem('update', '1');\r\n            } \r\n          }\r\n        },\r\n        complete: () => {\r\n          this.commonService.hideLoading();\r\n        }\r\n      });\r\n    } else {\r\n      this.monitorService.logEvent('skipped_redirectToGtEstimate', [ 'ChqDamageAnalysisComponent', 'addenda-quote', {\r\n        caseId: caseGuid\r\n      } ]);\r\n      this.router.navigate([ `/case/${caseGuid}/estimate` ]);\r\n    }\r\n   \r\n  }\r\n\r\n  /**\r\n   * oninit\r\n   */\r\n  ngOnInit(): void {\r\n    const repairData = this.repairData;\r\n    this.nextButton.onclick = this.redirectToGtEstimate.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Cancel booking\r\n   */\r\n  cancelBooking(): void {\r\n    this.commonService.openDeleteDialog()\r\n      .afterClosed().subscribe((data) => {\r\n        if (data) {\r\n          this.commonService.showLoading();\r\n          this.calendarService.deleteBooking(this.repairData?.booking?.bookingGuid).subscribe({\r\n            next: () => {\r\n              this.commonService.hideLoading();\r\n              this.router.navigate([ '/repair/booking-journal' ]);\r\n            }\r\n          });\r\n        }\r\n      });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule } from '@angular/router';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { MatTabsModule } from '@angular/material/tabs';\r\nimport { MatToolbarModule } from '@angular/material/toolbar';\r\nimport { WidgetsModule } from 'src/app/widgets/chq-widgets.module';\r\nimport { NoAccessErrorComponent } from './no-access-error/no-access-error.component';\r\n\r\n@NgModule({\r\n  declarations: [  \r\n    NoAccessErrorComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatInputModule,\r\n    WidgetsModule,\r\n    MatSidenavModule,\r\n    MatTabsModule,\r\n    MatToolbarModule,\r\n  ],\r\n  exports: [ RouterModule, NoAccessErrorComponent ],\r\n})\r\nexport class ErrorModule {}\r\n","import { Component } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'no-access-error',\r\n  templateUrl: './no-access-error.component.html',\r\n  styleUrls: [ './no-access-error.component.scss' ]\r\n})\r\nexport class NoAccessErrorComponent {\r\n\r\n}\r\n","<div class=\"main-container\">\r\n    <div class=\"\" style=\"\">\r\n        <img src=\"assets/img/no-access.png\"/>\r\n    </div>\r\n</div>\r\n","import { CommonModule } from '@angular/common';\r\nimport { CUSTOM_ELEMENTS_SCHEMA, Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatSidenav, MatSidenavModule } from '@angular/material/sidenav';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { ChqWidgetsButtonModel } from 'src/app/model/chq-widgets-button-model';\r\nimport { WidgetsModule } from 'src/app/widgets/chq-widgets.module';\r\nimport * as dayjs from 'dayjs';\r\nimport * as utc from 'dayjs/plugin/utc';\r\nimport { CommonService } from 'src/app/services/common/common.service';\r\nimport { environment } from 'src/environments/environment';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { ChqRepairDialogComponent } from 'src/app/widgets/chq-repair-dialog/chq-repair-dialog.component';\r\ndayjs.extend(utc)\r\n\r\n@Component({\r\n  selector: 'history',\r\n  templateUrl: './history.component.html',\r\n  styleUrls: [ './history.component.scss' ],\r\n})\r\nexport class HistoryComponent{\r\n  dayjs = dayjs()\r\n  /**\r\n   * Creates an instance of HistoryComponent.\r\n   * @constructor\r\n   * @param {Router} router\r\n   */\r\n  constructor(\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private commonService: CommonService,\r\n    private dialog: MatDialog,\r\n  ) {\r\n    this.router.events.subscribe({\r\n      next: (data) =>{\r\n        if(this.router.url.indexOf('?') !==-1 && this.router.url.indexOf('history=open')!==-1){\r\n          this.isMenuOpen = true;\r\n          this.toggleExpand.emit(this.isMenuOpen)\r\n        }\r\n      }\r\n    })\r\n    this.route.params.subscribe({\r\n      next: (data) =>{\r\n        if(this.router.url.indexOf('?') !==-1 && this.router.url.indexOf('history=open')!==-1){\r\n          this.isMenuOpen = true;\r\n          this.toggleExpand.emit(this.isMenuOpen)\r\n        }\r\n      }\r\n    })\r\n\r\n    this.currencySymbol = this.commonService.getCurrencySymbol()\r\n  }\r\n  /**\r\n   * constructor for HistoryComponent\r\n   */\r\n  @ViewChild('sidenav') sidenav: MatSidenav;\r\n  @Output() toggleExpand:EventEmitter<boolean> = new EventEmitter()\r\n  @Input() public history = [];\r\n  @Input() isMenuOpen = false;\r\n  @Input() isLoading = false;\r\n  /**\r\n   * Show/hide\r\n   */\r\n  close(): void {\r\n    this.isMenuOpen = !this.isMenuOpen;\r\n    this.toggleExpand.emit(this.isMenuOpen)\r\n  }\r\n  currencySymbol = ''\r\n  public viewMessage: ChqWidgetsButtonModel = {\r\n    label: 'View message',\r\n    icon: 'show',\r\n    type: 'outline',\r\n  };\r\n\r\n  /**\r\n   * convert utc to local time\r\n   */\r\n  public convertUtcToLocalTime(utcDate: string): string {\r\n    return dayjs.utc(utcDate).local().format('hh:mm A');\r\n  }\r\n  /**\r\n   * Returns class name according to status\r\n   */\r\n  getStatusClasses(status:string):string {\r\n    switch (status) {\r\n    case 'Draft':\r\n      return 'status-draft';\r\n    case 'Pending Approval':\r\n      return 'status-pending';\r\n    case 'Upload photos':\r\n      return 'status-upload';\r\n    case 'Repair estimate':\r\n      return 'status-repair-estimate';\r\n    default:\r\n      return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * download pdf history\r\n   */\r\n  downloadPdfHistory(referenceId: number): void {\r\n    this.commonService.showLoading();\r\n    this.commonService.blobObservable1(`${environment.caseMgmtUrl}/api/casehistory/report/${referenceId}`).subscribe({\r\n      next: (data: any) => {\r\n        window.open(data.fileURL, '_blank');\r\n        this.commonService.hideLoading();\r\n      },\r\n      error: () => {\r\n        this.commonService.hideLoading();\r\n      },\r\n    });\r\n  }\r\n  /**\r\n   * show image dialog\r\n   */\r\n  showImageDialog(blobUrls: string[], name: string): void {\r\n    const gallery = [];\r\n\r\n    blobUrls.forEach((url) => {\r\n      let title = '';\r\n      let imageUrl = url;\r\n\r\n      if (name.indexOf('photo') !== -1 || name.indexOf('document') !== -1) {\r\n        title = url.substring(0, url.indexOf('|')).trim();\r\n        imageUrl = url.substring(url.indexOf('|') + 1);\r\n      }\r\n\r\n      gallery.push({\r\n        image: imageUrl,\r\n        thumbImage: imageUrl,\r\n        //alt: alt,\r\n        title: title\r\n      });\r\n    });\r\n\r\n    const data = { 'imageGallery': true, 'gallery': gallery };\r\n    this.dialog.open(ChqRepairDialogComponent, {\r\n      data:\r\n          data\r\n    });\r\n  }\r\n\r\n  /**\r\n   * show comment dialog\r\n   */\r\n  showCommentDialog(comment: string, status: string, email?:null): void {\r\n    const data = { 'comment': comment, 'status': status, 'email': email };\r\n    this.dialog.open(ChqRepairDialogComponent, {\r\n      data:\r\n          data\r\n    });\r\n  }\r\n\r\n\r\n}\r\n","<div *ngIf=\"!showNoAccess\">\r\n    <chq-images-uploader #imageUploaders *ngIf=\"imageStatusSteps && imageStatusSteps.length > 0\"\r\n        [fileUploaderService]=\"currentObservable\" (cardSelection)=\"setObservable($event)\" [footerOptions]=\"footer\"\r\n        [imageStatusSteps]=\"imageStatusSteps\" [header]=\"documentHeader\" (stepSkipped)=\"stepSkipped()\"></chq-images-uploader>\r\n    <div class=\"wrapper\" *ngIf=\"noDocumentData\">\r\n        <div class=\"no-document-div\">\r\n            <img src=\"assets/icons/no-document.svg\">\r\n            <label class=\"no-vehicle-content\">\r\n                No Content Available\r\n            </label>\r\n\r\n        </div>\r\n        <div class=\"empty-wrapper\">\r\n            <div class=\"step-container\"></div>\r\n            <div class=\"step-container\"></div>\r\n            <div class=\"step-container\"></div>\r\n            <div class=\"step-container\"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div *ngIf=\"noDocumentData\" class=\"footer-full-wrapper\">\r\n        <div class=\"footer-image-wrapper\">\r\n            <div class=\"image-wrapper\">\r\n                <img src=\"assets/img/{{ + documentHeader.isRepairModule ?'addenda-repair.png':'addenda-quote.png'}}\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<no-access-error *ngIf=\"showNoAccess\"></no-access-error>","import { AfterViewInit, ChangeDetectorRef, Component, Input, OnInit, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { SeverityLevel } from '@microsoft/applicationinsights-web';\r\nimport { BehaviorSubject, catchError, forkJoin, of } from 'rxjs';\r\nimport { FooterModel, UploadStepModel } from 'src/app/model/chq-upload-model';\r\nimport { ChqWidgetsButtonModel } from 'src/app/model/chq-widgets-button-model';\r\nimport { ChqWidgetsHeaderModel } from 'src/app/model/chq-widgets-header-model';\r\nimport { documentPartMapper } from 'src/app/modules/quote/chq-new-cases/chq-new-customer/chq-new-customer-form-data-helper';\r\nimport { BookingService } from 'src/app/services/booking/booking.service';\r\nimport { CaseService } from 'src/app/services/case/case.service';\r\nimport { CommonService } from 'src/app/services/common/common.service';\r\nimport { MediacollectionService } from 'src/app/services/mediacollection-service/mediacollection.service';\r\nimport { MonitorService } from 'src/app/services/monitor-service/monitor.service';\r\nimport { ChqImagesUploaderComponent } from 'src/app/widgets/chq-images-uploader/chq-images-uploader.component';\r\n\r\nconst newDocumentHeader: ChqWidgetsHeaderModel = {\r\n  title: 'add_documents',\r\n  step: 3,\r\n  description: 'add_documents_msg',\r\n  stepName: 'step_three',\r\n};\r\n\r\n@Component({\r\n  selector: 'new-documents',\r\n  templateUrl: './new-documents.component.html',\r\n  styleUrls: [ './new-documents.component.scss' ]\r\n})\r\nexport class NewDocumentsComponent implements OnInit, AfterViewInit {\r\n  @Input() documentHeader: ChqWidgetsHeaderModel = newDocumentHeader;\r\n  public imageStatusSteps: UploadStepModel[] = [];\r\n  public allowExtension = [ 'jpg', 'jpeg', 'png' ];\r\n  @ViewChild('imageUploaders') imageUploaders:ChqImagesUploaderComponent;\r\n  public skipButtonModel: ChqWidgetsButtonModel = {\r\n    label: 'Skip',\r\n    type: 'primary'\r\n  }\r\n\r\n  public footer: FooterModel = {\r\n    text: 'Next add photos',\r\n    icon: 'review',\r\n    route: 'quote/case/photos',\r\n    currentStatus: '',\r\n    status: 'UploadDocuments',\r\n    caseId: ''\r\n  }\r\n\r\n  public documentSizeLimit = 5242880;\r\n  public mediaTemplate: any;\r\n  public mediaTemplateId: number;\r\n  public collectionGuid: string;\r\n  public domainId: number;\r\n  public noDocumentData = false;\r\n  private repairId:string = '';\r\n  private currentRepairStatus = '';\r\n  public objectId: number;\r\n  public mediaPartTemplates: any[];\r\n  public currentObservable:(currentStep:UploadStepModel)=>void;\r\n  public currentUploadingStep: UploadStepModel;\r\n  public showNoAccess: boolean = false;\r\n  private currentOrgId: number;\r\n\r\n  statusUpdated: boolean = false;\r\n \r\n  /**\r\n   * constructor\r\n   * @param fb ChangeDetectorRef \r\n   */\r\n  constructor(private cd: ChangeDetectorRef, private commonService: CommonService, private route: ActivatedRoute,\r\n    private caseService: CaseService,\r\n    private monitorService: MonitorService,\r\n    private bookingService:BookingService,\r\n    private mediaCollectionService: MediacollectionService) {\r\n    if (commonService.pageName.closed) {\r\n      commonService.pageName = new BehaviorSubject<string>(null);\r\n    }\r\n    commonService.pageName.next('document');\r\n\r\n    if(this.commonService.accessRight.closed) {\r\n      this.commonService.accessRight = new BehaviorSubject<boolean>(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ngAfterViewInit hook\r\n   * @param fb FormBuilder \r\n   */\r\n  ngAfterViewInit(): void {\r\n    this.commonService.updatePage('/quote/case/0', 'document');\r\n    this.cd.detectChanges();\r\n    this.monitorService.logEvent('ngAfterViewInit', [ 'ChqNewDocumentsComponent', 'addenda-quote' ]);\r\n  }\r\n\r\n  /**\r\n   * check route params\r\n   */\r\n  checkRouteParams():void {\r\n    this.route.queryParams?.subscribe((params)=>{\r\n      const codeParam = params['fromPersonal']  \r\n      if (codeParam === 'true' || codeParam === true){\r\n        this.imageStatusSteps = this.imageStatusSteps.filter((step:UploadStepModel)=>{\r\n          return step.stepName.indexOf('Vehicle Registration') != -1;\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * set current Observable\r\n   */\r\n  setObservable($event:UploadStepModel): void{\r\n    if ($event.uploadedGuid && $event.uploadedPartGuid) {\r\n      this.currentObservable = this.updateFile.bind(this);\r\n    } else {\r\n      this.currentObservable = this.uploadFile.bind(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * media template by id\r\n   */\r\n  getMediaTemplateByObject():void {\r\n    this.mediaPartTemplates = this.commonService.getAllChild(this.mediaTemplate?.mediaTemplates, 'mediaPartTemplates', 'mediaTemplateGuid',\r\n      { 'parentProp': 'name', 'childProp': 'parentName' });\r\n    for (let i = 0; i < this.mediaPartTemplates.length; i++){\r\n      const mediaPart = this.mediaPartTemplates[i];\r\n      const documentStep = documentPartMapper(mediaPart, i);\r\n      const isAdditionalImage = documentStep.stepName.toLowerCase().indexOf('additional document') != -1;\r\n      const isAdditionalDocumentFromReviewPageOnly = isAdditionalImage && !documentStep.url;\r\n      this.imageStatusSteps.push({\r\n        ...documentStep, mandatory: mediaPart.mandatory, index: i,\r\n        isAdditionalDocumentFromReviewPageOnly,\r\n        parentName: mediaPart.parentName,\r\n        isFront: mediaPart.frontSide,\r\n        updatedDate: mediaPart.mediaPartGuid != '00000000-0000-0000-0000-000000000000' ? mediaPart.updatedDate: '',\r\n        uploadedDate: mediaPart.mediaPartGuid != '00000000-0000-0000-0000-000000000000' ? mediaPart.createdDate: '',\r\n        domainId: this.domainId, objectId: this.objectId,\r\n        sizeLimit: mediaPart.sizeLimit, allowExtension: mediaPart.allowExtension,\r\n        uploadedPartGuid: mediaPart.mediaPartGuid != '00000000-0000-0000-0000-000000000000' ? mediaPart.mediaPartGuid : '',\r\n        uploadedGuid: mediaPart.mediaGuid != '00000000-0000-0000-0000-000000000000' ? mediaPart.mediaGuid:'',\r\n        partTemplateGuid: mediaPart.mediaPartTemplateGuid, templateGuid: mediaPart['mediaTemplateGuid']\r\n      });\r\n      this.checkRouteParams();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * update repair status\r\n   */\r\n  updateRepairStatus(repairId:string):void{\r\n    if(!this.statusUpdated) {      \r\n      this.statusUpdated = true;\r\n      this.bookingService.updateRepairStatus('UploadDocuments', repairId, '').subscribe({\r\n        next: ()=>{\r\n          this.currentRepairStatus = 'UploadDocuments';\r\n          this.footer.currentStatus = this.currentRepairStatus;\r\n          this.commonService.showLoading();\r\n          this.bookingService.getRepairDetailByGuid(this.repairId).subscribe({\r\n            next: async (result: any) => {\r\n              if (result?.data) {\r\n                this.commonService.repairDetails.next(result.data);\r\n                this.commonService.bookingId.next(result.data.repairNumber);                          \r\n                this.commonService.hideLoading();\r\n              }\r\n            },\r\n            error: (err: any) => {\r\n              this.monitorService.logException(err, SeverityLevel.Error);\r\n              this.commonService.hideLoading();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * upload file\r\n   */\r\n  uploadFile(currentStep:UploadStepModel):void {\r\n\r\n    const obj = {\r\n      mediaCollectionId: this.mediaTemplate.collectionGuid,\r\n      domainId: this.domainId,\r\n      objectId: this.objectId,\r\n      mediaTemplateId: currentStep.templateGuid,\r\n      mediaPartTemplateId: currentStep.partTemplateGuid\r\n    }\r\n    this.monitorService.logEvent('uploadFile', [ 'ChqNewDocumentsComponent', 'addenda-quote', {\r\n      obj\r\n    } ]);\r\n    currentStep.uploadInProgress = true;\r\n    currentStep.isSkipped = false;\r\n    currentStep.isUploadFailed = false;\r\n    currentStep.isUploadSuccess = false;\r\n    const messageForUploading = `Your photo is currently uploading won’t be long and we’ll \r\n    notify you when its uploaded, you can continue to take your photos.`;\r\n    this.commonService.showNotification(messageForUploading);\r\n    this.mediaCollectionService.uploadDocument(currentStep.imageFile, obj).subscribe( {\r\n      next: (res: any):void => {\r\n        const responseData = res?.data;\r\n        const mediaPartTemplate = this.mediaPartTemplates?.find((x: any) => x.mediaPartTemplateGuid == responseData?.mediaPartTemplateId);\r\n        if(mediaPartTemplate) {              \r\n          mediaPartTemplate.mediaGuid = responseData.mediaGuid;\r\n          mediaPartTemplate.mediaPartGuid = responseData.mediaPartGuid;\r\n          if(location.href.includes('repair') && this.currentRepairStatus?.toLowerCase() === 'draft'){\r\n            this.updateRepairStatus(this.repairId);\r\n          }\r\n          if(location.href.includes('quote') && this.footer.currentStatus?.toLowerCase() === 'vehicledetails'){\r\n            this.updateStatus();\r\n          }\r\n          this.imageUploaders.updateUploadStatus('success', currentStep, null, responseData);\r\n        }\r\n      },\r\n      error: (err: any):void => {\r\n        if(err.status != 401) {\r\n          try{\r\n            this.imageUploaders.updateUploadStatus( 'failed', currentStep, err);\r\n          }catch(e){\r\n            this.imageUploaders.updateUploadStatus('failed', currentStep);\r\n          }\r\n        }\r\n        this.monitorService.logException(err, SeverityLevel.Error);\r\n      },\r\n      complete: ():void => this.commonService.hideLoading(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * update existing document\r\n   */\r\n  updateFile(currentStep:UploadStepModel):void {\r\n    const obj = {\r\n      objectId: this.objectId,\r\n      mediaGuid: currentStep.uploadedGuid,\r\n      mediaPartGuid: currentStep.uploadedPartGuid\r\n    }\r\n\r\n    this.monitorService.logEvent('updateFile', [ 'ChqNewDocumentsComponent', 'addenda-quote', {\r\n      obj\r\n    } ]);\r\n\r\n    currentStep.uploadInProgress = true;\r\n    currentStep.isSkipped = false;\r\n    currentStep.isUploadFailed = false;\r\n    currentStep.isUploadSuccess = false;\r\n    this.mediaCollectionService.updateDocument(currentStep.imageFile, obj).subscribe({\r\n      next: (res: any): void => {\r\n        this.imageUploaders.updateUploadStatus('success', currentStep);\r\n      },\r\n      error: (err: any):void => {\r\n        if(err.status != 401) {\r\n          try{\r\n            this.imageUploaders.updateUploadStatus( 'failed', currentStep, err);\r\n          }catch(e){\r\n            this.imageUploaders.updateUploadStatus('failed', currentStep);\r\n          }\r\n        }\r\n        this.monitorService.logException(err, SeverityLevel.Error);\r\n      },\r\n      complete: ():void =>this.commonService.hideLoading(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * update status\r\n   */\r\n  updateStatus():void{\r\n    if(!this.statusUpdated) {  \r\n      this.statusUpdated = true;\r\n      this.monitorService.logEvent('updateStatus', [ 'ChqNewDocumentsComponent', 'addenda-quote', {\r\n        caseId: this.footer.caseId\r\n      } ]);\r\n      this.caseService.updateCaseStatus(this.footer.caseId, 'UploadDocuments').subscribe({\r\n        next: ()=>{\r\n          this.footer = { ...this.footer, status: '' };\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * map media template Data\r\n   * @param mediaData \r\n   */\r\n  mapMediaTemplate(mediaData: any):void {\r\n    if(this.mediaTemplate) {\r\n      try {\r\n        for(let i=0;i<this.mediaTemplate.mediaTemplates.length;i++) {\r\n          const media = this.mediaTemplate.mediaTemplates[i];\r\n          const mediaDataTemplate = mediaData.find((x:any)=> x.mediaTemplateGuid == media.mediaTemplateGuid);\r\n          if(mediaDataTemplate) {\r\n            for(let j=0;j<media.mediaPartTemplates.length;j++) {\r\n              const mediaPart = media.mediaPartTemplates[j];\r\n              const mediaDataPart = mediaDataTemplate.mediaParts.find((x: any)=> x.mediaPartTemplateGuid == mediaPart.mediaPartTemplateGuid);\r\n              mediaPart.mediaGuid = mediaDataTemplate.mediaGuid;\r\n              mediaPart.mediaPartGuid = mediaDataPart.mediaPartGuid;\r\n              mediaPart.createdDate = mediaDataPart.createdDate;\r\n              mediaPart.updatedDate = mediaDataPart.updatedDate;\r\n              mediaPart.image = mediaDataPart.getURL;\r\n              mediaPart.isUploadSuccess = false;\r\n              if(mediaPart.mediaPartGuid && mediaPart.mediaPartGuid != '00000000-0000-0000-0000-000000000000') {\r\n                mediaPart.isUploadSuccess = true;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        this.mediaTemplate = { ...this.mediaTemplate };\r\n        \r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ngOnInit hook\r\n   */\r\n  ngOnInit(): void {\r\n    this.commonService.showLoading();\r\n    const id = this.route.parent?.snapshot.paramMap.get('id');\r\n    this.monitorService.logEvent('ngOnInit', [ 'ChqNewDocumentsComponent', 'addenda-quote', {\r\n      caseId: id\r\n    } ]);\r\n    this.footer = { ...this.footer, route: `quote/case/${id}/photos`, caseId: id };\r\n\r\n    this.commonService.accessRight.subscribe({\r\n      next: (res: boolean) => {\r\n        if (!res) {\r\n          this.showNoAccess = true;\r\n        } \r\n      }\r\n    });\r\n    const promiseApi:any = {\r\n      mediaTemplate: this.mediaCollectionService.getMediaTemplate()\r\n    }\r\n    let isRepair = false;\r\n    if(location.href.includes('repair')){\r\n      promiseApi.bookingDetail = this.bookingService.getRepairDetailByGuid(id);\r\n      isRepair = true;\r\n    }else{\r\n      this.commonService.userProfileData.subscribe((res) => {\r\n        if (res && res.data) {\r\n          const { organizationDetail } = res.data;\r\n          this.currentOrgId = organizationDetail.id;\r\n        }\r\n      });\r\n      promiseApi.caseDetail = this.caseService.getCaseDetail(id);\r\n    }\r\n\r\n    const result = forkJoin(promiseApi).pipe(\r\n      catchError(error => of(error))\r\n    )\r\n    result.subscribe((dict: any) => {\r\n      if (dict) {\r\n        const mediaTemplate = dict.mediaTemplate;\r\n        if (mediaTemplate) {\r\n          const mediaTemplateSelected = mediaTemplate.data;\r\n          if (dict.caseDetail) {\r\n            const { caseNumber, id, status, inspections, repairGuid, organizationDetail } = dict.caseDetail.data;\r\n\r\n            if (this.currentOrgId != organizationDetail?.organizationId) {\r\n              this.commonService.isViewOnly = true;\r\n            } else {\r\n              this.commonService.isViewOnly = false;\r\n            }\r\n\r\n            if (inspections.length > 0) {\r\n              this.commonService.inspectionId.next(inspections[0].inspectionId);\r\n            }\r\n            this.commonService.caseStatus.next(status);\r\n            if (status.toLowerCase() === 'vehicledetails') {\r\n            //   this.updateStatus();\r\n            }else{\r\n              this.footer = { ...this.footer, status: '' };\r\n            }\r\n            this.footer.currentStatus = status;\r\n            this.documentHeader.caseNumber = caseNumber;\r\n            this.objectId = id;\r\n            if (repairGuid) {\r\n              this.footer.repairId = repairGuid;\r\n              this.footer.from = 'Quote';\r\n            }\r\n          }\r\n          if(dict.bookingDetail){\r\n            const { id, status, repairGuid, quoteId, repairNumber, isRepairCreatedFromCase, booking } = dict.bookingDetail.data;\r\n            this.objectId = id;\r\n            this.repairId = repairGuid;\r\n\r\n            //adding \r\n            if(quoteId) {\r\n              this.footer.caseId = quoteId;\r\n              this.footer.from = 'Repair';\r\n            }\r\n\r\n            this.footer.isRepairCreatedFromCase = isRepairCreatedFromCase;\r\n            this.footer.repairId = repairGuid;\r\n            this.footer.bookingId = booking?.bookingGuid;\r\n            this.footer.currentStatus = status;\r\n\r\n            this.commonService.repairStatus.next(status);\r\n            //\r\n            \r\n            this.currentRepairStatus = status;\r\n            // Send booking data in observable\r\n            this.commonService.repairDetails.next(dict.bookingDetail.data);\r\n            this.commonService.bookingId.next(repairNumber);\r\n          }\r\n          if (mediaTemplateSelected.length > 0) {\r\n            const { id, collectionGuid } = mediaTemplateSelected[0];\r\n            this.mediaTemplateId = id;\r\n            this.domainId = 2100;\r\n            if(isRepair){\r\n              this.domainId = 3100;\r\n            }\r\n            this.collectionGuid = collectionGuid;\r\n            const detailResult = forkJoin({\r\n              mediaTemplateDetail: this.mediaCollectionService.getMediaTemplateById(collectionGuid),\r\n              mediaDetail: this.mediaCollectionService.getMediaDocumentData(id, this.objectId, this.domainId)\r\n            }).pipe(\r\n              catchError(error => of(error))\r\n            )\r\n            detailResult.subscribe((detailDict: any) => {\r\n              if (detailDict) {\r\n                const { mediaTemplateDetail, mediaDetail } = detailDict;\r\n                this.mediaTemplate = mediaTemplateDetail.data;\r\n                this.mediaTemplate.mediaTemplates = mediaTemplateDetail.data.mediaTemplates.sort((media: any, mediab: any) => {\r\n                  return media.orderNumber - mediab.orderNumber;\r\n                })\r\n                if (mediaDetail.data) {\r\n                  this.mapMediaTemplate(mediaDetail.data.medias);\r\n                }\r\n                this.getMediaTemplateByObject();\r\n              }\r\n              this.commonService.hideLoading();\r\n            }, (err) => {\r\n              this.commonService.hideLoading();\r\n              this.monitorService.logException(err, SeverityLevel.Error);\r\n            });\r\n           \r\n          } else {\r\n            this.commonService.hideLoading();\r\n          }\r\n        }else {\r\n          this.noDocumentData = true;\r\n          this.commonService.hideLoading();\r\n        }\r\n        \r\n      } else {\r\n        this.noDocumentData = true;\r\n        this.commonService.hideLoading();\r\n      }\r\n    });\r\n    const container: any = document.querySelector('.addenda-container');\r\n    if(container){\r\n      container.scrollTop = 0;\r\n    }\r\n    \r\n  }\r\n\r\n  /**\r\n   * handled if step is skipped\r\n   */\r\n  stepSkipped(): void {\r\n    if(location.href.includes('repair') && this.currentRepairStatus?.toLowerCase() === 'draft'){\r\n      this.updateRepairStatus(this.repairId);\r\n    }\r\n    if(location.href.includes('quote') && this.footer.currentStatus?.toLowerCase() === 'vehicledetails'){\r\n      this.updateStatus();\r\n    }\r\n  }\r\n \r\n  /**\r\n   * on destroy\r\n  */\r\n  ngOnDestroy(): void {\r\n    this.monitorService.logEvent('ngOnDestroy', [ 'ChqNewDocumentComponent', 'addenda-quote' ]);\r\n    this.commonService.accessRight.unsubscribe();\r\n\r\n    if(location.href.includes('quote')){\r\n      this.commonService.isViewOnly = false;\r\n    }\r\n  }\r\n}\r\n","<div *ngIf=\"!showNoAccess\" [ngClass]=\"{'photo-container': photosHeader.isRepairModule}\">\r\n    <ng-container *chqPermission=\"'newBooking'\">\r\n        <add-photos [caseData]=\"caseData\" [caseNumber]=\"photosHeader.caseNumber\" [showSPI]=\"checkRepairTypes\"\r\n            [photosHeader]=\"addPhotosHeader\" (mode)=\"handleMode($event)\" *ngIf=\"showUploading === false\"\r\n            [hidden]=\"hideContent\" [showEstimate]=\"showEstimateButton\" [repairData]=\"repairDetail\"></add-photos>\r\n    </ng-container>\r\n\r\n    <div class=\"wrapper\" *ngIf=\"noImagesData\">\r\n        <div class=\"no-document-div\">\r\n            <img src=\"assets/icons/no-document.svg\">\r\n            <label class=\"no-vehicle-content\">\r\n                {{'no_photos_configured' | translate }}\r\n            </label>\r\n\r\n        </div>\r\n        <div class=\"empty-wrapper\">\r\n            <div class=\"step-container\"></div>\r\n            <div class=\"step-container\"></div>\r\n            <div class=\"step-container\"></div>\r\n            <div class=\"step-container\"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div *ngIf=\"noImagesData\" class=\"footer-full-wrapper\">\r\n        <div class=\"footer-image-wrapper\">\r\n            <div class=\"image-wrapper\">\r\n                <img src=\"assets/img/{{ + photosHeader.isRepairModule ?'addenda-repair.png':'addenda-quote.png'}}\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <chq-images-uploader [hidden]=\"showDamageAnalysis || !showUploading\" (handleDeleteAllEvent)=\"handleDeleteAll()\"\r\n        (backToUpload)=\"this.setInitialMode();\" [currentAdditionalModeMultiple]=\"currentAdditionalModeMultiple\"\r\n        [fileUploaderService]=\"currentObservable\" #imageUploaders [footerOptions]=\"footer\"\r\n        (updateMassUpload)=\"updateCurrentStatus($event);\"\r\n        *ngIf=\"(showUploading === true || isMultipleUpload) || (imageStatusSteps && imageStatusSteps.length > 0)\"\r\n        [isMassUpload]=\"isMultipleUpload\" [showReTakeDelete]=\"true\" [imageStatusSteps]=\"imageStatusSteps\"\r\n        [header]=\"photosHeader\" [inspectionId]=\"inspectionId\" [inspection]=\"'photos'\" (stepSkipped)=\"stepSkipped()\"></chq-images-uploader>\r\n    <damage-analysis *ngIf=\"showDamageAnalysis\" [isBulkUpload]=\"isMultipleUpload\"\r\n        [minPhotoRequired]=\"minimumPhotosRequired\" [caseDetail]=\"partialCaseDetail || repairDetail\"\r\n        [steps]=\"imageStatusSteps\" [isRepairModule]=\"photosHeader.isRepairModule\"\r\n        (backEvent)=\"handleBack($event)\"></damage-analysis>\r\n</div>\r\n<no-access-error *ngIf=\"showNoAccess\"></no-access-error>","import { AfterViewInit, ChangeDetectorRef, Component, EventEmitter, Input, OnDestroy, OnInit, Output, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { SeverityLevel } from '@microsoft/applicationinsights-web';\r\nimport { BehaviorSubject, catchError, forkJoin, of, Subject } from 'rxjs';\r\nimport { PartialCaseDetail } from 'src/app/model/chq-cases-model';\r\nimport { ChqInspectionStep } from 'src/app/model/chq-inspection-step';\r\nimport { FooterModel, Modules, UploadStepModel } from 'src/app/model/chq-upload-model';\r\nimport { ChqWidgetsHeaderModel } from 'src/app/model/chq-widgets-header-model';\r\nimport { inspectionpartPartMapper } from 'src/app/modules/quote/chq-new-cases/chq-new-customer/chq-new-customer-form-data-helper';\r\nimport { BookingService } from 'src/app/services/booking/booking.service';\r\nimport { CaseService } from 'src/app/services/case/case.service';\r\nimport { CommonService } from 'src/app/services/common/common.service';\r\nimport { InspectionService } from 'src/app/services/inspection-service/inspection.service';\r\nimport { MonitorService } from 'src/app/services/monitor-service/monitor.service';\r\nimport { RepairEstimateService } from 'src/app/services/repair-estimate/repair-estimate.service';\r\nimport { ChqImagesUploaderComponent } from 'src/app/widgets/chq-images-uploader/chq-images-uploader.component';\r\n\r\n\r\nconst photosHeader: ChqWidgetsHeaderModel = {\r\n  title: 'add_damage_photos',\r\n  step: 4,\r\n  description: 'damage_photos_msg',\r\n  stepName: 'step_four',\r\n};\r\n\r\n@Component({\r\n  selector: 'new-photos',\r\n  templateUrl: './new-photos.component.html',\r\n  styleUrls: [ './new-photos.component.scss' ]\r\n})\r\nexport class NewPhotosComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  @Input() photosHeader: ChqWidgetsHeaderModel = photosHeader;\r\n  @Output() currentUploadMode: EventEmitter<{ 'mode': string, 'id'?: string }> = new EventEmitter();\r\n  addPhotosHeader: ChqWidgetsHeaderModel;\r\n  public imageStatusSteps: UploadStepModel[] = [];\r\n  public showUploading: boolean = false;\r\n  public isMultipleUpload: boolean = false;\r\n  public triggerMassUpload: boolean = false;\r\n  public caseStatus = '';\r\n  public caseId: string = '0';\r\n  public inspection: any;\r\n  public bookingId: string = '';\r\n  public vehicleId: number;\r\n  public domainId: number;\r\n  public uploadType: string;\r\n  public showDamageAnalysis: boolean;\r\n  public objectId: number;\r\n  public minimumPhotosRequired: number = 0;\r\n  public hideContent: boolean = true;\r\n  public currentAdditionalModeMultiple = false;\r\n  public vehicelType: string;\r\n  public isBulkUploaded: boolean;\r\n  public caseData: any;\r\n  public inspectionId: number;\r\n  private currentInspectionTemplate: any;\r\n  public hideUploaders = false;\r\n  private repairTypes: any = [];\r\n  private repairType = '';\r\n  public noImagesData:boolean = false;\r\n  private repairId: string = '';\r\n  public inspectionTemplatesJSONString = '';\r\n  private currentRepairStatus = '';\r\n  public partialCaseDetail: PartialCaseDetail;\r\n  public repairDetail: any;\r\n  @ViewChild('imageUploaders') imageUploaders: ChqImagesUploaderComponent;\r\n  public inspectionTemplateId: number;\r\n  public currentObservable: (currentStep: UploadStepModel) => void;\r\n  public inspectionTemplates: ChqInspectionStep[];\r\n  public inspectionItemTemplates: ChqInspectionStep[];\r\n  public inspectionTemplateList: any[];\r\n  public inspectionDetail: any;\r\n  public originalSteps: UploadStepModel[] = [];\r\n  public showNoAccess: boolean = false;\r\n  public footer: FooterModel = {\r\n    text: 'Next create estimate',\r\n    icon: 'boardview',\r\n    route: 'case/gt',\r\n    status: 'UploadPhotos',\r\n    caseId: '',\r\n    currentStatus: '',\r\n    showButton: true,\r\n    showUploadOption: true\r\n  }\r\n\r\n  statusUpdated: boolean = false;\r\n  private currentOrgId: number;\r\n\r\n  /**\r\n   * handle back\r\n   */\r\n  handleBack($event: { back: boolean }): void {\r\n    this.showDamageAnalysis = !$event.back;\r\n  }\r\n\r\n  /**\r\n   * check repair types\r\n   */\r\n  get checkRepairTypes(): boolean {\r\n    if (location.href.indexOf('repair') === -1) {\r\n      return true;\r\n    }\r\n\r\n    if (this.repairType !== 'repair') {\r\n      return true;\r\n    }\r\n\r\n    return this.repairTypes.filter((v) => {\r\n      return v.repairServiceType === 'Body' || v.repairServiceType === 'Paint';\r\n    }).length > 0;\r\n  }\r\n\r\n  /**\r\n   * go to gtEstimate\r\n   */\r\n  redirectToGtEstimate(): void {\r\n    this.commonService.showLoading();\r\n    if (this.caseStatus?.toLowerCase() === 'uploaddocuments' || this.caseStatus?.toLowerCase() === 'uploadphotos') {\r\n      this.estimateService.createEstimate(this.caseId, this.inspectionId, this.vehicleId, this.domainId).subscribe({\r\n        next: (resp: any) => {\r\n          if (resp) {\r\n            if (resp?.data?.url) {\r\n              location.href = resp.data.url;\r\n              sessionStorage.setItem('update', '1');\r\n            }\r\n          }\r\n        },\r\n        complete: () => {\r\n          this.commonService.hideLoading();\r\n        }\r\n      });\r\n    } else {\r\n      this.router.navigate([ `/quote/case/${this.caseId}/estimate` ]);\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * constructor\r\n   * @param fb ChangeDetectorRef \r\n   */\r\n  constructor(private cd: ChangeDetectorRef, private commonService: CommonService,\r\n    private route: ActivatedRoute,\r\n    private router: Router, private caseService: CaseService,\r\n    private monitorService: MonitorService,\r\n    private inspectionService: InspectionService,\r\n    private bookingService: BookingService,\r\n    private estimateService: RepairEstimateService) {\r\n    if (commonService.pageName.closed) {\r\n      commonService.pageName = new BehaviorSubject<string>(null);\r\n    }\r\n    commonService.pageName.next('photos');\r\n\r\n    if (this.commonService.accessRight.closed) {\r\n      this.commonService.accessRight = new BehaviorSubject<boolean>(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * update page status\r\n   */\r\n  updateCurrentStatus($event): void {\r\n    this.monitorService.logEvent('updateCurrentStatus', [ 'ChqNewPhotosComponent', 'addenda-quote', {\r\n      caseId: $event\r\n    } ]);\r\n    if ($event.initial) {\r\n      this.setInitialMode();\r\n      return;\r\n    }\r\n    this.showUploading = true;\r\n\r\n    // if ((this.footer.repairId && this.footer.from == Modules.quote)\r\n    // || (this.footer.caseId && this.footer.from == Modules.repair)) {\r\n\r\n    //   this.commonService.showChangeWarningMessage(this.uploadBulkUploadFile.bind(this, $event.steps),\r\n    //     this.footer.from == Modules.quote ? 'Repair' : 'Quote');\r\n    // } else {\r\n    //   this.uploadBulkUploadFile($event.steps);\r\n    // }\r\n    this.uploadBulkUploadFile($event.steps);\r\n  }\r\n\r\n  /**\r\n   * handle delete all\r\n   */\r\n  handleDeleteAll(): void {\r\n    this.setInitialMode();\r\n  }\r\n\r\n  /**\r\n   * ngAfterViewInit hook\r\n   */\r\n  ngAfterViewInit(): void {\r\n    this.commonService.updatePage('/quote/case/0', 'photos');\r\n    this.cd.detectChanges();\r\n    this.monitorService.logEvent('ngAfterViewInit', [ 'ChqNewPhotosComponent', 'addenda-quote' ]);\r\n  }\r\n\r\n  /**\r\n * upload bulk file\r\n * @param uploads \r\n */\r\n  uploadBulkUploadFile(uploads: UploadStepModel[]): void {\r\n    for (let i = 0; i < uploads?.length; i++) {\r\n\r\n      const img = new Image();\r\n      img.src = uploads[i].image as string;\r\n      img.onload = (): void => {\r\n        const uploadObject = {\r\n          'height': img.height,\r\n          'width': img.width,\r\n          'inspectionId': this.inspectionId,\r\n          'templateId': this.inspectionTemplateId,\r\n          'type': this.vehicelType || '',\r\n          'isBulk': true\r\n        }\r\n        const step = uploads[i];\r\n        step.uploadInProgress = true;\r\n        step.isSkipped = false;\r\n        step.isUploadFailed = false;\r\n        step.isUploadSuccess = false;\r\n        this.monitorService.logEvent('uploadBulkUploadFile', [ 'ChqNewPhotosComponent', 'addenda-quote', {\r\n          uploadObject\r\n        } ]);\r\n        this.inspectionService.uploadImageBulk(uploadObject, step.imageFile).subscribe({\r\n          next: (data: any) => {\r\n            step.url = data.rawImage?.rawAzureBlobUrl;\r\n            step.inspectionItem = data;\r\n            step.procedureSteps = 'Bulk Upload Image';\r\n            this.imageUploaders.updateUploadStatus('success', step, null, data);\r\n            this.footer = { ...this.footer, showUploadOption: false };\r\n            if (location.href.includes('repair') && (this.currentRepairStatus?.toLowerCase() === 'draft' || this.currentRepairStatus?.toLowerCase() === 'uploaddocuments')) {\r\n              this.updateRepairStatus(this.repairId);\r\n            }\r\n            if (location.href.includes('quote') && (this.footer.currentStatus?.toLowerCase() === 'uploaddocuments')) {\r\n              this.updateStatus();\r\n            }\r\n          },\r\n          error: (err: any) => {\r\n            if (err.status != 401) {\r\n              this.imageUploaders.imageStatusSteps = this.imageUploaders.imageStatusSteps.filter((ig: UploadStepModel) => {\r\n                return (ig.index !== step.index || ig.stepName !== step.stepName || ig.uploadInProgress !== true);\r\n              })\r\n              this.imageUploaders.updateUploadStatus('failed', step, err, null, true);\r\n            }\r\n            this.monitorService.logException(err, SeverityLevel.Error);\r\n          },\r\n        })\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * update repair status\r\n   */\r\n  updateRepairStatus(repairId: string): void {\r\n    if(!this.statusUpdated) {  \r\n      this.statusUpdated = true;\r\n      this.bookingService.updateRepairStatus('UploadPhotos', repairId, '').subscribe({\r\n        next: () => {\r\n          this.currentRepairStatus = 'UploadPhotos';\r\n          this.footer.currentStatus = this.currentRepairStatus;\r\n          this.commonService.showLoading();\r\n          this.bookingService.getRepairDetailByGuid(this.repairId).subscribe({\r\n            next: async (result: any) => {\r\n              if (result?.data) {\r\n                this.commonService.repairDetails.next(result.data);\r\n                this.commonService.bookingId.next(result.data.repairNumber);                          \r\n                this.commonService.hideLoading();\r\n              }\r\n            },\r\n            error: (err: any) => {\r\n              this.monitorService.logException(err, SeverityLevel.Error);\r\n              this.commonService.hideLoading();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n    \r\n  }\r\n\r\n  /**\r\n   * upload photos\r\n   */\r\n  uploadFile(currentStep: UploadStepModel): void {\r\n    const uploadObject = {\r\n      'height': currentStep.imageHeight,\r\n      'width': currentStep.imageWidth,\r\n      'inspectionId': this.inspectionId,\r\n      'templateId': this.inspectionTemplateId,\r\n      'inspectionitemId': currentStep.inspectionItem.id,\r\n      'type': this.vehicelType || '',\r\n      'isBulk': false\r\n    }\r\n\r\n    this.monitorService.logEvent('uploadFile', [ 'ChqNewPhotosComponent', 'addenda-quote', {\r\n      uploadObject\r\n    } ]);\r\n\r\n    currentStep.uploadInProgress = true;\r\n    currentStep.isSkipped = false;\r\n    currentStep.isUploadFailed = false;\r\n    currentStep.isUploadSuccess = false;\r\n    this.commonService.inProgressSteps.next(1);\r\n    this.footer = { ...this.footer, showUploadOption: false };\r\n    this.commonService.showNotification(`Your photo ‘${currentStep.stepName}’ is currently uploading won’t be long and we’ll notify \r\n       you when its uploaded, you can continue to take your photos.`);\r\n    this.inspectionService.uploadImageBulk(uploadObject, currentStep.imageFile).subscribe({\r\n      next: (data: any) => {\r\n        const msg = `Your photo ‘${currentStep.stepName}’ is uploaded successfully.`;\r\n        this.commonService.showNotification(msg);\r\n        const inspectionItem = this.inspectionItemTemplates?.find((x: any) => x.inspectionItem.id == data?.id);\r\n        inspectionItem.inspectionItem.rawAzureBlobUrl = data.rawImage?.rawAzureBlobUrl;\r\n        if (inspectionItem) {\r\n          currentStep.url = data.rawImage?.rawAzureBlobUrl;\r\n          this.imageUploaders.updateUploadStatus('success', currentStep, null, data);\r\n        }\r\n        if (location.href.includes('repair') && (this.currentRepairStatus == 'Draft' || this.currentRepairStatus === 'UploadDocuments')) {\r\n          this.updateRepairStatus(this.repairId);\r\n        }\r\n        if (location.href.includes('quote') && (this.footer.currentStatus?.toLowerCase() === 'uploaddocuments')) {\r\n          this.updateStatus();\r\n        }\r\n      },\r\n      error: (err: any) => {\r\n        if (err.status != 401) {\r\n          const msg = `Your photo ‘${currentStep.stepName}’ failed to upload. Please try to upload again.`;\r\n          this.commonService.showNotification(msg);\r\n          this.imageUploaders.updateUploadStatus('failed', currentStep, err);\r\n          this.monitorService.logException(err, SeverityLevel.Error);\r\n        }\r\n      },\r\n    })\r\n  }\r\n\r\n  /**\r\n   * on destroy\r\n   */\r\n  ngOnDestroy(): void {\r\n    this.commonService.pageName.unsubscribe();\r\n    this.commonService.accessRight.unsubscribe();\r\n    if(location.href.includes('quote')){\r\n      this.commonService.isViewOnly = false;\r\n    }\r\n    this.monitorService.logEvent('ngOnDestroy', [ 'ChqNewPhotosComponent', 'addenda-quote' ]);\r\n  }\r\n\r\n  /**\r\n   * showRepairButton\r\n   */\r\n  get showEstimateButton(): boolean {\r\n    return this.currentInspectionTemplate?.minImageLimit === 0 && this.inspectionItemTemplates?.filter((value: ChqInspectionStep) => {\r\n      return value.isSkipEnabled !== true;\r\n    }).length === 0;\r\n  }\r\n\r\n  /**\r\n   * map inspection from api\r\n   * @param inspectionData \r\n   */\r\n  mapInspection(inspectionData: any): void {\r\n    if (inspectionData) {\r\n      try {\r\n        this.inspection = inspectionData;\r\n        this.uploadType = this.inspection.uploadType;\r\n        let currentMode = 'SPI';\r\n        if (this.uploadType) {\r\n          this.footer = { ...this.footer, showUploadOption: false };\r\n        }\r\n        if (this.uploadType === 'Bulk') {\r\n          currentMode = 'BULK';\r\n        }\r\n        const bulkUploadTemplateItem = this.inspectionTemplates?.filter(step => step.name === 'Bulk Upload Image');\r\n        const bulkUploadedItemsWithImages = this.inspection.inspectionItems?.filter((step) => {\r\n          return (step.name === 'Bulk Upload Image' || step.inspectionItemTemplateID === bulkUploadTemplateItem[0].id)\r\n              && step.rawAzureBlobUrl\r\n        });\r\n        if (bulkUploadedItemsWithImages?.length > 0 || this.uploadType === 'Bulk') {\r\n          const massUploadItems = [];\r\n          this.currentUploadMode.emit({ 'mode': 'multiple' });\r\n          for (const i in bulkUploadedItemsWithImages) {\r\n            const currentObj = {\r\n              ...bulkUploadTemplateItem[0], name: bulkUploadedItemsWithImages[i].name || bulkUploadTemplateItem[0].name,\r\n              inspectionItem: bulkUploadedItemsWithImages[i]\r\n            }\r\n            massUploadItems.push(currentObj);\r\n          }\r\n          this.inspectionItemTemplates = massUploadItems;\r\n        } else {\r\n\r\n          this.currentUploadMode.emit({ 'mode': 'single' });\r\n          this.inspectionTemplates?.map((chqInspectionStep: ChqInspectionStep) => {\r\n            const item = this.inspection.inspectionItems?.find((el: any) => el.inspectionItemTemplateID == chqInspectionStep.id);\r\n            if (item) {\r\n              chqInspectionStep['inspectionItem'] = item;\r\n            }\r\n          });\r\n          this.inspectionItemTemplates = this.inspectionTemplates?.filter(step => step.name != 'Bulk Upload Image');\r\n        }\r\n        if(bulkUploadTemplateItem?.length > 0) this.inspectionTemplateId = bulkUploadTemplateItem[0].id;\r\n\r\n        this.inspectionItemTemplates?.map((x: ChqInspectionStep) => {\r\n          if (x.inspectionItem?.rawAzureBlobUrl) {\r\n            x.isUploadSuccess = true;\r\n            x.image = x.inspectionItem?.rawAzureBlobUrl;\r\n          } else {\r\n            if (!x.inspectionItem) {\r\n              x.inspectionItem = { rawAzureBlobUrl: '' };\r\n            }\r\n            x.inspectionItem.rawAzureBlobUrl = '';\r\n            x.isUploadFailed = false;\r\n            x.isUploadSuccess = false;\r\n            x.uploadInProgress = false;\r\n          }\r\n        })\r\n        if (this.uploadType) {\r\n          if (currentMode === 'SPI') {\r\n            this.isMultipleUpload = false;\r\n            this.showUploading = true;\r\n            if (this.addPhotosHeader.isRepairModule) {\r\n              this.photosHeader = { ...this.photosHeader, title: 'back_smart_photo' };\r\n            }\r\n            this.minimumPhotosRequired = this.inspectionItemTemplates?.filter((value: ChqInspectionStep) => {\r\n              return value.isSkipEnabled !== true;\r\n            }).length;\r\n            this.currentObservable = this.uploadFile.bind(this);\r\n          } else {\r\n            this.currentObservable = this.uploadBulkUploadFile.bind(this);\r\n            this.isMultipleUpload = true;\r\n            this.minimumPhotosRequired = this.currentInspectionTemplate.minImageLimit;\r\n            this.triggerMassUpload = true;\r\n            this.isBulkUploaded = true;\r\n            if (this.addPhotosHeader.isRepairModule) {\r\n              this.photosHeader = { ...this.photosHeader, title: 'bulk_upload' };\r\n            }\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        console.log(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * inspection detail by id\r\n   */\r\n  getInspectionTemplateByObject(): void {\r\n    for (let i = 0; i < this.inspectionItemTemplates?.length; i++) {\r\n      const templatePart = this.inspectionItemTemplates[i];\r\n      const inspectionStep = inspectionpartPartMapper(templatePart, i);\r\n      const isAdditionalImage = inspectionStep.stepName?.toLowerCase().indexOf('additional photo') != -1;\r\n      const isMassUpload = inspectionStep.stepName?.toLowerCase().indexOf('bulk upload image') != -1;\r\n      const isAdditionalDocumentFromReviewPageOnly = isAdditionalImage && !inspectionStep.url;\r\n      this.imageStatusSteps.push({\r\n        ...inspectionStep, mandatory: !templatePart.isSkipEnabled, index: i,\r\n        isAdditionalDocumentFromReviewPageOnly,\r\n        isMassUpload,\r\n        updatedDate: inspectionStep.url ? templatePart?.inspectionItem?.updatedDate : '',\r\n        uploadedDate: inspectionStep.url ? templatePart?.inspectionItem?.created : '',\r\n        domainId: this.domainId, objectId: this.objectId,\r\n        uploadedPartGuid: '',\r\n        uploadedGuid: ''\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * update status\r\n   */\r\n  updateStatus(): void {\r\n    if(!this.statusUpdated) {  \r\n      this.statusUpdated = true;\r\n      this.monitorService.logEvent('updateStatus', [ 'ChqNewPhotosComponent', 'addenda-quote' ]);\r\n      this.caseService.updateCaseStatus(this.caseId, 'UploadPhotos').subscribe({\r\n        next: () => {\r\n          this.footer = { ...this.footer, status: '' };\r\n          this.partialCaseDetail.status = 'UploadPhotos';\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * handled if step is skipped\r\n   */\r\n  stepSkipped(): void {\r\n    if (location.href.includes('repair') && (this.currentRepairStatus?.toLowerCase() === 'draft' || this.currentRepairStatus?.toLowerCase() === 'uploaddocuments')) {\r\n      this.updateRepairStatus(this.repairId);\r\n    }\r\n    if (location.href.includes('quote') && (this.footer.currentStatus?.toLowerCase() === 'uploaddocuments')) {\r\n      this.updateStatus();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * load server details\r\n   */\r\n  loadApiData(id: string): void {\r\n    if (id && id != '0') {\r\n      this.caseId = id;\r\n      this.bookingId = id;\r\n      this.commonService.showLoading();\r\n      this.inspectionService.getInspectionTemplateList().subscribe({\r\n        next: (inspectionList: any) => {\r\n          let isRepair = false;\r\n          let inspectionTemplateId = 0;\r\n          if (location.href.includes('repair')) {\r\n            isRepair = true;\r\n          }\r\n          const repairInspectionTemplate = inspectionList?.data;\r\n\r\n          if (repairInspectionTemplate?.length > 0) {\r\n            this.commonService.repairInspectionTemplate = repairInspectionTemplate[0];\r\n            inspectionTemplateId = repairInspectionTemplate[0].id\r\n          }\r\n          const promiseApi: any = {};\r\n          promiseApi.inspectionTemplate = this.inspectionService.getInspectionTemplate(inspectionTemplateId);\r\n          if (isRepair) {\r\n            promiseApi.bookingDetail = this.bookingService.getRepairDetailByGuid(id);\r\n\r\n          } else {\r\n            this.commonService.userProfileData.subscribe((res) => {\r\n              if (res && res.data) {\r\n                const { organizationDetail } = res.data;\r\n                this.currentOrgId = organizationDetail.id;\r\n              }\r\n            });\r\n            promiseApi.caseDetail = this.caseService.getCaseDetail(id);\r\n          }\r\n          const serverDetails = forkJoin(promiseApi).pipe(\r\n            catchError(error => of(error))\r\n          )\r\n          serverDetails.subscribe({\r\n            next: (resultMap: any) => {\r\n              if (resultMap.inspectionTemplate) {\r\n\r\n                const inspectionTemplateDetail = resultMap.inspectionTemplate.inspectionItemTemplates;\r\n                this.currentInspectionTemplate = resultMap.inspectionTemplate;\r\n                if (resultMap.inspectionDetail) {\r\n                  this.inspectionDetail = resultMap.inspectionDetail;\r\n                }\r\n                this.inspectionTemplates = inspectionTemplateDetail;\r\n                this.inspectionTemplatesJSONString = JSON.stringify(this.inspectionTemplates);\r\n                if (resultMap.caseDetail) {\r\n                  const { caseNumber, id, status, statusId, domainID, inspections, vehicleModel, vehicleId, organizationDetail } = resultMap.caseDetail.data;\r\n                  this.caseData = resultMap.caseDetail.data;\r\n                  this.partialCaseDetail = resultMap.caseDetail.data;\r\n\r\n                  if (this.currentOrgId != organizationDetail?.organizationId) {\r\n                    this.commonService.isViewOnly = true;\r\n                  } else {\r\n                    this.commonService.isViewOnly = false;\r\n                  }\r\n\r\n                  this.vehicelType = vehicleModel;\r\n                  this.vehicleId = vehicleId;\r\n                  this.domainId = domainID;\r\n                  this.commonService.caseStatus.next(status);\r\n                  this.caseStatus = status;\r\n                  if (status?.toLowerCase() === 'uploaddocuments') {\r\n                    //this.updateStatus();\r\n                  } else {\r\n                    this.footer = { ...this.footer, status: '', caseId: id }\r\n                  }\r\n                  this.footer.currentStatus = status;\r\n                  if (inspections?.length > 0) {\r\n                    this.inspectionId = inspections[0].inspectionId;\r\n                    this.commonService.inspectionId.next(this.inspectionId);\r\n                  }\r\n                  this.photosHeader.caseNumber = caseNumber;\r\n\r\n                  if (this.caseData.repairGuid) {\r\n                    this.footer.repairId = this.caseData.repairGuid;\r\n                    this.footer.from = Modules.quote;\r\n                  }\r\n\r\n                  this.objectId = id;\r\n                }\r\n                if (resultMap.bookingDetail) {\r\n                  const { id, vehicle, repairServiceTypes, repairGuid, domainId, status, quoteId, repairType, repairNumber, booking, isRepairCreatedFromCase } = resultMap.bookingDetail.data;\r\n                  this.repairDetail = resultMap.bookingDetail.data;\r\n                  const { vehicleModel, vehicleId } = vehicle;\r\n\r\n                  this.objectId = id;\r\n                  this.domainId = domainId;\r\n                  this.repairId = repairGuid;\r\n                  this.currentRepairStatus = status;\r\n                  this.repairTypes = repairServiceTypes;\r\n                  this.repairType = repairType;\r\n                  this.inspectionId = vehicle.inspectionId;\r\n                  this.vehicelType = vehicleModel;\r\n                  this.vehicleId = vehicleId;\r\n\r\n                  this.footer = { ...this.footer, currentStatus: status, isRepairModule: true, caseId: quoteId, \r\n                    from: Modules.repair, repairTypes: repairServiceTypes, isRepairCreatedFromCase: isRepairCreatedFromCase, bookingId: booking?.bookingGuid };\r\n                  // Send booking data in observable\r\n                  this.commonService.repairDetails.next(resultMap.bookingDetail.data)\r\n                  this.commonService.bookingId.next(repairNumber);\r\n                  this.commonService.repairStatus.next(status);\r\n                }\r\n\r\n                if (this.inspectionId) {\r\n                  this.inspectionService.getInspection(this.inspectionId).subscribe({\r\n                    next: (inspectionDetailResponse: any) => {\r\n                      if (inspectionDetailResponse) {\r\n                        this.mapInspection(inspectionDetailResponse);\r\n                        this.noImagesData = false;\r\n                        this.getInspectionTemplateByObject();\r\n                        setTimeout(() => {\r\n                          this.hideContent = false;\r\n                          if (this.isBulkUploaded) {\r\n                            this.showUploading = true;\r\n                            this.isMultipleUpload = true;\r\n                            this.currentAdditionalModeMultiple = true;\r\n                          }\r\n                          if (this.uploadType) {\r\n                            this.imageUploaders.goToReview();\r\n                          }\r\n                        })\r\n                      }\r\n                    },\r\n                    error: ()=>{\r\n                      this.noImagesData = true;\r\n                    },\r\n                    complete: () => {\r\n                      this.commonService.hideLoading();\r\n                    },\r\n                  });\r\n                } else {\r\n                  this.noImagesData = true;\r\n                  this.hideContent = false;\r\n                  this.commonService.hideLoading();\r\n                }\r\n              }else{\r\n                this.noImagesData = true;\r\n                this.commonService.hideLoading();\r\n              }\r\n            }\r\n          });\r\n        }, error: ()=>{\r\n          this.noImagesData = true;\r\n          this.commonService.hideLoading();\r\n        }\r\n      });\r\n\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * oninit\r\n   */\r\n  ngOnInit(): void {\r\n    const currentObjectId = this.route.parent?.snapshot.paramMap.get('id');\r\n    this.addPhotosHeader = { ...this.photosHeader, isHeaderOnly: false };\r\n    this.monitorService.logEvent('ngOnInit', [ 'ChqNewPhotosComponent', 'addenda-quote', {\r\n      caseId: currentObjectId,\r\n      repairId: currentObjectId\r\n    } ]);\r\n\r\n    this.footer = {\r\n      ...this.footer, caseId: this.photosHeader.isRepairModule? '': currentObjectId,\r\n      repairId: this.photosHeader.isRepairModule? currentObjectId: '', \r\n      handleBack: this.handleBack.bind(this)\r\n      , finalRedirection: this.redirectToGtEstimate.bind(this) }\r\n\r\n    this.commonService.accessRight.subscribe({\r\n      next: (res: boolean) => {\r\n        if (!res) {\r\n          this.showNoAccess = true;\r\n        }\r\n      }\r\n    });\r\n    \r\n    this.loadApiData(currentObjectId);\r\n    const container: any = document.querySelector('.addenda-container');\r\n    if (container) {\r\n      container.scrollTop = 0;\r\n    }\r\n\r\n    this.currentObservable = this.uploadFile.bind(this);\r\n  }\r\n\r\n  /**\r\n   * reload inspection and map\r\n   */\r\n  public reloadInspection(): void {\r\n    this.commonService.showLoading();\r\n    this.inspectionTemplates = JSON.parse(this.inspectionTemplatesJSONString);\r\n    if (this.inspectionId) {\r\n      this.inspectionService.getInspection(this.inspectionId).subscribe({\r\n        next: (inspectionDetailResponse: any) => {\r\n          if (inspectionDetailResponse) {\r\n            this.mapInspection(inspectionDetailResponse);\r\n            this.getInspectionTemplateByObject();\r\n            this.isMultipleUpload = false;\r\n\r\n            this.isBulkUploaded = false;\r\n            this.currentAdditionalModeMultiple = false;\r\n            this.triggerMassUpload = false;\r\n            setTimeout(() => {\r\n              this.hideContent = false;\r\n              this.showUploading = true;\r\n            })\r\n\r\n          }\r\n        },\r\n        complete: () => {\r\n          this.commonService.hideLoading();\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * set to initial mode\r\n   */\r\n  setInitialMode(): void {\r\n    this.showUploading = false;\r\n    this.imageStatusSteps = [];\r\n    this.triggerMassUpload = false;\r\n    this.isBulkUploaded = false;\r\n    this.imageUploaders.isReviewSection = false;\r\n    this.isMultipleUpload = false;\r\n    this.currentAdditionalModeMultiple = false;\r\n  }\r\n\r\n  /**\r\n   *handle mode selection\r\n   * @param $event \r\n   */\r\n  handleMode($event: any): void {\r\n    this.monitorService.logEvent('handleMode', [ 'ChqNewPhotosComponent', 'addenda-quote', {\r\n      $event\r\n    } ]);\r\n    if (!this.inspectionId) {\r\n      this.currentUploadMode.emit({ 'mode': 'error', 'id': this.bookingId });\r\n      return;\r\n    }\r\n    this.currentUploadMode.emit($event);\r\n\r\n    if ($event.mode === 'single') {\r\n\r\n      if (this.imageStatusSteps?.length === 0) {\r\n        this.isMultipleUpload = false;\r\n        this.isBulkUploaded = false;\r\n        this.currentAdditionalModeMultiple = false;\r\n        this.triggerMassUpload = false;\r\n        this.minimumPhotosRequired = this.inspectionItemTemplates.filter((value: ChqInspectionStep) => {\r\n          return value.isSkipEnabled !== true;\r\n        }).length;\r\n        this.reloadInspection();\r\n      } else {\r\n        this.isMultipleUpload = false;\r\n        this.showUploading = true;\r\n        this.isBulkUploaded = false;\r\n        this.currentAdditionalModeMultiple = false;\r\n        this.minimumPhotosRequired = this.currentInspectionTemplate.minImageLimit;\r\n        this.triggerMassUpload = false;\r\n      }\r\n\r\n      this.currentObservable = this.uploadFile.bind(this);\r\n    } else {\r\n      this.imageStatusSteps = [];\r\n      this.currentObservable = this.uploadBulkUploadFile.bind(this);\r\n      this.isMultipleUpload = true;\r\n      this.triggerMassUpload = true;\r\n      this.showUploading = true;\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { WidgetsModule } from 'src/app/widgets/chq-widgets.module';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { CanDeactivateGuard } from 'src/app/guards/deactivate-gaurd/deactivate-gaurd.guard';\r\nimport { ErrorModule } from 'src/app/shared/error-page/error.module';\r\nimport { NewDocumentsComponent } from './new-documents/new-documents.component';\r\nimport { NewPhotosComponent } from './new-photos/new-photos.component';\r\nimport { AddPhotosComponent } from './add-photos/add-photos.component';\r\nimport { IconsModule } from '../icons.module';\r\nimport { DamageAnalysisComponent } from './damage-analysis/damage-analysis.component';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { HasPermissionDirective } from '../helper/directive/has-permission.directive';\r\nimport { DirectiveModule } from '../helper/directive.module';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { HistoryComponent } from './history/history.component';\r\n//import { NgxPrintModule } from 'ngx-print';\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [ \r\n    NewDocumentsComponent,\r\n    NewPhotosComponent, \r\n    AddPhotosComponent, \r\n    DamageAnalysisComponent,\r\n    HistoryComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    IconsModule,\r\n    WidgetsModule,\r\n    ErrorModule,\r\n    TranslateModule,\r\n    DirectiveModule,\r\n    MatSidenavModule\r\n  ],\r\n  exports: [ \r\n    NewDocumentsComponent, \r\n    NewPhotosComponent, \r\n    AddPhotosComponent, \r\n    DamageAnalysisComponent\r\n    \r\n  ],\r\n  providers: [ \r\n    CanDeactivateGuard\r\n  ]\r\n})\r\nexport class SharedModule { }\r\n"]}