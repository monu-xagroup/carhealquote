"use strict";(self.webpackChunkcar_heal_quote=self.webpackChunkcar_heal_quote||[]).push([[937],{40937:(Ft,V,d)=>{d.r(V),d.d(V,{ChqNewCaseModule:()=>Pt,MyHammerConfig:()=>X});var C=d(38583),M=d(55278),K=d(89993),L=d(76627),$=d(25852),Q=d(7408),N=d(54121),e=d(37716);let W=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,i){},encapsulation:2}),n})();class ee extends W{canDeactivate(){return!this.checkDataChanged()}}var q=d(83853),Z=d(4893),D=d(95016),F=d(38709),te=d(85567),k=d(35782),Y=d(67017),I=d(36978),j=d(54135),T=d(29790);const ie=["companyOrg"],oe=["licenseId"],ne=["driverPhone"],ae=["driverCode"],se=["orgType"];function re(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-input",33),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw(2).onFormUpdate(o)}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("inputModel",t.formModel.claimNumber)}}const ce=function(n){return{hide:n}};function le(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",34),e.TgZ(1,"div",35),e.TgZ(2,"div",36),e.TgZ(3,"label",10),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"chq-input",37),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw(2).onFormUpdate(o)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(5,ce,t.isFormConfirmed)),e.xp6(4),e.Oqu(e.lcZ(5,3,"car_owner_details")),e.xp6(2),e.Q6J("inputModel",t.formModel.carOwnerSelector)}}const de=function(n){return{"disable-input disable-controls":n}};function me(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",5),e.TgZ(1,"div",35),e.TgZ(2,"div",36),e.TgZ(3,"label",10),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"chq-input",38,39),e.NdJ("clicked",function(o){return e.CHM(t),e.oxw(2).hideDropdown(o)})("controlOutput",function(o){return e.CHM(t),e.oxw(2).onFormUpdate(o)}),e.qZA(),e.TgZ(8,"chq-input",40,41),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw(2).onFormUpdate(o)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.isRetailProvider&&t.isFormConfirmed?"car_owner_details":e.lcZ(5,4,"company_details")),e.xp6(2),e.Q6J("inputModel",t.formModel.companyName),e.xp6(2),e.Q6J("ngClass",e.VKq(6,de,"select"===t.formModel.companyName.type))("inputModel",t.formModel.licenseId)}}function he(n,c){if(1&n&&e._UZ(0,"chq-button",42),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.confirmButtonModel)}}function pe(n,c){if(1&n&&e._UZ(0,"chq-button",42),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.nextButtonModel)}}const ue=function(n){return{"text-mode":n}};function ge(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"chq-step-header",3),e.TgZ(2,"form",4),e.TgZ(3,"div",5),e.TgZ(4,"div",6),e.TgZ(5,"chq-input",7),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",5),e.TgZ(7,"div",8),e.TgZ(8,"div",9),e.TgZ(9,"label",10),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"chq-input",11,12),e.NdJ("clicked",function(o){return e.CHM(t),e.oxw().hideDropdown(o)})("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.YNc(14,re,1,1,"chq-input",13),e.qZA(),e.qZA(),e.qZA(),e.YNc(15,le,7,7,"div",14),e.YNc(16,me,10,8,"div",15),e.TgZ(17,"div",5),e.TgZ(18,"div",16),e.TgZ(19,"div",17),e.TgZ(20,"label",10),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"div",18),e.TgZ(24,"chq-input",19),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(25,"chq-input",19),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"div",20),e.TgZ(27,"div",18),e.TgZ(28,"chq-input",21),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(29,"div",22),e.TgZ(30,"div",18),e.TgZ(31,"chq-input",23,24),e.NdJ("clicked",function(o){return e.CHM(t),e.oxw().hideDropdown(o)})("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(33,"chq-input",25,26),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(35,"div",27),e.TgZ(36,"div",28),e.TgZ(37,"div",29),e._UZ(38,"img",30),e.qZA(),e.qZA(),e.TgZ(39,"div",31),e.YNc(40,he,1,1,"chq-button",32),e.YNc(41,pe,1,1,"chq-button",32),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(20,ue,t.isFormConfirmed)),e.xp6(1),e.Q6J("chqModel",t.header),e.xp6(4),e.Q6J("inputModel",t.formModel.jobNumber),e.xp6(5),e.Oqu(e.lcZ(11,16,"work_provider_details")),e.xp6(2),e.Q6J("inputModel",t.formModel.companyOrgType),e.xp6(2),e.Q6J("ngIf","Insurance Company"===t.customerFormData.companyOrgType),e.xp6(1),e.Q6J("ngIf",t.isRetailProvider),e.xp6(1),e.Q6J("ngIf",!t.isRetailProvider||t.customerFormData[t.formModel.carOwnerSelector.name]&&"Person"!==t.customerFormData[t.formModel.carOwnerSelector.name]),e.xp6(5),e.Oqu(t.isRetailProvider&&t.isFormConfirmed&&t.customerFormData[t.formModel.carOwnerSelector.name]&&"Person"===t.customerFormData[t.formModel.carOwnerSelector.name]?"car_owner_details":e.lcZ(22,18,"drivers_details")),e.xp6(3),e.Q6J("inputModel",t.formModel.firstName),e.xp6(1),e.Q6J("inputModel",t.formModel.lastName),e.xp6(3),e.Q6J("inputModel",t.formModel.email),e.xp6(3),e.Q6J("inputModel",t.formModel.driverCode),e.xp6(2),e.Q6J("inputModel",t.formModel.driverPhone),e.xp6(7),e.Q6J("ngIf",t.currentCaseStatus),e.xp6(1),e.Q6J("ngIf",t.isFormConfirmed&&!t.commonService.isViewOnly)}}function ve(n,c){1&n&&e._UZ(0,"no-access-error")}let H=(()=>{class n extends ee{constructor(t,i,o,a,s,l){super(),this.router=t,this.commonService=i,this.monitorService=o,this.caseService=a,this.coreService=s,this.route=l,this.header=q.XJ,this.isApiLoading=!0,this.confirmButtonModel={label:"",type:"primary"},this.nextButtonModel={label:"",type:"primary"},this.isFormConfirmed=!1,this.isRetail=!0,this.customerFormData={jobNumber:"",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",firstName:"",lastName:"",companyId:0,partnershipId:0,customerTypeID:1,driverCode:"",driverPhone:0,carOwnerSelector:"",email:""},this.caseId="0",this.caseObjectId=0,this.showNoAccess=!1,this.commonService.accessRight.closed&&(this.commonService.accessRight=new N.X(!0)),this.commonService.userProfileData.subscribe(m=>{if(m&&m.data){const{organizationDetail:r}=m.data;r&&(this.currentOrgId=r.id)}})}checkDataChanged(){return!this.isFormConfirmed&&(this.originalData?this.compareObjects(this.originalData,this.customerFormData):!!this.checkDataDirty())}compareObjects(t,i){const o=Object.keys(t);for(const a in o){const s=o[a];if(t[s]!==i[s])return!0}return!1}get isRetailProvider(){return!!this.customerFormData.companyOrgType&&"Retail"===this.customerFormData.companyOrgType}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0"),this.monitorService.logEvent("ngAfterViewInit",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}get isRetailAndCompanyProvider(){return!!this.customerFormData.companyOrgType&&("Retail"!==this.customerFormData.companyOrgType||"Retail"===this.customerFormData.companyOrgType&&this.customerFormData.carOwnerSelector&&"Person"!==this.customerFormData.carOwnerSelector)}get retail(){return this.customerFormData.companyOrgType?this.formModel.companyOrgType.selectedOption[this.formModel.companyOrgType.displayValue]:""}updateButton(){const t=Object.keys(this.formModel);for(const i in t){const o=t[i];this.formModel[o]=Object.assign(Object.assign({},this.formModel[o]),{mode:this.isFormConfirmed?"value":"text"})}this.isFormConfirmed=!this.isFormConfirmed,this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:this.isFormConfirmed?"Change details":"Confirm",type:this.isFormConfirmed?"outline":"primary",icon:this.isFormConfirmed?"gobackward":"check"}),this.monitorService.logEvent("updateButton",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}setTextMode(){const t=Object.keys(this.formModel);for(const i in t){const o=t[i];if("companyOrgType"===o){const a={},{displayValue:s,fieldValue:l}=this.formModel[o];a[l]=this.customerFormData[o],a[s]="",a[s]=this.customerFormData[o],this.formModel[o]=Object.assign(Object.assign({},this.formModel[o]),{mode:"text",selectedOption:a})}else this.formModel[o]=Object.assign(Object.assign({},this.formModel[o]),{mode:"text"})}this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:"Change details",type:"outline",icon:"gobackward"}),this.monitorService.logEvent("setTextMode",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}])}confirmData(){if(this.monitorService.logEvent("confirmData",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}]),this.isFormConfirmed)return this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.selectedOption.name="",this.formModel.companyOrgType.observable=this.caseService.getProviders(),setTimeout(()=>{this.orgType.triggerObservable()})),void this.updateButton();this.commonService.showLoading();const t={companyOrgType:this.customerFormData.companyOrgType,caseTypeID:1,customerTypeID:"Retail"===this.customerFormData.companyOrgType?this.customerFormData.customerTypeID:null,domainID:2100,tariffId:this.customerFormData.tariffId,isTariffEditable:this.customerFormData.isTariffEditable,firstName:this.customerFormData.firstName,lastName:this.customerFormData.lastName,countryCode:this.customerFormData.driverCode,mobileNumber:this.customerFormData.driverPhone.toString(),email:this.customerFormData.email,companyId:this.customerFormData.companyId,partnershipId:this.customerFormData.partnershipId,claimNumber:"Insurance Company"===this.customerFormData.companyOrgType?this.customerFormData.claimNumber:"",companyName:this.isRetailAndCompanyProvider?this.customerFormData.companyName:"",companyLicenseNumber:this.isRetailAndCompanyProvider?this.customerFormData.licenseId:""};this.commonService.repairPermission||(t.externalID=this.customerFormData.jobNumber),"0"!=this.caseId?(t.caseId=this.caseObjectId,t.caseGuid=this.caseId,this.caseService.updateCase(t).subscribe({next:i=>{i&&(this.updateButton(),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])),this.commonService.hideLoading()},error:i=>{this.commonService.hideLoading(),this.monitorService.logException(i,Q._.Error)}})):this.caseService.saveNewCase(t).subscribe({next:i=>{i&&(this.caseId=i.data.caseGuid,this.commonService.caseId.next(this.caseId),this.caseObjectId=i.data.id,this.header.caseNumber=i.data.caseNumber,this.updateButton(),this.router.navigate([`/quote/case/${this.caseId}`],{replaceUrl:!0}),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])),this.commonService.hideLoading()},error:i=>{this.commonService.hideLoading(),this.monitorService.logException(i,Q._.Error)}})}hideDropdown(t){var i,o,a,s;t===this.formModel.companyOrgType.name?(this.driverCode.closeDropdown(),null===(i=this.companyOrg)||void 0===i||i.closeDropdown()):t===this.formModel.companyName.name?(this.driverCode.closeDropdown(),null===(o=this.orgType)||void 0===o||o.closeDropdown()):(null===(a=this.orgType)||void 0===a||a.closeDropdown(),null===(s=this.companyOrg)||void 0===s||s.closeDropdown())}onObservableLoad(t){var i;if(this.commonService.hideLoading(),t&&t&&t.length>0){const o=t.filter(s=>{var l;return s.phoneCountryCode===(null===(l=this.formModel.driverCode.selectedOption)||void 0===l?void 0:l.phoneCountryCode)});if(o.length>0){const s=o[0],l=s.regExpression;this.formModel.driverCode=Object.assign(Object.assign({},this.formModel.driverCode),{selectedOption:s}),this.driverPhone.updateCurrentValidation(l,!0)}const a=null===(i=this.route.parent)||void 0===i?void 0:i.snapshot.paramMap.get("id");(!a||"0"===a)&&this.setPrefillData(t)}}onFormUpdate(t){var i,o,a,s;if(this.monitorService.logEvent("onFormUpdate",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId,output:t}]),"driverCode"===t.name&&this.driverPhone.updateCurrentValidation(t.value.regExpression),"select"===t.type){const l=this.customerFormData[t.name],m=this.formModel[t.name].fieldValue||this.formModel[t.name].displayValue;if((null===(i=this.formModel[t.name])||void 0===i?void 0:i.selectedOption)&&(null===(o=this.formModel[t.name])||void 0===o?void 0:o.selectedOption[m])===(null==t?void 0:t.value[m]))return;this.formModel[t.name]=Object.assign(Object.assign({},this.formModel[t.name]),{selectedOption:t.value}),this.customerFormData[t.name]=t.value[m],"companyOrgType"===t.name&&(l!==this.customerFormData[t.name]&&setTimeout(()=>{var r,p;null===(r=this.companyOrg)||void 0===r||r.setUnTouched(),null===(p=this.licenseId)||void 0===p||p.setUnTouched()}),t.value[m]&&"Insurance Company"!==t.value[this.formModel[t.name].displayValue]&&(this.formModel.claimNumber=Object.assign(Object.assign({},this.formModel.claimNumber),{value:""})),t.value[m]&&"Retail"!==t.value[this.formModel[t.name].displayValue]?(this.formModel.companyName=Object.assign(Object.assign({},this.formModel.companyName),{displayValue:"companyName",fieldValue:"companyName",onObservableLoad:this.updateCaseData.bind(this),placeHolder:"Select...",value:"",type:"select",observable:this.caseService.getCompanyData(t.value[m],"")}),this.formModel.companyName.selectedOption&&(null===(a=this.formModel.companyName.selectedOption)||void 0===a?void 0:a.tariffId)&&(this.customerFormData.companyId=null,this.customerFormData.companyName=null,this.formModel.companyName.selectedOption={}),this.customerFormData.licenseId="",this.formModel.licenseId=Object.assign(Object.assign({},this.formModel.licenseId),{value:""}),setTimeout(()=>{var r;l&&"Retail"!==l&&this.currentStatus&&(null===(r=this.companyOrg)||void 0===r||r.triggerObservable())})):(t.value[m]&&"Retail"===t.value[this.formModel[t.name].displayValue]&&(this.formModel.claimNumber=Object.assign(Object.assign({},this.formModel.claimNumber),{value:""}),this.formModel.companyName=Object.assign(Object.assign({},this.formModel.companyName),{placeHolder:"Company Name"}),this.customerFormData.claimNumber="",this.currentStatus&&this.caseService.getCompanyData(t.value[m],"").subscribe({next:r=>{var p,h,u;if(r&&(null===(p=r.data)||void 0===p?void 0:p.length)>0){const v=r.data[0];this.customerFormData.companyId=v.companyId,this.customerFormData.tariffId=v.tariffId,this.formModel.companyName.selectedOption&&(null===(h=this.formModel.companyName.selectedOption)||void 0===h?void 0:h.tariffId)&&(this.customerFormData.licenseId="",this.formModel.licenseId=Object.assign(Object.assign({},null===(u=this.formModel)||void 0===u?void 0:u.licenseId),{value:""})),"Person"===this.customerFormData[this.formModel.carOwnerSelector.name]&&(this.customerFormData.companyName=null,this.formModel.companyName.value=""),this.customerFormData.isTariffEditable=v.isEditable,this.customerFormData.partnershipId=v.partnershipId,this.formModel.companyName.selectedOption=v[0],this.checkForFormValidation()}},error:()=>{this.customerFormData.tariffId=0,this.customerFormData.isTariffEditable=!1}})),this.formModel.companyName=Object.assign(Object.assign({},this.formModel.companyName),{type:"text"}))),"companyName"===t.name&&t.value&&(this.customerFormData.companyId=t.value.companyId,this.customerFormData.tariffId=t.value.tariffId,this.customerFormData.isTariffEditable=t.value.isEditable,this.customerFormData.licenseId=t.value.licenseId.toString(),this.formModel.licenseId=Object.assign(Object.assign({},null===(s=this.formModel)||void 0===s?void 0:s.licenseId),{value:t.value.licenseId.toString()}),this.customerFormData.partnershipId=t.value.partnershipId),this.customerFormData[this.formModel[t.name].idField]=t.value[this.formModel[t.name].displayValue]}else"carOwnerSelector"===t.name&&t.keyFieldValue&&this.formModel[t.name].idField&&(this.customerFormData[this.formModel[t.name].idField]=t.keyFieldValue),t.isValid?(this.formModel[t.name].value=t.value,this.customerFormData[t.name]=t.value):(this.formModel[t.name].value="",this.customerFormData[t.name]="driverPhone"!==t.name?"":0);this.customerFormData=Object.assign({},this.customerFormData),this.checkForFormValidation()}navigateToVehicle(){this.monitorService.logEvent("navigateToVehicle",["ChqNewCustomerComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/vehicle`])}updateCaseData(t){var i;if(t&&this.customerFormData.companyId&&!this.customerFormData.tariffId){const o=t.filter(a=>a.companyId===this.customerFormData.companyId);o.length>0&&(this.customerFormData.tariffId=o[0].tariffId,this.customerFormData.isTariffEditable=o[0].isEditable,this.formModel.licenseId=Object.assign(Object.assign({},null===(i=this.formModel)||void 0===i?void 0:i.licenseId),{value:o[0].licenseId.toString()}),this.customerFormData.partnershipId=o[0].partnershipId,this.formModel.companyName.selectedOption=o[0])}}get currentStatus(){var t,i,o;return!(null===(t=this.caseResponse)||void 0===t?void 0:t.status)&&!this.isFormConfirmed||-1===["reject","rejected","approved","closed","repairestimation"].indexOf(null===(o=null===(i=this.caseResponse)||void 0===i?void 0:i.status)||void 0===o?void 0:o.toLowerCase())&&!this.isFormConfirmed}get currentCaseStatus(){var t,i,o,a,s;return!(null===(t=this.caseResponse)||void 0===t?void 0:t.status)&&this.currentOrgId===(null===(o=null===(i=this.caseResponse)||void 0===i?void 0:i.organizationDetail)||void 0===o?void 0:o.organizationId)||!this.commonService.isViewOnly&&-1===["reject","rejected","approved","closed","repairestimation","complete"].indexOf(null===(s=null===(a=this.caseResponse)||void 0===a?void 0:a.status)||void 0===s?void 0:s.toLowerCase())}loadCaseDetails(){var t;const i=Object.keys(this.formModel),o=null===(t=this.route.parent)||void 0===t?void 0:t.snapshot.paramMap.get("id");if(o&&"0"!=o)this.caseId=o,this.isApiLoading=!0,this.commonService.caseId.next(this.caseId),this.commonService.showLoading(),this.caseService.getCaseDetail(this.caseId).subscribe({next:a=>{var s,l;this.caseResponse=a.data,this.caseObjectId=this.caseResponse.id,this.commonService.caseStatus.next(this.caseResponse.status),this.caseResponse.inspections.length>0&&this.commonService.inspectionId.next(this.caseResponse.inspections[0].inspectionId),this.commonService.isViewOnly=this.currentOrgId!=(null===(l=null===(s=this.caseResponse)||void 0===s?void 0:s.organizationDetail)||void 0===l?void 0:l.organizationId),(!this.currentStatus||this.commonService.isViewOnly)&&(this.setTextMode(),this.isFormConfirmed=!0),this.header.caseNumber=this.caseResponse.caseNumber,this.formDataFromResponse=(0,q.Wk)(this.caseResponse),this.customerFormData=(0,q.Qb)(this.formDataFromResponse),this.originalData=JSON.parse(JSON.stringify(this.customerFormData));for(const r in i){const p=this.formModel[i[r]],{type:h,displayValue:u,fieldValue:v}=p;if(this.customerFormData[i[r]])if("select"===h){const g={};g[u]="",g[v]=this.customerFormData[i[r]],!this.currentStatus&&"companyOrgType"===i[r]&&(g[u]=this.customerFormData[i[r]]),this.formModel[i[r]]=Object.assign(Object.assign({},this.formModel[i[r]]),{value:"",selectedOption:g})}else{let g={};"companyName"===i[r]&&(g={companyName:this.customerFormData[i[r]]}),this.formModel[i[r]]=Object.assign(Object.assign({},this.formModel[i[r]]),{value:this.customerFormData[i[r]],selectedOption:g})}}this.checkRouteParams(),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()},complete:()=>{this.isApiLoading=!1}});else{this.isApiLoading=!1,this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.observable=this.caseService.getProviders());for(const a in i){const s=i[a];"driverCode"!==s?this.formModel[s]=Object.assign(Object.assign({},this.formModel[s]),{value:"",selectedOption:{}}):(this.formModel[s]=Object.assign(Object.assign({},this.formModel[s]),{value:"",selectedOption:{phoneCountryCode:"+91"}}),this.customerFormData.driverCode="+91")}}}setPrefillData(t){var i,o,a,s,l,m,r;const p=this.commonService.getSessionStorage("selectedSearchItem");if(p){const h=JSON.parse(p);if(this.formModel.email=Object.assign(Object.assign({},this.formModel.email),{value:h.email,selectedOption:{}}),this.customerFormData.email=h.email,h.firstName&&(this.customerFormData.firstName=h.firstName,this.formModel.firstName=Object.assign(Object.assign({},this.formModel.firstName),{value:this.customerFormData.firstName,selectedOption:{}})),h.lastName&&(this.customerFormData.lastName=h.lastName,this.formModel.lastName=Object.assign(Object.assign({},this.formModel.lastName),{value:this.customerFormData.lastName,selectedOption:{}})),h.phoneNumber){const u=null===(i=h.phoneNumber)||void 0===i?void 0:i.substring(0,3),v=null===(o=h.phoneNumber)||void 0===o?void 0:o.substring(0,4);let g="",_=t.filter(f=>f.phoneCountryCode===u);if(0===_.length?(g=null===(a=h.phoneNumber)||void 0===a?void 0:a.substring(4,null===(s=h.phoneNumber)||void 0===s?void 0:s.length),_=t.filter(f=>f.phoneCountryCode===v)):g=null===(l=h.phoneNumber)||void 0===l?void 0:l.substring(3,null===(m=h.phoneNumber)||void 0===m?void 0:m.length),_.length>0){const f=_[0],S=f.regExpression;this.customerFormData.driverCode=null==f?void 0:f.phoneCountryCode,this.formModel.driverCode=Object.assign(Object.assign({},this.formModel.driverCode),{selectedOption:f}),null===(r=this.driverPhone)||void 0===r||r.updateCurrentValidation(S,!0)}this.formModel.driverPhone=Object.assign(Object.assign({},this.formModel.driverPhone),{value:g,selectedOption:{}}),this.customerFormData.driverPhone=parseInt(g)}if(h.email||h.phoneNumber||h.firstName){if(h.make||h.model||h.vin||h.plate)return;this.commonService.setSessionStorage("selectedSearchItem","")}}}checkDataDirty(){return Object.keys(this.customerFormData),this.compareObjects(this.customerFormData,{jobNumber:"",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",firstName:"",lastName:"",companyId:0,partnershipId:0,customerTypeID:1,driverCode:"+91",driverPhone:0,carOwnerSelector:"",email:""})}checkForFormValidation(){const t=Object.keys(this.customerFormData);let i=[];"Retail"===this.retail?"Person"===this.customerFormData.carOwnerSelector?i=["companyName","claimNumber","licenseId","companyId"]:"Company"===this.customerFormData.carOwnerSelector&&(i=["claimNumber","companyId"]):"Insurance Company"!=this.customerFormData.companyOrgType&&(i=["claimNumber"]),this.commonService.repairPermission&&i.push("jobNumber");let o=!0;for(const a in t){const s=t[a];"carOwnerSelector"===s||"isTariffEditable"===s||-1!==i.indexOf(s)||this.customerFormData[s]||(o=!1)}if(this.isFormConfirmed)this.confirmButtonModel.type="outline";else if(o){if(this.isFormConfirmed)return void(this.confirmButtonModel.type="outline");this.confirmButtonModel.type="primary"}else this.confirmButtonModel.type="disabled";this.monitorService.logEvent("checkForFormValidation",["ChqNewCustomerComponent","addenda-quote",{validationStatus:o?"Form is valid":"Form is invalid"}])}checkRouteParams(){this.route.queryParams.subscribe(t=>{const i=t.isBack;"true"===i||!0===i?(this.isFormConfirmed=!0,this.setTextMode()):this.currentStatus&&(this.formModel.companyOrgType.observable||(this.formModel.companyOrgType.observable=this.caseService.getProviders()))})}ngOnInit(){this.monitorService.logEvent("ngOnInit",["ChqNewCustomerComponent","addenda-quote"]),this.formModel=(0,q.U6)(),this.commonService.repairPermission&&(this.formModel.jobNumber=Object.assign(Object.assign({},this.formModel.jobNumber),{disabled:!0,validation:null})),this.confirmButtonModel={label:"Confirm",type:"primary",icon:"check",onclick:this.confirmData.bind(this)},this.nextButtonModel={label:"Next add vehicle",type:"primary",icon:"plus-filled",onclick:this.navigateToVehicle.bind(this)},this.formModel.driverCode.observable||(this.formModel.driverCode.observable=this.coreService.getPhoneNumber(),this.formModel.driverCode.onObservableLoad=this.onObservableLoad.bind(this)),this.header.caseNumber="",this.checkForFormValidation(),this.loadCaseDetails(),this.commonService.accessRight.subscribe({next:i=>{i||(this.showNoAccess=!0)}});const t=document.querySelector(".addenda-container");t&&(t.scrollTop=0)}ngOnDestroy(){this.monitorService.logEvent("ngOnDestroy",["ChqNewCustomerComponent","addenda-quote"]),this.commonService.accessRight.unsubscribe(),this.commonService.isViewOnly=!1}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(M.F0),e.Y36(Z.v),e.Y36(D.M),e.Y36(F.n),e.Y36(te.p),e.Y36(M.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chq-new-case"]],viewQuery:function(t,i){if(1&t&&(e.Gf(ie,5),e.Gf(oe,5),e.Gf(ne,5),e.Gf(ae,5),e.Gf(se,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.companyOrg=o.first),e.iGM(o=e.CRH())&&(i.licenseId=o.first),e.iGM(o=e.CRH())&&(i.driverPhone=o.first),e.iGM(o=e.CRH())&&(i.driverCode=o.first),e.iGM(o=e.CRH())&&(i.orgType=o.first)}},features:[e.qOj],decls:2,vars:2,consts:[["class","new-case-container mh-0",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"new-case-container","mh-0",3,"ngClass"],[3,"chqModel"],[1,"form-container"],[1,"row"],[1,"job-number","col-3"],[3,"inputModel","controlOutput"],[1,"work-provider","col-6"],[1,"work-input-wrapper","row"],[1,"col-12","sub-heading"],[1,"col-6",3,"inputModel","clicked","controlOutput"],["orgType",""],["class","col-6",3,"inputModel","controlOutput",4,"ngIf"],["class","row",3,"ngClass",4,"ngIf"],["class","row",4,"ngIf"],[1,"driver-details","col-12"],[1,"driver-input-wrapper","row"],[1,"driver-fields-wrapper"],[1,"driver-field",3,"inputModel","controlOutput"],[1,"driver-address-wrapper","row"],[1,"driver-field","basis-272",3,"inputModel","controlOutput"],[1,"driver-field","basis-272"],[1,"driver-field","driver-code-field","no-padding",3,"inputModel","clicked","controlOutput"],["driverCode",""],[1,"driver-field","no-padding",3,"inputModel","controlOutput"],["driverPhone",""],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],[1,"footer-button-wrapper"],[3,"buttonModel",4,"ngIf"],[1,"col-6",3,"inputModel","controlOutput"],[1,"row",3,"ngClass"],[1,"insurer-details","col-12"],[1,"insurance-input-wrapper","row"],[1,"company-input","col-3",3,"inputModel","controlOutput"],[1,"company-input","col-6",3,"inputModel","clicked","controlOutput"],["companyOrg",""],[1,"col-6",3,"ngClass","inputModel","controlOutput"],["licenseId",""],[3,"buttonModel"]],template:function(t,i){1&t&&(e.YNc(0,ge,42,22,"div",0),e.YNc(1,ve,1,0,"no-access-error",1)),2&t&&(e.Q6J("ngIf",!i.isApiLoading&&!i.showNoAccess),e.xp6(1),e.Q6J("ngIf",i.showNoAccess))},directives:[C.O5,C.mk,k._,Y.D,I.E,j.U],pipes:[T.X$],styles:[".new-case-container[_ngcontent-%COMP%]{height:calc(100vh - 76px - calc(5px + 1.5vw + 58px + 1.6vw + 1.5vw));overflow:hidden;overflow-y:auto;padding:0 calc(5px + 1.5vw);padding-bottom:1.5vw}.new-case-container[_ngcontent-%COMP%]   .sub-heading[_ngcontent-%COMP%]{font-weight:700;font-size:14px;line-height:20px;color:var(--xa-black)}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;flex:1}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .job-number[_ngcontent-%COMP%]{margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]{flex-direction:column;margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:15px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   .work-input-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .work-provider[_ngcontent-%COMP%]   .car-owner-wrapper[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]{margin-bottom:10px;flex-direction:column}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .insurer-details[_ngcontent-%COMP%]   .insurance-input-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]{flex:4;display:flex;flex-direction:column}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-input-wrapper[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-address-wrapper[_ngcontent-%COMP%]{margin-bottom:10px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-input-wrapper[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-address-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field[_ngcontent-%COMP%]{flex:1 1 120px;padding:10px;width:120px}@media (max-width: 850px){.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field[_ngcontent-%COMP%]{padding:6px}}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.no-padding[_ngcontent-%COMP%]{padding:0}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.driver-code-field[_ngcontent-%COMP%]{min-width:120px;max-width:120px;padding-right:20px}.new-case-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]   .driver-details[_ngcontent-%COMP%]   .driver-fields-wrapper[_ngcontent-%COMP%]   .driver-field.basis-272[_ngcontent-%COMP%]{flex-basis:272px}.new-case-container[_ngcontent-%COMP%]   .hide[_ngcontent-%COMP%]{display:none}.new-case-container[_ngcontent-%COMP%]   .disable-input[_ngcontent-%COMP%], .new-case-container[_ngcontent-%COMP%]   .partial-disable-info[_ngcontent-%COMP%]{pointer-events:none}.text-mode[_ngcontent-%COMP%]   .job-number[_ngcontent-%COMP%]{padding-left:9px}  .disable-controls input{opacity:.6!important}"]}),n})();var x=d(97582),A=d(57445),fe=d(49517),R=d(60562),O=d(48873),_e=d(4093),B=d(13975),Ce=d(50356),be=d(74178);const Me=["make"],xe=["model"],Oe=["year"];function we(n,c){if(1&n&&e._UZ(0,"chq-button",25),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.confirmButtonModel)}}function ye(n,c){if(1&n&&e._UZ(0,"chq-button",25),2&n){const t=e.oxw(2);e.Q6J("buttonModel",t.nextButtonModel)}}const qe=function(n){return{"text-mode":n}},De=function(n){return{"partial-disable-info":n}},P=function(n){return{"disable-input disable-controls":n}},Ie=function(n){return{"partial-disable-info disable-controls":n}};function Te(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"chq-step-header",3),e.TgZ(2,"label",4),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",5),e.TgZ(6,"chq-input",6),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.qZA(),e.TgZ(7,"form",7),e.TgZ(8,"div",8),e.TgZ(9,"chq-input",9,10),e.NdJ("clicked",function(o){return e.CHM(t),e.oxw().hideDropdown(o)})("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(11,"chq-input",11,12),e.NdJ("clicked",function(o){return e.CHM(t),e.oxw().hideDropdown(o)})("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(13,"chq-input",13,14),e.NdJ("clicked",function(o){return e.CHM(t),e.oxw().hideDropdown(o)})("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.qZA(),e.TgZ(15,"div",15),e.TgZ(16,"chq-input",6),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(17,"chq-input",6),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.TgZ(18,"chq-input",16),e.NdJ("controlOutput",function(o){return e.CHM(t),e.oxw().onFormUpdate(o)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"div",17),e._UZ(20,"img",18),e.qZA(),e.TgZ(21,"div",19),e.TgZ(22,"div",20),e.TgZ(23,"div",21),e._UZ(24,"img",22),e.qZA(),e.qZA(),e.TgZ(25,"div",23),e.YNc(26,we,1,1,"chq-button",24),e.YNc(27,ye,1,1,"chq-button",24),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(20,qe,t.isFormConfirmed)),e.xp6(1),e.Q6J("chqModel",t.vehicleHeader),e.xp6(2),e.Oqu(e.lcZ(4,18,"vehicle_detail")),e.xp6(2),e.Q6J("ngClass",e.VKq(22,De,t.searchDisabled)),e.xp6(1),e.Q6J("inputModel",t.formModel.vin),e.xp6(2),e.Q6J("ngClass",e.VKq(24,P,t.inputDisabled)),e.xp6(1),e.Q6J("inputModel",t.formModel.make)("ngClass",e.VKq(26,P,t.makeDisabled)),e.xp6(2),e.Q6J("inputModel",t.formModel.model)("ngClass",e.VKq(28,P,t.modelDisabled)),e.xp6(2),e.Q6J("inputModel",t.formModel.year)("ngClass",e.VKq(30,P,t.yearDisabled)),e.xp6(2),e.Q6J("ngClass",e.VKq(32,Ie,t.infoDisabled)),e.xp6(1),e.Q6J("inputModel",t.formModel.licensePlate),e.xp6(1),e.Q6J("inputModel",t.formModel.carMilege),e.xp6(1),e.Q6J("inputModel",t.formModel.registrationDate),e.xp6(8),e.Q6J("ngIf",t.currentStatus),e.xp6(1),e.Q6J("ngIf",t.isFormConfirmed&&!t.commonService.isViewOnly)}}function Pe(n,c){1&n&&e._UZ(0,"no-access-error")}let Se=(()=>{class n{constructor(t,i,o,a,s,l,m,r,p,h){this.router=t,this.commonService=i,this.route=o,this.caseService=a,this.vehicleService=s,this.inspectionService=l,this.monitorService=m,this.labourService=r,this.mediaCollectionService=p,this.cd=h,this.vehicleHeader=R.mo,this.caseId="0",this.status="",this.tariffId=0,this.vehicleFormData={vin:"",make:"",model:"",year:"",carMilege:"",licensePlate:"",registrationDate:""},this.isFormConfirmed=!1,this.serviceName="vin",this.inputDisabled=!0,this.infoDisabled=!0,this.searchDisabled=!1,this.importTerms=[],this.vehicleId=0,this.inspections={},this.domainID=0,this.partnershipId=0,this.labourData=null,this.makeDisabled=!1,this.preventVinCall=!1,this.caseCreatedDate="",this.umc="",this.originalVin="",this.modelDisabled=!1,this.yearDisabled=!1,this.inspectionTemplateId=0,this.showNoAccess=!1,this.customerName="",this.email="",this.originalTariffObject={},this.userPermission={},this.commonService.eventfromToastComponent$.subscribe(u=>{u&&(this.monitorService.logEvent("eventfromToastComponent",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/document`]))}),this.commonService.accessRight.closed&&(this.commonService.accessRight=new N.X(!0)),this.commonService.userProfileData.subscribe(u=>{if(u&&u.data){const{userPermission:v,vehicleSourceType:g,organizationDetail:_}=u.data;this.userPermission=v||{},this.estimateId=g,_&&(this.currentOrgId=_.id)}})}checkGTEstimatePermission(){const{orgPackages:t=[]}=this.userPermission,i=t.filter(o=>"Repair Estimate"===o.automotiveServiceName);if(i&&i.length>0){const{permissions:o}=i[0],a=o.filter(s=>"gt.estimate"===s.permissionName||"gt.estimate.vinquery"===s.permissionName);if(a&&a.length>0)return!0}return!1}process(t){return(0,x.mG)(this,void 0,void 0,function*(){if(this.caseId=t,this.commonService.showLoading(),yield this.populateReadonlyFields(t).then(i=>{var o,a,s,l,m,r;if(null==i.data)return void this.commonService.hideLoading();this.vehicleId=i.data.vehicleId||0,this.vehicleHeader.caseNumber=i.data.caseNumber;const{vinNumber:p,licensePlateNumber:h,vehicleMileage:u,registrationDate:v,vehicleMake:g,vehicleModel:_,modelYear:f,status:S,tariffs:y,domainID:St,umc:Nt,id:Zt}=i.data;this.id=Zt,0!=this.vehicleId&&(this.infoDisabled=!1,this.searchDisabled=!1,this.inputDisabled=!1,this.preventVinCall=!0,this.originalVin=p,this.labourData=y.length>0?y[0]:[]),this.customerName=null===(o=i.data.caseDetail)||void 0===o?void 0:o.firstName,this.email=null===(a=i.data.caseDetail)||void 0===a?void 0:a.email,this.vehicleHeader.caseNumber=i.data.caseNumber,this.caseCreatedDate=i.data.createdDate,this.formModel.vin=Object.assign(Object.assign({},this.formModel.vin),{value:p}),this.status=S,this.commonService.caseStatus.next(S),this.formModel.licensePlate=Object.assign(Object.assign({},this.formModel.licensePlate),{value:h}),this.formModel.carMilege=Object.assign(Object.assign({},this.formModel.carMilege),{value:u}),this.formModel.registrationDate=Object.assign(Object.assign({},this.formModel.registrationDate),{value:v}),this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{name:g}}),this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{name:f||i.data.modelYearRange}}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{modelDescription:_}}),this.umc=Nt,this.tariffId=null===(s=y[0])||void 0===s?void 0:s.tariffId,this.isTariffEditable=null===(l=y[0])||void 0===l?void 0:l.isEditable,this.partnershipId=null===(m=y[0])||void 0===m?void 0:m.partnershipId,this.domainID=St,this.inspections=i.data.inspections[0],this.inspections&&this.commonService.inspectionId.next(this.inspections.inspectionId),this.originalTariffObject={make:g,partnershipId:this.partnershipId,registrationDate:O(v).format("YYYY-MM-DDT00:00:00")},this.vehicleFormData=Object.assign(Object.assign({},this.vehicleFormData),{vin:p,make:g,model:_,year:f||i.data.modelYearRange,carMilege:u,licensePlate:h,registrationDate:v}),this.commonService.isViewOnly=this.currentOrgId!=(null===(r=i.data.organizationDetail)||void 0===r?void 0:r.organizationId),this.validate(),this.commonService.hideLoading()}).catch(()=>{this.commonService.hideLoading()}),this.prefillVehicleData(),0!=this.vehicleId||this.commonService.isViewOnly)return this.setTextMode(),void(this.isFormConfirmed=!0);yield this.populateDropdowns()})}prefillVehicleData(){const t=this.commonService.getSessionStorage("selectedSearchItem");if(t){const i=JSON.parse(t);i.vin&&!this.vehicleFormData.vin&&(this.preventVinCall=!0,this.vehicleFormData.vin=i.vin,this.formModel.vin=Object.assign(Object.assign({},this.formModel.vin),{value:i.vin})),i.make&&!this.vehicleFormData.make&&(this.vehicleFormData.make=i.make,this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{name:i.make}})),i.model&&!this.vehicleFormData.model&&(this.vehicleFormData.model=i.model,this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{modelDescription:i.model}})),i.importInterval&&!this.vehicleFormData.year&&(this.vehicleFormData.year=i.importInterval,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{value:i.importInterval,selectedOption:{name:i.importInterval}})),i.plate&&!this.vehicleFormData.licensePlate&&(this.vehicleFormData.licensePlate=i.plate,this.formModel.licensePlate=Object.assign(Object.assign({},this.formModel.licensePlate),{value:i.plate})),(i.make||i.model||i.vin||i.plate)&&(this.commonService.setSessionStorage("selectedSearchItem",""),this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!0,this.enableDropdowns())}}populateDropdowns(){return(0,x.mG)(this,void 0,void 0,function*(){const t=yield(0,A.z)(this.vehicleService.getVehicleMake());this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{options:t.sort((a,s)=>a.name.localeCompare(s.name))});const o=this.formModel.make.options.filter(a=>a.name===this.vehicleFormData.make);o.length>0&&this.vehicleService.getVehicleModel(o[0].id,this.estimateId).subscribe(a=>{var s,l;this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{options:a});const m=null===(s=this.formModel.model.options)||void 0===s?void 0:s.filter(r=>r.umc==this.umc);m.length>0&&(null===(l=this.vehicleService.getVehicleYearByModel(m[0].id,this.estimateId))||void 0===l||l.subscribe(r=>{this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{options:r})}))})})}populateReadonlyFields(t){return(0,x.mG)(this,void 0,void 0,function*(){if(t&&"0"!=t)return this.caseId=t,this.commonService.showLoading(),(0,A.z)(this.caseService.getCaseDetail(t))})}navigateToDocument(){this.monitorService.logEvent("navigateToDocument",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.router.navigate([`/quote/case/${this.caseId}/document`])}ngOnInit(){var t,i,o,a;return(0,x.mG)(this,void 0,void 0,function*(){this.formModel=(0,R.br)(),this.confirmButtonModel={label:"Confirm",type:"primary",icon:"check",onclick:this.confirmData.bind(this)},this.nextButtonModel={label:"Next add documents",type:"primary",icon:"plus-filled",onclick:this.navigateToDocument.bind(this)};const s=null===(a=null===(o=null===(i=null===(t=this.route)||void 0===t?void 0:t.parent)||void 0===i?void 0:i.snapshot)||void 0===o?void 0:o.paramMap)||void 0===a?void 0:a.get("id");this.monitorService.logEvent("ngOnInit",["ChqNewVehicleComponent","addenda-quote",{caseId:s}]),this.commonService.accessRight.subscribe({next:m=>{m||(this.showNoAccess=!0)}}),this.inspectionService.getInspectionTemplateList().subscribe({next:m=>{const r=null==m?void 0:m.data;r.length>0&&(this.inspectionTemplateId=r[0].id)}}),yield this.process(s);const l=document.querySelector(".addenda-container");l&&(l.scrollTop=0)})}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0","vehicle"),this.monitorService.logEvent("ngAfterViewInit",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}])}setTextMode(){this.inputDisabled=!1,this.makeDisabled=!1;const t=Object.keys(this.formModel);for(const i in t){const o=t[i];this.formModel[o]=Object.assign(Object.assign({},this.formModel[o]),{mode:"text"})}this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:"Change car",type:"outline",icon:"gobackward"})}updateButton(){return(0,x.mG)(this,void 0,void 0,function*(){const t=Object.keys(this.formModel);for(const i in t){const o=t[i];this.formModel[o]=Object.assign(Object.assign({},this.formModel[o]),{mode:this.isFormConfirmed?"value":"text"})}"Change car"==this.confirmButtonModel.label&&(this.preventVinCall=!0,this.vehicleService.getVinDecoder(this.vehicleFormData.vin).subscribe({next:i=>{this.makeDisabled=!!(null==i?void 0:i.success)}}),this.commonService.showLoading(),yield this.populateDropdowns(),this.commonService.hideLoading()),this.isFormConfirmed=!this.isFormConfirmed,this.confirmButtonModel=Object.assign(Object.assign({},this.confirmButtonModel),{label:this.isFormConfirmed?"Change car":"Confirm",type:this.isFormConfirmed?"outline":"primary",icon:this.isFormConfirmed?"refresh":"check"})})}confirmData(){if(this.isFormConfirmed)this.updateButton();else if(this.commonService.showLoading(),this.vehicleId&&this.vehicleFormData.vin===this.originalVin)this.updateVehicle();else{const t={vin:this.vehicleFormData.vin,vehicleCountryId:1,umc:this.umc,make:this.vehicleFormData.make,model:this.vehicleFormData.model,mileage:Number(this.vehicleFormData.carMilege),firstRegistrationDate:O(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00"),registrationNumber:this.vehicleFormData.licensePlate,condition:1,ModelYearRange:this.vehicleFormData.year,InspectionTemplateId:this.inspectionTemplateId,CustomerName:this.customerName,CustomerEmail:this.email};this.vehicleService.addVehicle(t,this.domainID,this.id).subscribe({next:i=>{i&&(this.vehicleId=i.id,this.inspections={},this.inspections.inspectionId=i.inspectionId,this.inspections.inspectionGuid=i.inspectionGuid,this.updateVehicle())},error:i=>{this.commonService.hideLoading()}})}}updateVehicle(){var t,i,o;return(0,x.mG)(this,void 0,void 0,function*(){this.monitorService.logEvent("updateVehicle",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.commonService.showLoading();const a={vin:this.vehicleFormData.vin,umc:this.umc,vehicleMake:this.vehicleFormData.make,vehicleModel:this.vehicleFormData.model,modelYearRange:(null===(t=this.vinGTMotive)||void 0===t?void 0:t.modelYearRange)||this.vehicleFormData.year,vehicleID:this.vehicleId,licensePlateNumber:this.vehicleFormData.licensePlate,vehicleMileage:Number(this.vehicleFormData.carMilege),registrationDate:O(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00")},s={inspectionID:this.inspections.inspectionId,inspectionGuid:this.inspections.inspectionGuid},l=O(this.vehicleFormData.registrationDate).year().toString();(this.originalTariffObject.make!=this.vehicleFormData.make||this.partnershipId!=this.originalTariffObject.partnershipId||O(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00")!=this.originalTariffObject.registrationDate||!(null===(o=null===(i=this.labourData)||void 0===i?void 0:i.tariffLabourRates)||void 0===o?void 0:o.length))&&(yield this.getLabourData(this.tariffId,this.isTariffEditable,this.partnershipId,this.vehicleFormData.make,l)),this.vehicleService.updateVehicleCase({vehicle:a,inspection:s,tariff:this.labourData},this.caseId).subscribe({next:r=>{if(r){if(this.labourData.isEditable){let p=!0;if(this.labourData.tariffLabourRates.forEach(h=>{h.amount>0&&(p=!1)}),p){const h={objectId:this.caseId,link:"here",labourData:this.labourData};return this.commonService.hideLoading(),void this.commonService.showInfoToast(5e5,"labour_value_update",h)}}this.router.navigate([`/quote/case/${this.caseId}/document`])}this.commonService.hideLoading()},error:r=>{this.commonService.hideLoading()}})})}onFormUpdate(t){this.monitorService.logEvent("onFormUpdate",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId,output:t}]),"select"===t.type?(this.formModel[t.name]=Object.assign(Object.assign({},this.formModel[t.name]),{selectedOption:t.value}),this.vehicleFormData[t.name]=t.value[this.formModel[t.name].fieldValue],"make"==t.name?(this.vehicleFormData.model="",this.vehicleFormData.year=null,this.modelDisabled=!0,this.yearDisabled=!0,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{},options:[],observable:null}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{}}),t.value&&(this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{observable:this.vehicleService.getVehicleModel(t.value.id,this.estimateId),onObservableLoad:this.enableDropdowns.bind(this)}),setTimeout(()=>{this.model.triggerObservable()}))):"model"==t.name&&(this.yearDisabled=!0,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{},observable:null,options:[]}),this.vehicleFormData.year=null,t.value&&(this.umc=t.value.umc,this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{observable:this.vehicleService.getVehicleYearByModel(t.value.id,this.estimateId),onObservableLoad:this.enableDropdowns.bind(this)}),setTimeout(()=>{this.year.triggerObservable()})))):t.isValid?(this.formModel[t.name].value=t.value,this.vehicleFormData[t.name]=t.value):(this.formModel[t.name].value="",this.vehicleFormData[t.name]=""),this.vehicleFormData=Object.assign({},this.vehicleFormData),"vin"==t.name&&t.isValid&&this.populateForm(),this.validate()}enableDropdowns(){this.modelDisabled=!1,this.yearDisabled=!1}hideDropdown(t){t===this.formModel.make.name?(this.model.closeDropdown(),this.year.closeDropdown()):t===this.formModel.model.name?(this.make.closeDropdown(),this.year.closeDropdown()):(this.model.closeDropdown(),this.make.closeDropdown())}validate(){const t=Object.keys(this.vehicleFormData);this.monitorService.logEvent("validate",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]);let i=!0;for(const o in t)if(!this.vehicleFormData[t[o]]){i=!1;break}this.confirmButtonModel.type=this.isFormConfirmed?"outline":i?"primary":"disabled"}populateForm(){var t;const i=null===(t=this.formModel.vin.value)||void 0===t?void 0:t.toLocaleString();this.monitorService.logEvent("populateForm",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),(0,fe.D)(i).pipe().subscribe({complete:()=>{17==i.length&&!this.isFormConfirmed&&!this.preventVinCall&&(this.commonService.showLoading(),this.vehicleService.getVinDecoder(i).subscribe({error:()=>{this.commonService.hideLoading(),this.vinGTMotive=null,this.resetDropdown()},next:o=>{var a;if(null==o?void 0:o.success){this.vinGTMotive=o.data,this.umc=null===(a=this.vinGTMotive)||void 0===a?void 0:a.umc,this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{name:o.data.vehicleMake}}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{modelDescription:o.data.vehicleModel}});const l=this.formModel.make.options.filter(m=>m.name===o.data.vehicleMake);l.length>0&&(this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{observable:this.vehicleService.getVehicleModel(l[0].id,this.estimateId)}),setTimeout(()=>{this.model.triggerObservable()})),this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{name:o.data.modelYearRange}}),this.vehicleFormData.make=o.data.vehicleMake,this.vehicleFormData.model=o.data.vehicleModel,this.vehicleFormData.year=o.data.modelYearRange,this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!0,this.enableDropdowns()}else this.vinGTMotive=null,this.commonService.showInfoToast(5e3,"show-info | "+(null==o?void 0:o.message)),this.resetDropdown();setTimeout(()=>{this.make.dropdownValidationMessage="",this.make.dropdownContainer.dropdownConfig.isTouched=!1,this.make.dropdownContainer.dropdownConfig.isDirty=!1,this.model.dropdownValidationMessage="",this.model.dropdownContainer.dropdownConfig.isTouched=!1,this.model.dropdownContainer.dropdownConfig.isDirty=!1,this.year.dropdownValidationMessage="",this.year.dropdownContainer.dropdownConfig.isTouched=!1,this.year.dropdownContainer.dropdownConfig.isDirty=!1},0),this.validate()},complete:()=>{this.commonService.hideLoading()}})),this.preventVinCall&&17==i.length&&(this.preventVinCall=!1)}})}resetDropdown(){this.inputDisabled=!1,this.infoDisabled=!1,this.makeDisabled=!1,this.vehicleFormData.make="",this.vehicleFormData.model="",this.vehicleFormData.year=null,this.formModel.model.options=[],this.formModel.year.options=[],this.formModel.make=Object.assign(Object.assign({},this.formModel.make),{selectedOption:{}}),this.formModel.model=Object.assign(Object.assign({},this.formModel.model),{selectedOption:{}}),this.formModel.year=Object.assign(Object.assign({},this.formModel.year),{selectedOption:{}})}get currentStatus(){var t;return!this.status&&!this.commonService.isViewOnly||!this.commonService.isViewOnly&&-1===["reject","rejected","approved","closed","repairestimation","complete"].indexOf(null===(t=this.status)||void 0===t?void 0:t.toLowerCase())}getLabourData(t,i,o,a,s){return(0,x.mG)(this,void 0,void 0,function*(){return this.monitorService.logEvent("getLabourData",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),(0,A.z)(this.labourService.getLabourData(t,a,O(this.vehicleFormData.registrationDate).format("YYYY-MM-DDT00:00:00"),this.caseCreatedDate)).then(l=>{l.data&&(this.labourData={tariffId:l.data.id,tariffDiscountRates:l.data.tariffDiscountRates,tariffLabourRates:l.data.tariffLaborRates,isEditable:i,partnershipId:o})})})}getDomainId(){this.mediaCollectionService.getMediaTemplate().subscribe({next:t=>{(null==t?void 0:t.data.length)>0&&(this.domainID=t.data[0].domainID)}})}ngOnDestroy(){this.monitorService.logEvent("ngOnDestroy",["ChqNewVehicleComponent","addenda-quote",{caseId:this.caseId}]),this.formModel=(0,R.br)(),this.commonService.accessRight.unsubscribe(),this.commonService.isViewOnly=!1}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(M.F0),e.Y36(Z.v),e.Y36(M.gz),e.Y36(F.n),e.Y36(_e.f),e.Y36(B.a),e.Y36(D.M),e.Y36(Ce.T),e.Y36(be.m),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chq-new-vehicle"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Me,5),e.Gf(xe,5),e.Gf(Oe,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.make=o.first),e.iGM(o=e.CRH())&&(i.model=o.first),e.iGM(o=e.CRH())&&(i.year=o.first)}},decls:2,vars:2,consts:[["class","new-vehicle-container",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"new-vehicle-container",3,"ngClass"],[3,"chqModel"],[1,"label"],[1,"search-box",3,"ngClass"],[1,"col-4",3,"inputModel","controlOutput"],[1,"form-container"],[1,"vehicle-brand-wrapper","row",3,"ngClass"],["id","input-make",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["make",""],["id","input-model",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["model",""],["id","input-year",1,"col-4",3,"inputModel","ngClass","clicked","controlOutput"],["year",""],[1,"vehicle-info-wrapper","row",3,"ngClass"],[1,"col-4","registration-date",3,"inputModel","controlOutput"],[1,"image-car"],["src","assets/img/half-car.png"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],[1,"footer-button-wrapper"],[3,"buttonModel",4,"ngIf"],[3,"buttonModel"]],template:function(t,i){1&t&&(e.YNc(0,Te,28,34,"div",0),e.YNc(1,Pe,1,0,"no-access-error",1)),2&t&&(e.Q6J("ngIf",!i.showNoAccess),e.xp6(1),e.Q6J("ngIf",i.showNoAccess))},directives:[C.O5,C.mk,k._,Y.D,I.E,j.U],pipes:[T.X$],styles:[".new-vehicle-container[_ngcontent-%COMP%]{padding-bottom:1.5vw}.new-vehicle-container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:10px;display:block;font-weight:600}.new-vehicle-container[_ngcontent-%COMP%]     .disable-controls input{opacity:.6!important}.new-vehicle-container[_ngcontent-%COMP%]   .disable-input[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .partial-disable-info[_ngcontent-%COMP%]{pointer-events:none}.new-vehicle-container[_ngcontent-%COMP%]   .registration-date[_ngcontent-%COMP%]     .input-wrapper input{pointer-events:none}.new-vehicle-container[_ngcontent-%COMP%]   .registration-date[_ngcontent-%COMP%]     .input-wrapper input[readonly]{opacity:1}.new-vehicle-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]{margin-bottom:20px}.new-vehicle-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%]   .extra-position[_ngcontent-%COMP%], .new-vehicle-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]   .extra-position[_ngcontent-%COMP%]{top:5px;position:relative}.new-vehicle-container[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;flex:1}.new-vehicle-container[_ngcontent-%COMP%]   .image-car[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:654px;position:fixed;bottom:76px}.new-vehicle-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:20px}.new-vehicle-container[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   chq-input[_ngcontent-%COMP%]{width:242px}@media (max-height: 640px){.image-car[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none!important}}@media (orientation: portrait){.search-box[_ngcontent-%COMP%]{margin-top:20px}.search-box[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{flex-basis:auto;max-width:none;width:375px!important}.form-container[_ngcontent-%COMP%]{margin-left:5px}.form-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:0!important}.form-container[_ngcontent-%COMP%]   .vehicle-brand-wrapper[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]   .vehicle-info-wrapper[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{flex-basis:auto;max-width:none;width:375px!important;margin-bottom:20px;padding-left:0;padding-right:0}}"]}),n})();const Ne={approve:{status:"Approve Case",info:"Please fill out a reason why you are approving this case.",buttonModel:{label:"Approve Case",type:"success",icon:"check"},imageGallery:!1,gallery:[]},reject:{status:"Reject Case",info:"Please fill out a reason why you are rejecting this case.",buttonModel:{label:"Reject Case",type:"red",icon:"cross"},imageGallery:!1,gallery:[]},close:{status:"Close Case",info:"Please fill out a reason why you are closing this case.",buttonModel:{label:"Close Case",type:"primary",icon:"folder-plus"},imageGallery:!1,gallery:[]},complete:{status:"Complete Case",info:"Please fill out a reason why you are completing this case.",buttonModel:{label:"Complete Case",type:"primary",icon:"folder-plus"},imageGallery:!1,gallery:[]}};var b=d(3679),E=d(22238),Ze=d(51927),Fe=d(79034),G=d(48262),ke=d(6690);const je=["nav"];function Ae(n,c){1&n&&(e.TgZ(0,"div",17),e._uU(1," Please enter comment "),e.qZA())}const Re=function(n){return{"invalid-label":n}};function Ee(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"div",5),e.TgZ(2,"div",6),e._uU(3),e.qZA(),e.TgZ(4,"div",7),e.TgZ(5,"mat-icon",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().cancelDialog()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",9),e._uU(7),e.qZA(),e.TgZ(8,"div",10),e.TgZ(9,"form",11),e.TgZ(10,"label",12),e._uU(11,"Comments"),e.qZA(),e._UZ(12,"textarea",13),e.YNc(13,Ae,2,0,"div",14),e.qZA(),e.qZA(),e.TgZ(14,"div",15),e.TgZ(15,"chq-button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().processCase()}),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.hij(" ",t.data.status," "),e.xp6(2),e.Q6J("svgIcon","cross"),e.xp6(2),e.hij(" ",t.data.info," "),e.xp6(2),e.Q6J("formGroup",t.commentForm),e.xp6(1),e.Q6J("ngClass",e.VKq(7,Re,(t.formControl.dirty||t.formControl.touched)&&t.formControl.errors)),e.xp6(3),e.Q6J("ngIf",(t.formControl.dirty||t.formControl.touched)&&t.formControl.errors),e.xp6(2),e.Q6J("buttonModel",t.data.buttonModel)}}function Je(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",30),e.TgZ(1,"mat-icon",31),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).prevImageClick()}),e.qZA(),e.qZA()}}function Ve(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",32),e.TgZ(1,"mat-icon",33),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).nextImageClick()}),e.qZA(),e.qZA()}}function Le(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",34),e.TgZ(1,"mat-icon",31),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).prevImageClick()}),e.qZA(),e.qZA()}}function Qe(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",35),e.TgZ(1,"mat-icon",33),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).nextImageClick()}),e.qZA(),e.qZA()}}const Ye=function(){return{width:"75px",height:"75px"}};function He(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",18),e.TgZ(1,"div",5),e.TgZ(2,"div",7),e.TgZ(3,"mat-icon",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().cancelDialog()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"div",19),e.YNc(5,Je,2,0,"div",20),e.TgZ(6,"img",21),e.NdJ("error",function(){return e.CHM(t),e.oxw().updateLoading()})("load",function(){return e.CHM(t),e.oxw().updateLoading()}),e.qZA(),e._UZ(7,"chq-customloader",22),e.YNc(8,Ve,2,0,"div",23),e.qZA(),e.TgZ(9,"div",24),e.YNc(10,Le,2,0,"div",25),e.TgZ(11,"ng-image-slider",26,27),e.NdJ("imageClick",function(o){return e.CHM(t),e.oxw().showImage(o)}),e.qZA(),e.YNc(13,Qe,2,0,"div",28),e.qZA(),e.TgZ(14,"div",29),e.TgZ(15,"span"),e._uU(16),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("svgIcon","cross"),e.xp6(2),e.Q6J("ngIf",t.thumbnails.length>1),e.xp6(1),e.Q6J("src",t.currentImage,e.LSH),e.xp6(1),e.Q6J("showLoading",t.showLoading),e.xp6(1),e.Q6J("ngIf",t.thumbnails.length>1),e.xp6(2),e.Q6J("ngIf",t.thumbnails.length>1),e.xp6(1),e.Q6J("images",t.thumbnails)("infinite",!1)("autoSlide",1)("imageSize",e.DdM(15,Ye))("imagePopup",!1)("showArrow",!1),e.xp6(2),e.Q6J("ngIf",t.thumbnails.length>1),e.xp6(3),e.AsE("",t.index,"/",t.totalImages,"")}}function Be(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",36),e.TgZ(1,"div",37),e.TgZ(2,"div",7),e.TgZ(3,"mat-icon",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().cancelDialog()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"div",38),e.TgZ(5,"div",39),e._uU(6),e.qZA(),e.TgZ(7,"div",40),e._uU(8),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("svgIcon","cross"),e.xp6(3),e.hij(" ",t.data.status," "),e.xp6(2),e.hij(" ",t.comments," ")}}function Ge(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",41),e.TgZ(1,"div",37),e.TgZ(2,"div",7),e.TgZ(3,"mat-icon",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().cancelDialog()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"div",42),e._uU(5),e.qZA(),e.TgZ(6,"div",43),e.TgZ(7,"p"),e.TgZ(8,"strong"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._uU(11),e.qZA(),e.TgZ(12,"p"),e.TgZ(13,"strong"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._uU(16),e.qZA(),e._UZ(17,"div",44),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("svgIcon","cross"),e.xp6(2),e.Oqu(null==t.data?null:t.data.status),e.xp6(4),e.hij("",e.lcZ(10,7,"to"),":"),e.xp6(2),e.hij(" ",t.emailContent.To,""),e.xp6(3),e.hij("",e.lcZ(15,9,"subject"),":"),e.xp6(2),e.hij(" ",t.emailContent.Subject,""),e.xp6(1),e.Q6J("innerHTML",t.emailContent.Content,e.oJD)}}let Ue=(()=>{class n{constructor(t,i,o,a,s){this.dialogRef=t,this.data=i,this.changeDedectionRef=o,this.monitorService=a,this.formBuilder=s,this.thumbnails=[],this.index=1,this.showComment=!1,this.showLoading=!0,this.showEmail=!1}ngOnInit(){var t,i,o,a,s;this.monitorService.logEvent("ngOnInit",["ChqRepairDialogComponent","addenda-quote"]),(null===(t=this.data)||void 0===t?void 0:t.email)&&(this.showEmail=!0,this.emailContent=JSON.parse(null===(i=this.data)||void 0===i?void 0:i.email)),(null===(o=this.data)||void 0===o?void 0:o.imageGallery)?this.getImages():(null===(a=this.data)||void 0===a?void 0:a.comment)?(this.showComment=!0,this.comments=null===(s=this.data)||void 0===s?void 0:s.comment):(this.commentForm=this.formBuilder.group({comment:["",[b.kI.required,n=>n.value&&""===n.value.trim()?{noEmptySpaces:!0}:null]]}),this.data&&this.data.buttonModel&&(this.data.buttonModel.type=this.commentForm.invalid?"disabled":"Approve Case"===this.data.buttonModel.label?"success":"Reject Case"===this.data.buttonModel.label?"red":"primary"),this.commentForm.get("comment").valueChanges.pipe((0,Ze.O)(null),(0,Fe.G)()).subscribe(([l,m])=>{this.data.buttonModel.type=(null==m?void 0:m.trim())?"Approve Case"===this.data.buttonModel.label?"success":"Reject Case"===this.data.buttonModel.label?"red":"primary":"disabled"}))}ngAfterContentChecked(){this.changeDedectionRef.detectChanges()}cancelDialog(){this.monitorService.logEvent("cancelDialog",["ChqRepairDialogComponent","addenda-quote"]),this.dialogRef.close()}processCase(){this.commentForm.invalid||this.dialogRef.close({data:this.commentForm.controls.comment.value})}getImages(){this.thumbnails=this.data.gallery,this.totalImages=this.thumbnails.length,this.showLoading=!0,this.currentImage=this.thumbnails[0].thumbImage}showImage(t){this.index=t+1,this.showLoading=!0,this.currentImage=this.thumbnails[t].thumbImage}prevImageClick(){this.index>1&&(this.index=this.index-1,this.slider.prev(),this.showLoading=!0,this.currentImage=this.thumbnails[this.index-1].thumbImage)}nextImageClick(){this.index<this.slider.totalImages&&(this.index=this.index+1,this.slider.next(),this.showLoading=!0,this.currentImage=this.thumbnails[this.index-1].thumbImage)}get formControl(){return this.commentForm.controls.comment}updateLoading(){this.showLoading=!this.showLoading}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.so),e.Y36(E.WI),e.Y36(e.sBO),e.Y36(D.M),e.Y36(b.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chq-repair-dialog"]],viewQuery:function(t,i){if(1&t&&e.Gf(je,5),2&t){let o;e.iGM(o=e.CRH())&&(i.slider=o.first)}},decls:4,vars:4,consts:[["class","repair dialog-container",4,"ngIf"],["class","dialog-container-image",4,"ngIf"],["class","dialog-container dialog-container-comment",4,"ngIf"],["class","dialog-container dialog-container-email",4,"ngIf"],[1,"repair","dialog-container"],[1,"heading"],[1,"heading-content"],[1,"close-icon"],[3,"svgIcon","click"],[1,"info"],[1,"content"],[3,"formGroup"],[3,"ngClass"],["rows","8","formControlName","comment","maxlength","500","placeholder","",1,"input-wrapper"],["class","invalid",4,"ngIf"],[1,"button"],[3,"buttonModel","click"],[1,"invalid"],[1,"dialog-container-image"],[1,"image-content"],["class","navigation prev-button",4,"ngIf"],[3,"src","error","load"],[3,"showLoading"],["class","navigation next-button",4,"ngIf"],[1,"slider"],["class","prev-button",4,"ngIf"],["slideImage","1",3,"images","infinite","autoSlide","imageSize","imagePopup","showArrow","imageClick"],["nav",""],["class","next-button",4,"ngIf"],[1,"footer"],[1,"navigation","prev-button"],["aria-hidden","false","aria-label","Example chevron left icon","fontIcon","chevron_left",3,"click"],[1,"navigation","next-button"],["aria-hidden","false","aria-label","Example chevron right icon","fontIcon","chevron_right",3,"click"],[1,"prev-button"],[1,"next-button"],[1,"dialog-container","dialog-container-comment"],[1,"heading","heading-comment"],[1,"comment-content"],[1,"comment-status"],[1,"comment"],[1,"dialog-container","dialog-container-email"],[1,"email-status"],[1,"email-content"],[3,"innerHTML"]],template:function(t,i){1&t&&(e.YNc(0,Ee,16,9,"div",0),e.YNc(1,He,17,16,"div",1),e.YNc(2,Be,9,3,"div",2),e.YNc(3,Ge,18,11,"div",3)),2&t&&(e.Q6J("ngIf",!(null!=i.data&&i.data.imageGallery||i.showComment||i.showEmail)),e.xp6(1),e.Q6J("ngIf",null==i.data?null:i.data.imageGallery),e.xp6(1),e.Q6J("ngIf",i.showComment),e.xp6(1),e.Q6J("ngIf",i.showEmail))},directives:[C.O5,L.Hw,b._Y,b.JL,b.sg,C.mk,b.Fj,b.JJ,b.u,b.nD,I.E,G.h,ke.sN],pipes:[T.X$],styles:[".repair.dialog-container{display:flex;flex-direction:column;justify-content:flex-start;padding:30px;grid-gap:36px;gap:36px}.repair.dialog-container .heading{display:flex;flex-direction:row;justify-content:space-between}.repair.dialog-container .heading .heading-content{display:flex;font-weight:700;font-size:20px;line-height:25px;align-items:center}.repair.dialog-container .heading-comment{justify-content:flex-end}.repair.dialog-container .info{font-weight:500;font-size:12px;line-height:14px;color:#000}.repair.dialog-container .content{position:relative}.repair.dialog-container .content label{height:14px;font-weight:400;font-size:10px;line-height:14px;text-transform:uppercase;color:var(--xa-dark-gray);flex:none;order:0;flex-grow:0;position:absolute;top:-8px;z-index:2;top:-6px;left:12px;padding:0 4px;background:var(--xa-white)}.repair.dialog-container .button{display:flex;justify-content:flex-end}.repair.dialog-container textarea{border-radius:8px;width:100%;box-sizing:border-box;padding:10px}.dialog-container-image{padding:20px;min-width:724px;max-width:724px;height:558px}.dialog-container-image .image-content{padding:20px;height:345px;display:flex;justify-content:center;align-items:center}.dialog-container-image .image-content img{height:100%}.dialog-container-image .slider{margin-top:19px;display:flex;flex-direction:row;justify-content:space-evenly}.dialog-container-image .slider .prev-button,.dialog-container-image .slider .next-button{display:flex;flex-direction:column;justify-content:space-around}.dialog-container-image .slider .prev-button img,.dialog-container-image .slider .next-button img{height:25px}.dialog-container-image .slider ng-image-slider{width:100%;margin:0 20px}.dialog-container-image .slider .ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:75px!important;margin-left:5px!important;margin-right:0!important}.dialog-container-image .slider .selected-image{border:1px solid #EAB308}.dialog-container-image .footer{margin-top:20px;display:flex;justify-content:center}.dialog-container-image .footer span{text-align:center}.dialog-container-comment{min-width:450px;max-width:450px;padding:32px 20px;overflow-x:hidden}.dialog-container-comment .comment-content{font-weight:500;font-size:14px;max-height:200px}.dialog-container-comment .comment-content .comment-status{margin-bottom:10px;font-size:16px}.dialog-container-comment .comment-content .comment{overflow-y:auto;overflow-x:hidden;white-space:pre-line}.dialog-container-email{min-width:450px;max-width:450px;padding:32px 20px;overflow-x:hidden}.dialog-container-email .email-status{margin-bottom:10px;font-size:1rem;font-weight:700;padding:.625rem 1.375rem;border-bottom:1px solid var(--xa-dp-light-gray)}.dialog-container-email .email-content{font-weight:500;font-size:.75rem;max-height:500px;border-radius:.625rem;padding:.625rem 1.375rem;background-color:rgba(27,3,163,.05)}.dialog-container .heading .close-icon,.dialog-container-image .heading .close-icon{justify-content:flex-end;display:flex}.dialog-container .heading .close-icon mat-icon,.dialog-container-image .heading .close-icon mat-icon{height:36px!important;width:36px!important;background:black;border-radius:50%;text-align:center}.dialog-container .heading .close-icon mat-icon svg,.dialog-container-image .heading .close-icon mat-icon svg{height:16px;width:16px;vertical-align:middle;position:relative;top:7px}.dialog-container .heading .close-icon mat-icon svg path,.dialog-container-image .heading .close-icon mat-icon svg path{fill:#fff}@media (orientation: portrait){.dialog-container-image{min-width:570px;max-width:570px}}.invalid{margin-top:6px;font-style:normal;font-weight:400;font-size:12px;line-height:18px;color:var(--xa-red);flex:none;order:2;align-self:stretch;flex-grow:0}.invalid-label{color:var(--xa-red)!important}.input-wrapper.ng-touched.ng-invalid{border:1px solid var(--xa-red);color:var(--xa-red);outline:0}.navigation{position:absolute;top:calc(50% - 55px)}.navigation.prev-button{left:0}.navigation.next-button{right:0}.navigation .mat-icon{font-size:50px!important;height:50px!important;width:50px!important}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div .caption{padding:2px!important;background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,.6),rgba(0,0,0,.7),rgba(0,0,0,.8),rgba(0,0,0,.9))!important;font-size:10px}.email-content td{border-radius:5px!important;padding:5px!important}.email-content a{color:#fff!important;text-decoration:none!important;pointer-events:none!important}\n"],encapsulation:2}),n})();var Xe=d(50617),Ke=d(84967),$e=d(33568),We=d(84945),et=d(14368),U=d(75983),tt=d(87855),it=d(72076),ot=d(8851),nt=d(9988);const at=["anchor"];function st(n,c){if(1&n&&(e.TgZ(0,"div",17),e.TgZ(1,"div",18),e.TgZ(2,"div",19),e.TgZ(3,"label"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"div",20),e.TgZ(6,"label"),e._uU(7),e.qZA(),e.TgZ(8,"span"),e._uU(9),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"div",21),e._UZ(11,"img",22),e.TgZ(12,"div",20),e._UZ(13,"a",23,24),e.TgZ(15,"label"),e._uU(16),e.qZA(),e.TgZ(17,"span"),e._uU(18),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.customerData.initial),e.xp6(3),e.Oqu(t.customerData.firstName+" "+t.customerData.lastName),e.xp6(2),e.Oqu(t.customerData.countryCode+" "+t.customerData.mobileNumber),e.xp6(4),e.Q6J("href",t.downloadUrl,e.LSH)("hidden",!0)("download",t.pdfName),e.xp6(3),e.Oqu(null==t.caseData?null:t.caseData.vehicleMake),e.xp6(2),e.Oqu(null==t.caseData?null:t.caseData.vehicleModel)}}function rt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-estimate-details",25),e.NdJ("downloadPdf",function(){return e.CHM(t),e.oxw(2).downloadPdf()}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("estimateResponse",t.estimateResponse)("editEstimate",t.editEstimate)("estimateSource",t.estimateSource)("i18n",t.i18n)}}function ct(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){return e.CHM(t),e.oxw(3).booking("create","")}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.createBooking)}}function lt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.booking("view",o.repairId)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.viewBooking)}}function dt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.changeCaseStatusDialog(o.closeCaseButton)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.closeCaseButton)}}function mt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.changeCaseStatusDialog(o.approveCaseButton)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.approveCaseButton)}}function ht(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.changeCaseStatusDialog(o.rejectButton)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.rejectButton)}}function pt(n,c){if(1&n&&e._UZ(0,"chq-button",30),2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.calculationButton)}}function ut(n,c){if(1&n&&(e.TgZ(0,"div",26),e.YNc(1,ct,1,1,"chq-button",27),e.YNc(2,lt,1,1,"chq-button",27),e.YNc(3,dt,1,1,"chq-button",27),e.YNc(4,mt,1,1,"chq-button",27),e.YNc(5,ht,1,1,"chq-button",27),e.YNc(6,pt,1,1,"chq-button",28),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&!t.repairId&&"rejected"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&t.repairId),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&t.currentRejStatus&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&t.currentStatus&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&t.currentRejStatus&&"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase()))}}function gt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-dropdown",33),e.NdJ("selected",function(o){return e.CHM(t),e.oxw(3).changeCaseStatusDialog(o)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("dropdownModel",t.dropdownModelFilter)}}function vt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){return e.CHM(t),e.oxw(3).booking("create","")}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.createBooking)}}function ft(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"chq-button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.booking("view",o.repairId)}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("buttonModel",t.viewBooking)}}function _t(n,c){if(1&n&&(e.TgZ(0,"div",31),e.YNc(1,gt,1,1,"chq-dropdown",32),e.YNc(2,vt,1,1,"chq-button",27),e.YNc(3,ft,1,1,"chq-button",27),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!t.isPendingApproval()&&t.isGTEstimate()&&(t.commonService.repairPermission||"complete"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())&&!t.commonService.repairPermission)),e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&!t.repairId&&"rejected"!==(null==t.caseStatus?null:t.caseStatus.toLowerCase())),e.xp6(1),e.Q6J("ngIf",t.commonService.repairPermission&&t.repairId)}}const Ct=function(n){return{hidden:n}};function bt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"chq-step-header",4),e.NdJ("back",function(o){return e.CHM(t),e.oxw().handleBack(o)}),e.qZA(),e.YNc(2,st,19,8,"div",5),e.TgZ(3,"div",6),e.TgZ(4,"div",7),e.YNc(5,rt,1,4,"chq-estimate-details",8),e._UZ(6,"chq-customloader",9),e.qZA(),e.qZA(),e.TgZ(7,"div",10),e.TgZ(8,"div",11),e.TgZ(9,"div",12),e._UZ(10,"img",13),e.qZA(),e.qZA(),e.YNc(11,ut,7,6,"div",14),e.YNc(12,_t,4,3,"div",15),e.qZA(),e.TgZ(13,"history",16),e.NdJ("toggleExpand",function(){return e.CHM(t),e.oxw().getCaseHistory()}),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(10,Ct,t.showDamageAnalysis)),e.xp6(1),e.Q6J("chqModel",t.header)("showButton",!0),e.xp6(1),e.Q6J("ngIf",t.pageReady),e.xp6(3),e.Q6J("ngIf",t.showData),e.xp6(1),e.Q6J("showLoading",!t.showData),e.xp6(5),e.Q6J("ngIf",t.estimateResponse&&!t.commonService.isViewOnly),e.xp6(1),e.Q6J("ngIf",t.estimateResponse&&!t.commonService.isViewOnly),e.xp6(1),e.Q6J("history",t.history)("isLoading",t.isHistoryLoading)}}function Mt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"damage-analysis",34),e.NdJ("backEvent",function(o){return e.CHM(t),e.oxw().handleBack(o)}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("hideNext",!0)("caseDetail",t.caseResult)}}function xt(n,c){1&n&&e._UZ(0,"no-access-error")}const Ot={title:"create_estimate",step:5,description:"create_estimate_msg",stepName:"step_five"};let wt=(()=>{class n{constructor(t,i,o,a,s,l,m,r,p){this.cd=t,this.commonService=i,this.caseService=o,this.repairEstimateService=a,this.route=s,this.monitorService=l,this.inspectionService=m,this.dialog=r,this.router=p,this.header=Ot,this.customerFormData={jobNumber:"1212",companyOrgType:"",claimNumber:"",companyName:"",tariffId:0,isTariffEditable:!0,licenseId:"",companyId:0,partnershipId:0,firstName:"John",lastName:"Doe",driverCode:"+971",driverPhone:502302030,carOwnerSelector:"Person",email:""},this.isInitCalled=!1,this.dialogData=Ne,this.showGen=!0,this.pageReady=!1,this.showData=!1,this.showInspection=!1,this.pdfName="",this.showNoAccess=!1,this.editEstimate=!1,this.estimateSource="",this.dropdownModelFilter={options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}],placeHolder:"Options",label:"",appearance:"button",placeHolderIcon:"settings",name:"option",displayValue:"label",selectedOption:{}},this.history=[],this.isHistoryLoading=!1,this.commonService.accessRight.closed&&(this.commonService.accessRight=new N.X(!0)),this.commonService.userProfileData.subscribe(h=>{if(h&&h.data){const{organizationDetail:u}=h.data;u&&(this.currentOrgId=u.id)}}),this.i18n=this.commonService.geti18nInfo()}get isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}handleVisibilityChange(t){var i,o;!this.isInitCalled||!this.isiOS||!this.orgName||0==(null===(o=null===(i=this.estimateResponse)||void 0===i?void 0:i.estimateCharges)||void 0===o?void 0:o.length)&&this.getEstimationDetail(this.orgName)}onPopState(t){sessionStorage.setItem("update","0")}ngAfterViewInit(){this.commonService.updatePage("/quote/case/0","estimate"),this.cd.detectChanges(),this.showGen=!1,this.monitorService.logEvent("ngAfterViewInit",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}handleBack(t){this.showDamageAnalysis=!t.back,this.monitorService.logEvent("handleBack",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}ngOnInit(){var t;this.caseGuid=null===(t=this.route.parent)||void 0===t?void 0:t.snapshot.paramMap.get("id"),this.getCaseDetail(),this.isInitCalled=!0,this.closeCaseButton={label:"Complete",type:"primary",icon:"folderplus"},this.approveCaseButton={label:"Approve",type:"success",icon:"check"},this.rejectButton={label:"Reject",type:"outline-danger",icon:"cross"},this.calculationButton={label:"Edit Calculations",type:"outline",icon:"edit",onclick:this.editGtMotive.bind(this)},this.createBooking={label:"Create Booking",type:"outline",icon:"calendar"},this.viewBooking={label:"View Booking",type:"outline",icon:"view"},this.commonService.accessRight.subscribe({next:o=>{o||(this.showNoAccess=!0)}});const i=document.querySelector(".addenda-container");i&&(i.scrollTop=0),this.monitorService.logEvent("ngOnInit",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}])}editGtMotive(){this.repairId?this.commonService.showChangeWarningMessage(this.redirectToGtEstimate.bind(this),U.j.repair):this.redirectToGtEstimate()}changeCaseStatusDialog(t){var i,o,a,s,l,m;let r=null,p="";if("Edit Calculations"!=(null===(i=null==t?void 0:t.value)||void 0===i?void 0:i.label)&&"Edit Calculations"!=(null==t?void 0:t.label)){if("Approve"==(null===(o=null==t?void 0:t.value)||void 0===o?void 0:o.label)||"Approve"==(null==t?void 0:t.label))r=this.dialogData.approve,p="Approved";else if("Complete"==(null===(a=null==t?void 0:t.value)||void 0===a?void 0:a.label)||"Complete"==(null==t?void 0:t.label))r=this.dialogData.complete,p="Complete";else if("Reject"==(null===(s=null==t?void 0:t.value)||void 0===s?void 0:s.label)||"Reject"==(null==t?void 0:t.label))r=this.dialogData.reject,p="Rejected";else{if("View Booking"==(null===(l=null==t?void 0:t.value)||void 0===l?void 0:l.label)||"View Booking"==(null==t?void 0:t.label))return void this.booking("view",this.repairId);if("Create Booking"==(null===(m=null==t?void 0:t.value)||void 0===m?void 0:m.label)||"Create Booking"==(null==t?void 0:t.label))return void this.booking("create","")}this.monitorService.logEvent("changeCaseStatusDialog",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status:p}]),this.dialog.open(Ue,{autoFocus:!1,data:r}).afterClosed().subscribe({next:u=>{this.commonService.showLoading(),u?this.caseService.updateCaseStatus(this.caseGuid,p,u.data).subscribe({next:()=>{this.monitorService.logEvent("updateCaseStatus",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status:p}]),this.caseStatus=p,this.toggleOption(p)},complete:()=>{this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}}):this.commonService.hideLoading()}})}else this.repairId?this.commonService.showChangeWarningMessage(this.redirectToGtEstimate.bind(this),U.j.repair):this.redirectToGtEstimate()}redirectToGtEstimate(){this.commonService.showLoading(),this.monitorService.logEvent("redirectToGtEstimate",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid,status}]),this.route.snapshot.queryParams.send&&"true"==this.route.snapshot.queryParams.send&&this.router.navigate([],{relativeTo:this.route,queryParams:{send:"false"},queryParamsHandling:"merge"}),this.repairEstimateService.createEstimate(this.caseGuid,this.inspectionId,this.vehicleId,this.domainId).subscribe({next:t=>{t&&(location.href=t.data.url,sessionStorage.setItem("update","1"))},complete:()=>{this.commonService.hideLoading()}})}downloadPdf(){this.commonService.showLoading(),this.monitorService.logEvent("downloadPdf",["ChqRepairEstimateComponent","addenda-quote",{caseId:this.caseGuid}]),this.repairEstimateService.getXADownloadUrl(this.caseGuid).subscribe({next:i=>{window.open(i.data.url,"_top"),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}})}get currentRejStatus(){var t;return!!this.caseStatus&&-1===["approved","closed","complete"].indexOf(null===(t=this.caseStatus)||void 0===t?void 0:t.toLowerCase())}get currentStatus(){var t;return!!this.caseStatus&&-1===["approved","closed","complete"].indexOf(null===(t=this.caseStatus)||void 0===t?void 0:t.toLowerCase())}getCaseHistory(){this.history=[],this.isHistoryLoading=!0,this.caseService.getCaseHistory(this.caseGuid,this.domainId).subscribe({next:t=>{this.history=t},complete:()=>{this.isHistoryLoading=!1}})}getCaseDetail(){this.caseService.getCaseDetail(this.caseGuid).subscribe({next:t=>{var i,o,a,s;if(null==t?void 0:t.data){const{inspections:l,vehicleId:m,status:r,orgName:p,repairGuid:h,domainID:u}=t.data;if(this.commonService.caseStatus.next(r),this.inspectionId=l?null===(i=l[0])||void 0===i?void 0:i.inspectionId:"",-1===["uploadphotos","repairestimation","closed","rejected","approved","complete","pendingapproval","readytoinvoice","invoiceready"].indexOf(r.toLowerCase()))return;this.vehicleId=m,this.repairId=h,this.caseStatus=r,this.domainId=u,this.toggleOption(r),this.header.caseNumber=t.data.caseNumber,this.caseResult=t.data,this.customerData=t.data.caseDetail,this.orgName=p,this.customerData=Object.assign(Object.assign({},this.customerData),{initial:(null===(o=this.customerData.firstName)||void 0===o?void 0:o.substring(0,1).toUpperCase())+(null===(a=this.customerData.lastName)||void 0===a?void 0:a.substring(0,1).toUpperCase())}),this.pageReady=!0,this.commonService.isViewOnly=this.currentOrgId!=(null===(s=t.data.organizationDetail)||void 0===s?void 0:s.organizationId);const v=sessionStorage.getItem("update")||"0";"0"===v?(this.getEstimationDetail(p),this.commonService.updatePage("/quote/case/0","estimate")):"1"===v&&this.route.snapshot.queryParams.send&&"true"==this.route.snapshot.queryParams.send?this.repairEstimateService.readUpdateEstimate(this.caseGuid,t.data.inspections[0].inspectionId,t.data.vehicleId,"put",this.domainId).subscribe({next:()=>{sessionStorage.setItem("update","0"),this.getEstimationDetail(p),this.router.navigate([],{relativeTo:this.route,queryParams:{send:"false"},queryParamsHandling:"merge"}),this.commonService.hideLoading(),setTimeout(()=>{this.commonService.updatePage("/quote/case/0","estimate")})}}):this.getEstimationDetail(p)}},error:()=>{this.commonService.hideLoading()}})}getEstimationDetail(t){this.repairEstimateService.getEstimate(this.caseGuid,this.inspectionId,this.vehicleId,this.domainId).subscribe({next:i=>{var o,a,s;this.estimateResponse=i.data,this.caseData={vehicleMake:this.estimateResponse.make,vehicleModel:this.estimateResponse.modelCode},this.estimateResponse.orgName=t,this.estimateSource=null===(o=i.data)||void 0===o?void 0:o.externalSource,this.estimateResponse.currencyCode||(this.estimateResponse.currencyCode=this.i18n.currencySymbol),0==(null===(s=null===(a=this.estimateResponse)||void 0===a?void 0:a.estimateCharges)||void 0===s?void 0:s.length)?(this.commonService.hideLoading(),this.showConfirmationPopup()):(this.getInspection(),this.showData=!0),this.commonService.hideLoading()},error:()=>{this.commonService.hideLoading()}})}getInspection(){this.inspectionService.getInspectionTemplateList().subscribe({next:t=>{const i=null==t?void 0:t.data;(null==i?void 0:i.length)>0&&(this.commonService.repairInspectionTemplate=i[0],(0,Ke.D)({inspectionTemplate:this.inspectionService.getInspectionTemplate(i[0].id),inspectionDetail:this.inspectionService.getInspection(this.inspectionId)}).pipe((0,$e.K)(s=>(0,We.of)(s))).subscribe(s=>{var l,m,r,p;const h=null===(l=s.inspectionTemplate)||void 0===l?void 0:l.inspectionItemTemplates,u=s.inspectionDetail,v=null==h?void 0:h.filter(g=>"Bulk Upload Image"===g.name);this.images=null===(m=null==u?void 0:u.inspectionItems)||void 0===m?void 0:m.filter(g=>("Bulk Upload Image"==g.name||g.inspectionItemTemplateID===v[0].id)&&""!=g.rawAzureBlobUrl).map(g=>g.rawAzureBlobUrl),0==(null===(r=this.images)||void 0===r?void 0:r.length)&&(this.images=null===(p=null==u?void 0:u.inspectionItems)||void 0===p?void 0:p.filter(g=>"Bulk Upload Image"!=g.name&&""!=g.rawAzureBlobUrl).map(g=>g.rawAzureBlobUrl)),this.showInspection=!0}))}})}showConfirmationPopup(){this.dialog.open(et.I,{disableClose:!0,data:{message:"The estimate values are 0. Press continue to navigate to gtmotive."},backdropClass:"confirmation-popup-backdrop"}).afterClosed().subscribe({next:i=>{console.log(i),i&&this.redirectToGtEstimate()}})}toggleOption(t){this.dropdownModelFilter="reject"===t.toLowerCase()||"rejected"===t.toLowerCase()?Object.assign(Object.assign({},this.dropdownModelFilter),{options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}]}):"approved"===t.toLowerCase()?Object.assign(Object.assign({},this.dropdownModelFilter),{options:[{label:"Complete",dropdownItemIcon:"folderplus"}]}):"complete"===t.toLowerCase()?Object.assign(Object.assign({},this.dropdownModelFilter),{options:[]}):Object.assign(Object.assign({},this.dropdownModelFilter),{options:[{label:"Edit Calculations",dropdownItemIcon:"edit"},{label:"Reject",dropdownItemIcon:"cross",color:"var(--xa-red) !important"},{label:"Approve",dropdownItemIcon:"check"},{label:"Complete",dropdownItemIcon:"folderplus"}]})}booking(t,i){"create"===t?this.router.navigate(["repair/booking/0"],{queryParams:{caseId:this.caseGuid}}):this.router.navigate([`repair/booking/${i}`])}ngOnDestroy(){this.commonService.accessRight.unsubscribe(),this.monitorService.logEvent("ngOnDestroy",["ChqRepairEstimateComponent","addenda-quote"]),this.commonService.isViewOnly=!1}isGTEstimate(){return"GTMotive"===this.estimateSource}isPendingApproval(){var t;return"pendingapproval"===(null===(t=this.caseStatus)||void 0===t?void 0:t.toLowerCase())}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.sBO),e.Y36(Z.v),e.Y36(F.n),e.Y36(tt.H),e.Y36(M.gz),e.Y36(D.M),e.Y36(B.a),e.Y36(E.uw),e.Y36(M.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chq-repair-estimate"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Xe.y,5),e.Gf(at,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.elementRef=o.first),e.iGM(o=e.CRH())&&(i.anchor=o.first)}},hostBindings:function(t,i){1&t&&e.NdJ("visibilitychange",function(a){return i.handleVisibilityChange(a)},!1,e.evT)("popstate",function(a){return i.onPopState(a)},!1,e.Jf7)},inputs:{customerFormData:"customerFormData"},decls:3,vars:3,consts:[["class","estimate-container",3,"ngClass",4,"ngIf"],[3,"hideNext","caseDetail","backEvent",4,"ngIf"],[4,"ngIf"],[1,"estimate-container",3,"ngClass"],[1,"header",3,"chqModel","showButton","back"],["class","info-container",4,"ngIf"],[1,"estimate-block","row"],[1,"quote-estimate-step","col-12"],["serviceType","repair",3,"estimateResponse","editEstimate","estimateSource","i18n","downloadPdf",4,"ngIf"],[3,"showLoading"],[1,"footer-full-wrapper"],[1,"footer-image-wrapper"],[1,"image-wrapper"],["src","assets/img/addenda-quote.png"],["class","footer-button-wrapper show-md",4,"ngIf"],["class","footer-button-wrapper show-sm",4,"ngIf"],["serviceType","quote",3,"history","isLoading","toggleExpand"],[1,"info-container"],[1,"info-block"],[1,"avatar"],[1,"text-block"],[1,"vehicle-block"],["src","assets/img/default_car.png"],[3,"href","hidden","download"],["anchor",""],["serviceType","repair",3,"estimateResponse","editEstimate","estimateSource","i18n","downloadPdf"],[1,"footer-button-wrapper","show-md"],[3,"buttonModel","click",4,"ngIf"],[3,"buttonModel",4,"ngIf"],[3,"buttonModel","click"],[3,"buttonModel"],[1,"footer-button-wrapper","show-sm"],["class","option-dropdown",3,"dropdownModel","selected",4,"ngIf"],[1,"option-dropdown",3,"dropdownModel","selected"],[3,"hideNext","caseDetail","backEvent"]],template:function(t,i){1&t&&(e.YNc(0,bt,14,12,"div",0),e.YNc(1,Mt,1,2,"damage-analysis",1),e.YNc(2,xt,1,0,"no-access-error",2)),2&t&&(e.Q6J("ngIf",!i.showNoAccess),e.xp6(1),e.Q6J("ngIf",i.showDamageAnalysis),e.xp6(1),e.Q6J("ngIf",i.showNoAccess))},directives:[C.O5,C.mk,k._,G.h,it.r,I.E,ot.I,nt.wm,j.U],styles:[".estimate-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]{display:flex;flex-direction:row}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]{padding:10px 32px;display:flex;flex-direction:row;align-items:center;border:1px solid var(--xa-light-gray);flex:1}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]{margin-left:12px;display:flex;flex-direction:column}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:20px;line-height:25px;display:flex;align-items:center;letter-spacing:-.25px}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:auto;width:auto;max-height:45px;max-width:102px}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .info-block[_ngcontent-%COMP%]{border-left:none}.estimate-container[_ngcontent-%COMP%]   .info-container[_ngcontent-%COMP%]   .vehicle-block[_ngcontent-%COMP%]{border-left:none;border-right:none}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]{display:flex;margin:0}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]{padding:20px 20px 0 0;position:relative}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .image-slider[_ngcontent-%COMP%]{padding:20px 0 0 10px;position:relative}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]{border-right:1px solid var(--xa-light-gray)}.estimate-container[_ngcontent-%COMP%]   .estimate-block[_ngcontent-%COMP%]   .estimate-tables[_ngcontent-%COMP%]   chq-customloader[_ngcontent-%COMP%]{margin:auto}.hidden[_ngcontent-%COMP%]{display:none!important}.avatar[_ngcontent-%COMP%]{width:60px;height:61px;background:rgba(26,34,51,.2);border-radius:100px;display:flex;flex-direction:row;justify-content:center;align-items:center}.avatar[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:20px;line-height:25px}.show-sm[_ngcontent-%COMP%]{display:none!important}@media (max-width: 985px){.show-md[_ngcontent-%COMP%]{display:none!important}.show-sm[_ngcontent-%COMP%]{display:flex!important}}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container{border:1px solid var(--xa-form-border);border-radius:8px;background:var(--xa-white);margin-top:25px;margin-bottom:25px;padding:0 32px 32px}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container chq-customloader{margin:auto}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-label{margin-top:25px}.quote-estimate-step[_ngcontent-%COMP%]     .estimate-label, .quote-estimate-step[_ngcontent-%COMP%]     .estimate-main-container{margin-left:calc(6px + 1.5vw);margin-right:calc(5px + 1.5vw)}.option-dropdown[_ngcontent-%COMP%]{width:180px}"]}),n})();var z=d(42895),J=d(39075),w=d(74743),yt=d(88784),qt=d(44466),Dt=d(4704),It=d(64307);let X=(()=>{class n extends J.hm{}return n.\u0275fac=function(){let c;return function(i){return(c||(c=e.n5z(n)))(i||n)}}(),n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();const Tt=[{path:"",component:H,canDeactivate:[z.I],resolve:{version:w.n}},{path:"vehicle",component:Se,resolve:{version:w.n}},{path:"document",component:It.O,resolve:{version:w.n}},{path:"photos",component:Dt.X,resolve:{version:w.n}},{path:"estimate",component:wt,resolve:{version:w.n}},{path:"refresh",component:H}];let Pt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[z.I,{provide:J.ok,useClass:X}],imports:[[J.t6,C.ez,L.Ps,$.p,qt.m,M.Bz.forChild(Tt),K.H,yt.T,T.aw]]}),n})()}}]);